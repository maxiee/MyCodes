<h1>Intents and Intent Filters</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Types">
      Intent Types
     </a>
    </li>
    <li>
     <a href="#Building">
      Building an Intent
     </a>
     <ol>
      <li>
       <a href="#ExampleExplicit">
        Example explicit intent
       </a>
      </li>
      <li>
       <a href="#ExampleSend">
        Example implicit intent
       </a>
      </li>
      <li>
       <a href="#ForceChooser">
        Forcing an app chooser
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Receiving">
      Receiving an Implicit Intent
     </a>
     <ol>
      <li>
       <a href="#ExampleFilters">
        Example filters
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#PendingIntent">
      Using a Pending Intent
     </a>
    </li>
    <li>
     <a href="#Resolution">
      Intent Resolution
     </a>
     <ol>
      <li>
       <a href="#ActionTest">
        Action test
       </a>
      </li>
      <li>
       <a href="#CategoryTest">
        Category test
       </a>
      </li>
      <li>
       <a href="#DataTest">
        Data test
       </a>
      </li>
      <li>
       <a href="#imatch">
        Intent matching
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/training/basics/intents/index.html">
      Interacting with Other Apps
     </a>
    </li>
    <li>
     <a href="/training/sharing/index.html">
      Sharing Content
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  An
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  is a messaging object you can use to request an action
from another
  <a href="/guide/components/fundamentals.html#Components">
   app component
  </a>
  .
Although intents facilitate communication between components in several ways, there are three
fundamental use-cases:
 </p>
 <ul>
  <li>
   <b>
    To start an activity:
   </b>
   <p>
    An
    <code>
     <a href="/reference/android/app/Activity.html">
      Activity
     </a>
    </code>
    represents a single screen in an app. You can start a new
instance of an
    <code>
     <a href="/reference/android/app/Activity.html">
      Activity
     </a>
    </code>
    by passing an
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    to
    <code>
     <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
      startActivity()
     </a>
    </code>
    . The
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    describes the activity to start and carries any necessary data.
   </p>
   <p>
    If you want to receive a result from the activity when it finishes,
call
    <code>
     <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
      startActivityForResult()
     </a>
    </code>
    . Your activity receives the result
as a separate
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    object in your activity's
    <code>
     <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
      onActivityResult()
     </a>
    </code>
    callback.
For more information, see the
    <a href="/guide/components/activities.html">
     Activities
    </a>
    guide.
   </p>
  </li>
  <li>
   <b>
    To start a service:
   </b>
   <p>
    A
    <code>
     <a href="/reference/android/app/Service.html">
      Service
     </a>
    </code>
    is a component that performs operations in the background
without a user interface. You can start a service to perform a one-time operation
(such as download a file) by passing an
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    to
    <code>
     <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
      startService()
     </a>
    </code>
    . The
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    describes the service to start and carries any necessary data.
   </p>
   <p>
    If the service is designed with a client-server interface, you can bind to the service
from another component by passing an
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    to
    <code>
     <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
      bindService()
     </a>
    </code>
    . For more information, see the
    <a href="/guide/components/services.html">
     Services
    </a>
    guide.
   </p>
  </li>
  <li>
   <b>
    To deliver a broadcast:
   </b>
   <p>
    A broadcast is a message that any app can receive. The system delivers various
broadcasts for system events, such as when the system boots up or the device starts charging.
You can deliver a broadcast to other apps by passing an
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    to
    <code>
     <a href="/reference/android/content/Context.html#sendBroadcast(android.content.Intent)">
      sendBroadcast()
     </a>
    </code>
    ,
    <code>
     <a href="/reference/android/content/Context.html#sendOrderedBroadcast(android.content.Intent, java.lang.String)">
      sendOrderedBroadcast()
     </a>
    </code>
    , or
    <code>
     <a href="/reference/android/content/Context.html#sendStickyBroadcast(android.content.Intent)">
      sendStickyBroadcast()
     </a>
    </code>
    .
   </p>
  </li>
 </ul>
 <h2 id="Types">
  Intent Types
 </h2>
 <p>
  There are two types of intents:
 </p>
 <ul>
  <li>
   <b>
    Explicit intents
   </b>
   specify the component to start by name (the
fully-qualified class name). You'll typically use an explicit intent to start a component in
your own app, because you know the class name of the activity or service you want to start. For
example, start a new activity in response to a user action or start a service to download
a file in the background.
  </li>
  <li>
   <b>
    Implicit intents
   </b>
   do not name a specific component, but instead declare a general action
to perform, which allows a component from another app to handle it. For example, if you want to
show the user a location on a map, you can use an implicit intent to request that another capable
app show a specified location on a map.
  </li>
 </ul>
 <p>
  When you create an explicit intent to start an activity or service, the system immediately
starts the app component specified in the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object.
 </p>
 <div class="figure" style="width:446px">
  <img alt="" src="http://developer.android.com/images/components/intent-filters@2x.png" width="446"/>
  <p class="img-caption">
   <strong>
    Figure 1.
   </strong>
   Illustration of how an implicit intent is
delivered through the system to start another activity:
   <b>
    [1]
   </b>
   <em>
    Activity A
   </em>
   creates an
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   with an action description and passes it to
   <code>
    <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
     startActivity()
    </a>
   </code>
   .
   <b>
    [2]
   </b>
   The Android System searches all
apps for an intent filter that matches the intent. When a match is found,
   <b>
    [3]
   </b>
   the system
starts the matching activity (
   <em>
    Activity B
   </em>
   ) by invoking its
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
   method and passing it the
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   .
  </p>
 </div>
 <p>
  When you create an implicit intent, the Android system finds the appropriate component to start
by comparing the contents of the intent to the
  <em>
   intent filters
  </em>
  declared in the
  <a href="/guide/topics/manifest/manifest-intro.html">
   manifest file
  </a>
  of other apps on the
device. If the intent matches an intent filter, the system starts that component and delivers it
the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object. If multiple intent filters are compatible, the system
displays a dialog so the user can pick which app to use.
 </p>
 <p>
  An intent filter is an expression in an app's manifest file that
specifies the type of intents that the component
would like to receive. For instance, by declaring an intent filter for an activity,
you make it possible for other apps to directly start your activity with a certain kind of intent.
Likewise, if you do
  <em>
   not
  </em>
  declare any intent filters for an activity, then it can be started
only with an explicit intent.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  To ensure your app is secure, always use an explicit
intent when starting a
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  and do not
declare intent filters for your services. Using an implicit intent to start a service is a
security hazard because you cannot be certain what service will respond to the intent,
and the user cannot see which service starts. Beginning with Android 5.0 (API level 21), the system
throws an exception if you call
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  with an implicit intent.
 </p>
 <h2 id="Building">
  Building an Intent
 </h2>
 <p>
  An
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object carries information that the Android system uses
to determine which component to start (such as the exact component name or component
category that should receive the intent), plus information that the recipient component uses in
order to properly perform the action (such as the action to take and the data to act upon).
 </p>
 <p>
  The primary information contained in an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  is the following:
 </p>
 <dl>
  <dt>
   <b>
    Component name
   </b>
  </dt>
  <dd>
   The name of the component to start.
   <p>
    This is optional, but it's the critical piece of information that makes an intent
    <b>
     explicit
    </b>
    , meaning that the intent should be delivered only to the app component
defined by the component name. Without a component name, the intent is
    <b>
     implicit
    </b>
    and the
system decides which component should receive the intent based on the other intent information
(such as the action, data, and category&mdash;described below). So if you need to start a specific
component in your app, you should specify the component name.
   </p>
   <p class="note">
    <strong>
     Note:
    </strong>
    When starting a
    <code>
     <a href="/reference/android/app/Service.html">
      Service
     </a>
    </code>
    , you should
    <strong>
     always specify the component name
    </strong>
    . Otherwise, you cannot be certain what service
will respond to the intent, and the user cannot see which service starts.
   </p>
   <p>
    This field of the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    is a
    <code>
     <a href="/reference/android/content/ComponentName.html">
      ComponentName
     </a>
    </code>
    object, which you can specify using a fully
qualified class name of the target component, including the package name of the app. For example,
    <code>
     com.example.ExampleActivity
    </code>
    . You can set the component name with
    <code>
     <a href="/reference/android/content/Intent.html#setComponent(android.content.ComponentName)">
      setComponent()
     </a>
    </code>
    ,
    <code>
     <a href="/reference/android/content/Intent.html#setClass(android.content.Context, java.lang.Class&lt;?&gt;)">
      setClass()
     </a>
    </code>
    ,
    <code>
     <a href="/reference/android/content/Intent.html#setClassName(java.lang.String, java.lang.String)">
      setClassName()
     </a>
    </code>
    , or with the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    constructor.
   </p>
  </dd>
  <p>
  </p>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   A string that specifies the generic action to perform (such as
   <em>
    view
   </em>
   or
   <em>
    pick
   </em>
   ).
   <p>
    In the case of a broadcast intent, this is the action that took place and is being reported.
The action largely determines how the rest of the intent is structured&mdash;particularly
what is contained in the data and extras.
   </p>
   <p>
    You can specify your own actions for use by intents within your app (or for use by other
apps to invoke components in your app), but you should usually use action constants
defined by the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    class or other framework classes. Here are some
common actions for starting an activity:
   </p>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_VIEW">
       ACTION_VIEW
      </a>
     </code>
    </dt>
    <dd>
     Use this action in an intent with
     <code>
      <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
       startActivity()
      </a>
     </code>
     when you have some information that
   an activity can show to the user, such as a photo to view in a gallery app, or an address to
   view in a map app.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_SEND">
       ACTION_SEND
      </a>
     </code>
    </dt>
    <dd>
     Also known as the "share" intent, you should use this in an intent with
     <code>
      <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
       startActivity()
      </a>
     </code>
     when you have some data that the user can
   share through another app, such as an email app or social sharing app.
    </dd>
   </dl>
   <p>
    See the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    class reference for more
constants that define generic actions.  Other actions are defined
elsewhere in the Android framework, such as in
    <code>
     <a href="/reference/android/provider/Settings.html">
      Settings
     </a>
    </code>
    for actions
that open specific screens in the system's Settings app.
   </p>
   <p>
    You can specify the action for an intent with
    <code>
     <a href="/reference/android/content/Intent.html#setAction(java.lang.String)">
      setAction()
     </a>
    </code>
    or with an
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    constructor.
   </p>
   <p>
    If you define your own actions, be sure to include your app's package name
as a prefix. For example:
   </p>
   <pre>static final String ACTION_TIMETRAVEL = "com.example.action.TIMETRAVEL";</pre>
  </dd>
  <dt>
   <b>
    Data
   </b>
  </dt>
  <dd>
   The URI (a
   <code>
    <a href="/reference/android/net/Uri.html">
     Uri
    </a>
   </code>
   object) that references the data to be acted on and/or the
MIME type of that data. The type of data supplied is generally dictated by the intent's action. For
example, if the action is
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_EDIT">
     ACTION_EDIT
    </a>
   </code>
   , the data should contain the
URI of the document to edit.
   <p>
    When creating an intent,
it's often important to specify the type of data (its MIME type) in addition to its URI.
For example, an activity that's able to display images probably won't be able
to play an audio file, even though the URI formats could be similar.
So specifying the MIME type of your data helps the Android
system find the best component to receive your intent.
However, the MIME type can sometimes be inferred from the URI&mdash;particularly when the data is a
    <code>
     content:
    </code>
    URI, which indicates the data is located on the device and controlled by a
    <code>
     <a href="/reference/android/content/ContentProvider.html">
      ContentProvider
     </a>
    </code>
    , which makes the data MIME type visible to the system.
   </p>
   <p>
    To set only the data URI, call
    <code>
     <a href="/reference/android/content/Intent.html#setData(android.net.Uri)">
      setData()
     </a>
    </code>
    .
To set only the MIME type, call
    <code>
     <a href="/reference/android/content/Intent.html#setType(java.lang.String)">
      setType()
     </a>
    </code>
    . If necessary, you
can set both explicitly with
    <code>
     <a href="/reference/android/content/Intent.html#setDataAndType(android.net.Uri, java.lang.String)">
      setDataAndType()
     </a>
    </code>
    .
   </p>
   <p class="caution">
    <strong>
     Caution:
    </strong>
    If you want to set both the URI and MIME type,
    <strong>
     do not
    </strong>
    call
    <code>
     <a href="/reference/android/content/Intent.html#setData(android.net.Uri)">
      setData()
     </a>
    </code>
    and
    <code>
     <a href="/reference/android/content/Intent.html#setType(java.lang.String)">
      setType()
     </a>
    </code>
    because they each nullify the value of the other.
Always use
    <code>
     <a href="/reference/android/content/Intent.html#setDataAndType(android.net.Uri, java.lang.String)">
      setDataAndType()
     </a>
    </code>
    to set both
URI and MIME type.
   </p>
  </dd>
  <p>
  </p>
  <dt>
   <b>
    Category
   </b>
  </dt>
  <dd>
   A string containing additional information about the kind of component
that should handle the intent.  Any number of category descriptions can be
placed in an intent, but most intents do not require a category.
Here are some common categories:
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#CATEGORY_BROWSABLE">
       CATEGORY_BROWSABLE
      </a>
     </code>
    </dt>
    <dd>
     The target activity allows itself to be started by a web browser to display data
       referenced by a link&mdash;such as an image or an e-mail message.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#CATEGORY_LAUNCHER">
       CATEGORY_LAUNCHER
      </a>
     </code>
    </dt>
    <dd>
     The activity is the initial activity of a task and is listed in
       the system's application launcher.
    </dd>
   </dl>
   <p>
    See the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    class description for the full list of
categories.
   </p>
   <p>
    You can specify a category with
    <code>
     <a href="/reference/android/content/Intent.html#addCategory(java.lang.String)">
      addCategory()
     </a>
    </code>
    .
   </p>
  </dd>
 </dl>
 <p>
  These properties listed above (component name, action, data, and category) represent the
defining characteristics of an intent. By reading these properties, the Android system
is able to resolve which app component it should start.
 </p>
 <p>
  However, an intent can carry additional information that does not affect
how it is resolved to an app component. An intent can also supply:
 </p>
 <dl>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   Key-value pairs that carry additional information required to accomplish the requested action.
Just as some actions use particular kinds of data URIs, some actions also use particular extras.
   <p>
    You can add extra data with various
    <code>
     <a href="/reference/android/content/Intent.html#putExtra(java.lang.String, android.os.Bundle)">
      putExtra()
     </a>
    </code>
    methods,
each accepting two parameters: the key name and the value.
You can also create a
    <code>
     <a href="/reference/android/os/Bundle.html">
      Bundle
     </a>
    </code>
    object with all the extra data, then insert
the
    <code>
     <a href="/reference/android/os/Bundle.html">
      Bundle
     </a>
    </code>
    in the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    with
    <code>
     <a href="/reference/android/content/Intent.html#putExtras(android.content.Intent)">
      putExtras()
     </a>
    </code>
    .
   </p>
   <p>
    For example, when creating an intent to send an email with
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_SEND">
      ACTION_SEND
     </a>
    </code>
    , you can specify the "to" recipient with the
    <code>
     <a href="/reference/android/content/Intent.html#EXTRA_EMAIL">
      EXTRA_EMAIL
     </a>
    </code>
    key, and specify the "subject" with the
    <code>
     <a href="/reference/android/content/Intent.html#EXTRA_SUBJECT">
      EXTRA_SUBJECT
     </a>
    </code>
    key.
   </p>
   <p>
    The
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    class specifies many
    <code>
     EXTRA_*
    </code>
    constants
for standardized data types. If you need to declare your own extra keys (for intents that
your app receives), be sure to include your app's package name
as a prefix. For example:
   </p>
   <pre>static final String EXTRA_GIGAWATTS = "com.example.EXTRA_GIGAWATTS";</pre>
  </dd>
  <dt>
   <b>
    Flags
   </b>
  </dt>
  <dd>
   Flags defined in the
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   class that function as metadata for the
intent. The flags may instruct the Android system how to launch an activity (for example, which
   <a href="/guide/components/tasks-and-back-stack.html">
    task
   </a>
   the activity should belong
to) and how to treat it after it's launched (for example, whether it belongs in the list of recent
activities).
   <p>
    For more information, see the
    <code>
     <a href="/reference/android/content/Intent.html#setFlags(int)">
      setFlags()
     </a>
    </code>
    method.
   </p>
  </dd>
 </dl>
 <h3 id="ExampleExplicit">
  Example explicit intent
 </h3>
 <p>
  An explicit intent is one that you use to launch a specific app component, such as
a particular activity or service in your app. To create an explicit intent, define
the component name for the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object&mdash;all
other intent properties are optional.
 </p>
 <p>
  For example, if you built a service in your app, named
  <code>
   DownloadService
  </code>
  ,
designed to download a file from the web, you can start it with the following code:
 </p>
 <pre>
// Executed in an Activity, so 'this' is the <code><a href="/reference/android/content/Context.html">Context</a></code>
// The fileUrl is a string URL, such as "http://www.example.com/image.png"
Intent downloadIntent = new Intent(this, DownloadService.class);
downloadIntent.setData(<code><a href="/reference/android/net/Uri.html#parse(java.lang.String)">Uri.parse</a></code>(fileUrl));
startService(downloadIntent);
</pre>
 <p>
  The
  <code>
   <a href="/reference/android/content/Intent.html#Intent(android.content.Context, java.lang.Class&lt;?&gt;)">
    Intent(Context, Class)
   </a>
  </code>
  constructor supplies the app
  <code>
   <a href="/reference/android/content/Context.html">
    Context
   </a>
  </code>
  and the
component a
  <code>
   <a href="/reference/java/lang/Class.html">
    Class
   </a>
  </code>
  object. As such,
this intent explicitly starts the
  <code>
   DownloadService
  </code>
  class in the app.
 </p>
 <p>
  For more information about building and starting a service, see the
  <a href="/guide/components/services.html">
   Services
  </a>
  guide.
 </p>
 <h3 id="ExampleSend">
  Example implicit intent
 </h3>
 <p>
  An implicit intent specifies an action that can invoke any app on the device able
to perform the action. Using an implicit intent is useful when your app cannot perform the
action, but other apps probably can and you'd like the user to pick which app to use.
 </p>
 <p>
  For example, if you have content you want the user to share with other people, create an intent
with the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_SEND">
    ACTION_SEND
   </a>
  </code>
  action
and add extras that specify the content to share. When you call
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  with that intent, the user can
pick an app through which to share the content.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  It's possible that a user won't have
  <em>
   any
  </em>
  apps that handle the implicit intent you send to
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . If that happens, the call will fail and your app will crash. To verify
that an activity will receive the intent, call
  <code>
   <a href="/reference/android/content/Intent.html#resolveActivity(android.content.pm.PackageManager)">
    resolveActivity()
   </a>
  </code>
  on your
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object. If the result is non-null,
then there is at least one app that can handle the intent and it's safe to call
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . If the result is null,
you should not use the intent and, if possible, you should disable the feature that issues
the intent.
 </p>
 <pre>
// Create the text message with a string
Intent sendIntent = new Intent();
sendIntent.setAction(Intent.ACTION_SEND);
sendIntent.putExtra(Intent.EXTRA_TEXT, textMessage);
sendIntent.setType(<code><a href="/reference/org/apache/http/protocol/HTTP.html#PLAIN_TEXT_TYPE">HTTP.PLAIN_TEXT_TYPE</a></code>); // "text/plain" MIME type

// Verify that the intent will resolve to an activity
if (sendIntent.resolveActivity(getPackageManager()) != null) {
    startActivity(sendIntent);
}
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  In this case, a URI is not used, but the intent's data type
is declared to specify the content carried by the extras.
 </p>
 <p>
  When
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  is called, the system
examines all of the installed apps to determine which ones can handle this kind of intent (an
intent with the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_SEND">
    ACTION_SEND
   </a>
  </code>
  action and that carries "text/plain"
data). If there's only one app that can handle it, that app opens immediately and is given the
intent. If multiple activities accept the intent, the system
displays a dialog so the user can pick which app to use..
 </p>
 <div class="figure" style="width:200px">
  <img alt="" src="http://developer.android.com/images/training/basics/intent-chooser.png"/>
  <p class="img-caption">
   <strong>
    Figure 2.
   </strong>
   A chooser dialog.
  </p>
 </div>
 <h3 id="ForceChooser">
  Forcing an app chooser
 </h3>
 <p>
  When there is more than one app that responds to your implicit intent,
the user can select which app to use and make that app the default choice for the
action. This is nice when performing an action for which the user
probably wants to use the same app from now on, such as when opening a web page (users
often prefer just one web browser) .
 </p>
 <p>
  However, if multiple apps can respond to the intent and the user might want to use a different
app each time, you should explicitly show a chooser dialog. The chooser dialog asks the
user to select which app to use for the action every time (the user cannot select a default app for
the action). For example, when your app performs "share" with the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_SEND">
    ACTION_SEND
   </a>
  </code>
  action, users may want to share using a different app depending
on their current situation, so you should always use the chooser dialog, as shown in figure 2.
 </p>
 <p>
  To show the chooser, create an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  using
  <code>
   <a href="/reference/android/content/Intent.html#createChooser(android.content.Intent, java.lang.CharSequence)">
    createChooser()
   </a>
  </code>
  and pass it to
  <code>
   <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . For example:
 </p>
 <pre>
Intent sendIntent = new Intent(Intent.ACTION_SEND);
...

// Always use string resources for UI text.
// This says something like "Share this photo with"
String title = getResources().getString(R.string.chooser_title);
// Create intent to show the chooser dialog
Intent chooser = Intent.createChooser(sendIntent, title);

// Verify the original intent will resolve to at least one activity
if (sendIntent.resolveActivity(getPackageManager()) != null) {
    startActivity(chooser);
}
</pre>
 <p>
  This displays a dialog with a list of apps that respond to the intent passed to the
  <code>
   <a href="/reference/android/content/Intent.html#createChooser(android.content.Intent, java.lang.CharSequence)">
    createChooser()
   </a>
  </code>
  method and uses the supplied text as the
dialog title.
 </p>
 <h2 id="Receiving">
  Receiving an Implicit Intent
 </h2>
 <p>
  To advertise which implicit intents your app can receive, declare one or more intent filters for
each of your app components with an
  <a href="/guide/topics/manifest/intent-filter-element.html">
   <code>
    &lt;intent-filter&gt;
   </code>
  </a>
  element in your
  <a href="/guide/topics/manifest/manifest-intro.html">
   manifest file
  </a>
  .
Each intent filter specifies the type of intents it accepts based on the intent's action,
data, and category. The system will deliver an implicit intent to your app component only if the
intent can pass through one of your intent filters.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  An explicit intent is always delivered to its target,
regardless of any intent filters the component declares.
 </p>
 <p>
  An app component should declare separate filters for each unique job it can do.
For example, one activity in an image gallery app may have two filters: one filter
to view an image, and another filter to edit an image. When the activity starts,
it inspects the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  and decides how to behave based on the information
in the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  (such as to show the editor controls or not).
 </p>
 <p>
  Each intent filter is defined by an
  <a href="/guide/topics/manifest/intent-filter-element.html">
   <code>
    &lt;intent-filter&gt;
   </code>
  </a>
  element in the app's manifest file, nested in the corresponding app component (such
as an
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element). Inside the
  <a href="/guide/topics/manifest/intent-filter-element.html">
   <code>
    &lt;intent-filter&gt;
   </code>
  </a>
  ,
you can specify the type of intents to accept using one or more
of these three elements:
 </p>
 <dl>
  <dt>
   <a href="/guide/topics/manifest/action-element.html">
    <code>
     &lt;action&gt;
    </code>
   </a>
  </dt>
  <dd>
   Declares the intent action accepted, in the
   <code>
    name
   </code>
   attribute. The value
  must be the literal string value of an action, not the class constant.
  </dd>
  <dt>
   <a href="/guide/topics/manifest/data-element.html">
    <code>
     &lt;data&gt;
    </code>
   </a>
  </dt>
  <dd>
   Declares the type of data accepted, using one or more attributes that specify various
  aspects of the data URI (
   <code>
    scheme
   </code>
   ,
   <code>
    host
   </code>
   ,
   <code>
    port
   </code>
   ,
   <code>
    path
   </code>
   , etc.) and MIME type.
  </dd>
  <dt>
   <a href="/guide/topics/manifest/category-element.html">
    <code>
     &lt;category&gt;
    </code>
   </a>
  </dt>
  <dd>
   Declares the intent category accepted, in the
   <code>
    name
   </code>
   attribute. The value
  must be the literal string value of an action, not the class constant.
   <p class="note">
    <strong>
     Note:
    </strong>
    In order to receive implicit intents, you
    <strong>
     must include
    </strong>
    the
    <code>
     <a href="/reference/android/content/Intent.html#CATEGORY_DEFAULT">
      CATEGORY_DEFAULT
     </a>
    </code>
    category in the intent filter. The methods
    <code>
     <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
      startActivity()
     </a>
    </code>
    and
    <code>
     <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
      startActivityForResult()
     </a>
    </code>
    treat all intents
  as if they declared the
    <code>
     <a href="/reference/android/content/Intent.html#CATEGORY_DEFAULT">
      CATEGORY_DEFAULT
     </a>
    </code>
    category.
  If you do not declare this category in your intent filter, no implicit intents will resolve to
  your activity.
   </p>
  </dd>
 </dl>
 <p>
  For example, here's an activity declaration with an intent filter to receive an
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_SEND">
    ACTION_SEND
   </a>
  </code>
  intent when the data type is text:
 </p>
 <pre>
&lt;activity android:name="ShareActivity"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SEND"/&gt;
        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
        &lt;data android:mimeType="text/plain"/&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p>
  It's okay to create a filter that includes more than one instance of
  <a href="/guide/topics/manifest/action-element.html">
   <code>
    &lt;action&gt;
   </code>
  </a>
  ,
  <a href="/guide/topics/manifest/data-element.html">
   <code>
    &lt;data&gt;
   </code>
  </a>
  , or
  <a href="/guide/topics/manifest/category-element.html">
   <code>
    &lt;category&gt;
   </code>
  </a>
  .
If you do, you simply need to be certain that the component can handle any and all combinations
of those filter elements.
 </p>
 <p>
  When you want to handle multiple kinds of intents, but only in specific combinations of
action, data, and category type, then you need to create multiple intent filters.
 </p>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h2>
    Restricting access to components
   </h2>
   <p>
    Using an intent filter is not a secure way to prevent other apps from starting
your components. Although intent filters restrict a component to respond to only
certain kinds of implicit intents, another app can potentially start your app component
by using an explicit intent if the developer determines your component names.
If it's important that
    <em>
     only your own app
    </em>
    is able to start one of your components,
set the
    <a href="/guide/topics/manifest/activity-element.html#exported">
     <code>
      exported
     </code>
    </a>
    attribute to
    <code>
     "false"
    </code>
    for that component.
   </p>
  </div>
 </div>
 <p>
  An implicit intent is tested against a filter by comparing the intent to each of the
three elements. To be delivered to the component, the intent must pass all three tests.
If it fails to match even one of them, the Android system won't deliver the intent to the
component.  However, because a component may have multiple intent filters, an intent that does
not pass through one of a component's filters might make it through on another filter.
More information about how the system resolves intents is provided in the section below
about
  <a href="#Resolution">
   Intent Resolution
  </a>
  .
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  To avoid inadvertently running a different app's
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  , always use an explicit intent to start your own service and do not
declare intent filters for your service.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  For all activities, you must declare your intent filters in the manifest file.
However, filters for broadcast receivers can be registered dynamically by calling
  <code>
   <a href="/reference/android/content/Context.html#registerReceiver(android.content.BroadcastReceiver, android.content.IntentFilter, java.lang.String, android.os.Handler)">
    registerReceiver()
   </a>
  </code>
  . You can then unregister the receiver with
  <code>
   <a href="/reference/android/content/Context.html#unregisterReceiver(android.content.BroadcastReceiver)">
    unregisterReceiver()
   </a>
  </code>
  . Doing so allows your app
to listen for specific broadcasts during only a specified period of time while your app
is running.
 </p>
 <h3 id="ExampleFilters">
  Example filters
 </h3>
 <p>
  To better understand some of the intent filter behaviors, look at the following snippet
from the manifest file of a social-sharing app.
 </p>
 <pre>
&lt;activity android:name="MainActivity"&gt;
    &lt;!-- This activity is the main entry, should appear in app launcher --&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.MAIN" /&gt;
        &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;

&lt;activity android:name="ShareActivity"&gt;
    &lt;!-- This activity handles "SEND" actions with text data --&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SEND"/&gt;
        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
        &lt;data android:mimeType="text/plain"/&gt;
    &lt;/intent-filter&gt;
    &lt;!-- This activity also handles "SEND" and "SEND_MULTIPLE" with media data --&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SEND"/&gt;
        &lt;action android:name="android.intent.action.SEND_MULTIPLE"/&gt;
        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
        &lt;data android:mimeType="application/vnd.google.panorama360+jpg"/&gt;
        &lt;data android:mimeType="image/*"/&gt;
        &lt;data android:mimeType="video/*"/&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p>
  The first activity,
  <code>
   MainActivity
  </code>
  , is the app's main entry point&mdash;the activity that
opens when the user initially launches the app with the launcher icon:
 </p>
 <ul>
  <li>
   The
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_MAIN">
     ACTION_MAIN
    </a>
   </code>
   action
  indicates this is the main entry point and does not expect any intent data.
  </li>
  <li>
   The
   <code>
    <a href="/reference/android/content/Intent.html#CATEGORY_LAUNCHER">
     CATEGORY_LAUNCHER
    </a>
   </code>
   category indicates that this activity's
  icon should be placed in the system's app launcher. If the
   <a href="/guide/topics/manifest/activity-element.html">
    <code>
     &lt;activity&gt;
    </code>
   </a>
   element
  does not specify an icon with
   <code>
    icon
   </code>
   , then the system uses the icon from the
   <a href="/guide/topics/manifest/application-element.html">
    <code>
     &lt;application&gt;
    </code>
   </a>
   element.
  </li>
 </ul>
 <p>
  These two must be paired together in order for the activity to appear in the app launcher.
 </p>
 <p>
  The second activity,
  <code>
   ShareActivity
  </code>
  , is intended to facilitate sharing text and media
content. Although users might enter this activity by navigating to it from
  <code>
   MainActivity
  </code>
  ,
they can also enter
  <code>
   ShareActivity
  </code>
  directly from another app that issues an implicit
intent matching one of the two intent filters.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  The MIME type,
  <a href="https://developers.google.com/panorama/android/">
   <code>
    application/vnd.google.panorama360+jpg
   </code>
  </a>
  , is a special data type that specifies
panoramic photos, which you can handle with the
  <a href="/reference/com/google/android/gms/panorama/package-summary.html">
   Google
panorama
  </a>
  APIs.
 </p>
 <h2 id="PendingIntent">
  Using a Pending Intent
 </h2>
 <p>
  A
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  object is a wrapper around an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object. The primary purpose of a
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  is to grant permission to a foreign application
to use the contained
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  as if it were executed from your
app's own process.
 </p>
 <p>
  Major use cases for a pending intent include:
 </p>
 <ul>
  <li>
   Declare an intent to be executed when the user performs an action with your
   <a href="/guide/topics/ui/notifiers/notifications.html">
    Notification
   </a>
   (the Android system's
   <code>
    <a href="/reference/android/app/NotificationManager.html">
     NotificationManager
    </a>
   </code>
   executes the
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   ).
  </li>
  <li>
   Declare an intent to be executed when the user performs an action with your
   <a href="/guide/topics/appwidgets/index.html">
    App Widget
   </a>
   (the Home screen app executes the
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   ).
  </li>
  <li>
   Declare an intent to be executed at a specified time in the future (the Android
  system's
   <code>
    <a href="/reference/android/app/AlarmManager.html">
     AlarmManager
    </a>
   </code>
   executes the
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   ).
  </li>
 </ul>
 <p>
  Because each
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object is designed to be handled by a specific
type of app component (either an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  , a
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  , or
a
  <code>
   <a href="/reference/android/content/BroadcastReceiver.html">
    BroadcastReceiver
   </a>
  </code>
  ), so too must a
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  be
created with the same consideration. When using a pending intent, your app will not
execute the intent with a call such as
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . You must instead declare the intended component type when you create the
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  by calling the respective creator method:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/android/app/PendingIntent.html#getActivity(android.content.Context, int, android.content.Intent, int)">
     PendingIntent.getActivity()
    </a>
   </code>
   for an
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   that starts an
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   .
  </li>
  <li>
   <code>
    <a href="/reference/android/app/PendingIntent.html#getService(android.content.Context, int, android.content.Intent, int)">
     PendingIntent.getService()
    </a>
   </code>
   for an
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   that starts a
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
   .
  </li>
  <li>
   <code>
    <a href="/reference/android/app/PendingIntent.html#getBroadcast(android.content.Context, int, android.content.Intent, int)">
     PendingIntent.getBroadcast()
    </a>
   </code>
   for a
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   that starts an
   <code>
    <a href="/reference/android/content/BroadcastReceiver.html">
     BroadcastReceiver
    </a>
   </code>
   .
  </li>
 </ul>
 <p>
  Unless your app is
  <em>
   receiving
  </em>
  pending intents from other apps,
the above methods to create a
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  are the only
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  methods you'll probably ever need.
 </p>
 <p>
  Each method takes the current app
  <code>
   <a href="/reference/android/content/Context.html">
    Context
   </a>
  </code>
  , the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  you want to wrap, and one or more flags that specify
how the intent should be used (such as whether the intent can be used more than once).
 </p>
 <p>
  More information about using pending intents is provided with the documentation for each
of the respective use cases, such as in the
  <a href="/guide/topics/ui/notifiers/notifications.html">
   Notifications
  </a>
  and
  <a href="/guide/topics/appwidgets/index.html">
   App Widgets
  </a>
  API guides.
 </p>
 <h2 id="Resolution">
  Intent Resolution
 </h2>
 <p>
  When the system receives an implicit intent to start an activity, it searches for the
best activity for the intent by comparing the intent to intent filters based on three aspects:
 </p>
 <ul>
  <li>
   The intent action
  </li>
  <li>
   The intent data (both URI and data type)
  </li>
  <li>
   The intent category
  </li>
 </ul>
 <p>
  The following sections describe how an intents are matched to the appropriate component(s)
in terms of how the intent filter is declared in an app's manifest file.
 </p>
 <h3 id="ActionTest">
  Action test
 </h3>
 <p>
  To specify accepted intent actions, an intent filter can declare zero or more
  <a href="/guide/topics/manifest/action-element.html">
   <code>
    &lt;action&gt;
   </code>
  </a>
  elements.  For example:
 </p>
 <pre>
&lt;intent-filter&gt;
    &lt;action android:name="android.intent.action.EDIT" /&gt;
    &lt;action android:name="android.intent.action.VIEW" /&gt;
    ...
&lt;/intent-filter&gt;
</pre>
 <p>
  To get through this filter, the action specified in the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  must match one of the actions listed in the filter.
 </p>
 <p>
  If the filter does not list any actions, there is nothing for an
intent to match, so all intents fail the test. However, if an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  does not specify an action, it will pass the test (as long as the filter
contains at least one action).
 </p>
 <h3 id="CategoryTest">
  Category test
 </h3>
 <p>
  To specify accepted intent categories, an intent filter can declare zero or more
  <a href="/guide/topics/manifest/category-element.html">
   <code>
    &lt;category&gt;
   </code>
  </a>
  elements.  For example:
 </p>
 <pre>
&lt;intent-filter&gt;
    &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
    ...
&lt;/intent-filter&gt;
</pre>
 <p>
  For an intent to pass the category test, every category in the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  must match a category in the filter. The reverse is not necessary&mdash;the intent filter may
declare more categories than are specified in the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  and the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  will still pass. Therefore, an intent with no categories should
always pass this test, regardless of what categories are declared in the filter.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Android automatically applies the the
  <code>
   <a href="/reference/android/content/Intent.html#CATEGORY_DEFAULT">
    CATEGORY_DEFAULT
   </a>
  </code>
  category
to all implicit intents passed to
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
    startActivityForResult()
   </a>
  </code>
  .
So if you want your activity to receive implicit intents, it must
include a category for
  <code>
   "android.intent.category.DEFAULT"
  </code>
  in its intent filters (as
shown in the previous
  <code>
   &lt;intent-filter&gt;
  </code>
  example.
 </p>
 <h3 id="DataTest">
  Data test
 </h3>
 <p>
  To specify accepted intent data, an intent filter can declare zero or more
  <a href="/guide/topics/manifest/data-element.html">
   <code>
    &lt;data&gt;
   </code>
  </a>
  elements.  For example:
 </p>
 <pre>
&lt;intent-filter&gt;
    &lt;data android:mimeType="video/mpeg" android:scheme="http" ... /&gt;
    &lt;data android:mimeType="audio/mpeg" android:scheme="http" ... /&gt;
    ...
&lt;/intent-filter&gt;
</pre>
 <p>
  Each
  <code>
   <a href="/guide/topics/manifest/data-element.html">
    &lt;data&gt;
   </a>
  </code>
  element can specify a URI structure and a data type (MIME media type).  There are separate
attributes &mdash;
  <code>
   scheme
  </code>
  ,
  <code>
   host
  </code>
  ,
  <code>
   port
  </code>
  ,
and
  <code>
   path
  </code>
  &mdash; for each part of the URI:
 </p>
 <p style="margin-left: 2em">
  <code>
   &lt;scheme&gt;://&lt;host&gt;:&lt;port&gt;/&lt;path&gt;
  </code>
 </p>
 <p>
  For example:
 </p>
 <p style="margin-left: 2em">
  <code>
   content://com.example.project:200/folder/subfolder/etc
  </code>
 </p>
 <p>
  In this URI, the scheme is
  <code>
   content
  </code>
  , the host is
  <code>
   com.example.project
  </code>
  ,
the port is
  <code>
   200
  </code>
  , and the path is
  <code>
   folder/subfolder/etc
  </code>
  .
 </p>
 <p>
  Each of these attributes is optional in a
  <a href="/guide/topics/manifest/data-element.html">
   <code>
    &lt;data&gt;
   </code>
  </a>
  element,
but there are linear dependencies:
 </p>
 <ul>
  <li>
   If a scheme is not specified, the host is ignored.
  </li>
  <li>
   If a host is not specified, the port is ignored.
  </li>
  <li>
   If both the scheme and host are not specified, the path is ignored.
  </li>
 </ul>
 <p>
  When the URI in an intent is compared to a URI specification in a filter,
it's compared only to the parts of the URI included in the filter. For example:
 </p>
 <ul>
  <li>
   If a filter specifies only a scheme, all URIs with that scheme match
the filter.
  </li>
  <li>
   If a filter specifies a scheme and an authority but no path, all URIs
with the same scheme and authority pass the filter, regardless of their paths.
  </li>
  <li>
   If a filter specifies a scheme, an authority, and a path, only URIs with the same scheme,
authority, and path pass the filter.
  </li>
 </ul>
 <p class="note">
  <strong>
   Note:
  </strong>
  A path specification can
contain a wildcard asterisk (*) to require only a partial match of the path name.
 </p>
 <p>
  The data test compares both the URI and the MIME type in the intent to a URI
and MIME type specified in the filter.  The rules are as follows:
 </p>
 <ol type="a">
  <li>
   An intent that contains neither a URI nor a MIME type passes the
test only if the filter does not specify any URIs or MIME types.
  </li>
  <li>
   An intent that contains a URI but no MIME type (neither explicit nor inferable from the
URI) passes the test only if its URI matches the filter's URI format
and the filter likewise does not specify a MIME type.
  </li>
  <li>
   An intent that contains a MIME type but not a URI passes the test
only if the filter lists the same MIME type and does not specify a URI format.
  </li>
  <li>
   An intent that contains both a URI and a MIME type (either explicit or inferable from the
URI) passes the MIME type part of the test only if that
type matches a type listed in the filter.  It passes the URI part of the test
either if its URI matches a URI in the filter or if it has a
   <code>
    content:
   </code>
   or
   <code>
    file:
   </code>
   URI and the filter does not specify a URI.  In other words,
a component is presumed to support
   <code>
    content:
   </code>
   and
   <code>
    file:
   </code>
   data if
its filter lists
   <em>
    only
   </em>
   a MIME type.
  </li>
 </ol>
 <p>
  This last rule, rule (d), reflects the expectation
that components are able to get local data from a file or content provider.
Therefore, their filters can list just a data type and do not need to explicitly
name the
  <code>
   content:
  </code>
  and
  <code>
   file:
  </code>
  schemes.
This is a typical case.  A
  <a href="/guide/topics/manifest/data-element.html">
   <code>
    &lt;data&gt;
   </code>
  </a>
  element
like the following, for example, tells Android that the component can get image data from a content
provider and display it:
 </p>
 <pre>
&lt;intent-filter&gt;
    &lt;data android:mimeType="image/*" /&gt;
    ...
&lt;/intent-filter&gt;</pre>
 <p>
  Because most available data is dispensed by content providers, filters that
specify a data type but not a URI are perhaps the most common.
 </p>
 <p>
  Another common configuration is filters with a scheme and a data type.  For
example, a
  <a href="/guide/topics/manifest/data-element.html">
   <code>
    &lt;data&gt;
   </code>
  </a>
  element like the following tells Android that
the component can retrieve video data from the network in order to perform the action:
 </p>
 <pre>
&lt;intent-filter&gt;
    &lt;data android:scheme="http" android:type="video/*" /&gt;
    ...
&lt;/intent-filter&gt;</pre>
 <h3 id="imatch">
  Intent matching
 </h3>
 <p>
  Intents are matched against intent filters not only to discover a target
component to activate, but also to discover something about the set of
components on the device.  For example, the Home app populates the app launcher
by finding all the  activities with intent filters that specify the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_MAIN">
    ACTION_MAIN
   </a>
  </code>
  action and
  <code>
   <a href="/reference/android/content/Intent.html#CATEGORY_LAUNCHER">
    CATEGORY_LAUNCHER
   </a>
  </code>
  category.
 </p>
 <p>
  Your application can use intent matching in a similar way.
The
  <code>
   <a href="/reference/android/content/pm/PackageManager.html">
    PackageManager
   </a>
  </code>
  has a set of
  <code>
   query...()
  </code>
  methods that return all components that can accept a particular intent, and
a similar series of
  <code>
   resolve...()
  </code>
  methods that determine the best
component to respond to an intent.  For example,
  <code>
   <a href="/reference/android/content/pm/PackageManager.html#queryIntentActivities(android.content.Intent, int)">
    queryIntentActivities()
   </a>
  </code>
  returns a list of all activities that can perform
the intent passed as an argument, and
  <code>
   <a href="/reference/android/content/pm/PackageManager.html#queryIntentServices(android.content.Intent, int)">
    queryIntentServices()
   </a>
  </code>
  returns a similar list of services.
Neither method activates the components; they just list the ones that
can respond.  There's a similar method,
  <code>
   <a href="/reference/android/content/pm/PackageManager.html#queryBroadcastReceivers(android.content.Intent, int)">
    queryBroadcastReceivers()
   </a>
  </code>
  , for broadcast receivers.
 </p>
</div>
<h1>Common Intents</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
    <a class="header-toggle" href="#" onclick="hideNestedItems('#tocIntents',this);return false;">
     <span class="more">
      show more
     </span>
     <span class="less" style="display:none">
      show less
     </span>
    </a>
   </h2>
   <ol class="hide-nested" id="tocIntents">
    <li>
     <a href="#Clock">
      Alarm Clock
     </a>
     <ol>
      <li>
       <a href="#CreateAlarm">
        Create an alarm
       </a>
      </li>
      <li>
       <a href="#CreateTimer">
        Create a timer
       </a>
      </li>
      <li>
       <a href="#ShowAlarms">
        Show all alarms
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Calendar">
      Calendar
     </a>
     <ol>
      <li>
       <a href="#AddEvent">
        Add a calendar event
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Camera">
      Camera
     </a>
     <ol>
      <li>
       <a href="#ImageCapture">
        Capture a picture or video and return it
       </a>
      </li>
      <li>
       <a href="#CameraStill">
        Start a camera app in still image mode
       </a>
      </li>
      <li>
       <a href="#CameraVideo">
        Start a camera app in video mode
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Contacts">
      Contacts/People App
     </a>
     <ol>
      <li>
       <a href="#PickContact">
        Select a contact
       </a>
      </li>
      <li>
       <a href="#PickContactDat">
        Select specific contact data
       </a>
      </li>
      <li>
       <a href="#ViewContact">
        View a contact
       </a>
      </li>
      <li>
       <a href="#EditContact">
        Edit an existing contact
       </a>
      </li>
      <li>
       <a href="#InsertContact">
        Insert a contact
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Email">
      Email
     </a>
     <ol>
      <li>
       <a href="#ComposeEmail">
        Compose an email with optional attachments
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Storage">
      File Storage
     </a>
     <ol>
      <li>
       <a href="#GetFile">
        Retrieve a specific type of file
       </a>
      </li>
      <li>
       <a href="#OpenFile">
        Open a specific type of file
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Local">
      Local Actions
     </a>
     <ol>
      <li>
       <a href="#CallCar">
        Call a car
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Maps">
      Maps
     </a>
     <ol>
      <li>
       <a href="#ViewMap">
        Show a location on a map
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Music">
      Music or Video
     </a>
     <ol>
      <li>
       <a href="#PlayMedia">
        Play a media file
       </a>
      </li>
      <li>
       <a href="#PlaySearch">
        Play music based on a search query
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Phone">
      Phone
     </a>
     <ol>
      <li>
       <a href="#DialPhone">
        Initiate a phone call
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Search">
      Search
     </a>
     <ol>
      <li>
       <a href="#SearchOnApp">
        Search in a specific app
       </a>
      </li>
      <li>
       <a href="#SearchWeb">
        Perform a web search
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Settings">
      Settings
     </a>
     <ol>
      <li>
       <a href="#OpenSettings">
        Open a specific section of Settings
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Messaging">
      Text Messaging
     </a>
     <ol>
      <li>
       <a href="#SendMessage">
        Compose an SMS/MMS message with attachment
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Browser">
      Web Browser
     </a>
     <ol>
      <li>
       <a href="#ViewUrl">
        Load a web URL
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#AdbIntents">
      Verify Intents with the Android Debug Bridge
     </a>
    </li>
    <li>
     <a href="#Now">
      Intents Fired by Google Now
     </a>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/components/intents-filters.html">
      Intents and Intent
Filters
     </a>
    </li>
   </ol>
  </div>
 </div>
 <!-- Google Now box styles -->
 <style type="text/css">
  .now-box {
  border-color: rgb(204,204,204);
  border-style: solid;
  border-width: 1px;
  float: right;
  margin: 0px 0px 20px 15px;
  padding: 17px;
  width: 200px;
}
.now-box li {
  font-size: 13px;
  font-style: italic;
  margin-top: 0px;
}
.now-box ul {
  margin-bottom: 0px;
}
.now-img {
  width: 30px;
  margin-bottom: 0px !important;
}
.now-img-cont {
  float: left;
  margin-right: 10px;
}
.now-title {
  font-weight: bold;
  margin-top: 7px;
}
.now-list {
  font-size: 13px;
  margin-bottom: 10px !important;
  list-style-type: none;
}
.now-list li {
  font-style: italic;
}
 </style>
 <p>
  An intent allows you to start an activity in another app by describing a simple
action you'd like to perform (such as "view a map" or "take a picture")
in an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object. This type of intent is
called an
  <em>
   implicit
  </em>
  intent because it does not specify the app component
to start, but instead specifies an
  <em>
   action
  </em>
  and provides some
  <em>
   data
  </em>
  with which to perform the action.
 </p>
 <p>
  When you call
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
    startActivityForResult()
   </a>
  </code>
  and pass it an
implicit intent, the system
  <a href="/guide/components/intents-filters.html#Resolution">
   resolves the intent
  </a>
  to an app that can handle the intent
and starts its corresponding
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  . If there's more than one app
that can handle the intent, the system presents the user with a dialog to pick which app
to use.
 </p>
 <p>
  This page describes several implicit intents that you can use to perform common actions,
organized by the type of app that handles the intent. Each section also shows how you can
create an
  <a href="/guide/components/intents-filters.html#Receiving">
   intent filter
  </a>
  to
advertise your app's ability to perform the same action.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  If there are no apps on the device that can receive
the implicit intent, your app will crash when it calls
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . To first verify that an app exists to receive the intent, call
  <code>
   <a href="/reference/android/content/Intent.html#resolveActivity(android.content.pm.PackageManager)">
    resolveActivity()
   </a>
  </code>
  on your
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  object. If the result is non-null, there is at least one app that can handle the intent and
it's safe to call
  <code>
   <a href="/reference/android/content/Context.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . If the result is
null, you should not use the intent and, if possible, you should disable the feature that invokes
the intent.
 </p>
 <p>
  If you're not familiar with how to create intents or intent filters, you should first read
  <a href="/guide/components/intents-filters.html">
   Intents and Intent Filters
  </a>
  .
 </p>
 <p>
  To learn how to fire the intents listed on this page from your development host, see
  <a href="#AdbIntents">
   Verify Intents with the Android Debug Bridge
  </a>
  .
 </p>
 <h4>
  Google Now
 </h4>
 <p>
  <a href="http://www.google.com/landing/now/">
   Google Now
  </a>
  fires some of the intents listed
on this page in response to voice commands. For more information, see
  <a href="#Now">
   Intents Fired by Google Now
  </a>
  .
 </p>
 <h2 id="Clock">
  Alarm Clock
 </h2>
 <h3 id="CreateAlarm">
  Create an alarm
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "set an alarm for 7 am"
   </li>
  </ul>
 </div>
 <p>
  To create a new alarm, use the
  <code>
   <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_ALARM">
    ACTION_SET_ALARM
   </a>
  </code>
  action and specify alarm details such as the time and message using extras defined below.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Only the hour, minutes, and message extras are available
in Android 2.3 (API level 9) and higher. The other extras were added in later versions of the
platform.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_ALARM">
     ACTION_SET_ALARM
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_HOUR">
       EXTRA_HOUR
      </a>
     </code>
    </dt>
    <dd>
     The hour for the alarm.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_MINUTES">
       EXTRA_MINUTES
      </a>
     </code>
    </dt>
    <dd>
     The minutes for the alarm.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_MESSAGE">
       EXTRA_MESSAGE
      </a>
     </code>
    </dt>
    <dd>
     A custom message to identify the alarm.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_DAYS">
       EXTRA_DAYS
      </a>
     </code>
    </dt>
    <dd>
     An
     <code>
      <a href="/reference/java/util/ArrayList.html">
       ArrayList
      </a>
     </code>
     including each week day on which this alarm should
      be repeated. Each day must be declared with an integer from the
     <code>
      <a href="/reference/java/util/Calendar.html">
       Calendar
      </a>
     </code>
     class such as
     <code>
      <a href="/reference/java/util/Calendar.html#MONDAY">
       MONDAY
      </a>
     </code>
     .
     <p>
      For a one-time alarm, do not specify this extra.
     </p>
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_RINGTONE">
       EXTRA_RINGTONE
      </a>
     </code>
    </dt>
    <dd>
     A
     <code>
      content:
     </code>
     URI specifying a ringtone to use with the alarm, or
     <code>
      <a href="/reference/android/provider/AlarmClock.html#VALUE_RINGTONE_SILENT">
       VALUE_RINGTONE_SILENT
      </a>
     </code>
     for no ringtone.
     <p>
      To use the default ringtone, do not specify this extra.
     </p>
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_VIBRATE">
       EXTRA_VIBRATE
      </a>
     </code>
    </dt>
    <dd>
     A boolean specifying whether to vibrate for this alarm.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_SKIP_UI">
       EXTRA_SKIP_UI
      </a>
     </code>
    </dt>
    <dd>
     A boolean specifying whether the responding app should skip its UI when setting the alarm.
      If true, the app should bypass any confirmation UI and simply set the specified alarm.
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void createAlarm(String message, int hour, int minutes) {
    Intent intent = new Intent(AlarmClock.ACTION_SET_ALARM)
            .putExtra(AlarmClock.EXTRA_MESSAGE, message)
            .putExtra(AlarmClock.EXTRA_HOUR, hour)
            .putExtra(AlarmClock.EXTRA_MINUTES, minutes);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <div class="note">
  <strong>
   Note:
  </strong>
  <p>
   In order to invoke the
   <code>
    <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_ALARM">
     ACTION_SET_ALARM
    </a>
   </code>
   intent, your app must have the
   <code>
    <a href="/reference/android/Manifest.permission.html#SET_ALARM">
     SET_ALARM
    </a>
   </code>
   permission:
  </p>
  <pre>
&lt;uses-permission android:name="com.android.alarm.permission.SET_ALARM" /&gt;
</pre>
 </div>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SET_ALARM" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h3 id="CreateTimer">
  Create a timer
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "set timer for 5 minutes"
   </li>
  </ul>
 </div>
 <p>
  To create a countdown timer, use the
  <code>
   <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_TIMER">
    ACTION_SET_TIMER
   </a>
  </code>
  action and specify timer details such as the duration using extras defined below.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  This intent was added
in Android 4.4 (API level 19).
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_TIMER">
     ACTION_SET_TIMER
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_LENGTH">
       EXTRA_LENGTH
      </a>
     </code>
    </dt>
    <dd>
     The length of the timer in seconds.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_MESSAGE">
       EXTRA_MESSAGE
      </a>
     </code>
    </dt>
    <dd>
     A custom message to identify the timer.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/AlarmClock.html#EXTRA_SKIP_UI">
       EXTRA_SKIP_UI
      </a>
     </code>
    </dt>
    <dd>
     A boolean specifying whether the responding app should skip its UI when setting the timer.
      If true, the app should bypass any confirmation UI and simply start the specified timer.
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void startTimer(String message, int seconds) {
    Intent intent = new Intent(AlarmClock.ACTION_SET_TIMER)
            .putExtra(AlarmClock.EXTRA_MESSAGE, message)
            .putExtra(AlarmClock.EXTRA_LENGTH, seconds)
            .putExtra(AlarmClock.EXTRA_SKIP_UI, true);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <div class="note">
  <strong>
   Note:
  </strong>
  <p>
   In order to invoke the
   <code>
    <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_TIMER">
     ACTION_SET_TIMER
    </a>
   </code>
   intent, your app must have the
   <code>
    <a href="/reference/android/Manifest.permission.html#SET_ALARM">
     SET_ALARM
    </a>
   </code>
   permission:
  </p>
  <pre>
&lt;uses-permission android:name="com.android.alarm.permission.SET_ALARM" /&gt;
</pre>
 </div>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SET_TIMER" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h3 id="ShowAlarms">
  Show all alarms
 </h3>
 <p>
  To show the list of alarms, use the
  <code>
   <a href="/reference/android/provider/AlarmClock.html#ACTION_SHOW_ALARMS">
    ACTION_SHOW_ALARMS
   </a>
  </code>
  action.
 </p>
 <p>
  Although not many apps will invoke this intent (it's primarily used by system apps),
any app that behaves as an alarm clock should implement
this intent filter and respond by showing the list of current alarms.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  This intent was added
in Android 4.4 (API level 19).
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/AlarmClock.html#ACTION_SHOW_ALARMS">
     ACTION_SHOW_ALARMS
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SHOW_ALARMS" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h2 id="Calendar">
  Calendar
 </h2>
 <h3 id="AddEvent">
  Add a calendar event
 </h3>
 <p>
  To add a new event to the user's calendar, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    ACTION_INSERT
   </a>
  </code>
  action and specify the data URI with
  <code>
   <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
    Events.CONTENT_URI
   </a>
  </code>
  . You can then specify various event details using extras defined below.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_INSERT">
     ACTION_INSERT
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
     Events.CONTENT_URI
    </a>
   </code>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <code>
    "vnd.android.cursor.dir/event"
   </code>
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_ALL_DAY">
       EXTRA_EVENT_ALL_DAY
      </a>
     </code>
    </dt>
    <dd>
     A boolean specifying whether this is an all-day event.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_BEGIN_TIME">
       EXTRA_EVENT_BEGIN_TIME
      </a>
     </code>
    </dt>
    <dd>
     The start time of the event (milliseconds since epoch).
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_END_TIME">
       EXTRA_EVENT_END_TIME
      </a>
     </code>
    </dt>
    <dd>
     The end time of the event (milliseconds since epoch).
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/CalendarContract.EventsColumns.html#TITLE">
       TITLE
      </a>
     </code>
    </dt>
    <dd>
     The event title.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DESCRIPTION">
       DESCRIPTION
      </a>
     </code>
    </dt>
    <dd>
     The event description.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/CalendarContract.EventsColumns.html#EVENT_LOCATION">
       EVENT_LOCATION
      </a>
     </code>
    </dt>
    <dd>
     The event location.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_EMAIL">
       EXTRA_EMAIL
      </a>
     </code>
    </dt>
    <dd>
     A comma-separated list of email addresses that specify the invitees.
    </dd>
   </dl>
   <p>
    Many more event details can be specified using the constants defined in the
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html">
      CalendarContract.EventsColumns
     </a>
    </code>
    class.
   </p>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void addEvent(String title, String location, Calendar begin, Calendar end) {
    Intent intent = new Intent(Intent.ACTION_INSERT)
            .setData(Events.CONTENT_URI)
            .putExtra(Events.TITLE, title)
            .putExtra(Events.EVENT_LOCATION, location)
            .putExtra(CalendarContract.EXTRA_EVENT_BEGIN_TIME, begin)
            .putExtra(CalendarContract.EXTRA_EVENT_END_TIME, end);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.INSERT" /&gt;
        &lt;data android:mimeType="vnd.android.cursor.dir/event" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h2 id="Camera">
  Camera
 </h2>
 <h3 id="ImageCapture">
  Capture a picture or video and return it
 </h3>
 <p>
  To open a camera app and receive the resulting photo or video, use the
  <code>
   <a href="/reference/android/provider/MediaStore.html#ACTION_IMAGE_CAPTURE">
    ACTION_IMAGE_CAPTURE
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/provider/MediaStore.html#ACTION_VIDEO_CAPTURE">
    ACTION_VIDEO_CAPTURE
   </a>
  </code>
  action. Also specify the URI location where you'd
like the camera to save the photo or video, in the
  <code>
   <a href="/reference/android/provider/MediaStore.html#EXTRA_OUTPUT">
    EXTRA_OUTPUT
   </a>
  </code>
  extra.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/MediaStore.html#ACTION_IMAGE_CAPTURE">
     ACTION_IMAGE_CAPTURE
    </a>
   </code>
   or
   <br/>
   <code>
    <a href="/reference/android/provider/MediaStore.html#ACTION_VIDEO_CAPTURE">
     ACTION_VIDEO_CAPTURE
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/provider/MediaStore.html#EXTRA_OUTPUT">
       EXTRA_OUTPUT
      </a>
     </code>
    </dt>
    <dd>
     The URI location where the camera app should save the photo or
      video file (as a
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
     object).
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  When the camera app successfully returns
focus to your activity (your app receives the
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  callback), you can access the photo or video at the URI you specified
with the
  <code>
   <a href="/reference/android/provider/MediaStore.html#EXTRA_OUTPUT">
    EXTRA_OUTPUT
   </a>
  </code>
  value.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  When you use
  <code>
   <a href="/reference/android/provider/MediaStore.html#ACTION_IMAGE_CAPTURE">
    ACTION_IMAGE_CAPTURE
   </a>
  </code>
  to capture a photo, the camera may also return a
downscaled copy (a thumbnail) of the photo in the result
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  , saved as a
  <code>
   <a href="/reference/android/graphics/Bitmap.html">
    Bitmap
   </a>
  </code>
  in an extra field named
  <code>
   "data"
  </code>
  .
 </p>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
static final int REQUEST_IMAGE_CAPTURE = 1;
static final Uri mLocationForPhotos;

public void capturePhoto(String targetFilename) {
    Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
    intent.putExtra(MediaStore.EXTRA_OUTPUT,
            Uri.withAppendedPath(mLocationForPhotos, targetFilename);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivityForResult(intent, REQUEST_IMAGE_CAPTURE);
    }
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == REQUEST_IMAGE_CAPTURE &amp;&amp; resultCode == RESULT_OK) {
        Bitmap thumbnail = data.getParcelable("data");
        // Do other work with full size photo saved in mLocationForPhotos
        ...
    }
}
</pre>
 <p>
  For more information about how to use this intent to capture a photo, including
how to create an appropriate
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  for the output location, read
  <a href="/training/camera/photobasics.html">
   Taking Photos Simply
  </a>
  or
  <a href="/training/camera/videobasics.html">
   Taking Videos Simply
  </a>
  .
 </p>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.media.action.IMAGE_CAPTURE" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p>
  When handling this intent, your activity should check for the
  <code>
   <a href="/reference/android/provider/MediaStore.html#EXTRA_OUTPUT">
    EXTRA_OUTPUT
   </a>
  </code>
  extra in the incoming
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  ,
then save the captured image or video at the location specified by that extra and call
  <code>
   <a href="/reference/android/app/Activity.html#setResult(int, android.content.Intent)">
    setResult()
   </a>
  </code>
  with an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  that includes a compressed thumbnail
in an extra named
  <code>
   "data"
  </code>
  .
 </p>
 <h3 id="CameraStill">
  Start a camera app in still image mode
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "take a picture"
   </li>
  </ul>
 </div>
 <p>
  To open a camera app in still image mode, use the
  <code>
   <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_STILL_IMAGE_CAMERA">
    INTENT_ACTION_STILL_IMAGE_CAMERA
   </a>
  </code>
  action.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_STILL_IMAGE_CAMERA">
     INTENT_ACTION_STILL_IMAGE_CAMERA
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void capturePhoto() {
    Intent intent = new Intent(MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivityForResult(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.media.action.STILL_IMAGE_CAMERA" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h3 id="CameraVideo">
  Start a camera app in video mode
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "record a video"
   </li>
  </ul>
 </div>
 <p>
  To open a camera app in video mode, use the
  <code>
   <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_VIDEO_CAMERA">
    INTENT_ACTION_VIDEO_CAMERA
   </a>
  </code>
  action.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_VIDEO_CAMERA">
     INTENT_ACTION_VIDEO_CAMERA
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void capturePhoto() {
    Intent intent = new Intent(MediaStore.INTENT_ACTION_VIDEO_CAMERA);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivityForResult(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.media.action.VIDEO_CAMERA" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h2 id="Contacts">
  Contacts/People App
 </h2>
 <h3 id="PickContact">
  Select a contact
 </h3>
 <p>
  To have the user select a contact and provide your app access to all the contact information,
use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_PICK">
    ACTION_PICK
   </a>
  </code>
  action and specify the MIME type to
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_TYPE">
    Contacts.CONTENT_TYPE
   </a>
  </code>
  .
 </p>
 <p>
  The result
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  delivered to your
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  callback contains the
  <code>
   content:
  </code>
  URI pointing to the selected contact. The response grants
your app temporary permissions to read that contact using the
  <a href="/guide/topics/providers/contacts-provider.html">
   Contacts Provider
  </a>
  API even if
your app does not include the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  permission.
 </p>
 <p class="note">
  <strong>
   Tip:
  </strong>
  If you need access to only a specific piece of contact
information, such as a phone number or email address, instead see the next section about how to
  <a href="#PickContactData">
   select specific contact data
  </a>
  .
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_PICK">
     ACTION_PICK
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_TYPE">
     Contacts.CONTENT_TYPE
    </a>
   </code>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
static final int REQUEST_SELECT_CONTACT = 1;

public void selectContact() {
    Intent intent = new Intent(Intent.ACTION_PICK);
    intent.setType(ContactsContract.Contacts.CONTENT_TYPE);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivityForResult(intent, REQUEST_SELECT_CONTACT);
    }
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == REQUEST_SELECT_CONTACT &amp;&amp; resultCode == RESULT_OK) {
        Uri contactUri = data.getData();
        // Do something with the selected contact at contactUri
        ...
    }
}
</pre>
 <p>
  For information about how to retrieve contact details once you have the contact URI,
read
  <a href="/training/contacts-provider/retrieve-details.html">
   Retrieving Details
for a Contact
  </a>
  . Remember, when you retrieve the contact URI with the above intent, you
  <strong>
   do not
  </strong>
  need the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  permission
to read details for that contact.
 </p>
 <h3 id="PickContactDat">
  Select specific contact data
 </h3>
 <p>
  To have the user select a specific piece of information from a contact, such as
a phone number, email address, or other data type, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_PICK">
    ACTION_PICK
   </a>
  </code>
  action and specify the MIME type to one
of the content types listed below, such as
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Phone.html#CONTENT_TYPE">
    CommonDataKinds.Phone.CONTENT_TYPE
   </a>
  </code>
  to get the contact's phone number.
 </p>
 <p>
  If you need to retrieve only one type of data from a contact, this technique with a
  <code>
   CONTENT_TYPE
  </code>
  from the
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.html">
    ContactsContract.CommonDataKinds
   </a>
  </code>
  classes is more efficient than
using the
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_TYPE">
    Contacts.CONTENT_TYPE
   </a>
  </code>
  (as shown in the previous section) because the result provides you direct
access to the desired data without requiring you to perform a more complex query to
  <a href="/guide/topics/providers/contacts-provider.html">
   Contacts Provider
  </a>
  .
 </p>
 <p>
  The result
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  delivered to your
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  callback contains the
  <code>
   content:
  </code>
  URI pointing to the selected contact data. The response grants
your app temporary permissions to read that contact data even if your app does
not include the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  permission.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_PICK">
     ACTION_PICK
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Phone.html#CONTENT_TYPE">
       CommonDataKinds.Phone.CONTENT_TYPE
      </a>
     </code>
    </dt>
    <dd>
     Pick from contacts with a phone number.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html#CONTENT_TYPE">
       CommonDataKinds.Email.CONTENT_TYPE
      </a>
     </code>
    </dt>
    <dd>
     Pick from contacts with an email address.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredPostal.html#CONTENT_TYPE">
       CommonDataKinds.StructuredPostal.CONTENT_TYPE
      </a>
     </code>
    </dt>
    <dd>
     Pick from contacts with a postal address.
    </dd>
   </dl>
   <p>
    Or one of many other
    <code>
     CONTENT_TYPE
    </code>
    values
  under
    <code>
     <a href="/reference/android/provider/ContactsContract.html">
      ContactsContract
     </a>
    </code>
    .
   </p>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
static final int REQUEST_SELECT_PHONE_NUMBER = 1;

public void selectContact() {
    // Start an activity for the user to pick a phone number from contacts
    Intent intent = new Intent(Intent.ACTION_PICK);
    intent.setType(CommonDataKinds.Phone.CONTENT_TYPE);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivityForResult(intent, REQUEST_SELECT_PHONE_NUMBER);
    }
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == REQUEST_SELECT_PHONE_NUMBER &amp;&amp; resultCode == RESULT_OK) {
        // Get the URI and query the content provider for the phone number
        Uri contactUri = data.getData();
        String[] projection = new String[]{CommonDataKinds.Phone.NUMBER};
        Cursor cursor = getContentResolver().query(contactUri, projection,
                null, null, null);
        // If the cursor returned is valid, get the phone number
        if (cursor != null &amp;&amp; cursor.moveToFirst()) {
            int numberIndex = cursor.getColumnIndex(CommonDataKinds.Phone.NUMBER);
            String number = cursor.getString(numberIndex);
            // Do something with the phone number
            ...
        }
    }
}
</pre>
 <h3 id="ViewContact">
  View a contact
 </h3>
 <p>
  To display the details for a known contact, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_VIEW">
    ACTION_VIEW
   </a>
  </code>
  action and specify the contact with a
  <code>
   content:
  </code>
  URI as the intent data.
 </p>
 <p>
  There are primarily two ways to initially retrieve the contact's URI:
 </p>
 <ul>
  <li>
   Use the contact URI returned by the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_PICK">
     ACTION_PICK
    </a>
   </code>
   ,
  shown in the previous section (this approach does not require any app permissions).
  </li>
  <li>
   Access the list of all contacts directly, as described in
   <a href="/training/contacts-provider/retrieve-names.html">
    Retrieving a List of
  Contacts
   </a>
   (this approach requires the
   <code>
    <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
     READ_CONTACTS
    </a>
   </code>
   permission).
  </li>
 </ul>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_VIEW">
     ACTION_VIEW
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <code>
    content:&lt;URI&gt;
   </code>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None. The type is inferred from contact URI.
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void viewContact(Uri contactUri) {
    Intent intent = new Intent(Intent.ACTION_VIEW, contactUri);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <h3 id="EditContact">
  Edit an existing contact
 </h3>
 <p>
  To edit a known contact, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_EDIT">
    ACTION_EDIT
   </a>
  </code>
  action, specify the contact with a
  <code>
   content:
  </code>
  URI
as the intent data, and include any known contact information in extras specified by
constants in
  <code>
   <a href="/reference/android/provider/ContactsContract.Intents.Insert.html">
    ContactsContract.Intents.Insert
   </a>
  </code>
  .
 </p>
 <p>
  There are primarily two ways to initially retrieve the contact URI:
 </p>
 <ul>
  <li>
   Use the contact URI returned by the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_PICK">
     ACTION_PICK
    </a>
   </code>
   ,
  shown in the previous section (this approach does not require any app permissions).
  </li>
  <li>
   Access the list of all contacts directly, as described in
   <a href="/training/contacts-provider/retrieve-names.html">
    Retrieving a List of
  Contacts
   </a>
   (this approach requires the
   <code>
    <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
     READ_CONTACTS
    </a>
   </code>
   permission).
  </li>
 </ul>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_EDIT">
     ACTION_EDIT
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <code>
    content:&lt;URI&gt;
   </code>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   The type is inferred from contact URI.
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   One or more of the extras defined in
   <code>
    <a href="/reference/android/provider/ContactsContract.Intents.Insert.html">
     ContactsContract.Intents.Insert
    </a>
   </code>
   so you can populate fields of the contact details.
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void editContact(Uri contactUri, String email) {
    Intent intent = new Intent(Intent.ACTION_EDIT);
    intent.setData(contactUri);
    intent.putExtra(Intents.Insert.EMAIL, email);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  For more information about how to edit a contact, read
  <a href="/training/contacts-provider/modify-data.html">
   Modifying
Contacts Using Intents
  </a>
  .
 </p>
 <h3 id="InsertContact">
  Insert a contact
 </h3>
 <p>
  To insert a new contact, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    ACTION_INSERT
   </a>
  </code>
  action,
specify
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_TYPE">
    Contacts.CONTENT_TYPE
   </a>
  </code>
  as
the MIME type, and include any known contact information in extras specified by
constants in
  <code>
   <a href="/reference/android/provider/ContactsContract.Intents.Insert.html">
    ContactsContract.Intents.Insert
   </a>
  </code>
  .
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_INSERT">
     ACTION_INSERT
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_TYPE">
     Contacts.CONTENT_TYPE
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   One or more of the extras defined in
   <code>
    <a href="/reference/android/provider/ContactsContract.Intents.Insert.html">
     ContactsContract.Intents.Insert
    </a>
   </code>
   .
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void insertContact(String name, String email) {
    Intent intent = new Intent(Intent.ACTION_INSERT);
    intent.setType(Contacts.CONTENT_TYPE);
    intent.putExtra(Intents.Insert.NAME, name);
    intent.putExtra(Intents.Insert.EMAIL, email);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  For more information about how to insert a contact, read
  <a href="/training/contacts-provider/modify-data.html">
   Modifying
Contacts Using Intents
  </a>
  .
 </p>
 <h2 id="Email">
  Email
 </h2>
 <h3 id="ComposeEmail">
  Compose an email with optional attachments
 </h3>
 <p>
  To compose an email, use one of the below actions based on whether you'll include attachments,
and include email details such as the recipient and subject using the extra keys listed below.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_SENDTO">
     ACTION_SENDTO
    </a>
   </code>
   (for no attachment) or
   <br/>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_SEND">
     ACTION_SEND
    </a>
   </code>
   (for one attachment) or
   <br/>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_SEND_MULTIPLE">
     ACTION_SEND_MULTIPLE
    </a>
   </code>
   (for multiple attachments)
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/org/apache/http/protocol/HTTP.html#PLAIN_TEXT_TYPE">
       PLAIN_TEXT_TYPE
      </a>
     </code>
     ("text/plain")
     <dt>
      <code>
       "*/*"
      </code>
     </dt>
    </dt>
   </dl>
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_EMAIL">
       Intent.EXTRA_EMAIL
      </a>
     </code>
    </dt>
    <dd>
     A string array of all "To" recipient email addresses.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_CC">
       Intent.EXTRA_CC
      </a>
     </code>
    </dt>
    <dd>
     A string array of all "CC" recipient email addresses.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_BCC">
       Intent.EXTRA_BCC
      </a>
     </code>
    </dt>
    <dd>
     A string array of all "BCC" recipient email addresses.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_SUBJECT">
       Intent.EXTRA_SUBJECT
      </a>
     </code>
    </dt>
    <dd>
     A string with the email subject.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_TEXT">
       Intent.EXTRA_TEXT
      </a>
     </code>
    </dt>
    <dd>
     A string with the body of the email.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_STREAM">
       Intent.EXTRA_STREAM
      </a>
     </code>
    </dt>
    <dd>
     A
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
     pointing to the attachment. If using the
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_SEND_MULTIPLE">
       ACTION_SEND_MULTIPLE
      </a>
     </code>
     action, this should instead
        be an
     <code>
      <a href="/reference/java/util/ArrayList.html">
       ArrayList
      </a>
     </code>
     containing multiple
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
     objects.
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void composeEmail(String[] addresses, String subject, Uri attachment) {
    Intent intent = new Intent(Intent.ACTION_SEND);
    intent.setType("*/*");
    intent.putExtra(Intent.EXTRA_EMAIL, addresses);
    intent.putExtra(Intent.EXTRA_SUBJECT, subject);
    intent.putExtra(Intent.EXTRA_STREAM, attachment);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  If you want to ensure that your intent is handled only by an email app (and not other
text messaging or social apps), then use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_SENDTO">
    ACTION_SENDTO
   </a>
  </code>
  action
and include the
  <code>
   "mailto:"
  </code>
  data scheme. For example:
 </p>
 <pre>
public void composeEmail(String[] addresses, String subject) {
    Intent intent = new Intent(Intent.ACTION_SENDTO);
    intent.setData(Uri.parse("mailto:")); // only email apps should handle this
    intent.putExtra(Intent.EXTRA_EMAIL, addresses);
    intent.putExtra(Intent.EXTRA_SUBJECT, subject);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SEND" /&gt;
        &lt;data android:type="*/*" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SENDTO" /&gt;
        &lt;data android:scheme="mailto" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h2 id="Storage">
  File Storage
 </h2>
 <h3 id="GetFile">
  Retrieve a specific type of file
 </h3>
 <p>
  To request that the user select a file such as a document or photo and return a reference to
your app, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  action and specify your desired
MIME type. The file reference returned to your app is transient to your activity's current
lifecycle, so if you want to access it later you must import a copy that you can read later.
This intent also allows the user to create a new file in the process (for
example, instead of selecting an existing photo, the user can capture a new photo with the camera).
 </p>
 <p>
  The result intent delivered to your
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  method includes data with a URI pointing to the file.
The URI could be anything, such as an
  <code>
   http:
  </code>
  URI,
  <code>
   file:
  </code>
  URI, or
  <code>
   content:
  </code>
  URI. However, if you'd like to restrict selectable files to only those that are accessible
from a content provider (a
  <code>
   content:
  </code>
  URI) and that are available as a file stream with
  <code>
   <a href="/reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">
    openFileDescriptor()
   </a>
  </code>
  , you should add
the
  <code>
   <a href="/reference/android/content/Intent.html#CATEGORY_OPENABLE">
    CATEGORY_OPENABLE
   </a>
  </code>
  category to your intent.
 </p>
 <p>
  On Android 4.3 (API level 18) and higher,
you can also allow the user to select multiple files by adding
  <code>
   <a href="/reference/android/content/Intent.html#EXTRA_ALLOW_MULTIPLE">
    EXTRA_ALLOW_MULTIPLE
   </a>
  </code>
  to the intent, set to
  <code>
   true
  </code>
  .
You can then access each of the selected files in a
  <code>
   <a href="/reference/android/content/ClipData.html">
    ClipData
   </a>
  </code>
  object returned by
  <code>
   <a href="/reference/android/content/Intent.html#getClipData()">
    getClipData()
   </a>
  </code>
  .
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
     ACTION_GET_CONTENT
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   The MIME type corresponding to the file type the user should select.
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_ALLOW_MULTIPLE">
       EXTRA_ALLOW_MULTIPLE
      </a>
     </code>
    </dt>
    <dd>
     A boolean declaring whether the user can select more than one file at a time.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_LOCAL_ONLY">
       EXTRA_LOCAL_ONLY
      </a>
     </code>
    </dt>
    <dd>
     A boolean that declares whether the returned file must be available directly from
      the device, rather than requiring a download from a remote service.
    </dd>
   </dl>
  </dd>
  <dt>
   <b>
    Category
   </b>
   (optional)
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#CATEGORY_OPENABLE">
       CATEGORY_OPENABLE
      </a>
     </code>
    </dt>
    <dd>
     To return only "openable" files that can be represented as a file stream
      with
     <code>
      <a href="/reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">
       openFileDescriptor()
      </a>
     </code>
     .
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent to get a photo:
  </b>
 </p>
 <pre>
static final int REQUEST_IMAGE_GET = 1;

public void selectImage() {
    Intent intent = new Intent(Intent.ACTION_GET_CONTENT);
    intent.setType("image/*");
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivityForResult(intent, REQUEST_IMAGE_GET);
    }
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == REQUEST_IMAGE_GET &amp;&amp; resultCode == RESULT_OK) {
        Bitmap thumbnail = data.getParcelable("data");
        Uri fullPhotoUri = data.getData();
        // Do work with photo saved at fullPhotoUri
        ...
    }
}
</pre>
 <p>
  <b>
   Example intent filter to return a photo:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.GET_CONTENT" /&gt;
        &lt;data android:type="image/*" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;!-- The OPENABLE category declares that the returned file is accessible
             from a content provider that supports <code><a href="/reference/android/provider/OpenableColumns.html">OpenableColumns</a></code>
             and <code><a href="/reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">ContentResolver.openFileDescriptor()</a></code> --&gt;
        &lt;category android:name="android.intent.category.OPENABLE" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h3 id="OpenFile">
  Open a specific type of file
 </h3>
 <p>
  Instead of retrieving a copy of a file that you must import to your app
(by using the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  action), when running on Android
4.4 or higher, you can instead request to
  <em>
   open
  </em>
  a file that's managed by another app by
using the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  action and specifying a MIME type.
To also allow the user to instead create a new document that your app can write to, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
    ACTION_CREATE_DOCUMENT
   </a>
  </code>
  action instead. For example, instead of
selecting from existing PDF documents, the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
    ACTION_CREATE_DOCUMENT
   </a>
  </code>
  intent allows users to select where they'd like to create a new document (within another app
that manages the document's storage)&mdash;your app then receives the URI location of where it
can write the new document.
 </p>
 <p>
  Whereas the intent delivered to your
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  method from the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  action may
return a URI of any type, the result intent from
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
    ACTION_CREATE_DOCUMENT
   </a>
  </code>
  always specify the chosen file as a
  <code>
   content:
  </code>
  URI that's backed by a
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  . You can open the
file with
  <code>
   <a href="/reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">
    openFileDescriptor()
   </a>
  </code>
  and
query its details using columns from
  <code>
   <a href="/reference/android/provider/DocumentsContract.Document.html">
    DocumentsContract.Document
   </a>
  </code>
  .
 </p>
 <p>
  The returned URI grants your app long-term read access to the file (also possibly
with write access). So the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  action is
particularly useful (instead of using
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  )
when you want to read an existing file without making a copy into your app,
or when you want to open and edit a file in place.
 </p>
 <p>
  You can also allow the user to select multiple files by adding
  <code>
   <a href="/reference/android/content/Intent.html#EXTRA_ALLOW_MULTIPLE">
    EXTRA_ALLOW_MULTIPLE
   </a>
  </code>
  to the intent, set to
  <code>
   true
  </code>
  .
If the user selects just one item, then you can retrieve the item from
  <code>
   <a href="/reference/android/content/Intent.html#getData()">
    getData()
   </a>
  </code>
  . If the user selects more than one item, then
  <code>
   <a href="/reference/android/content/Intent.html#getData()">
    getData()
   </a>
  </code>
  returns null and you must instead
retrieve each item from a
  <code>
   <a href="/reference/android/content/ClipData.html">
    ClipData
   </a>
  </code>
  object that is returned by
  <code>
   <a href="/reference/android/content/Intent.html#getClipData()">
    getClipData()
   </a>
  </code>
  .
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Your intent
  <strong>
   must
  </strong>
  specify a MIME type and
  <strong>
   must
  </strong>
  declare the
  <code>
   <a href="/reference/android/content/Intent.html#CATEGORY_OPENABLE">
    CATEGORY_OPENABLE
   </a>
  </code>
  category. If
appropriate, you can specify more than one MIME type by adding an array of MIME types with the
  <code>
   <a href="/reference/android/content/Intent.html#EXTRA_MIME_TYPES">
    EXTRA_MIME_TYPES
   </a>
  </code>
  extra&mdash;if you do so, you must set the
primary MIME type in
  <code>
   <a href="/reference/android/content/Intent.html#setType(java.lang.String)">
    setType()
   </a>
  </code>
  to
  <code>
   "*/*"
  </code>
  .
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
     ACTION_OPEN_DOCUMENT
    </a>
   </code>
   or
   <br/>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
     ACTION_CREATE_DOCUMENT
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   The MIME type corresponding to the file type the user should select.
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_MIME_TYPES">
       EXTRA_MIME_TYPES
      </a>
     </code>
    </dt>
    <dd>
     An array of MIME types corresponding to the types of files your app is
      requesting. When you use this extra, you must set the primary MIME type in
     <code>
      <a href="/reference/android/content/Intent.html#setType(java.lang.String)">
       setType()
      </a>
     </code>
     to
     <code>
      "*/*"
     </code>
     .
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_ALLOW_MULTIPLE">
       EXTRA_ALLOW_MULTIPLE
      </a>
     </code>
    </dt>
    <dd>
     A boolean that declares whether the user can select more than one file at a time.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_TITLE">
       EXTRA_TITLE
      </a>
     </code>
    </dt>
    <dd>
     For use with
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
       ACTION_CREATE_DOCUMENT
      </a>
     </code>
     to specify
      an initial file name.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_LOCAL_ONLY">
       EXTRA_LOCAL_ONLY
      </a>
     </code>
    </dt>
    <dd>
     A boolean that declares whether the returned file must be available directly from
      the device, rather than requiring a download from a remote service.
    </dd>
   </dl>
  </dd>
  <dt>
   <b>
    Category
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#CATEGORY_OPENABLE">
       CATEGORY_OPENABLE
      </a>
     </code>
    </dt>
    <dd>
     To return only "openable" files that can be represented as a file stream
      with
     <code>
      <a href="/reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">
       openFileDescriptor()
      </a>
     </code>
     .
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent to get a photo:
  </b>
 </p>
 <pre>
static final int REQUEST_IMAGE_OPEN = 1;

public void selectImage() {
    Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);
    intent.setType("image/*");
    intent.addCategory(Intent.CATEGORY_OPENABLE);
    // Only the system receives the ACTION_OPEN_DOCUMENT, so no need to test.
    startActivityForResult(intent, REQUEST_IMAGE_OPEN);
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == REQUEST_IMAGE_OPEN &amp;&amp; resultCode == RESULT_OK) {
        Uri fullPhotoUri = data.getData();
        // Do work with full size photo saved at fullPhotoUri
        ...
    }
}
</pre>
 <p>
  Third party apps cannot actually respond to an intent with the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  action. Instead, the system receives this
intent and displays all the files available from various apps in a unified user interface.
 </p>
 <p>
  To provide your app's files in this UI and allow other apps to open them, you must implement
a
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  and include an intent filter for
  <code>
   <a href="/reference/android/provider/DocumentsContract.html#PROVIDER_INTERFACE">
    PROVIDER_INTERFACE
   </a>
  </code>
  (
  <code>
   "android.content.action.DOCUMENTS_PROVIDER"
  </code>
  ). For example:
 </p>
 <pre>
&lt;provider ...
    android:grantUriPermissions="true"
    android:exported="true"
    android:permission="android.permission.MANAGE_DOCUMENTS"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.content.action.DOCUMENTS_PROVIDER" /&gt;
    &lt;/intent-filter&gt;
&lt;/provider&gt;
</pre>
 <p>
  For more information about how to make the files managed by your app openable from other apps,
read the
  <a href="/guide/topics/providers/document-provider.html">
   Storage Access
Framework
  </a>
  guide.
 </p>
 <h2 id="Local">
  Local Actions
 </h2>
 <h3 id="CallCar">
  Call a car
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "get me a taxi"
   </li>
   <li>
    "call me a car"
   </li>
  </ul>
  <p style="font-size:13px;margin-bottom:0px;margin-top:10px">
   (Android Wear only)
  </p>
 </div>
 <p>
  To call a taxi, use the
  <a href="/reference/com/google/android/gms/actions/ReserveIntents.html#ACTION_RESERVE_TAXI_RESERVATION">
   <code>
    ACTION_RESERVE_TAXI_RESERVATION
   </code>
  </a>
  action.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Apps must ask for confirmation from the user
before completing the action.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <a href="/reference/com/google/android/gms/actions/ReserveIntents.html#ACTION_RESERVE_TAXI_RESERVATION">
    <code>
     ACTION_RESERVE_TAXI_RESERVATION
    </code>
   </a>
  </dd>
  <dt>
   <b>
    Data URI
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void callCar() {
    Intent intent = new Intent(ReserveIntents.ACTION_RESERVE_TAXI_RESERVATION);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="com.google.android.gms.actions.RESERVE_TAXI_RESERVATION" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h2 id="Maps">
  Maps
 </h2>
 <h3 id="ViewMap">
  Show a location on a map
 </h3>
 <p>
  To open a map, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_VIEW">
    ACTION_VIEW
   </a>
  </code>
  action and specify
the location information in the intent data with one of the schemes defined below.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_VIEW">
     ACTION_VIEW
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      geo:
      <em>
       latitude
      </em>
      ,
      <em>
       longitude
      </em>
     </code>
    </dt>
    <dd>
     Show the map at the given longitude and latitude.
     <p>
      Example:
      <code>
       "geo:47.6,-122.3"
      </code>
     </p>
    </dd>
    <dt>
     <code>
      geo:
      <em>
       latitude
      </em>
      ,
      <em>
       longitude
      </em>
      ?z=
      <em>
       zoom
      </em>
     </code>
    </dt>
    <dd>
     Show the map at the given longitude and latitude at a certain zoom level. A zoom level of
    1 shows the whole Earth, centered at the given
     <em>
      lat
     </em>
     ,
     <em>
      lng
     </em>
     . The highest
    (closest) zoom level is 23.
     <p>
      Example:
      <code>
       "geo:47.6,-122.3?z=11"
      </code>
     </p>
    </dd>
    <dt>
     <code>
      geo:0,0?q=lat,lng(label)
     </code>
    </dt>
    <dd>
     Show the map at the given longitude and latitude with a string label.
     <p>
      Example:
      <code>
       "geo:0,0?q=34.99,-106.61(Treasure)"
      </code>
     </p>
    </dd>
    <dt>
     <code>
      geo:0,0?q=my+street+address
     </code>
    </dt>
    <dd>
     Show the location for "my street address" (may be a specific address or location query).
     <p>
      Example:
      <code>
       "geo:0,0?q=1600+Amphitheatre+Parkway%2C+CA"
      </code>
     </p>
     <p class="note">
      <strong>
       Note:
      </strong>
      All strings passed in the
      <code>
       geo
      </code>
      URI must
      be encoded. For example, the string
      <code>
       1st &amp; Pike, Seattle
      </code>
      should become
      <code>
       1st%20%26%20Pike%2C%20Seattle
      </code>
      . Spaces in the string can be encoded with
      <code>
       %20
      </code>
      or replaced with the plus sign (
      <code>
       +
      </code>
      ).
     </p>
    </dd>
   </dl>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void showMap(Uri geoLocation) {
    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setData(geoLocation);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;data android:scheme="geo" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h2 id="Music">
  Music or Video
 </h2>
 <h3 id="PlayMedia">
  Play a media file
 </h3>
 <p>
  To play a music file, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_VIEW">
    ACTION_VIEW
   </a>
  </code>
  action and
specify the URI location of the file in the intent data.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_VIEW">
     ACTION_VIEW
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      file:
      <em>
       &lt;URI&gt;
      </em>
     </code>
     <dt>
      <code>
       content:
       <em>
        &lt;URI&gt;
       </em>
      </code>
      <dt>
       <code>
        http:
        <em>
         &lt;URL&gt;
        </em>
       </code>
      </dt>
     </dt>
    </dt>
   </dl>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      "audio/*"
     </code>
     <dt>
      <code>
       "application/ogg"
      </code>
      <dt>
       <code>
        "application/x-ogg"
       </code>
       <dt>
        <code>
         "application/itunes"
        </code>
        <dt>
         Or any other that your app may require.
        </dt>
       </dt>
      </dt>
     </dt>
    </dt>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void playMedia(Uri file) {
    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setData(file);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;data android:type="audio/*" /&gt;
        &lt;data android:type="application/ogg" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h3 id="PlaySearch">
  Play music based on a search query
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "play michael jackson billie jean"
   </li>
  </ul>
 </div>
 <p>
  To play music based on a search query, use the
  <code>
   <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH">
    INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH
   </a>
  </code>
  intent. An app may fire
this intent in response to the user's voice command to play music. The receiving app for this
intent performs a search within its inventory to match existing content to the given query and
starts playing that content.
 </p>
 <p>
  This intent should include the
  <code>
   <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_FOCUS">
    EXTRA_MEDIA_FOCUS
   </a>
  </code>
  string
extra, which specifies the inteded search mode. For example, the search mode can specify whether
the search is for an artist name or song name.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH">
     INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_FOCUS">
       MediaStore.EXTRA_MEDIA_FOCUS
      </a>
     </code>
     (required)
    </dt>
    <dd>
     <p>
      Indicates the search mode (whether the user is looking for a particular artist, album, song,
or playlist). Most search modes take additional extras. For example, if the user
is interested in listening to a particular song, the intent might have three additional extras:
the song title, the artist, and the album. This intent supports the following search modes for
each value of
      <code>
       <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_FOCUS">
        EXTRA_MEDIA_FOCUS
       </a>
      </code>
      :
     </p>
     <dl>
      <dt>
       <p>
        <em>
         Any
        </em>
        -
        <code>
         "vnd.android.cursor.item/*"
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play any music. The receiving app should play some music based on a smart choice, such
as the last playlist the user listened to.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - An empty string. This extra is always
      provided for backward compatibility: existing apps that do not know about search modes can
      process this intent as an unstructured search.
        </li>
       </ul>
      </dd>
      <dt>
       <p>
        <em>
         Unstructured
        </em>
        -
        <code>
         "vnd.android.cursor.item/*"
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play a particular song, album or genre from an unstructured search query. Apps may generate
an intent with this search mode when they can't identify the type of content the user wants to
listen to. Apps should use more specific search modes when possible.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - A string that contains any combination
      of: the artist, the album, the song name, or the genre.
        </li>
       </ul>
      </dd>
      <dt>
       <p>
        <em>
         Genre
        </em>
        -
        <code>
         <a href="/reference/android/provider/MediaStore.Audio.Genres.html#ENTRY_CONTENT_TYPE">
          Audio.Genres.ENTRY_CONTENT_TYPE
         </a>
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play music of a particular genre.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          "android.intent.extra.genre"
         </code>
         (required) - The genre.
        </li>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - The genre. This extra is always provided
      for backward compatibility: existing apps that do not know about search modes can process
      this intent as an unstructured search.
        </li>
       </ul>
      </dd>
      <dt>
       <p>
        <em>
         Artist
        </em>
        -
        <code>
         <a href="/reference/android/provider/MediaStore.Audio.Artists.html#ENTRY_CONTENT_TYPE">
          Audio.Artists.ENTRY_CONTENT_TYPE
         </a>
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play music from a particular artist.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ARTIST">
           EXTRA_MEDIA_ARTIST
          </a>
         </code>
         (required) - The artist.
        </li>
        <li>
         <code>
          "android.intent.extra.genre"
         </code>
         - The genre.
        </li>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - A string that contains any combination of
      the artist or the genre. This extra is always provided for backward compatibility:
      existing apps that do not know about search modes can process this intent as an unstructured
      search.
        </li>
       </ul>
      </dd>
      <dt>
       <p>
        <em>
         Album
        </em>
        -
        <code>
         <a href="/reference/android/provider/MediaStore.Audio.Albums.html#ENTRY_CONTENT_TYPE">
          Audio.Albums.ENTRY_CONTENT_TYPE
         </a>
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play music from a particular album.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ALBUM">
           EXTRA_MEDIA_ALBUM
          </a>
         </code>
         (required) - The album.
        </li>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ARTIST">
           EXTRA_MEDIA_ARTIST
          </a>
         </code>
         - The artist.
        </li>
        <li>
         <code>
          "android.intent.extra.genre"
         </code>
         - The genre.
        </li>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - A string that contains any combination of
      the album or the artist. This extra is always provided for backward
      compatibility: existing apps that do not know about search modes can process this intent as an
      unstructured search.
        </li>
       </ul>
      </dd>
      <dt>
       <p>
        <em>
         Song
        </em>
        -
        <code>
         "vnd.android.cursor.item/audio"
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play a particular song.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ALBUM">
           EXTRA_MEDIA_ALBUM
          </a>
         </code>
         - The album.
        </li>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ARTIST">
           EXTRA_MEDIA_ARTIST
          </a>
         </code>
         - The artist.
        </li>
        <li>
         <code>
          "android.intent.extra.genre"
         </code>
         - The genre.
        </li>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_TITLE">
           EXTRA_MEDIA_TITLE
          </a>
         </code>
         (required) - The song name.
        </li>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - A string that contains any combination of:
      the album, the artist, the genre, or the title. This extra is always provided for
      backward compatibility: existing apps that do not know about search modes can process this
      intent as an unstructured search.
        </li>
       </ul>
      </dd>
      <dt>
       <p>
        <em>
         Playlist
        </em>
        -
        <code>
         <a href="/reference/android/provider/MediaStore.Audio.Playlists.html#ENTRY_CONTENT_TYPE">
          Audio.Playlists.ENTRY_CONTENT_TYPE
         </a>
        </code>
       </p>
      </dt>
      <dd>
       <p>
        Play a particular playlist or a playlist that matches some criteria specified
by additional extras.
       </p>
       <p>
        Additional extras:
       </p>
       <ul>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ALBUM">
           EXTRA_MEDIA_ALBUM
          </a>
         </code>
         - The album.
        </li>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_ARTIST">
           EXTRA_MEDIA_ARTIST
          </a>
         </code>
         - The artist.
        </li>
        <li>
         <code>
          "android.intent.extra.genre"
         </code>
         - The genre.
        </li>
        <li>
         <code>
          "android.intent.extra.playlist"
         </code>
         - The playlist.
        </li>
        <li>
         <code>
          <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_TITLE">
           EXTRA_MEDIA_TITLE
          </a>
         </code>
         - The song name that the playlist is
      based on.
        </li>
        <li>
         <code>
          <a href="/reference/android/app/SearchManager.html#QUERY">
           QUERY
          </a>
         </code>
         (required) - A string that contains any combination
      of: the album, the artist, the genre, the playlist, or the title. This extra is always
      provided for backward compatibility: existing apps that do not know about search modes can
      process this intent as an unstructured search.
        </li>
       </ul>
      </dd>
     </dl>
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <p>
  If the user wants to listen to music from a particular artist, a search app may generate the
following intent:
 </p>
 <pre>
public void playSearchArtist(String artist) {
    Intent intent = new Intent(MediaStore.INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH);
    intent.putExtra(MediaStore.EXTRA_MEDIA_FOCUS,
                    MediaStore.Audio.Artists.ENTRY_CONTENT_TYPE);
    intent.putExtra(MediaStore.EXTRA_MEDIA_ARTIST, artist);
    intent.putExtra(SearchManager.QUERY, artist);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.media.action.MEDIA_PLAY_FROM_SEARCH" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p>
  When handling this intent, your activity should check the value of the
  <code>
   <a href="/reference/android/provider/MediaStore.html#EXTRA_MEDIA_FOCUS">
    EXTRA_MEDIA_FOCUS
   </a>
  </code>
  extra in the incoming
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  to determine the search mode. Once your activity has identified
the search mode, it should read the values of the additional extras for that particular search mode.
With this information your app can then perform the search within its inventory to play the
content that matches the search query. For example:
 </p>
 <pre>
protected void onCreate(Bundle savedInstanceState) {
    ...
    Intent intent = this.getIntent();
    if (intent.getAction().compareTo(MediaStore.INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH) == 0) {

        String mediaFocus = intent.getStringExtra(MediaStore.EXTRA_MEDIA_FOCUS);
        String query = intent.getStringExtra(SearchManager.QUERY);

        // Some of these extras may not be available depending on the search mode
        String album = intent.getStringExtra(MediaStore.EXTRA_MEDIA_ALBUM);
        String artist = intent.getStringExtra(MediaStore.EXTRA_MEDIA_ARTIST);
        String genre = intent.getStringExtra("android.intent.extra.genre");
        String playlist = intent.getStringExtra("android.intent.extra.playlist");
        String title = intent.getStringExtra(MediaStore.EXTRA_MEDIA_TITLE);

        // Determine the search mode and use the corresponding extras
        if (mediaFocus == null) {
            // 'Unstructured' search mode (backward compatible)
            playUnstructuredSearch(query);

        } else if (mediaFocus.compareTo("vnd.android.cursor.item/*") == 0) {
            if (query.isEmpty()) {
                // 'Any' search mode
                playResumeLastPlaylist();
            } else {
                // 'Unstructured' search mode
                playUnstructuredSearch(query);
            }

        } else if (mediaFocus.compareTo(MediaStore.Audio.Genres.ENTRY_CONTENT_TYPE) == 0) {
            // 'Genre' search mode
            playGenre(genre);

        } else if (mediaFocus.compareTo(MediaStore.Audio.Artists.ENTRY_CONTENT_TYPE) == 0) {
            // 'Artist' search mode
            playArtist(artist, genre);

        } else if (mediaFocus.compareTo(MediaStore.Audio.Albums.ENTRY_CONTENT_TYPE) == 0) {
            // 'Album' search mode
            playAlbum(album, artist);

        } else if (mediaFocus.compareTo("vnd.android.cursor.item/audio") == 0) {
            // 'Song' search mode
            playSong(album, artist, genre, title);

        } else if (mediaFocus.compareTo(MediaStore.Audio.Playlists.ENTRY_CONTENT_TYPE) == 0) {
            // 'Playlist' search mode
            playPlaylist(album, artist, genre, playlist, title);
        }
    }
}
</pre>
 <h2 id="Phone">
  Phone
 </h2>
 <h3 id="DialPhone">
  Initiate a phone call
 </h3>
 <p>
  To open the phone app and dial a phone number, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_DIAL">
    ACTION_DIAL
   </a>
  </code>
  action and specify a phone number using
the URI scheme defined below. When the phone app opens, it displays the phone number
but the user must press the
  <em>
   Call
  </em>
  button to begin the phone call.
 </p>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "call 555-5555"
   </li>
   <li>
    "call bob"
   </li>
   <li>
    "call voicemail"
   </li>
  </ul>
 </div>
 <p>
  To place a phone call directly, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CALL">
    ACTION_CALL
   </a>
  </code>
  action
and specify a phone number using the URI scheme defined below. When the phone app opens, it
begins the phone call; the user does not need to press the
  <em>
   Call
  </em>
  button.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CALL">
    ACTION_CALL
   </a>
  </code>
  action requires that you add the
  <code>
   CALL_PHONE
  </code>
  permission to your manifest file:
 </p>
 <pre style="margin-top:45px">
&lt;uses-permission android:name="android.permission.CALL_PHONE" /&gt;
</pre>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <ul>
    <li>
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_DIAL">
       ACTION_DIAL
      </a>
     </code>
     - Opens the dialer or phone app.
    </li>
    <li>
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_CALL">
       ACTION_CALL
      </a>
     </code>
     - Places a phone call (requires the
     <code>
      CALL_PHONE
     </code>
     permission)
    </li>
   </ul>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <ul>
    <li>
     <code>
      tel:&lt;phone-number&gt;
     </code>
    </li>
    <li>
     <code>
      voicemail:&lt;phone-number&gt;
     </code>
    </li>
   </ul>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  Valid telephone numbers are those defined
in
  <a href="http://tools.ietf.org/html/rfc3966">
   the IETF RFC 3966
  </a>
  .
Valid examples include the following:
 </p>
 <ul>
  <li>
   <code>
    tel:2125551212
   </code>
  </li>
  <li>
   <code>
    tel:(212) 555 1212
   </code>
  </li>
 </ul>
 <p>
  The Phone's dialer is good at normalizing schemes, such as
telephone numbers. So the scheme described isn't strictly required in the
  <code>
   <a href="/reference/android/net/Uri.html#parse(java.lang.String)">
    Uri.parse()
   </a>
  </code>
  method.
However, if you have not tried a scheme or are unsure whether it
can be handled, use the
  <code>
   <a href="/reference/android/net/Uri.html#fromParts(java.lang.String, java.lang.String, java.lang.String)">
    Uri.fromParts()
   </a>
  </code>
  method instead.
 </p>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void dialPhoneNumber(String phoneNumber) {
    Intent intent = new Intent(Intent.ACTION_DIAL);
    intent.setData(Uri.parse("tel:" + phoneNumber));
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <h2 id="Search">
  Search
 </h2>
 <h3 id="SearchOnApp">
  Search using a specific app
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "search for cat videos on myvideoapp"
   </li>
  </ul>
 </div>
 <!-- Video box -->
 <a class="notice-developers-video" href="https://www.youtube.com/watch?v=PS1FbB5qWEI">
  <div>
   <h3>
    Video
   </h3>
   <p>
    Voice search in your app
   </p>
  </div>
 </a>
 <p>
  To support search within the context of your app, declare an intent filter in your app with
the
  <code>
   SEARCH_ACTION
  </code>
  action, as shown in the example intent filter below.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      "com.google.android.gms.actions.SEARCH_ACTION"
     </code>
    </dt>
    <dd>
     Support search queries from Google Now.
    </dd>
   </dl>
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <code>
       <a href="/reference/android/app/SearchManager.html#QUERY">
        QUERY
       </a>
      </code>
     </code>
    </dt>
    <dd>
     A string that contains the search query.
    </dd>
    <dl>
    </dl>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity android:name=".SearchActivity"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="com.google.android.gms.actions.SEARCH_ACTION"/&gt;
        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <h3 id="SearchWeb">
  Perform a web search
 </h3>
 <p>
  To initiate a web search, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_WEB_SEARCH">
    ACTION_WEB_SEARCH
   </a>
  </code>
  action
and specify the search string in the
  <code>
   <a href="/reference/android/app/SearchManager.html#QUERY">
    SearchManager.QUERY
   </a>
  </code>
  extra.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_WEB_SEARCH">
     ACTION_WEB_SEARCH
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/app/SearchManager.html#QUERY">
       SearchManager.QUERY
      </a>
     </code>
    </dt>
    <dd>
     The search string.
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void searchWeb(String query) {
    Intent intent = new Intent(Intent.ACTION_SEARCH);
    intent.putExtra(SearchManager.QUERY, query);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <h2 id="Settings">
  Settings
 </h2>
 <h3 id="OpenSettings">
  Open a specific section of Settings
 </h3>
 <p>
  To open a screen in the system settings when your app requires the user to change something,
use one of the following intent actions to open the settings screen respective to the action name.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_SETTINGS">
     ACTION_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_WIRELESS_SETTINGS">
     ACTION_WIRELESS_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_AIRPLANE_MODE_SETTINGS">
     ACTION_AIRPLANE_MODE_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_WIFI_SETTINGS">
     ACTION_WIFI_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_APN_SETTINGS">
     ACTION_APN_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_BLUETOOTH_SETTINGS">
     ACTION_BLUETOOTH_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_DATE_SETTINGS">
     ACTION_DATE_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_LOCALE_SETTINGS">
     ACTION_LOCALE_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_INPUT_METHOD_SETTINGS">
     ACTION_INPUT_METHOD_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_DISPLAY_SETTINGS">
     ACTION_DISPLAY_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_SECURITY_SETTINGS">
     ACTION_SECURITY_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_LOCATION_SOURCE_SETTINGS">
     ACTION_LOCATION_SOURCE_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_INTERNAL_STORAGE_SETTINGS">
     ACTION_INTERNAL_STORAGE_SETTINGS
    </a>
   </code>
   <br/>
   <code>
    <a href="/reference/android/provider/Settings.html#ACTION_MEMORY_CARD_SETTINGS">
     ACTION_MEMORY_CARD_SETTINGS
    </a>
   </code>
   <br/>
   <p>
    See the
    <code>
     <a href="/reference/android/provider/Settings.html">
      Settings
     </a>
    </code>
    documentation for additional settings screens
that are available.
   </p>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   None
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   None
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void openWifiSettings() {
    Intent intent = new Intent(Intent.ACTION_WIFI_SETTINGS);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <h2 id="Messaging">
  Text Messaging
 </h2>
 <h3 id="SendMessage">
  Compose an SMS/MMS message with attachment
 </h3>
 <p>
  To initiate an SMS or MMS text message, use one of the intent actions below and specify message
details such as the phone number, subject, and message body using the extra keys listed below.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_SENDTO">
     ACTION_SENDTO
    </a>
   </code>
   or
   <br/>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_SEND">
     ACTION_SEND
    </a>
   </code>
   or
   <br/>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_SEND_MULTIPLE">
     ACTION_SEND_MULTIPLE
    </a>
   </code>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      sms:
      <em>
       &lt;phone_number&gt;
      </em>
     </code>
     <dt>
      <code>
       smsto:
       <em>
        &lt;phone_number&gt;
       </em>
      </code>
      <dt>
       <code>
        mms:
        <em>
         &lt;phone_number&gt;
        </em>
       </code>
       <dt>
        <code>
         mmsto:
         <em>
          &lt;phone_number&gt;
         </em>
        </code>
       </dt>
      </dt>
     </dt>
    </dt>
   </dl>
   <p>
    Each of these schemes are handled the same.
   </p>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/org/apache/http/protocol/HTTP.html#PLAIN_TEXT_TYPE">
       PLAIN_TEXT_TYPE
      </a>
     </code>
     (
     <code>
      "text/plain"
     </code>
     )
     <dt>
      <code>
       "image/*"
      </code>
      <dt>
       <code>
        "video/*"
       </code>
      </dt>
     </dt>
    </dt>
   </dl>
  </dd>
  <dt>
   <b>
    Extras
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      "subject"
     </code>
    </dt>
    <dd>
     A string for the message subject (usually for MMS only).
    </dd>
    <dt>
     <code>
      "sms_body"
     </code>
    </dt>
    <dd>
     A string for the text message.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/Intent.html#EXTRA_STREAM">
       EXTRA_STREAM
      </a>
     </code>
    </dt>
    <dd>
     A
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
     pointing to the
image or video to attach. If using the
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_SEND_MULTIPLE">
       ACTION_SEND_MULTIPLE
      </a>
     </code>
     action,
this extra should be an
     <code>
      <a href="/reference/java/util/ArrayList.html">
       ArrayList
      </a>
     </code>
     of
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
     s pointing to the images/videos to attach.
    </dd>
    <dl>
    </dl>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void composeMmsMessage(String message, Uri attachment) {
    Intent intent = new Intent(Intent.ACTION_SENDTO);
    intent.setType(HTTP.PLAIN_TEXT_TYPE);
    intent.putExtra("sms_body", message);
    intent.putExtra(Intent.EXTRA_STREAM, attachment);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  If you want to ensure that your intent is handled only by a text messaging app (and not other
email or social apps), then use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_SENDTO">
    ACTION_SENDTO
   </a>
  </code>
  action
and include the
  <code>
   "smsto:"
  </code>
  data scheme. For example:
 </p>
 <pre>
public void composeMmsMessage(String message, Uri attachment) {
    Intent intent = new Intent(Intent.ACTION_SEND);
    intent.setData(Uri.parse("smsto:"));  // This ensures only SMS apps respond
    intent.putExtra("sms_body", message);
    intent.putExtra(Intent.EXTRA_STREAM, attachment);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.SEND" /&gt;
        &lt;data android:type="text/plain" /&gt;
        &lt;data android:type="image/*" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  If you're developing an SMS/MMS messaging app, you must
implement intent filters for several additional actions in order to be available as the
  <em>
   default SMS app
  </em>
  on Android 4.4 and higher. For more information, see the documentation
at
  <code>
   <a href="/reference/android/provider/Telephony.html">
    Telephony
   </a>
  </code>
  .
 </p>
 <h2 id="Browser">
  Web Browser
 </h2>
 <h3 id="ViewUrl">
  Load a web URL
 </h3>
 <!-- Google Now box -->
 <div class="now-box">
  <div class="now-img-cont">
   <a href="#Now">
    <img alt="" class="now-img" height="30" src="/guide/componentshttp://developer.android.com/images/voice-icon.png" width="30"/>
   </a>
  </div>
  <p class="now-title">
   Google Now
  </p>
  <ul>
   <li>
    "open example.com"
   </li>
  </ul>
 </div>
 <p>
  To open a web page, use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_VIEW">
    ACTION_VIEW
   </a>
  </code>
  action
and specify the web URL in the intent data.
 </p>
 <dl>
  <dt>
   <b>
    Action
   </b>
  </dt>
  <dd>
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_VIEW">
     ACTION_VIEW
    </a>
   </code>
   <dd>
   </dd>
  </dd>
  <dt>
   <b>
    Data URI Scheme
   </b>
  </dt>
  <dd>
   <code>
    http:
    <em>
     &lt;URL&gt;
    </em>
   </code>
   <br/>
   <code>
    https:
    <em>
     &lt;URL&gt;
    </em>
   </code>
  </dd>
  <dt>
   <b>
    MIME Type
   </b>
  </dt>
  <dd>
   <dl>
    <dt>
     <code>
      <a href="/reference/org/apache/http/protocol/HTTP.html#PLAIN_TEXT_TYPE">
       PLAIN_TEXT_TYPE
      </a>
     </code>
     (
     <code>
      "text/plain"
     </code>
     )
     <dt>
      <code>
       "text/html"
      </code>
      <dt>
       <code>
        "application/xhtml+xml"
       </code>
       <dt>
        <code>
         "application/vnd.wap.xhtml+xml"
        </code>
       </dt>
      </dt>
     </dt>
    </dt>
   </dl>
  </dd>
 </dl>
 <p>
  <b>
   Example intent:
  </b>
 </p>
 <pre>
public void openWebPage(String url) {
    Uri webpage = Uri.parse(url);
    Intent intent = new Intent(Intent.ACTION_VIEW, webpage);
    if (intent.resolveActivity(getPackageManager()) != null) {
        startActivity(intent);
    }
}
</pre>
 <p>
  <b>
   Example intent filter:
  </b>
 </p>
 <pre>
&lt;activity ...&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;!-- Include the host attribute if you want your app to respond
             only to URLs with your app's domain. --&gt;
        &lt;data android:scheme="http" android:host="www.example.com" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;!-- The BROWSABLE category is required to get links from web pages. --&gt;
        &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p class="note">
  <strong>
   Tip:
  </strong>
  If your Android app provides functionality similar to
your web site, include an intent filter for URLs that point to your web site. Then,
if users have your app installed, links from emails or other web pages pointing to your web site
open your Android app instead of your web page.
 </p>
 <h2 id="AdbIntents">
  Verify Intents with the Android Debug Bridge
 </h2>
 <p>
  To verify that your app responds to the intents that you want to support, you can use the
  <a href="/tools/help/adb.html">
   <code>
    adb
   </code>
  </a>
  tool to fire specific intents:
 </p>
 <ol>
  <li>
   Set up an Android device for
   <a href="/tools/device.html#setting-up">
    development
   </a>
   ,
or use a
   <a href="/tools/devices/emulator.html#avds">
    virtual device
   </a>
   .
  </li>
  <li>
   Install a version of your app that handles the intents you want to support.
  </li>
  <li>
   Fire an intent using
   <code>
    adb
   </code>
   :
   <pre class="no-pretty-print">
adb shell am start -a &lt;ACTION&gt; -t &lt;MIME_TYPE&gt; -d &lt;DATA&gt; \
  -e &lt;EXTRA_NAME&gt; &lt;EXTRA_VALUE&gt; -n &lt;ACTIVITY&gt;
</pre>
   <p>
    For example:
   </p>
   <pre class="no-pretty-print">
adb shell am start -a android.intent.action.DIAL \
  -d tel:555-5555 -n org.example.MyApp/.MyActivity
</pre>
  </li>
  <li>
   If you defined the required intent filters, your app should handle the intent.
  </li>
 </ol>
 <p>
  For more information, see
  <a href="/tools/help/shell.html#am">
   ADB Shell Commands
  </a>
  .
 </p>
 <h2 id="Now">
  Intents Fired by Google Now
 </h2>
 <p>
  <a href="http://www.google.com/landing/now/">
   Google Now
  </a>
  recognizes many voice commands
and fires intents for them. As such, users may launch your app with a Google Now voice command
if your app declares the corresponding intent filter. For example, if your app can
  <a href="#CreateAlarm">
   set an alarm
  </a>
  and you add the corresponding intent filter to your
manifest file, Google Now lets users choose your app when they request to set an alarm, as
shown in figure 1.
 </p>
 <img alt="" height="241" src="/guide/componentshttp://developer.android.com/images/google-action.png" srcset="/guide/componentshttp://developer.android.com/images/google-action_2x.png 2x" width="700"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  Google Now lets users choose from installed
apps that support a given action.
 </p>
 <p>
  Google Now recognizes voice commands for the actions listed in table 1. For more information
about declaring each intent filter, click on the action description.
 </p>
 <p class="table-caption">
  <strong>
   Table 1.
  </strong>
  Voice commands recognized by Google Now
(Google Search app v3.6).
 </p>
 <table>
  <tr>
   <th>
    Category
   </th>
   <th>
    Details and Examples
   </th>
   <th>
    Action Name
   </th>
  </tr>
  <tr>
   <td rowspan="2" style="vertical-align:middle">
    Alarm
   </td>
   <td>
    <p>
     <a href="#CreateAlarm">
      Set alarm
     </a>
    </p>
    <ul class="now-list">
     <li>
      "set an alarm for 7 am"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_ALARM">
      AlarmClock.ACTION_SET_ALARM
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <p>
     <a href="#CreateTimer">
      Set timer
     </a>
    </p>
    <ul class="now-list">
     <li>
      "set a timer for 5 minutes"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/AlarmClock.html#ACTION_SET_TIMER">
      AlarmClock.ACTION_SET_TIMER
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td style="vertical-align:middle">
    Communication
   </td>
   <td>
    <p>
     <a href="#DialPhone">
      Call a number
     </a>
    </p>
    <ul class="now-list">
     <li>
      "call 555-5555"
     </li>
     <li>
      "call bob"
     </li>
     <li>
      "call voicemail"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_CALL">
      Intent.ACTION_CALL
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td style="vertical-align:middle">
    Local
   </td>
   <td>
    <p>
     <a href="#CallCar">
      Book a car
     </a>
    </p>
    <ul class="now-list">
     <li>
      "call me a car"
     </li>
     <li>
      "book me a taxi"
     </li>
    </ul>
   </td>
   <td>
    <a href="/reference/com/google/android/gms/actions/ReserveIntents.html#ACTION_RESERVE_TAXI_RESERVATION">
     <code>
      ReserveIntents
      <br/>
      .ACTION_RESERVE_TAXI_RESERVATION
     </code>
    </a>
   </td>
  </tr>
  <tr>
   <td rowspan="3" style="vertical-align:middle">
    Media
   </td>
   <td>
    <p>
     <a href="#PlaySearch">
      Play music from search
     </a>
    </p>
    <ul class="now-list">
     <li>
      "play michael jackson billie jean"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH">
      MediaStore
      <br/>
      .INTENT_ACTION_MEDIA_PLAY_FROM_SEARCH
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <p>
     <a href="#CameraStill">
      Take a picture
     </a>
    </p>
    <ul class="now-list">
     <li>
      "take a picture"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_STILL_IMAGE_CAMERA">
      MediaStore
      <br/>
      .INTENT_ACTION_STILL_IMAGE_CAMERA
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <p>
     <a href="#CameraVideo">
      Record a video
     </a>
    </p>
    <ul class="now-list">
     <li>
      "record a video"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/MediaStore.html#INTENT_ACTION_VIDEO_CAMERA">
      MediaStore
      <br/>
      .INTENT_ACTION_VIDEO_CAMERA
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td style="vertical-align:middle">
    Search
   </td>
   <td>
    <p>
     <a href="#SearchOnApp">
      Search using a specific app
     </a>
    </p>
    <ul class="now-list">
     <li>
      "search for cat videos
      <br/>
      on myvideoapp"
     </li>
    </ul>
   </td>
   <td>
    <code>
     "com.google.android.gms.actions
     <br/>
     .SEARCH_ACTION"
    </code>
   </td>
  </tr>
  <tr>
   <td style="vertical-align:middle">
    Web browser
   </td>
   <td>
    <p>
     <a href="#ViewUrl">
      Open URL
     </a>
    </p>
    <ul class="now-list">
     <li>
      "open example.com"
     </li>
    </ul>
   </td>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_VIEW">
      Intent.ACTION_VIEW
     </a>
    </code>
   </td>
  </tr>
 </table>
</div>
<h1>Activities</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Creating">
      Creating an Activity
     </a>
     <ol>
      <li>
       <a href="#UI">
        Implementing a user interface
       </a>
      </li>
      <li>
       <a href="#Declaring">
        Declaring the activity in the manifest
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#StartingAnActivity">
      Starting an Activity
     </a>
     <ol>
      <li>
       <a href="#StartingAnActivityForResult">
        Starting an activity for a result
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#ShuttingDown">
      Shutting Down an Activity
     </a>
    </li>
    <li>
     <a href="#Lifecycle">
      Managing the Activity Lifecycle
     </a>
     <ol>
      <li>
       <a href="#ImplementingLifecycleCallbacks">
        Implementing the lifecycle callbacks
       </a>
      </li>
      <li>
       <a href="#SavingActivityState">
        Saving activity state
       </a>
      </li>
      <li>
       <a href="#ConfigurationChanges">
        Handling configuration changes
       </a>
      </li>
      <li>
       <a href="#CoordinatingActivities">
        Coordinating activities
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/app/Activity.html">
       Activity
      </a>
     </code>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/components/tasks-and-back-stack.html">
      Tasks and Back
Stack
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  An
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  is an application component that provides a screen with which
users can interact in order to do something, such as dial the phone, take a photo, send an email, or
view a map. Each activity is given a window in which to draw its user interface. The window
typically fills the screen, but may be smaller than the screen and float on top of other
windows.
 </p>
 <p>
  An application usually consists of multiple activities that are loosely bound
to each other. Typically, one activity in an application is specified as the "main" activity, which
is presented to the user when launching the application for the first time. Each
activity can then start another activity in order to perform different actions. Each time a new
activity starts, the previous activity is stopped, but the system preserves the activity
in a stack (the "back stack"). When a new activity starts, it is pushed onto the back stack and
takes user focus. The back stack abides to the basic "last in, first out" stack mechanism,
so, when the user is done with the current activity and presses the
  <em>
   Back
  </em>
  button, it
is popped from the stack (and destroyed) and the previous activity resumes. (The back stack is
discussed more in the
  <a href="/guide/components/tasks-and-back-stack.html">
   Tasks
and Back Stack
  </a>
  document.)
 </p>
 <p>
  When an activity is stopped because a new activity starts, it is notified of this change in state
through the activity's lifecycle callback methods.
There are several callback methods that an activity might receive, due to a change in its
state&mdash;whether the system is creating it, stopping it, resuming it, or destroying it&mdash;and
each callback provides you the opportunity to perform specific work that's
appropriate to that state change. For instance, when stopped, your activity should release any
large objects, such as network or database connections. When the activity resumes, you can
reacquire the necessary resources and resume actions that were interrupted. These state transitions
are all part of the activity lifecycle.
 </p>
 <p>
  The rest of this document discusses the basics of how to build and use an activity,
including a complete discussion of how the activity lifecycle works, so you can properly manage
the transition between various activity states.
 </p>
 <h2 id="Creating">
  Creating an Activity
 </h2>
 <p>
  To create an activity, you must create a subclass of
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  (or
an existing subclass of it). In your subclass, you need to implement callback methods that the
system calls when the activity transitions between various states of its lifecycle, such as when
the activity is being created, stopped, resumed, or destroyed. The two most important callback
methods are:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
  </dt>
  <dd>
   You must implement this method. The system calls this when creating your
    activity. Within your implementation, you should initialize the essential components of your
activity.
    Most importantly, this is where you must call
   <code>
    <a href="/reference/android/app/Activity.html#setContentView(android.view.View)">
     setContentView()
    </a>
   </code>
   to define the layout for the activity's user interface.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Activity.html#onPause()">
     onPause()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this method as the first indication that the user is leaving your
activity (though it does not always mean the activity is being destroyed). This is usually where you
should commit any changes that should be persisted beyond the current user session (because
the user might not come back).
  </dd>
 </dl>
 <p>
  There are several other lifecycle callback methods that you should use in order to provide a
fluid user experience between activities and handle unexpected interuptions that cause your activity
to be stopped and even destroyed. All of the lifecycle callback methods are discussed later, in
the section about
  <a href="#Lifecycle">
   Managing the Activity Lifecycle
  </a>
  .
 </p>
 <h3 id="UI">
  Implementing a user interface
 </h3>
 <p>
  The user interface for an activity is provided by a hierarchy of views&mdash;objects derived
from the
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  class.  Each view controls a particular rectangular space
within the activity's window and can respond to user interaction. For example, a view might be a
button that initiates an action when the user touches it.
 </p>
 <p>
  Android provides a number of ready-made views that you can use to design and organize your
layout. "Widgets" are views that provide a visual (and interactive) elements for the screen, such
as a button, text field, checkbox, or just an image. "Layouts" are views derived from
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  that provide a unique layout model for its child views, such as a linear
layout, a grid layout, or relative layout. You can also subclass the
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  classes (or existing subclasses) to create your own widgets and
layouts and apply them to your activity layout.
 </p>
 <p>
  The most common way to define a layout using views is with an XML layout file saved in your
application resources. This way, you can maintain the design of your user interface separately from
the source code that defines the activity's behavior. You can set the layout as the UI for your
activity with
  <code>
   <a href="/reference/android/app/Activity.html#setContentView(int)">
    setContentView()
   </a>
  </code>
  , passing the
resource ID for the layout. However, you can also create new
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  s in your
activity code and build a view hierarchy by inserting new
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  s into a
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  , then use that layout by passing the root
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  to
  <code>
   <a href="/reference/android/app/Activity.html#setContentView(android.view.View)">
    setContentView()
   </a>
  </code>
  .
 </p>
 <p>
  For information about creating a user interface, see the
  <a href="/guide/topics/ui/index.html">
   User Interface
  </a>
  documentation.
 </p>
 <h3 id="Declaring">
  Declaring the activity in the manifest
 </h3>
 <p>
  You must declare your activity in the manifest file in order for it to
be accessible to the system. To declare your activity, open your manifest file and add an
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element
as a child of the
  <a href="/guide/topics/manifest/application-element.html">
   <code>
    &lt;application&gt;
   </code>
  </a>
  element. For example:
 </p>
 <pre>
&lt;manifest ... &gt;
  &lt;application ... &gt;
      &lt;activity android:name=".ExampleActivity" /&gt;
      ...
  &lt;/application ... &gt;
  ...
&lt;/manifest &gt;
</pre>
 <p>
  There are several other attributes that you can include in this element, to define properties
such as the label for the activity, an icon for the activity, or a theme to style the activity's
UI. The
  <a href="/guide/topics/manifest/activity-element.html#nm">
   <code>
    android:name
   </code>
  </a>
  attribute is the only required attribute&mdash;it specifies the class name of the activity. Once
you publish your application, you should not change this name, because if you do, you might break
some functionality, such as application shortcuts (read the blog post,
  <a href="http://android-developers.blogspot.com/2011/06/things-that-cannot-change.html">
   Things
That Cannot Change
  </a>
  ).
 </p>
 <p>
  See the
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element
reference for more information about declaring your activity in the manifest.
 </p>
 <h4>
  Using intent filters
 </h4>
 <p>
  An
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element can also specify various intent filters&mdash;using the
  <a href="/guide/topics/manifest/intent-filter-element.html">
   <code>
    &lt;intent-filter&gt;
   </code>
  </a>
  element&mdash;in order to declare how other application components may
activate it.
 </p>
 <p>
  When you create a new application using the Android SDK tools, the stub activity
that's created for you automatically includes an intent filter that declares the activity
responds to the "main" action and should be placed in the "launcher" category. The intent filter
looks like this:
 </p>
 <pre>
&lt;activity android:name=".ExampleActivity" android:icon="@drawable/app_icon"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.MAIN" /&gt;
        &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p>
  The
  <a href="/guide/topics/manifest/action-element.html">
   <code>
    &lt;action&gt;
   </code>
  </a>
  element specifies that this is the "main" entry point to the application. The
  <a href="/guide/topics/manifest/category-element.html">
   <code>
    &lt;category&gt;
   </code>
  </a>
  element specifies that this activity should be listed in the
system's application launcher (to allow users to launch this activity).
 </p>
 <p>
  If you intend for your application to be self-contained and not allow other applications to
activate its activities, then you don't need any other intent filters. Only one activity should
have the "main" action and "launcher" category, as in the previous example. Activities that
you don't want to make available to other applications should have no intent filters and you can
start them yourself using explicit intents (as discussed in the following section).
 </p>
 <p>
  However, if you want your activity to respond to implicit intents that are delivered from
other applications (and your own), then you must define additional intent filters for your
activity. For each type of intent to which you want to respond, you must include an
  <a href="/guide/topics/manifest/intent-filter-element.html">
   <code>
    &lt;intent-filter&gt;
   </code>
  </a>
  that includes an
  <a href="/guide/topics/manifest/action-element.html">
   <code>
    &lt;action&gt;
   </code>
  </a>
  element and, optionally, a
  <a href="/guide/topics/manifest/category-element.html">
   <code>
    &lt;category&gt;
   </code>
  </a>
  element and/or a
  <a href="/guide/topics/manifest/data-element.html">
   <code>
    &lt;data&gt;
   </code>
  </a>
  element. These elements specify the type of intent to which your activity can
respond.
 </p>
 <p>
  For more information about how your activities can respond to intents, see the
  <a href="/guide/components/intents-filters.html">
   Intents and Intent Filters
  </a>
  document.
 </p>
 <h2 id="StartingAnActivity">
  Starting an Activity
 </h2>
 <p>
  You can start another activity by calling
  <code>
   <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  , passing it an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  that describes the activity you
  want to start. The intent specifies either the exact activity you want to start or describes the
  type of action you want to perform (and the system selects the appropriate activity for you,
which
  can even be from a different application). An intent can also carry small amounts of data to be
  used by the activity that is started.
 </p>
 <p>
  When working within your own application, you'll often need to simply launch a known activity.
 You can do so by creating an intent that explicitly defines the activity you want to start,
using the class name. For example, here's how one activity starts another activity named
  <code>
   SignInActivity
  </code>
  :
 </p>
 <pre>
Intent intent = new Intent(this, SignInActivity.class);
startActivity(intent);
</pre>
 <p>
  However, your application might also want to perform some action, such as send an email, text
  message, or status update, using data from your activity. In this case, your application might
 not have its own activities to perform such actions, so you can instead leverage the activities
  provided by other applications on the device, which can perform the actions for you. This is where
intents are really valuable&mdash;you can create an intent that describes an action you want to
perform and the system
  launches the appropriate activity from another application. If there are
  multiple activities that can handle the intent, then the user can select which one to use. For
  example, if you want to allow the user to send an email message, you can create the
  following intent:
 </p>
 <pre>
Intent intent = new Intent(Intent.ACTION_SEND);
intent.putExtra(Intent.EXTRA_EMAIL, recipientArray);
startActivity(intent);
</pre>
 <p>
  The
  <code>
   <a href="/reference/android/content/Intent.html#EXTRA_EMAIL">
    EXTRA_EMAIL
   </a>
  </code>
  extra added to the intent is a string array of
  email addresses to which the email should be sent. When an email application responds to this
  intent, it reads the string array provided in the extra and places them in the "to" field of the
  email composition form. In this situation, the email application's activity starts and when the
  user is done, your activity resumes.
 </p>
 <h3 id="StartingAnActivityForResult">
  Starting an activity for a result
 </h3>
 <p>
  Sometimes, you might want to receive a result from the activity that you start. In that case,
  start the activity by calling
  <code>
   <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
    startActivityForResult()
   </a>
  </code>
  (instead of
  <code>
   <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  ). To then receive the result from the subsequent
activity, implement the
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  callback
  method. When the subsequent activity is done, it returns a result in an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  to your
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  method.
 </p>
 <p>
  For example, perhaps you want the user to pick one of their contacts, so your activity can
do something with the information in that contact. Here's how you can create such an intent and
handle the result:
 </p>
 <pre>
private void pickContact() {
    // Create an intent to "pick" a contact, as defined by the content provider URI
    Intent intent = new Intent(Intent.ACTION_PICK, Contacts.CONTENT_URI);
    startActivityForResult(intent, PICK_CONTACT_REQUEST);
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    // If the request went well (OK) and the request was PICK_CONTACT_REQUEST
    if (resultCode == Activity.RESULT_OK &amp;&amp; requestCode == PICK_CONTACT_REQUEST) {
        // Perform a query to the contact's content provider for the contact's name
        Cursor cursor = getContentResolver().query(data.getData(),
        new String[] {Contacts.DISPLAY_NAME}, null, null, null);
        if (cursor.moveToFirst()) { // True if the cursor is not empty
            int columnIndex = cursor.getColumnIndex(Contacts.DISPLAY_NAME);
            String name = cursor.getString(columnIndex);
            // Do something with the selected contact's name...
        }
    }
}
</pre>
 <p>
  This example shows the basic logic you should use in your
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  method in order to handle an
activity result. The first condition checks whether the request was successful&mdash;if it was, then
the
  <code>
   resultCode
  </code>
  will be
  <code>
   <a href="/reference/android/app/Activity.html#RESULT_OK">
    RESULT_OK
   </a>
  </code>
  &mdash;and whether the request
to which this result is responding is known&mdash;in this case, the
  <code>
   requestCode
  </code>
  matches the
second parameter sent with
  <code>
   <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
    startActivityForResult()
   </a>
  </code>
  . From there, the code handles the activity result by querying the
data returned in an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  (the
  <code>
   data
  </code>
  parameter).
 </p>
 <p>
  What happens is, a
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  performs a query against a content provider, which returns a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  that allows the queried data to be read. For more information, see
the
  <a href="/guide/topics/providers/content-providers.html">
   Content Providers
  </a>
  document.
 </p>
 <p>
  For more information about using intents, see the
  <a href="/guide/components/intents-filters.html">
   Intents and Intent
Filters
  </a>
  document.
 </p>
 <h2 id="ShuttingDown">
  Shutting Down an Activity
 </h2>
 <p>
  You can shut down an activity by calling its
  <code>
   <a href="/reference/android/app/Activity.html#finish()">
    finish()
   </a>
  </code>
  method. You can also shut down a separate activity that you previously started by calling
  <code>
   <a href="/reference/android/app/Activity.html#finishActivity(int)">
    finishActivity()
   </a>
  </code>
  .
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  In most cases, you should not explicitly finish an activity
using these methods. As discussed in the following section about the activity lifecycle, the
Android system manages the life of an activity for you, so you do not need to finish your own
activities. Calling these methods could adversely affect the expected user
experience and should only be used when you absolutely do not want the user to return to this
instance of the activity.
 </p>
 <h2 id="Lifecycle">
  Managing the Activity Lifecycle
 </h2>
 <p>
  Managing the lifecycle of your activities by implementing callback methods is
crucial to developing a strong
and flexible application. The lifecycle of an activity is directly affected by its association with
other activities, its task and back stack.
 </p>
 <p>
  An activity can exist in essentially three states:
 </p>
 <dl>
  <dt>
   <i>
    Resumed
   </i>
  </dt>
  <dd>
   The activity is in the foreground of the screen and has user focus. (This state is
also sometimes referred to as "running".)
  </dd>
  <dt>
   <i>
    Paused
   </i>
  </dt>
  <dd>
   Another activity is in the foreground and has focus, but this one is still visible. That is,
another activity is visible on top of this one and that activity is partially transparent or doesn't
cover the entire screen. A paused activity is completely alive (the
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   object is retained in memory, it maintains all state and member information, and remains attached to
the window manager), but can be killed by the system in extremely low memory situations.
  </dd>
  <dt>
   <i>
    Stopped
   </i>
  </dt>
  <dd>
   The activity is completely obscured by another activity (the activity is now in the
"background"). A stopped activity is also still alive (the
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   object is retained in memory, it maintains all state and member information, but is
   <em>
    not
   </em>
   attached to the window manager). However, it is no longer visible to the user and it
can be killed by the system when memory is needed elsewhere.
  </dd>
 </dl>
 <p>
  If an activity is paused or stopped, the system can drop it from memory either by asking it to
finish (calling its
  <code>
   <a href="/reference/android/app/Activity.html#finish()">
    finish()
   </a>
  </code>
  method), or simply killing its
process.  When the activity is opened again (after being finished or killed), it must be created all
over.
 </p>
 <h3 id="ImplementingLifecycleCallbacks">
  Implementing the lifecycle callbacks
 </h3>
 <p>
  When an activity transitions into and out of the different states described above, it is notified
through various callback methods. All of the callback methods are hooks that you
can override to do appropriate work when the state of your activity changes. The following skeleton
activity includes each of the fundamental lifecycle methods:
 </p>
 <pre>
public class ExampleActivity extends Activity {
    @Override
    public void <code><a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate</a></code>(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // The activity is being created.
    }
    @Override
    protected void <code><a href="/reference/android/app/Activity.html#onStart()">onStart()</a></code> {
        super.onStart();
        // The activity is about to become visible.
    }
    @Override
    protected void <code><a href="/reference/android/app/Activity.html#onResume()">onResume()</a></code> {
        super.onResume();
        // The activity has become visible (it is now "resumed").
    }
    @Override
    protected void <code><a href="/reference/android/app/Activity.html#onPause()">onPause()</a></code> {
        super.onPause();
        // Another activity is taking focus (this activity is about to be "paused").
    }
    @Override
    protected void <code><a href="/reference/android/app/Activity.html#onStop()">onStop()</a></code> {
        super.onStop();
        // The activity is no longer visible (it is now "stopped")
    }
    @Override
    protected void <code><a href="/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code> {
        super.onDestroy();
        // The activity is about to be destroyed.
    }
}
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  Your implementation of these lifecycle methods must
always call the superclass implementation before doing any work, as shown in the examples above.
 </p>
 <p>
  Taken together, these methods define the entire lifecycle of an activity. By implementing these
methods, you can monitor three nested loops in the activity lifecycle:
 </p>
 <ul>
  <li>
   The
   <b>
    entire lifetime
   </b>
   of an activity happens between the call to
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
   and the call to
   <code>
    <a href="/reference/android/app/Activity.html#onDestroy()">
     onDestroy()
    </a>
   </code>
   . Your activity should perform setup of
"global" state (such as defining layout) in
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
   , and
release all remaining resources in
   <code>
    <a href="/reference/android/app/Activity.html#onDestroy()">
     onDestroy()
    </a>
   </code>
   . For example, if your
activity has a thread running in the background to download data from the network, it might create
that thread in
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
   and then stop the thread in
   <code>
    <a href="/reference/android/app/Activity.html#onDestroy()">
     onDestroy()
    </a>
   </code>
   .
  </li>
  <li>
   <p>
    The
    <b>
     visible lifetime
    </b>
    of an activity happens between the call to
    <code>
     <a href="/reference/android/app/Activity.html#onStart()">
      onStart()
     </a>
    </code>
    and the call to
    <code>
     <a href="/reference/android/app/Activity.html#onStop()">
      onStop()
     </a>
    </code>
    . During this time, the user can see the activity
on-screen and interact with it. For example,
    <code>
     <a href="/reference/android/app/Activity.html#onStop()">
      onStop()
     </a>
    </code>
    is called
when a new activity starts and this one is no longer visible. Between these two methods, you can
maintain resources that are needed to show the activity to the user. For example, you can register a
    <code>
     <a href="/reference/android/content/BroadcastReceiver.html">
      BroadcastReceiver
     </a>
    </code>
    in
    <code>
     <a href="/reference/android/app/Activity.html#onStart()">
      onStart()
     </a>
    </code>
    to monitor changes that impact your UI, and unregister
it in
    <code>
     <a href="/reference/android/app/Activity.html#onStop()">
      onStop()
     </a>
    </code>
    when the user can no longer see what you are
displaying. The system might call
    <code>
     <a href="/reference/android/app/Activity.html#onStart()">
      onStart()
     </a>
    </code>
    and
    <code>
     <a href="/reference/android/app/Activity.html#onStop()">
      onStop()
     </a>
    </code>
    multiple times during the entire lifetime of the activity, as
the activity alternates between being visible and hidden to the user.
   </p>
  </li>
  <li>
   <p>
    The
    <b>
     foreground lifetime
    </b>
    of an activity happens between the call to
    <code>
     <a href="/reference/android/app/Activity.html#onResume()">
      onResume()
     </a>
    </code>
    and the call to
    <code>
     <a href="/reference/android/app/Activity.html#onPause()">
      onPause()
     </a>
    </code>
    . During this time, the activity is in front of all other activities on screen and has
user input focus.  An activity can frequently transition in and out of the foreground&mdash;for
example,
    <code>
     <a href="/reference/android/app/Activity.html#onPause()">
      onPause()
     </a>
    </code>
    is called when the device goes to sleep or
when a dialog appears. Because this state can transition often, the code in these two methods should
be fairly lightweight in order to avoid slow transitions that make the user wait.
   </p>
  </li>
 </ul>
 <p>
  Figure 1 illustrates these loops and the paths an activity might take between states.
The rectangles represent the callback methods you can implement to perform operations when
the activity transitions between states.
 </p>
 <p>
  <img alt="" src="http://developer.android.com/images/activity_lifecycle.png"/>
 </p>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  The activity lifecycle.
 </p>
 <p>
  The same lifecycle callback methods are listed in table 1, which describes each of the callback
methods in more detail and locates each one within the
activity's overall lifecycle, including whether the system can kill the activity after the
callback method completes.
 </p>
 <p class="table-caption">
  <strong>
   Table 1.
  </strong>
  A summary of the activity lifecycle's
callback methods.
 </p>
 <table border="2" frame="hsides" rules="rows" width="85%">
  <colgroup align="left" span="3">
  </colgroup>
  <colgroup align="left">
  </colgroup>
  <colgroup align="center">
  </colgroup>
  <colgroup align="center">
  </colgroup>
  <thead>
   <tr>
    <th colspan="3">
     Method
    </th>
    <th>
     Description
    </th>
    <th>
     Killable after?
    </th>
    <th>
     Next
    </th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <td align="left" colspan="3">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
        onCreate()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called when the activity is first created.
      This is where you should do all of your normal static set up &mdash;
      create views, bind data to lists, and so on.  This method is passed
      a Bundle object containing the activity's previous state, if that
      state was captured (see
     <a href="#actstate">
      Saving Activity State
     </a>
     ,
      later).
     <p>
      Always followed by
      <code>
       onStart()
      </code>
      .
     </p>
    </td>
    <td align="center">
     No
    </td>
    <td align="center">
     <code>
      onStart()
     </code>
    </td>
   </tr>
   <tr>
    <td rowspan="5" style="border-left: none; border-right: none;">
     &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" colspan="2">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onRestart()">
        onRestart()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called after the activity has been stopped, just prior to it being
       started again.
     <p>
      Always followed by
      <code>
       onStart()
      </code>
     </p>
    </td>
    <td align="center">
     No
    </td>
    <td align="center">
     <code>
      onStart()
     </code>
    </td>
   </tr>
   <tr>
    <td align="left" colspan="2">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onStart()">
        onStart()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called just before the activity becomes visible to the user.
     <p>
      Followed by
      <code>
       onResume()
      </code>
      if the activity comes
       to the foreground, or
      <code>
       onStop()
      </code>
      if it becomes hidden.
     </p>
    </td>
    <td align="center">
     No
    </td>
    <td align="center">
     <code>
      onResume()
     </code>
     <br/>
     or
     <br/>
     <code>
      onStop()
     </code>
    </td>
   </tr>
   <tr>
    <td rowspan="2" style="border-left: none;">
     &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onResume()">
        onResume()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called just before the activity starts
       interacting with the user.  At this point the activity is at
       the top of the activity stack, with user input going to it.
     <p>
      Always followed by
      <code>
       onPause()
      </code>
      .
     </p>
    </td>
    <td align="center">
     No
    </td>
    <td align="center">
     <code>
      onPause()
     </code>
    </td>
   </tr>
   <tr>
    <td align="left">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onPause()">
        onPause()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called when the system is about to start resuming another
       activity.  This method is typically used to commit unsaved changes to
       persistent data, stop animations and other things that may be consuming
       CPU, and so on.  It should do whatever it does very quickly, because
       the next activity will not be resumed until it returns.
     <p>
      Followed either by
      <code>
       onResume()
      </code>
      if the activity
       returns back to the front, or by
      <code>
       onStop()
      </code>
      if it becomes
       invisible to the user.
     </p>
    </td>
    <td align="center">
     <strong style="color:#800000">
      Yes
     </strong>
    </td>
    <td align="center">
     <code>
      onResume()
     </code>
     <br/>
     or
     <br/>
     <code>
      onStop()
     </code>
    </td>
   </tr>
   <tr>
    <td align="left" colspan="2">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onStop()">
        onStop()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called when the activity is no longer visible to the user.  This
       may happen because it is being destroyed, or because another activity
       (either an existing one or a new one) has been resumed and is covering it.
     <p>
      Followed either by
      <code>
       onRestart()
      </code>
      if
       the activity is coming back to interact with the user, or by
      <code>
       onDestroy()
      </code>
      if this activity is going away.
     </p>
    </td>
    <td align="center">
     <strong style="color:#800000">
      Yes
     </strong>
    </td>
    <td align="center">
     <code>
      onRestart()
     </code>
     <br/>
     or
     <br/>
     <code>
      onDestroy()
     </code>
    </td>
   </tr>
   <tr>
    <td align="left" colspan="3">
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#onDestroy()">
        onDestroy()
       </a>
      </code>
     </code>
    </td>
    <td>
     Called before the activity is destroyed.  This is the final call
       that the activity will receive.  It could be called either because the
       activity is finishing (someone called
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#finish()">
        finish()
       </a>
      </code>
     </code>
     on it), or because the system is temporarily destroying this
       instance of the activity to save space.  You can distinguish
       between these two scenarios with the
     <code>
      <code>
       <a href="/reference/android/app/Activity.html#isFinishing()">
        isFinishing()
       </a>
      </code>
     </code>
     method.
    </td>
    <td align="center">
     <strong style="color:#800000">
      Yes
     </strong>
    </td>
    <td align="center">
     <em>
      nothing
     </em>
    </td>
   </tr>
  </tbody>
 </table>
 <p>
  The column labeled "Killable after?" indicates whether or not the system can
kill the process hosting the activity at any time
  <em>
   after the method returns
  </em>
  , without
executing another line of the activity's code.  Three methods are marked "yes": (
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/app/Activity.html#onStop()">
    onStop()
   </a>
  </code>
  , and
  <code>
   <a href="/reference/android/app/Activity.html#onDestroy()">
    onDestroy()
   </a>
  </code>
  ). Because
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  is the first
of the three, once the activity is created,
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  is the
last method that's guaranteed to be called before the process
  <em>
   can
  </em>
  be killed&mdash;if
the system must recover memory in an emergency, then
  <code>
   <a href="/reference/android/app/Activity.html#onStop()">
    onStop()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/app/Activity.html#onDestroy()">
    onDestroy()
   </a>
  </code>
  might
not be called. Therefore, you should use
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  to write
crucial persistent data (such as user edits) to storage. However, you should be selective about
what information must be retained during
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  , because any
blocking procedures in this method block the transition to the next activity and slow the user
experience.
 </p>
 <p>
  Methods that are marked "No" in the
  <b>
   Killable
  </b>
  column protect the process hosting the
activity from being killed from the moment they are called.  Thus, an activity is killable
from the time
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  returns to the time
  <code>
   <a href="/reference/android/app/Activity.html#onResume()">
    onResume()
   </a>
  </code>
  is called. It will not again be killable until
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  is again called and returns.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  An activity that's not technically "killable" by this
definition in table 1 might still be killed by the system&mdash;but that would happen only in
extreme circumstances when there is no other recourse. When an activity might be killed is
discussed more in the
  <a href="/guide/components/processes-and-threads.html">
   Processes and
Threading
  </a>
  document.
 </p>
 <h3 id="SavingActivityState">
  Saving activity state
 </h3>
 <p>
  The introduction to
  <a href="#Lifecycle">
   Managing the Activity Lifecycle
  </a>
  briefly mentions
that
when an activity is paused or stopped, the state of the activity is retained. This is true because
the
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  object is still held in memory when it is paused or
stopped&mdash;all information about its members and current state is still alive. Thus, any changes
the user made within the activity are retained so that when the activity returns to the
foreground (when it "resumes"), those changes are still there.
 </p>
 <p>
  However, when the system destroys an activity in order to recover memory, the
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  object is destroyed, so the system cannot simply resume it with its state
intact. Instead, the system must recreate the
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  object if the user
navigates back to it. Yet, the user is unaware
that the system destroyed the activity and recreated it and, thus, probably
expects the activity to be exactly as it was. In this situation, you can ensure that
important information about the activity state is preserved by implementing an additional
callback method that allows you to save information about the state of your activity:
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  .
 </p>
 <p>
  The system calls
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  before making the activity vulnerable to destruction. The system passes this method
a
  <code>
   <a href="/reference/android/os/Bundle.html">
    Bundle
   </a>
  </code>
  in which you can save 
state information about the activity as name-value pairs, using methods such as
  <code>
   <a href="/reference/android/os/BaseBundle.html#putString(java.lang.String, java.lang.String)">
    putString()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/os/BaseBundle.html#putInt(java.lang.String, int)">
    putInt()
   </a>
  </code>
  . Then, if the system kills your application
process and the user navigates back to your activity, the system recreates the activity and passes
the
  <code>
   <a href="/reference/android/os/Bundle.html">
    Bundle
   </a>
  </code>
  to both
  <code>
   <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">
    onRestoreInstanceState()
   </a>
  </code>
  . Using either of these
methods, you can extract your saved state from the
  <code>
   <a href="/reference/android/os/Bundle.html">
    Bundle
   </a>
  </code>
  and restore the
activity state. If there is no state information to restore, then the
  <code>
   <a href="/reference/android/os/Bundle.html">
    Bundle
   </a>
  </code>
  passed to you is null (which is the case when the activity is created for
the first time).
 </p>
 <img alt="" src="http://developer.android.com/images/fundamentals/restore_instance.png"/>
 <p class="img-caption">
  <strong>
   Figure 2.
  </strong>
  The two ways in which an activity returns to user
focus with its state intact: either the activity is destroyed, then recreated and the activity must restore
the previously saved state, or the activity is stopped, then resumed and the activity state
remains intact.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  There's no guarantee that
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  will be called before your
activity is destroyed, because there are cases in which it won't be necessary to save the state
(such as when the user leaves your activity using the
  <em>
   Back
  </em>
  button, because the user is
explicitly
closing the activity). If the system calls
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  , it does so before
  <code>
   <a href="/reference/android/app/Activity.html#onStop()">
    onStop()
   </a>
  </code>
  and possibly before
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  .
 </p>
 <p>
  However, even if you do nothing and do not implement
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  , some of the activity state is
restored by the
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  class's default implementation of
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  . Specifically, the default
implementation calls the corresponding
  <code>
   <a href="/reference/android/view/View.html#onSaveInstanceState()">
    onSaveInstanceState()
   </a>
  </code>
  method for every
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  in the layout, which allows each view to provide information about itself
that should be saved. Almost every widget in the Android framework implements this method as
appropriate, such that any visible changes to the UI are automatically saved and restored when your
activity is recreated. For example, the
  <code>
   <a href="/reference/android/widget/EditText.html">
    EditText
   </a>
  </code>
  widget saves any text
entered by the user and the
  <code>
   <a href="/reference/android/widget/CheckBox.html">
    CheckBox
   </a>
  </code>
  widget saves whether it's checked or
not. The only work required by you is to provide a unique ID (with the
  <a href="/guide/topics/resources/layout-resource.html#idvalue">
   <code>
    android:id
   </code>
  </a>
  attribute) for each widget you want to save its state. If a widget does not have an ID, then the
system cannot save its state.
 </p>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <p>
    You can also explicitly stop a view in your layout from saving its state by setting the
    <code>
     <a href="/reference/android/R.attr.html#saveEnabled">
      android:saveEnabled
     </a>
    </code>
    attribute to
    <code>
     "false"
    </code>
    or by calling
the
    <code>
     <a href="/reference/android/view/View.html#setSaveEnabled(boolean)">
      setSaveEnabled()
     </a>
    </code>
    method. Usually, you should not
disable this, but you might if you want to restore the state of the activity UI differently.
   </p>
  </div>
 </div>
 <p>
  Although the default implementation of
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  saves useful information about
your activity's UI, you still might need to override it to save additional information.
For example, you might need to save member values that changed during the activity's life (which
might correlate to values restored in the UI, but the members that hold those UI values are not
restored, by default).
 </p>
 <p>
  Because the default implementation of
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  helps save the state of the UI, if
you override the method in order to save additional state information, you should always call the
superclass implementation of
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  before doing any work. Likewise, you should also call the superclass implementation of
  <code>
   <a href="/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">
    onRestoreInstanceState()
   </a>
  </code>
  if you override it, so the
default implementation can restore view states.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Because
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  is not guaranteed
to be called, you should use it only to record the transient state of the activity (the state of
the UI)&mdash;you should never use it to store persistent data.  Instead, you should use
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  to store persistent data (such as data that should be saved
to a database) when the user leaves the activity.
 </p>
 <p>
  A good way to test your application's ability to restore its state is to simply rotate the
device so that the screen orientation changes. When the screen orientation changes, the system
destroys and recreates the activity in order to apply alternative resources that might be available
for the new screen configuration. For this reason alone, it's very important that your activity
completely restores its state when it is recreated, because users regularly rotate the screen while
using applications.
 </p>
 <h3 id="ConfigurationChanges">
  Handling configuration changes
 </h3>
 <p>
  Some device configurations can change during runtime (such as screen orientation, keyboard
availability, and language). When such a change occurs, Android recreates the running activity
(the system calls
  <code>
   <a href="/reference/android/app/Activity.html#onDestroy()">
    onDestroy()
   </a>
  </code>
  , then immediately calls
  <code>
   <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  ). This behavior is
designed to help your application adapt to new configurations by automatically reloading your
application with alternative resources that you've provided (such as different layouts for
different screen orientations and sizes).
 </p>
 <p>
  If you properly design your activity to handle a restart due to a screen orientation change and
restore the activity state as described above, your application will be more resilient to other
unexpected events in the activity lifecycle.
 </p>
 <p>
  The best way to handle such a restart is
  to save and restore the state of your activity using
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">
    onRestoreInstanceState()
   </a>
  </code>
  (or
  <code>
   <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  ), as discussed in the previous section.
 </p>
 <p>
  For more information about configuration changes that happen at runtime and how you can handle
them, read the guide to
  <a href="/guide/topics/resources/runtime-changes.html">
   Handling
Runtime Changes
  </a>
  .
 </p>
 <h3 id="CoordinatingActivities">
  Coordinating activities
 </h3>
 <p>
  When one activity starts another, they both experience lifecycle transitions. The first activity
pauses and stops (though, it won't stop if it's still visible in the background), while the other
activity is created. In case these activities share data saved to disc or elsewhere, it's important
to understand that the first activity is not completely stopped before the second one is created.
Rather, the process of starting the second one overlaps with the process of stopping the first
one.
 </p>
 <p>
  The order of lifecycle callbacks is well defined, particularly when the two activities are in the
same process and one is starting the other. Here's the order of operations that occur when Activity
A starts Acivity B:
 </p>
 <ol>
  <li>
   Activity A's
   <code>
    <a href="/reference/android/app/Activity.html#onPause()">
     onPause()
    </a>
   </code>
   method executes.
  </li>
  <li>
   Activity B's
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
   ,
   <code>
    <a href="/reference/android/app/Activity.html#onStart()">
     onStart()
    </a>
   </code>
   , and
   <code>
    <a href="/reference/android/app/Activity.html#onResume()">
     onResume()
    </a>
   </code>
   methods execute in sequence. (Activity B now has user focus.)
  </li>
  <li>
   Then, if Activity A is no longer visible on screen, its
   <code>
    <a href="/reference/android/app/Activity.html#onStop()">
     onStop()
    </a>
   </code>
   method executes.
  </li>
 </ol>
 <p>
  This predictable sequence of lifecycle callbacks allows you to manage the transition of
information from one activity to another. For example, if you must write to a database when the
first activity stops so that the following activity can read it, then you should write to the
database during
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  instead of during
  <code>
   <a href="/reference/android/app/Activity.html#onStop()">
    onStop()
   </a>
  </code>
  .
 </p>
 <!--
<h2>Beginner's Path</h2>

<p>For more information about how Android maintains a history of activities and
enables user multitasking, continue with the <b><a
href="/guide/components/tasks-and-back-stack.html">Tasks and Back
Stack</a></b> document.</p>
-->
</div>
<h1>Fragments</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Design">
      Design Philosophy
     </a>
    </li>
    <li>
     <a href="#Creating">
      Creating a Fragment
     </a>
     <ol>
      <li>
       <a href="#UI">
        Adding a user interface
       </a>
      </li>
      <li>
       <a href="#Adding">
        Adding a fragment to an activity
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Managing">
      Managing Fragments
     </a>
    </li>
    <li>
     <a href="#Transactions">
      Performing Fragment Transactions
     </a>
    </li>
    <li>
     <a href="#CommunicatingWithActivity">
      Communicating with the Activity
     </a>
     <ol>
      <li>
       <a href="#EventCallbacks">
        Creating event callbacks to the activity
       </a>
      </li>
      <li>
       <a href="#ActionBar">
        Adding items to the Action Bar
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Lifecycle">
      Handling the Fragment Lifecycle
     </a>
     <ol>
      <li>
       <a href="#CoordinatingWithActivity">
        Coordinating with the activity lifecycle
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Example">
      Example
     </a>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/app/Fragment.html">
       Fragment
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/app/FragmentManager.html">
       FragmentManager
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/app/FragmentTransaction.html">
       FragmentTransaction
      </a>
     </code>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/training/basics/fragments/index.html">
      Building a Dynamic UI with Fragments
     </a>
    </li>
    <li>
     <a href="/guide/practices/tablets-and-handsets.html">
      Supporting Tablets
and Handsets
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  A
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  represents a behavior or a portion of user interface in an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  . You can combine multiple fragments in a single activity to build a
multi-pane UI and reuse a fragment in multiple activities. You can think of a fragment as a
modular section of an activity, which has its own lifecycle, receives its own input events, and
which you can add or remove while the activity is running (sort of like a "sub activity" that
you can reuse in different activities).
 </p>
 <p>
  A fragment must always be embedded in an activity and the fragment's lifecycle is directly
affected by the host activity's lifecycle. For example, when the activity is paused, so are all
fragments in it, and when the activity is destroyed, so are all fragments. However, while an
activity is running (it is in the
  <em>
   resumed
  </em>
  <a href="/guide/components/activities.html#Lifecycle">
   lifecycle state
  </a>
  ), you can
manipulate each fragment independently, such as add or remove them. When you perform such a
fragment transaction, you can also add it to a back stack that's managed by the
activity&mdash;each back stack entry in the activity is a record of the fragment transaction that
occurred. The back stack allows the user to reverse a fragment transaction (navigate backwards),
by pressing the
  <em>
   Back
  </em>
  button.
 </p>
 <p>
  When you add a fragment as a part of your activity layout, it lives in a
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  inside the activity's view hierarchy and the fragment defines its own view
layout.
You can insert a fragment into your activity layout by declaring the fragment in the activity's
layout file, as a
  <code>
   &lt;fragment&gt;
  </code>
  element, or from your application code by adding it to an
existing
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  . However, a fragment is not required to be a part of the
activity layout; you may also use a fragment without its own UI as an invisible worker for the
activity.
 </p>
 <p>
  This document describes how to build your application to use fragments, including
how fragments can maintain their state when added to the activity's back stack, share
events with the activity and other fragments in the activity, contribute to the activity's action
bar, and more.
 </p>
 <h2 id="Design">
  Design Philosophy
 </h2>
 <p>
  Android introduced fragments in Android 3.0 (API level 11), primarily to support more
dynamic and flexible UI designs on large screens, such as tablets. Because a
tablet's screen is much larger than that of a handset, there's more room to combine and
interchange UI components. Fragments allow such designs without the need for you to manage complex
changes to the view hierarchy. By dividing the layout of an activity into fragments, you become able
to modify the activity's appearance at runtime and preserve those changes in a back stack
that's managed by the activity.
 </p>
 <p>
  For example, a news application can use one fragment to show a list of articles on the
left and another fragment to display an article on the right&mdash;both fragments appear in one
activity, side by side, and each fragment has its own set of lifecycle callback methods and handle
their own user input events. Thus, instead of using one activity to select an article and another
activity to read the article, the user can select an article and read it all within the same
activity, as illustrated in the tablet layout in figure 1.
 </p>
 <p>
  You should design each fragment as a modular and reusable activity component. That is, because
each fragment defines its own layout and its own behavior with its own lifecycle callbacks, you can
include one fragment in multiple activities, so you should design for reuse and avoid directly
manipulating one fragment from another fragment. This is especially important because a modular
fragment allows you to change your fragment combinations for different screen sizes. When designing
your application to support both tablets and handsets, you can reuse your fragments in different
layout configurations to optimize the user experience based on the available screen space. For
example, on a handset, it might be necessary to separate fragments to provide a single-pane UI when
more than one cannot fit within the same activity.
 </p>
 <img alt="" src="http://developer.android.com/images/fundamentals/fragments.png"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  An example of how two UI modules defined by
fragments can be combined into one activity for a tablet design, but separated for a
handset design.
 </p>
 <p>
  For example&mdash;to continue with the news application example&mdash;the application can embed
two fragments in
  <em>
   Activity A
  </em>
  , when running on a tablet-sized device. However, on a
handset-sized screen, there's not enough room for both fragments, so
  <em>
   Activity A
  </em>
  includes
only the fragment for the list of articles, and when the user selects an article, it starts
  <em>
   Activity B
  </em>
  , which includes the second fragment to read the article. Thus, the application
supports both tablets and handsets by reusing fragments in different combinations, as illustrated in
figure 1.
 </p>
 <p>
  For more information about designing your application with different fragment combinations for
different screen configurations, see the guide to
  <a href="/guide/practices/tablets-and-handsets.html">
   Supporting Tablets and Handsets
  </a>
  .
 </p>
 <h2 id="Creating">
  Creating a Fragment
 </h2>
 <div class="figure" style="width:327px">
  <img alt="" src="http://developer.android.com/images/fragment_lifecycle.png"/>
  <p class="img-caption">
   <strong>
    Figure 2.
   </strong>
   The lifecycle of a fragment (while its
activity is running).
  </p>
 </div>
 <p>
  To create a fragment, you must create a subclass of
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  (or an existing
subclass of it). The
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  class has code that looks a lot like
an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  . It contains callback methods similar to an activity, such
as
  <code>
   <a href="/reference/android/app/Fragment.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/app/Fragment.html#onStart()">
    onStart()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/app/Fragment.html#onPause()">
    onPause()
   </a>
  </code>
  , and
  <code>
   <a href="/reference/android/app/Fragment.html#onStop()">
    onStop()
   </a>
  </code>
  . In
fact, if you're converting an existing Android application to use fragments, you might simply move
code from your activity's callback methods into the respective callback methods of your
fragment.
 </p>
 <p>
  Usually, you should implement at least the following lifecycle methods:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this when creating the fragment. Within your implementation, you should
initialize essential components of the fragment that you want to retain when the fragment is
paused or stopped, then resumed.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
     onCreateView()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this when it's time for the fragment to draw its user interface for the
first time. To draw a UI for your fragment, you must return a
   <code>
    <a href="/reference/android/view/View.html">
     View
    </a>
   </code>
   from this
method that is the root of your fragment's layout. You can return null if the fragment does not
provide a UI.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Activity.html#onPause()">
     onPause()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this method as the first indication that the user is leaving the
fragment (though it does not always mean the fragment is being destroyed). This is usually where you
should commit any changes that should be persisted beyond the current user session (because
the user might not come back).
  </dd>
 </dl>
 <p>
  Most applications should implement at least these three methods for every fragment, but there are
several other callback methods you should also use to handle various stages of the
fragment lifecycle. All the lifecycle callback methods are discussed in more detail in the section
about
  <a href="#Lifecycle">
   Handling the Fragment Lifecycle
  </a>
  .
 </p>
 <p>
  There are also a few subclasses that you might want to extend, instead of the base
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  class:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/DialogFragment.html">
     DialogFragment
    </a>
   </code>
  </dt>
  <dd>
   Displays a floating dialog. Using this class to create a dialog is a good alternative to using
the dialog helper methods in the
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   class, because you can
incorporate a fragment dialog into the back stack of fragments managed by the activity,
allowing the user to return to a dismissed fragment.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/ListFragment.html">
     ListFragment
    </a>
   </code>
  </dt>
  <dd>
   Displays a list of items that are managed by an adapter (such as a
   <code>
    <a href="/reference/android/widget/SimpleCursorAdapter.html">
     SimpleCursorAdapter
    </a>
   </code>
   ), similar to
   <code>
    <a href="/reference/android/app/ListActivity.html">
     ListActivity
    </a>
   </code>
   . It provides
several methods for managing a list view, such as the
   <code>
    <a href="/reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">
     onListItemClick()
    </a>
   </code>
   callback to
handle click events.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/preference/PreferenceFragment.html">
     PreferenceFragment
    </a>
   </code>
  </dt>
  <dd>
   Displays a hierarchy of
   <code>
    <a href="/reference/android/preference/Preference.html">
     Preference
    </a>
   </code>
   objects as a list, similar to
   <code>
    <a href="/reference/android/preference/PreferenceActivity.html">
     PreferenceActivity
    </a>
   </code>
   . This is useful when creating a "settings"
activity for your application.
  </dd>
 </dl>
 <h3 id="UI">
  Adding a user interface
 </h3>
 <p>
  A fragment is usually used as part of an activity's user interface and contributes its own
layout to the activity.
 </p>
 <p>
  To provide a layout for a fragment, you must implement the
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  callback method, which the Android system calls
when it's time for the fragment to draw its layout. Your implementation of this method must return a
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  that is the root of your fragment's layout.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  If your fragment is a subclass of
  <code>
   <a href="/reference/android/app/ListFragment.html">
    ListFragment
   </a>
  </code>
  , the default implementation returns a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  from
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  , so you don't need to implement it.
 </p>
 <p>
  To return a layout from
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  , you can inflate it from a
  <a href="/guide/topics/resources/layout-resource.html">
   layout resource
  </a>
  defined in XML. To
help you do so,
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  provides a
  <code>
   <a href="/reference/android/view/LayoutInflater.html">
    LayoutInflater
   </a>
  </code>
  object.
 </p>
 <p>
  For example, here's a subclass of
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  that loads a layout from the
  <code>
   example_fragment.xml
  </code>
  file:
 </p>
 <pre>
public static class ExampleFragment extends Fragment {
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.example_fragment, container, false);
    }
}
</pre>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h3>
    Creating a layout
   </h3>
   <p>
    In the sample above,
    <code>
     R.layout.example_fragment
    </code>
    is a reference to a layout resource
named
    <code>
     example_fragment.xml
    </code>
    saved in the application resources. For information about how to
create a layout in XML, see the
    <a href="/guide/topics/ui/index.html">
     User Interface
    </a>
    documentation.
   </p>
  </div>
 </div>
 <p>
  The
  <code>
   container
  </code>
  parameter passed to
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  is the parent
  <code>
   <a href="/reference/android/view/ViewGroup.html">
    ViewGroup
   </a>
  </code>
  (from the activity's layout) in which
your fragment layout
will be inserted. The
  <code>
   savedInstanceState
  </code>
  parameter is a
  <code>
   <a href="/reference/android/os/Bundle.html">
    Bundle
   </a>
  </code>
  that
provides data about the previous instance of the fragment, if the fragment is being resumed
(restoring state is discussed more in the section about
  <a href="#Lifecycle">
   Handling the
Fragment Lifecycle
  </a>
  ).
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/view/LayoutInflater.html#inflate(int, android.view.ViewGroup, boolean)">
    inflate()
   </a>
  </code>
  method takes
three arguments:
 </p>
 <ul>
  <li>
   The resource ID of the layout you want to inflate.
  </li>
  <li>
   The
   <code>
    <a href="/reference/android/view/ViewGroup.html">
     ViewGroup
    </a>
   </code>
   to be the parent of the inflated layout. Passing the
   <code>
    container
   </code>
   is important in order for the system to apply layout parameters to the root view of the
inflated layout, specified by the parent view in which it's going.
  </li>
  <li>
   A boolean indicating whether the inflated layout should be attached to the
   <code>
    <a href="/reference/android/view/ViewGroup.html">
     ViewGroup
    </a>
   </code>
   (the second parameter) during inflation. (In this case, this
is false because the system is already inserting the inflated layout into the
   <code>
    container
   </code>
   &mdash;passing true would create a redundant view group in the final layout.)
  </li>
 </ul>
 <p>
  Now you've seen how to create a fragment that provides a layout. Next, you need to add
the fragment to your activity.
 </p>
 <h3 id="Adding">
  Adding a fragment to an activity
 </h3>
 <p>
  Usually, a fragment contributes a portion of UI to the host activity, which is embedded as a part
of the activity's overall view hierarchy. There are two ways you can add a fragment to the activity
layout:
 </p>
 <ul>
  <li>
   <b>
    Declare the fragment inside the activity's layout file.
   </b>
   <p>
    In this case, you can
specify layout properties for the fragment as if it were a view. For example, here's the layout
file for an activity with two fragments:
   </p>
   <pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;fragment android:name="com.example.news.ArticleListFragment"
            android:id="@+id/list"
            android:layout_weight="1"
            android:layout_width="0dp"
            android:layout_height="match_parent" /&gt;
    &lt;fragment android:name="com.example.news.ArticleReaderFragment"
            android:id="@+id/viewer"
            android:layout_weight="2"
            android:layout_width="0dp"
            android:layout_height="match_parent" /&gt;
&lt;/LinearLayout&gt;
</pre>
   <p>
    The
    <code>
     android:name
    </code>
    attribute in the
    <code>
     &lt;fragment&gt;
    </code>
    specifies the
    <code>
     <a href="/reference/android/app/Fragment.html">
      Fragment
     </a>
    </code>
    class to instantiate in the layout.
   </p>
   <p>
    When the system creates this activity layout, it instantiates each fragment specified in the
layout and calls the
    <code>
     <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
      onCreateView()
     </a>
    </code>
    method for each one,
to retrieve each fragment's layout. The system inserts the
    <code>
     <a href="/reference/android/view/View.html">
      View
     </a>
    </code>
    returned by the
fragment directly in place of the
    <code>
     &lt;fragment&gt;
    </code>
    element.
   </p>
   <div class="note">
    <p>
     <strong>
      Note:
     </strong>
     Each fragment requires a unique identifier that
the system can use to restore the fragment if the activity is restarted (and which you can use to
capture the fragment to perform transactions, such as remove it). There are three ways to provide an
ID for a fragment:
    </p>
    <ul>
     <li>
      Supply the
      <code>
       android:id
      </code>
      attribute with a unique ID.
     </li>
     <li>
      Supply the
      <code>
       android:tag
      </code>
      attribute with a unique string.
     </li>
     <li>
      If you provide neither of the previous two, the system uses the ID of the container 
view.
     </li>
    </ul>
   </div>
  </li>
  <li>
   <b>
    Or, programmatically add the fragment to an existing
    <code>
     <a href="/reference/android/view/ViewGroup.html">
      ViewGroup
     </a>
    </code>
    .
   </b>
   <p>
    At any time while your activity is running, you can add fragments to your activity layout. You
simply need to specify a
    <code>
     <a href="/reference/android/view/ViewGroup.html">
      ViewGroup
     </a>
    </code>
    in which to place the fragment.
   </p>
   <p>
    To make fragment transactions in your activity (such as add, remove, or replace a
fragment), you must use APIs from
    <code>
     <a href="/reference/android/app/FragmentTransaction.html">
      FragmentTransaction
     </a>
    </code>
    . You can get an instance
of
    <code>
     <a href="/reference/android/app/FragmentTransaction.html">
      FragmentTransaction
     </a>
    </code>
    from your
    <code>
     <a href="/reference/android/app/Activity.html">
      Activity
     </a>
    </code>
    like this:
   </p>
   <pre>
FragmentManager fragmentManager = <code><a href="/reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code>
FragmentTransaction fragmentTransaction = fragmentManager.<code><a href="/reference/android/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code>;
</pre>
   <p>
    You can then add a fragment using the
    <code>
     <a href="/reference/android/app/FragmentTransaction.html#add(int, android.app.Fragment)">
      add()
     </a>
    </code>
    method, specifying the fragment to add and
the view in which to insert it. For example:
   </p>
   <pre>
ExampleFragment fragment = new ExampleFragment();
fragmentTransaction.add(R.id.fragment_container, fragment);
fragmentTransaction.commit();
</pre>
   <p>
    The first argument passed to
    <code>
     <a href="/reference/android/app/FragmentTransaction.html#add(int, android.app.Fragment)">
      add()
     </a>
    </code>
    is the
    <code>
     <a href="/reference/android/view/ViewGroup.html">
      ViewGroup
     </a>
    </code>
    in which the fragment should be placed, specified by
resource ID, and the second parameter is the fragment to add.
   </p>
   <p>
    Once you've made your changes with
    <code>
     <a href="/reference/android/app/FragmentTransaction.html">
      FragmentTransaction
     </a>
    </code>
    , you must
call
    <code>
     <a href="/reference/android/app/FragmentTransaction.html#commit()">
      commit()
     </a>
    </code>
    for the changes to take effect.
   </p>
  </li>
 </ul>
 <h4 id="AddingWithoutUI">
  Adding a fragment without a UI
 </h4>
 <p>
  The examples above show how to add a fragment to your activity in order to provide a UI. However,
you can also use a fragment to provide a background behavior for the activity without presenting
additional UI.
 </p>
 <p>
  To add a fragment without a UI, add the fragment from the activity using
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">
    add(Fragment, String)
   </a>
  </code>
  (supplying a unique string "tag" for the
fragment, rather than a view ID). This adds the fragment, but, because it's not associated with a
view in the activity layout, it does not receive a call to
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  . So you don't need to implement that method.
 </p>
 <p>
  Supplying a string tag for the fragment isn't strictly for non-UI fragments&mdash;you can also
supply string tags to fragments that do have a UI&mdash;but if the fragment does not have a
UI, then the string tag is the only way to identify it. If you want to get the fragment from the
activity later, you need to use
  <code>
   <a href="/reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">
    findFragmentByTag()
   </a>
  </code>
  .
 </p>
 <p>
  For an example activity that uses a fragment as a background worker, without a UI, see the
  <code>
   FragmentRetainInstance.java
  </code>
  sample, which is included in the SDK samples (available through the
Android SDK Manager) and located on your system as
  <code>
   &lt;sdk_root&gt;/APIDemos/app/src/main/java/com/example/android/apis/app/FragmentRetainInstance.java
  </code>
  .
 </p>
 <h2 id="Managing">
  Managing Fragments
 </h2>
 <p>
  To manage the fragments in your activity, you need to use
  <code>
   <a href="/reference/android/app/FragmentManager.html">
    FragmentManager
   </a>
  </code>
  . To
get it, call
  <code>
   <a href="/reference/android/app/Activity.html#getFragmentManager()">
    getFragmentManager()
   </a>
  </code>
  from your activity.
 </p>
 <p>
  Some things that you can do with
  <code>
   <a href="/reference/android/app/FragmentManager.html">
    FragmentManager
   </a>
  </code>
  include:
 </p>
 <ul>
  <li>
   Get fragments that exist in the activity, with
   <code>
    <a href="/reference/android/app/FragmentManager.html#findFragmentById(int)">
     findFragmentById()
    </a>
   </code>
   (for fragments that provide a UI in
the activity layout) or
   <code>
    <a href="/reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">
     findFragmentByTag()
    </a>
   </code>
   (for fragments that do or don't provide a UI).
  </li>
  <li>
   Pop fragments off the back stack, with
   <code>
    <a href="/reference/android/app/FragmentManager.html#popBackStack()">
     popBackStack()
    </a>
   </code>
   (simulating a
   <em>
    Back
   </em>
   command by the user).
  </li>
  <li>
   Register a listener for changes to the back stack, with
   <code>
    <a href="/reference/android/app/FragmentManager.html#addOnBackStackChangedListener(android.app.FragmentManager.OnBackStackChangedListener)">
     addOnBackStackChangedListener()
    </a>
   </code>
   .
  </li>
 </ul>
 <p>
  For more information about these methods and others, refer to the
  <code>
   <a href="/reference/android/app/FragmentManager.html">
    FragmentManager
   </a>
  </code>
  class documentation.
 </p>
 <p>
  As demonstrated in the previous section, you can also use
  <code>
   <a href="/reference/android/app/FragmentManager.html">
    FragmentManager
   </a>
  </code>
  to open a
  <code>
   <a href="/reference/android/app/FragmentTransaction.html">
    FragmentTransaction
   </a>
  </code>
  , which allows you to perform transactions, such as
add and remove fragments.
 </p>
 <h2 id="Transactions">
  Performing Fragment Transactions
 </h2>
 <p>
  A great feature about using fragments in your activity is the ability to add, remove, replace,
and perform other actions with them, in response to user interaction. Each set of changes that you
commit to the activity is called a transaction and you can perform one using APIs in
  <code>
   <a href="/reference/android/app/FragmentTransaction.html">
    FragmentTransaction
   </a>
  </code>
  . You can also save each transaction to a back stack managed by the
activity, allowing the user to navigate backward through the fragment changes (similar to navigating
backward through activities).
 </p>
 <p>
  You can acquire an instance of
  <code>
   <a href="/reference/android/app/FragmentTransaction.html">
    FragmentTransaction
   </a>
  </code>
  from the
  <code>
   <a href="/reference/android/app/FragmentManager.html">
    FragmentManager
   </a>
  </code>
  like this:
 </p>
 <pre>
FragmentManager fragmentManager = <code><a href="/reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code>;
FragmentTransaction fragmentTransaction = fragmentManager.<code><a href="/reference/android/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code>;
</pre>
 <p>
  Each transaction is a set of changes that you want to perform at the same time. You can set
up all the changes you want to perform for a given transaction using methods such as
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">
    add()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#remove(android.app.Fragment)">
    remove()
   </a>
  </code>
  ,
and
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#replace(int, android.app.Fragment)">
    replace()
   </a>
  </code>
  . Then, to apply the transaction
to the activity, you must call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commit()">
    commit()
   </a>
  </code>
  .
 </p>
 <p>
  Before you call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commit()">
    commit()
   </a>
  </code>
  , however, you might want to call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">
    addToBackStack()
   </a>
  </code>
  , in order to add the transaction
to a back stack of fragment transactions. This back stack is managed by the activity and allows
the user to return to the previous fragment state, by pressing the
  <em>
   Back
  </em>
  button.
 </p>
 <p>
  For example, here's how you can replace one fragment with another, and preserve the previous
state in the back stack:
 </p>
 <pre>
// Create new fragment and transaction
Fragment newFragment = new ExampleFragment();
FragmentTransaction transaction = getFragmentManager().beginTransaction();

// Replace whatever is in the fragment_container view with this fragment,
// and add the transaction to the back stack
transaction.replace(R.id.fragment_container, newFragment);
transaction.addToBackStack(null);

// Commit the transaction
transaction.commit();
</pre>
 <p>
  In this example,
  <code>
   newFragment
  </code>
  replaces whatever fragment (if any) is currently in the
layout container identified by the
  <code>
   R.id.fragment_container
  </code>
  ID. By calling
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">
    addToBackStack()
   </a>
  </code>
  , the replace transaction is
saved to the back stack so the user can reverse the transaction and bring back the
previous fragment by pressing the
  <em>
   Back
  </em>
  button.
 </p>
 <p>
  If you add multiple changes to the transaction (such as another
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">
    add()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#remove(android.app.Fragment)">
    remove()
   </a>
  </code>
  ) and call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">
    addToBackStack()
   </a>
  </code>
  , then all changes applied
before you call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commit()">
    commit()
   </a>
  </code>
  are added to the
back stack as a single transaction and the
  <em>
   Back
  </em>
  button will reverse them all together.
 </p>
 <p>
  The order in which you add changes to a
  <code>
   <a href="/reference/android/app/FragmentTransaction.html">
    FragmentTransaction
   </a>
  </code>
  doesn't matter,
except:
 </p>
 <ul>
  <li>
   You must call
   <code>
    <a href="/reference/android/app/FragmentTransaction.html#commit()">
     commit()
    </a>
   </code>
   last
  </li>
  <li>
   If you're adding multiple fragments to the same container, then the order in which
you add them determines the order they appear in the view hierarchy
  </li>
 </ul>
 <p>
  If you do not call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">
    addToBackStack()
   </a>
  </code>
  when you perform a transaction that removes a fragment, then that fragment is
destroyed when the transaction is committed and the user cannot navigate back to it. Whereas, if you
do call
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">
    addToBackStack()
   </a>
  </code>
  when
removing a fragment, then the fragment is
  <em>
   stopped
  </em>
  and will be resumed if the user navigates
back.
 </p>
 <p class="note">
  <strong>
   Tip:
  </strong>
  For each fragment transaction, you can apply a transition
animation, by calling
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#setTransition(int)">
    setTransition()
   </a>
  </code>
  before
you commit.
 </p>
 <p>
  Calling
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commit()">
    commit()
   </a>
  </code>
  does not perform the transaction
immediately. Rather, it schedules it to run on the activity's UI thread (the "main" thread) as soon
as the thread is able to do so. If necessary, however, you may call
  <code>
   <a href="/reference/android/app/FragmentManager.html#executePendingTransactions()">
    executePendingTransactions()
   </a>
  </code>
  from your UI thread to immediately execute
transactions submitted by
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commit()">
    commit()
   </a>
  </code>
  . Doing so is
usually not necessary unless the transaction is a dependency for jobs in other threads.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  You can commit a transaction using
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commit()">
    commit()
   </a>
  </code>
  only prior to the activity
  <a href="/guide/components/activities.html#SavingActivityState">
   saving its
state
  </a>
  (when the user leaves the activity). If you attempt to commit after that point, an
exception will be thrown. This is because the state after the commit can be lost if the activity
needs to be restored. For situations in which its okay that you lose the commit, use
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#commitAllowingStateLoss()">
    commitAllowingStateLoss()
   </a>
  </code>
  .
 </p>
 <h2 id="CommunicatingWithActivity">
  Communicating with the Activity
 </h2>
 <p>
  Although a
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  is implemented as an object that's independent from an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  and can be used inside multiple activities, a given instance of
a fragment is directly tied to the activity that contains it.
 </p>
 <p>
  Specifically, the fragment can access the
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  instance with
  <code>
   <a href="/reference/android/app/Fragment.html#getActivity()">
    getActivity()
   </a>
  </code>
  and easily perform tasks such as find a view in the
activity layout:
 </p>
 <pre>
View listView = <code><a href="/reference/android/app/Fragment.html#getActivity()">getActivity()</a></code>.<code><a href="/reference/android/app/Activity.html#findViewById(int)">findViewById</a></code>(R.id.list);
</pre>
 <p>
  Likewise, your activity can call methods in the fragment by acquiring a reference to the
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  from
  <code>
   <a href="/reference/android/app/FragmentManager.html">
    FragmentManager
   </a>
  </code>
  , using
  <code>
   <a href="/reference/android/app/FragmentManager.html#findFragmentById(int)">
    findFragmentById()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">
    findFragmentByTag()
   </a>
  </code>
  . For example:
 </p>
 <pre>
ExampleFragment fragment = (ExampleFragment) getFragmentManager().findFragmentById(R.id.example_fragment);
</pre>
 <h3 id="EventCallbacks">
  Creating event callbacks to the activity
 </h3>
 <p>
  In some cases, you might need a fragment to share events with the activity. A good way to do that
is to define a callback interface inside the fragment and require that the host activity implement
it. When the activity receives a callback through the interface, it can share the information with
other fragments in the layout as necessary.
 </p>
 <p>
  For example, if a news application has two fragments in an activity&mdash;one to show a list of
articles (fragment A) and another to display an article (fragment B)&mdash;then fragment A must tell
the activity when a list item is selected so that it can tell fragment B to display the article. In
this case, the
  <code>
   OnArticleSelectedListener
  </code>
  interface is declared inside fragment A:
 </p>
 <pre>
public static class FragmentA extends ListFragment {
    ...
    // Container Activity must implement this interface
    public interface OnArticleSelectedListener {
        public void onArticleSelected(Uri articleUri);
    }
    ...
}
</pre>
 <p>
  Then the activity that hosts the fragment implements the
  <code>
   OnArticleSelectedListener
  </code>
  interface and
overrides
  <code>
   onArticleSelected()
  </code>
  to notify fragment B of the event from fragment A. To ensure
that the host activity implements this interface, fragment A's
  <code>
   <a href="/reference/android/app/Fragment.html#onAttach(android.app.Activity)">
    onAttach()
   </a>
  </code>
  callback method (which the system calls when adding
the fragment to the activity) instantiates an instance of
  <code>
   OnArticleSelectedListener
  </code>
  by
casting the
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  that is passed into
  <code>
   <a href="/reference/android/app/Fragment.html#onAttach(android.app.Activity)">
    onAttach()
   </a>
  </code>
  :
 </p>
 <pre>
public static class FragmentA extends ListFragment {
    OnArticleSelectedListener mListener;
    ...
    @Override
    public void onAttach(Activity activity) {
        super.onAttach(activity);
        try {
            mListener = (OnArticleSelectedListener) activity;
        } catch (ClassCastException e) {
            throw new ClassCastException(activity.toString() + " must implement OnArticleSelectedListener");
        }
    }
    ...
}
</pre>
 <p>
  If the activity has not implemented the interface, then the fragment throws a
  <code>
   <a href="/reference/java/lang/ClassCastException.html">
    ClassCastException
   </a>
  </code>
  .
On success, the
  <code>
   mListener
  </code>
  member holds a reference to activity's implementation of
  <code>
   OnArticleSelectedListener
  </code>
  , so that fragment A can share events with the activity by calling
methods defined by the
  <code>
   OnArticleSelectedListener
  </code>
  interface. For example, if fragment A is an
extension of
  <code>
   <a href="/reference/android/app/ListFragment.html">
    ListFragment
   </a>
  </code>
  , each time
the user clicks a list item, the system calls
  <code>
   <a href="/reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">
    onListItemClick()
   </a>
  </code>
  in the fragment, which then calls
  <code>
   onArticleSelected()
  </code>
  to share
the event with the activity:
 </p>
 <pre>
public static class FragmentA extends ListFragment {
    OnArticleSelectedListener mListener;
    ...
    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        // Append the clicked item's row ID with the content provider Uri
        Uri noteUri = ContentUris.<code><a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">withAppendedId</a></code>(ArticleColumns.CONTENT_URI, id);
        // Send the event and Uri to the host activity
        mListener.onArticleSelected(noteUri);
    }
    ...
}
</pre>
 <p>
  The
  <code>
   id
  </code>
  parameter passed to
  <code>
   <a href="/reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">
    onListItemClick()
   </a>
  </code>
  is the row ID of the clicked item,
which the activity (or other fragment) uses to fetch the article from the application's
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  .
 </p>
 <p>
  <!--To see a complete implementation of this kind of callback interface, see the <a
href="/resources/samples/NotePad/index.html">NotePad sample</a>. -->
  More information about
using a content provider is available in the
  <a href="/guide/topics/providers/content-providers.html">
   Content Providers
  </a>
  document.
 </p>
 <h3 id="ActionBar">
  Adding items to the Action Bar
 </h3>
 <p>
  Your fragments can contribute menu items to the activity's
  <a href="/guide/topics/ui/menus.html#options-menu">
   Options Menu
  </a>
  (and, consequently, the
  <a href="/guide/topics/ui/actionbar.html">
   Action Bar
  </a>
  ) by implementing
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateOptionsMenu(android.view.Menu, android.view.MenuInflater)">
    onCreateOptionsMenu()
   </a>
  </code>
  . In order
for this method to receive calls, however, you must call
  <code>
   <a href="/reference/android/app/Fragment.html#setHasOptionsMenu(boolean)">
    setHasOptionsMenu()
   </a>
  </code>
  during
  <code>
   <a href="/reference/android/app/Fragment.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  , to indicate that the fragment
would like to add items to the Options Menu (otherwise, the fragment will not receive a call to
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateOptionsMenu(android.view.Menu, android.view.MenuInflater)">
    onCreateOptionsMenu()
   </a>
  </code>
  ).
 </p>
 <p>
  Any items that you then add to the Options Menu from the fragment are appended to the existing
menu items. The fragment also receives callbacks to
  <code>
   <a href="/reference/android/app/Fragment.html#onOptionsItemSelected(android.view.MenuItem)">
    onOptionsItemSelected()
   </a>
  </code>
  when a menu item
is selected.
 </p>
 <p>
  You can also register a view in your fragment layout to provide a context menu by calling
  <code>
   <a href="/reference/android/app/Fragment.html#registerForContextMenu(android.view.View)">
    registerForContextMenu()
   </a>
  </code>
  . When the user opens
the context menu, the fragment receives a call to
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateContextMenu(android.view.ContextMenu, android.view.View, android.view.ContextMenu.ContextMenuInfo)">
    onCreateContextMenu()
   </a>
  </code>
  . When the user selects an item, the fragment receives a call to
  <code>
   <a href="/reference/android/app/Fragment.html#onContextItemSelected(android.view.MenuItem)">
    onContextItemSelected()
   </a>
  </code>
  .
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Although your fragment receives an on-item-selected callback
for each menu item it adds, the activity is first to receive the respective callback when the user
selects a menu item. If the activity's implementation of the on-item-selected callback does not
handle the selected item, then the event is passed to the fragment's callback. This is true for
the Options Menu and context menus.
 </p>
 <p>
  For more information about menus, see the
  <a href="/guide/topics/ui/menus.html">
   Menus
  </a>
  and
  <a href="/guide/topics/ui/actionbar.html">
   Action Bar
  </a>
  developer guides.
 </p>
 <h2 id="Lifecycle">
  Handling the Fragment Lifecycle
 </h2>
 <div class="figure" style="width:350px">
  <img alt="" src="http://developer.android.com/images/activity_fragment_lifecycle.png"/>
  <p class="img-caption">
   <strong>
    Figure 3.
   </strong>
   The effect of the activity lifecycle on the fragment
lifecycle.
  </p>
 </div>
 <p>
  Managing the lifecycle of a fragment is a lot like managing the lifecycle of an activity. Like
an activity, a fragment can exist in three states:
 </p>
 <dl>
  <dt>
   <i>
    Resumed
   </i>
  </dt>
  <dd>
   The fragment is visible in the running activity.
  </dd>
  <dt>
   <i>
    Paused
   </i>
  </dt>
  <dd>
   Another activity is in the foreground and has focus, but the activity in which this
fragment lives is still visible (the foreground activity is partially transparent or doesn't
cover the entire screen).
  </dd>
  <dt>
   <i>
    Stopped
   </i>
  </dt>
  <dd>
   The fragment is not visible. Either the host activity has been stopped or the
fragment has been removed from the activity but added to the back stack. A stopped fragment is
still alive (all state and member information is retained by the system). However, it is no longer
visible to the user and will be killed if the activity is killed.
  </dd>
 </dl>
 <p>
  Also like an activity, you can retain the state of a fragment using a
  <code>
   <a href="/reference/android/os/Bundle.html">
    Bundle
   </a>
  </code>
  , in case the activity's process is killed and you need to restore the
fragment state when the activity is recreated. You can save the state during the fragment's
  <code>
   <a href="/reference/android/app/Fragment.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  callback and restore it during
either
  <code>
   <a href="/reference/android/app/Fragment.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
    onCreateView()
   </a>
  </code>
  , or
  <code>
   <a href="/reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">
    onActivityCreated()
   </a>
  </code>
  . For more information about saving
state, see the
  <a href="/guide/components/activities.html#SavingActivityState">
   Activities
  </a>
  document.
 </p>
 <p>
  The most significant difference in lifecycle between an activity and a fragment is how one is
stored in its respective back stack. An activity is placed into a back stack of activities
that's managed by the system when it's stopped, by default (so that the user can navigate back
to it with the
  <em>
   Back
  </em>
  button, as discussed in
  <a href="/guide/components/tasks-and-back-stack.html">
   Tasks and Back Stack
  </a>
  ).
However, a fragment is placed into a back stack managed by the host activity only when you
explicitly request that the instance be saved by calling
  <code>
   <a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">
    addToBackStack()
   </a>
  </code>
  during a transaction that
removes the fragment.
 </p>
 <p>
  Otherwise, managing the fragment lifecycle is very similar to managing the activity
lifecycle. So, the same practices for
  <a href="/guide/components/activities.html#Lifecycle">
   managing the activity
lifecycle
  </a>
  also apply to fragments. What you also need to understand, though, is how the life
of the activity affects the life of the fragment.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  If you need a
  <code>
   <a href="/reference/android/content/Context.html">
    Context
   </a>
  </code>
  object
within your
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  , you can call
  <code>
   <a href="/reference/android/app/Fragment.html#getActivity()">
    getActivity()
   </a>
  </code>
  .
However, be careful to call
  <code>
   <a href="/reference/android/app/Fragment.html#getActivity()">
    getActivity()
   </a>
  </code>
  only when the fragment is
attached to an activity. When the fragment is not yet attached, or was detached during the end of
its lifecycle,
  <code>
   <a href="/reference/android/app/Fragment.html#getActivity()">
    getActivity()
   </a>
  </code>
  will return null.
 </p>
 <h3 id="CoordinatingWithActivity">
  Coordinating with the activity lifecycle
 </h3>
 <p>
  The lifecycle of the activity in which the fragment lives directly affects the lifecycle of the
fragment, such that each lifecycle callback for the activity results in a similar callback for each
fragment. For example, when the activity receives
  <code>
   <a href="/reference/android/app/Activity.html#onPause()">
    onPause()
   </a>
  </code>
  , each
fragment in the activity receives
  <code>
   <a href="/reference/android/app/Fragment.html#onPause()">
    onPause()
   </a>
  </code>
  .
 </p>
 <p>
  Fragments have a few extra lifecycle callbacks, however, that handle unique interaction with the
activity in order to perform actions such as build and destroy the fragment's UI. These additional
callback methods are:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onAttach(android.app.Activity)">
     onAttach()
    </a>
   </code>
  </dt>
  <dd>
   Called when the fragment has been associated with the activity (the
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   is passed in here).
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">
     onCreateView()
    </a>
   </code>
  </dt>
  <dd>
   Called to create the view hierarchy associated with the fragment.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">
     onActivityCreated()
    </a>
   </code>
  </dt>
  <dd>
   Called when the activity's
   <code>
    <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
     onCreate()
    </a>
   </code>
   method has returned.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onDestroyView()">
     onDestroyView()
    </a>
   </code>
  </dt>
  <dd>
   Called when the view hierarchy associated with the fragment is being removed.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Fragment.html#onDetach()">
     onDetach()
    </a>
   </code>
  </dt>
  <dd>
   Called when the fragment is being disassociated from the activity.
  </dd>
 </dl>
 <p>
  The flow of a fragment's lifecycle, as it is affected by its host activity, is illustrated
by figure 3. In this figure, you can see how each successive state of the activity determines which
callback methods a fragment may receive. For example, when the activity has received its
  <code>
   <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  callback, a fragment in the activity receives no more than
the
  <code>
   <a href="/reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">
    onActivityCreated()
   </a>
  </code>
  callback.
 </p>
 <p>
  Once the activity reaches the resumed state, you can freely add and remove fragments to the
activity. Thus, only while the activity is in the resumed state can the lifecycle of a fragment
change independently.
 </p>
 <p>
  However, when the activity leaves the resumed state, the fragment again is pushed through its
lifecycle by the activity.
 </p>
 <h2 id="Example">
  Example
 </h2>
 <p>
  To bring everything discussed in this document together, here's an example of an activity
using two fragments to create a two-pane layout. The activity below includes one fragment to
show a list of Shakespeare play titles and another to show a summary of the play when selected
from the list. It also demonstrates how to provide different configurations of the fragments,
based on the screen configuration.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  The complete source code for this activity is available in
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/FragmentLayout.html">
   <code>
    FragmentLayout.java
   </code>
  </a>
  .
 </p>
 <p>
  The main activity applies a layout in the usual way, during
  <code>
   <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  :
 </p>
 <pre>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    setContentView(R.layout.fragment_layout);
}</pre>
 <p>
  The layout applied is
  <code>
   fragment_layout.xml
  </code>
  :
 </p>
 <pre>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent" android:layout_height="match_parent"&gt;

    &lt;fragment class="com.example.android.apis.app.FragmentLayout$TitlesFragment"
            android:id="@+id/titles" android:layout_weight="1"
            android:layout_width="0px" android:layout_height="match_parent" /&gt;

    &lt;FrameLayout android:id="@+id/details" android:layout_weight="1"
            android:layout_width="0px" android:layout_height="match_parent"
            android:background="?android:attr/detailsElementBackground" /&gt;

&lt;/LinearLayout&gt;</pre>
 <p>
  Using this layout, the system instantiates the
  <code>
   TitlesFragment
  </code>
  (which lists the play
titles) as soon as the activity loads the layout, while the
  <code>
   <a href="/reference/android/widget/FrameLayout.html">
    FrameLayout
   </a>
  </code>
  (where the fragment for showing the play summary will go) consumes space on the right side of the
screen, but remains empty at first. As you'll see below, it's not until the user selects an item
from the list that a fragment is placed into the
  <code>
   <a href="/reference/android/widget/FrameLayout.html">
    FrameLayout
   </a>
  </code>
  .
 </p>
 <p>
  However, not all screen configurations are wide enough to show both the list of
plays and the summary, side by side. So, the layout above is used only for the landscape
screen configuration, by saving it at
  <code>
   res/layout-land/fragment_layout.xml
  </code>
  .
 </p>
 <p>
  Thus, when the screen is in portrait orientation, the system applies the following layout, which
is saved at
  <code>
   res/layout/fragment_layout.xml
  </code>
  :
 </p>
 <pre>&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent" android:layout_height="match_parent"&gt;
    &lt;fragment class="com.example.android.apis.app.FragmentLayout$TitlesFragment"
            android:id="@+id/titles"
            android:layout_width="match_parent" android:layout_height="match_parent" /&gt;
&lt;/FrameLayout&gt;</pre>
 <p>
  This layout includes only
  <code>
   TitlesFragment
  </code>
  . This means that, when the device is in
portrait orientation, only the list of play titles is visible. So, when the user clicks a list
item in this configuration, the application will start a new activity to show the summary,
instead of loading a second fragment.
 </p>
 <p>
  Next, you can see how this is accomplished in the fragment classes. First is
  <code>
   TitlesFragment
  </code>
  , which shows the list of Shakespeare play titles. This fragment extends
  <code>
   <a href="/reference/android/app/ListFragment.html">
    ListFragment
   </a>
  </code>
  and relies on it to handle most of the list view work.
 </p>
 <p>
  As you inspect this code, notice that there are two possible behaviors when the user clicks a
list item: depending on which of the two layouts is active, it can either create and display a new
fragment to show the details in the same activity (adding the fragment to the
  <code>
   <a href="/reference/android/widget/FrameLayout.html">
    FrameLayout
   </a>
  </code>
  ), or start a new activity (where the fragment can be shown).
 </p>
 <pre>public static class TitlesFragment extends ListFragment {
    boolean mDualPane;
    int mCurCheckPosition = 0;

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
        super.onActivityCreated(savedInstanceState);

        // Populate list with our static array of titles.
        setListAdapter(new ArrayAdapter&lt;String&gt;(getActivity(),
                android.R.layout.simple_list_item_activated_1, Shakespeare.TITLES));

        // Check to see if we have a frame in which to embed the details
        // fragment directly in the containing UI.
        View detailsFrame = getActivity().findViewById(R.id.details);
        mDualPane = detailsFrame != null &amp;&amp; detailsFrame.getVisibility() == View.VISIBLE;

        if (savedInstanceState != null) {
            // Restore last state for checked position.
            mCurCheckPosition = savedInstanceState.getInt("curChoice", 0);
        }

        if (mDualPane) {
            // In dual-pane mode, the list view highlights the selected item.
            getListView().setChoiceMode(ListView.CHOICE_MODE_SINGLE);
            // Make sure our UI is in the correct state.
            showDetails(mCurCheckPosition);
        }
    }

    @Override
    public void onSaveInstanceState(Bundle outState) {
        super.onSaveInstanceState(outState);
        outState.putInt("curChoice", mCurCheckPosition);
    }

    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        showDetails(position);
    }

    /**
     * Helper function to show the details of a selected item, either by
     * displaying a fragment in-place in the current UI, or starting a
     * whole new activity in which it is displayed.
     */
    void showDetails(int index) {
        mCurCheckPosition = index;

        if (mDualPane) {
            // We can display everything in-place with fragments, so update
            // the list to highlight the selected item and show the data.
            getListView().setItemChecked(index, true);

            // Check what fragment is currently shown, replace if needed.
            DetailsFragment details = (DetailsFragment)
                    getFragmentManager().findFragmentById(R.id.details);
            if (details == null || details.getShownIndex() != index) {
                // Make new fragment to show this selection.
                details = DetailsFragment.newInstance(index);

                // Execute a transaction, replacing any existing fragment
                // with this one inside the frame.
                FragmentTransaction ft = getFragmentManager().beginTransaction();
                if (index == 0) {
                    ft.replace(R.id.details, details);
                } else {
                    ft.replace(R.id.a_item, details);
                }
                ft.setTransition(FragmentTransaction.TRANSIT_FRAGMENT_FADE);
                ft.commit();
            }

        } else {
            // Otherwise we need to launch a new activity to display
            // the dialog fragment with selected text.
            Intent intent = new Intent();
            intent.setClass(getActivity(), DetailsActivity.class);
            intent.putExtra("index", index);
            startActivity(intent);
        }
    }
}</pre>
 <p>
  The second fragment,
  <code>
   DetailsFragment
  </code>
  shows the play summary for the item selected from
the list from
  <code>
   TitlesFragment
  </code>
  :
 </p>
 <pre>public static class DetailsFragment extends Fragment {
    /**
     * Create a new instance of DetailsFragment, initialized to
     * show the text at 'index'.
     */
    public static DetailsFragment newInstance(int index) {
        DetailsFragment f = new DetailsFragment();

        // Supply index input as an argument.
        Bundle args = new Bundle();
        args.putInt("index", index);
        f.setArguments(args);

        return f;
    }

    public int getShownIndex() {
        return getArguments().getInt("index", 0);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState) {
        if (container == null) {
            // We have different layouts, and in one of them this
            // fragment's containing frame doesn't exist.  The fragment
            // may still be created from its saved state, but there is
            // no reason to try to create its view hierarchy because it
            // won't be displayed.  Note this is not needed -- we could
            // just run the code below, where we would create and return
            // the view hierarchy; it would just never be used.
            return null;
        }

        ScrollView scroller = new ScrollView(getActivity());
        TextView text = new TextView(getActivity());
        int padding = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,
                4, getActivity().getResources().getDisplayMetrics());
        text.setPadding(padding, padding, padding, padding);
        scroller.addView(text);
        text.setText(Shakespeare.DIALOGUE[getShownIndex()]);
        return scroller;
    }
}</pre>
 <p>
  Recall from the
  <code>
   TitlesFragment
  </code>
  class, that, if the user clicks a list item and the
current layout does
  <em>
   not
  </em>
  include the
  <code>
   R.id.details
  </code>
  view (which is where the
  <code>
   DetailsFragment
  </code>
  belongs), then the application starts the
  <code>
   DetailsActivity
  </code>
  activity to display the content of the item.
 </p>
 <p>
  Here is the
  <code>
   DetailsActivity
  </code>
  , which simply embeds the
  <code>
   DetailsFragment
  </code>
  to display
the selected play summary when the screen is in portrait orientation:
 </p>
 <pre>public static class DetailsActivity extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        if (getResources().getConfiguration().orientation
                == Configuration.ORIENTATION_LANDSCAPE) {
            // If the screen is now in landscape mode, we can show the
            // dialog in-line with the list so we don't need this activity.
            finish();
            return;
        }

        if (savedInstanceState == null) {
            // During initial setup, plug in the details fragment.
            DetailsFragment details = new DetailsFragment();
            details.setArguments(getIntent().getExtras());
            getFragmentManager().beginTransaction().add(android.R.id.content, details).commit();
        }
    }
}</pre>
 <p>
  Notice that this activity finishes itself if the configuration is landscape, so that the main
activity can take over and display the
  <code>
   DetailsFragment
  </code>
  alongside the
  <code>
   TitlesFragment
  </code>
  .
This can happen if the user begins the
  <code>
   DetailsActivity
  </code>
  while in portrait orientation, but
then rotates to landscape (which restarts the current activity).
 </p>
 <p>
  For more samples using fragments (and complete source files for this example),
see the API Demos sample app available in
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/index.html#Fragment">
   ApiDemos
  </a>
  (available for download from the
  <a href="/resources/samples/get.html">
   Samples SDK component
  </a>
  ).
 </p>
</div>
<h1>Loaders</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#summary">
      Loader API Summary
     </a>
    </li>
    <li>
     <a href="#app">
      Using Loaders in an Application
     </a>
     <ol>
      <li>
       <a href="#requirements">
       </a>
      </li>
      <li>
       <a href="#starting">
        Starting a Loader
       </a>
      </li>
      <li>
       <a href="#restarting">
        Restarting a Loader
       </a>
      </li>
      <li>
       <a href="#callback">
        Using the LoaderManager Callbacks
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#example">
      Example
     </a>
     <ol>
      <li>
       <a href="#more_examples">
        More Examples
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/app/LoaderManager.html">
       LoaderManager
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/content/Loader.html">
       Loader
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Related samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LoaderCursor.html">
      LoaderCursor
     </a>
    </li>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LoaderThrottle.html">
      LoaderThrottle
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  Introduced in Android 3.0, loaders make it easy to asynchronously load data
in an activity or fragment. Loaders have these characteristics:
 </p>
 <ul>
  <li>
   They are available to every
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/app/Fragment.html">
     Fragment
    </a>
   </code>
   .
  </li>
  <li>
   They provide asynchronous loading of data.
  </li>
  <li>
   They monitor the source of their data and deliver new results when the
content changes.
  </li>
  <li>
   They automatically reconnect to the last loader's cursor when being
recreated after a configuration change. Thus, they don't need to re-query their
data.
  </li>
 </ul>
 <h2 id="summary">
  Loader API Summary
 </h2>
 <p>
  There are multiple classes and interfaces that may be involved in using
loaders in an application. They are summarized in this table:
 </p>
 <table>
  <tr>
   <th>
    Class/Interface
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/app/LoaderManager.html">
      LoaderManager
     </a>
    </code>
   </td>
   <td>
    An abstract class associated with an
    <code>
     <a href="/reference/android/app/Activity.html">
      Activity
     </a>
    </code>
    or
    <code>
     <a href="/reference/android/app/Fragment.html">
      Fragment
     </a>
    </code>
    for managing one or more
    <code>
     <a href="/reference/android/content/Loader.html">
      Loader
     </a>
    </code>
    instances.&nbsp;This helps an application manage
longer-running operations in conjunction with the
    <code>
     <a href="/reference/android/app/Activity.html">
      Activity
     </a>
    </code>
    or
    <code>
     <a href="/reference/android/app/Fragment.html">
      Fragment
     </a>
    </code>
    lifecycle; the most common use of this is with a
    <code>
     <a href="/reference/android/content/CursorLoader.html">
      CursorLoader
     </a>
    </code>
    , however applications are free to write
their own loaders for loading other types of data.
    <br/>
    <br/>
    There is only one
    <code>
     <a href="/reference/android/app/LoaderManager.html">
      LoaderManager
     </a>
    </code>
    per activity or fragment. But a
    <code>
     <a href="/reference/android/app/LoaderManager.html">
      LoaderManager
     </a>
    </code>
    can have
multiple loaders.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
      LoaderManager.LoaderCallbacks
     </a>
    </code>
   </td>
   <td>
    A callback interface for a client to interact with the
    <code>
     <a href="/reference/android/app/LoaderManager.html">
      LoaderManager
     </a>
    </code>
    . For example, you use the
    <code>
     <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onCreateLoader(int, android.os.Bundle)">
      onCreateLoader()
     </a>
    </code>
    callback method to create a new loader.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/content/Loader.html">
      Loader
     </a>
    </code>
   </td>
   <td>
    An abstract class that performs asynchronous loading of data. This is
the base class for a loader. You would typically use
    <code>
     <a href="/reference/android/content/CursorLoader.html">
      CursorLoader
     </a>
    </code>
    , but you can implement your own subclass. While
loaders are active they should monitor the source of their data and deliver new
results when the contents change.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/content/AsyncTaskLoader.html">
      AsyncTaskLoader
     </a>
    </code>
   </td>
   <td>
    Abstract loader that provides an
    <code>
     <a href="/reference/android/os/AsyncTask.html">
      AsyncTask
     </a>
    </code>
    to do the work.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/content/CursorLoader.html">
      CursorLoader
     </a>
    </code>
   </td>
   <td>
    A subclass of
    <code>
     <a href="/reference/android/content/AsyncTaskLoader.html">
      AsyncTaskLoader
     </a>
    </code>
    that queries the
    <code>
     <a href="/reference/android/content/ContentResolver.html">
      ContentResolver
     </a>
    </code>
    and returns a
    <code>
     <a href="/reference/android/database/Cursor.html">
      Cursor
     </a>
    </code>
    . This class implements the
    <code>
     <a href="/reference/android/content/Loader.html">
      Loader
     </a>
    </code>
    protocol in a standard way for querying cursors,
building on
    <code>
     <a href="/reference/android/content/AsyncTaskLoader.html">
      AsyncTaskLoader
     </a>
    </code>
    to perform the cursor query
on a background thread so that it does not block the application's UI. Using
this loader is the best way to asynchronously load data from a
    <code>
     <a href="/reference/android/content/ContentProvider.html">
      ContentProvider
     </a>
    </code>
    , instead of performing a managed query through
the fragment or activity's APIs.
   </td>
  </tr>
 </table>
 <p>
  The classes and interfaces in the above table are the essential components
you'll use to implement a loader in your application. You won't need all of them
for each loader you create, but you'll always need a reference to the
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  in order to initialize a loader and an implementation
of a
  <code>
   <a href="/reference/android/content/Loader.html">
    Loader
   </a>
  </code>
  class such as
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  . The following sections show you how to use these
classes and interfaces in an application.
 </p>
 <h2 id="app">
  Using Loaders in an Application
 </h2>
 <p>
  This section describes how to use loaders in an Android application. An
application that uses loaders typically includes the following:
 </p>
 <ul>
  <li>
   An
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/app/Fragment.html">
     Fragment
    </a>
   </code>
   .
  </li>
  <li>
   An instance of the
   <code>
    <a href="/reference/android/app/LoaderManager.html">
     LoaderManager
    </a>
   </code>
   .
  </li>
  <li>
   A
   <code>
    <a href="/reference/android/content/CursorLoader.html">
     CursorLoader
    </a>
   </code>
   to load data backed by a
   <code>
    <a href="/reference/android/content/ContentProvider.html">
     ContentProvider
    </a>
   </code>
   . Alternatively, you can implement your own subclass
of
   <code>
    <a href="/reference/android/content/Loader.html">
     Loader
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/content/AsyncTaskLoader.html">
     AsyncTaskLoader
    </a>
   </code>
   to
load data from some other source.
  </li>
  <li>
   An implementation for
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
     LoaderManager.LoaderCallbacks
    </a>
   </code>
   .
This is where you create new loaders and manage your references to existing
loaders.
  </li>
  <li>
   A way of displaying the loader's data, such as a
   <code>
    <a href="/reference/android/widget/SimpleCursorAdapter.html">
     SimpleCursorAdapter
    </a>
   </code>
   .
  </li>
  <li>
   A data source, such as a
   <code>
    <a href="/reference/android/content/ContentProvider.html">
     ContentProvider
    </a>
   </code>
   , when using a
   <code>
    <a href="/reference/android/content/CursorLoader.html">
     CursorLoader
    </a>
   </code>
   .
  </li>
 </ul>
 <h3 id="starting">
  Starting a Loader
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  manages one or more
  <code>
   <a href="/reference/android/content/Loader.html">
    Loader
   </a>
  </code>
  instances within an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  . There is only one
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  per activity or fragment.
 </p>
 <p>
  You typically
initialize a
  <code>
   <a href="/reference/android/content/Loader.html">
    Loader
   </a>
  </code>
  within the activity's
  <code>
   <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
    onCreate()
   </a>
  </code>
  method, or within the fragment's
  <code>
   <a href="/reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">
    onActivityCreated()
   </a>
  </code>
  method. You
do this as follows:
 </p>
 <pre>// Prepare the loader.  Either re-connect with an existing one,
// or start a new one.
getLoaderManager().initLoader(0, null, this);</pre>
 <p>
  The
  <code>
   <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    initLoader()
   </a>
  </code>
  method takes
the following parameters:
 </p>
 <ul>
  <li>
   A unique ID that identifies the loader. In this example, the ID is 0.
  </li>
  <li>
   Optional arguments to supply to the loader at
construction (
   <code>
    null
   </code>
   in this example).
  </li>
  <li>
   A
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
     LoaderManager.LoaderCallbacks
    </a>
   </code>
   implementation, which
the
   <code>
    <a href="/reference/android/app/LoaderManager.html">
     LoaderManager
    </a>
   </code>
   calls to report loader events. In this
example, the local class implements the
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
     LoaderManager.LoaderCallbacks
    </a>
   </code>
   interface, so it passes a reference
to itself,
   <code>
    this
   </code>
   .
  </li>
 </ul>
 <p>
  The
  <code>
   <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    initLoader()
   </a>
  </code>
  call ensures that a loader
is initialized and active. It has two possible outcomes:
 </p>
 <ul>
  <li>
   If the loader specified by the ID already exists, the last created loader
is reused.
  </li>
  <li>
   If the loader specified by the ID does
   <em>
    not
   </em>
   exist,
   <code>
    <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
     initLoader()
    </a>
   </code>
   triggers the
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
     LoaderManager.LoaderCallbacks
    </a>
   </code>
   method
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onCreateLoader(int, android.os.Bundle)">
     onCreateLoader()
    </a>
   </code>
   .
This is where you  implement the code to instantiate and return a new loader.
For more discussion, see the section
   <a href="#onCreateLoader">
    onCreateLoader
   </a>
   .
  </li>
 </ul>
 <p>
  In either case, the given
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
    LoaderManager.LoaderCallbacks
   </a>
  </code>
  implementation is associated with the loader, and  will be called when the
loader state changes.  If at the point of this call  the caller is in its
started state, and the requested loader already exists and has generated its
data, then the system calls
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onLoadFinished(android.content.Loader&lt;D&gt;, D)">
    onLoadFinished()
   </a>
  </code>
  immediately (during
  <code>
   <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    initLoader()
   </a>
  </code>
  ),
so you must be prepared for this to happen. See
  <a href="#onLoadFinished">
   onLoadFinished
  </a>
  for more discussion of this callback
 </p>
 <p>
  Note that the
  <code>
   <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    initLoader()
   </a>
  </code>
  method returns the
  <code>
   <a href="/reference/android/content/Loader.html">
    Loader
   </a>
  </code>
  that is created, but you don't
need to capture a reference to it. The
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  manages
the life of the loader automatically. The
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  starts and stops loading when necessary, and maintains the state of the loader
and its associated content. As this implies, you rarely interact with loaders
directly (though for an example of using loader methods to fine-tune a loader's
behavior, see the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LoaderThrottle.html">
   LoaderThrottle
  </a>
  sample). 
You most commonly use the
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
    LoaderManager.LoaderCallbacks
   </a>
  </code>
  methods to intervene in the loading
process when particular events occur. For more discussion of this topic, see
  <a href="#callback">
   Using the LoaderManager Callbacks
  </a>
  .
 </p>
 <h3 id="restarting">
  Restarting a Loader
 </h3>
 <p>
  When you use
  <code>
   <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    initLoader()
   </a>
  </code>
  , as
shown above, it uses an existing loader with the specified ID if there is one.
If there isn't, it creates one. But sometimes you want to discard your old data
and start over.
 </p>
 <p>
  To discard your old data, you use
  <code>
   <a href="/reference/android/app/LoaderManager.html#restartLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    restartLoader()
   </a>
  </code>
  . For example, this
implementation of
  <code>
   <a href="/reference/android/widget/SearchView.OnQueryTextListener.html">
    SearchView.OnQueryTextListener
   </a>
  </code>
  restarts
the loader when the user's query changes. The loader needs to be restarted so
that it can use the revised search filter to do a new query:
 </p>
 <pre>
public boolean onQueryTextChanged(String newText) {
    // Called when the action bar search text has changed.  Update
    // the search filter, and restart the loader to do a new query
    // with this filter.
    mCurFilter = !TextUtils.isEmpty(newText) ? newText : null;
    getLoaderManager().restartLoader(0, null, this);
    return true;
}</pre>
 <h3 id="callback">
  Using the LoaderManager Callbacks
 </h3>
 <p>
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
    LoaderManager.LoaderCallbacks
   </a>
  </code>
  is a callback interface
that lets a client  interact with the
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  .
 </p>
 <p>
  Loaders, in particular
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  , are  expected to
retain their  data after being stopped. This allows applications to keep their
data across the activity or fragment's
  <code>
   <a href="/reference/android/app/Activity.html#onStop()">
    onStop()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/app/Activity.html#onStart()">
    onStart()
   </a>
  </code>
  methods, so that
when users return to an application, they don't have to wait for the data to
reload. You use the
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
    LoaderManager.LoaderCallbacks
   </a>
  </code>
  methods
when to know when to create a new loader, and to tell the application when it is
 time to  stop using a loader's data.
 </p>
 <p>
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
    LoaderManager.LoaderCallbacks
   </a>
  </code>
  includes these
methods:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onCreateLoader(int, android.os.Bundle)">
     onCreateLoader()
    </a>
   </code>
   &mdash;
Instantiate and return a new
   <code>
    <a href="/reference/android/content/Loader.html">
     Loader
    </a>
   </code>
   for the given ID.
  </li>
 </ul>
 <ul>
  <li>
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onLoadFinished(android.content.Loader&lt;D&gt;, D)">
     onLoadFinished()
    </a>
   </code>
   &mdash; Called when a previously created loader has finished its load.
  </li>
 </ul>
 <ul>
  <li>
   <code>
    <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onLoaderReset(android.content.Loader&lt;D&gt;)">
     onLoaderReset()
    </a>
   </code>
   &mdash; Called when a previously created loader is being reset,  thus  making its
data unavailable.
  </li>
 </ul>
 <p>
  These methods are described in more detail in the following sections.
 </p>
 <h4 id="onCreateLoader">
  onCreateLoader
 </h4>
 <p>
  When you attempt to access a loader (for example, through
  <code>
   <a href="/reference/android/app/LoaderManager.html#initLoader(int, android.os.Bundle, android.app.LoaderManager.LoaderCallbacks&lt;D&gt;)">
    initLoader()
   </a>
  </code>
  ), it checks to see whether
the loader specified by the ID exists. If it doesn't, it triggers the
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html">
    LoaderManager.LoaderCallbacks
   </a>
  </code>
  method
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onCreateLoader(int, android.os.Bundle)">
    onCreateLoader()
   </a>
  </code>
  . This
is where you  create a new loader. Typically this will be a
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  , but you can implement your own
  <code>
   <a href="/reference/android/content/Loader.html">
    Loader
   </a>
  </code>
  subclass.
 </p>
 <p>
  In this example, the
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onCreateLoader(int, android.os.Bundle)">
    onCreateLoader()
   </a>
  </code>
  callback method creates a
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  . You must build
the
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  using its constructor method, which
requires the complete set of information needed to perform a query to the
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  . Specifically, it needs:
 </p>
 <ul>
  <li>
   <em>
    uri
   </em>
   &mdash; The URI for the content to retrieve.
  </li>
  <li>
   <em>
    projection
   </em>
   &mdash; A list of which columns to return. Passing
   <code>
    null
   </code>
   will return all columns, which is inefficient.
  </li>
  <li>
   <em>
    selection
   </em>
   &mdash; A filter declaring which rows to return,
formatted as an SQL WHERE clause (excluding the WHERE itself). Passing
   <code>
    null
   </code>
   will return all rows for the given URI.
  </li>
  <li>
   <em>
    selectionArgs
   </em>
   &mdash; You may include ?s in the selection, which will
be replaced by the values from
   <em>
    selectionArgs
   </em>
   , in the order that they appear in
the selection. The values will be bound as Strings.
  </li>
  <li>
   <em>
    sortOrder
   </em>
   &mdash; How to order the rows, formatted as an SQL
ORDER BY clause (excluding the ORDER BY itself). Passing
   <code>
    null
   </code>
   will
use the default sort order, which may be unordered.
  </li>
 </ul>
 <p>
  For example:
 </p>
 <pre>
 // If non-null, this is the current filter the user has provided.
String mCurFilter;
...
public Loader&lt;Cursor&gt; onCreateLoader(int id, Bundle args) {
    // This is called when a new Loader needs to be created. &nbsp;This
    // sample only has one Loader, so we don't care about the ID.
    // First, pick the base URI to use depending on whether we are
    // currently filtering.
    Uri baseUri;
&nbsp; &nbsp; if (mCurFilter != null) {
&nbsp; &nbsp; &nbsp; &nbsp; baseUri = Uri.withAppendedPath(Contacts.CONTENT_FILTER_URI,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Uri.encode(mCurFilter));
&nbsp; &nbsp; } else {
&nbsp; &nbsp; &nbsp; &nbsp; baseUri = Contacts.CONTENT_URI;
&nbsp; &nbsp; }

&nbsp; &nbsp; // Now create and return a CursorLoader that will take care of
&nbsp; &nbsp; // creating a Cursor for the data being displayed.
&nbsp; &nbsp; String select = "((" + Contacts.DISPLAY_NAME + " NOTNULL) AND ("
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + Contacts.HAS_PHONE_NUMBER + "=1) AND ("
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + Contacts.DISPLAY_NAME + " != '' ))";
&nbsp; &nbsp; return new CursorLoader(getActivity(), baseUri,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONTACTS_SUMMARY_PROJECTION, select, null,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Contacts.DISPLAY_NAME + " COLLATE LOCALIZED ASC");
}</pre>
 <h4 id="onLoadFinished">
  onLoadFinished
 </h4>
 <p>
  This method is called when a previously created loader has finished its load.
This method is guaranteed to be called prior to the release of  the last data
that was supplied for this loader.  At this point  you should remove all use of
the old data (since it will be released  soon), but should not do your own
release of the data since its loader  owns it and will take care of that.
 </p>
 <p>
  The loader will release the data once it knows the application  is no longer
using it.  For example, if the data is  a cursor from a
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  ,  you should not call
  <code>
   <a href="/reference/android/database/Cursor.html#close()">
    close()
   </a>
  </code>
  on it yourself. If the cursor is being
placed in a
  <code>
   <a href="/reference/android/widget/CursorAdapter.html">
    CursorAdapter
   </a>
  </code>
  , you should use the
  <code>
   <a href="/reference/android/widget/SimpleCursorAdapter.html#swapCursor(android.database.Cursor)">
    swapCursor()
   </a>
  </code>
  method so that the
old
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  is not closed. For example:
 </p>
 <pre>
// This is the Adapter being used to display the list's data.<br/>SimpleCursorAdapter mAdapter;
...

public void onLoadFinished(Loader&lt;Cursor&gt; loader, Cursor data) {
    // Swap the new cursor in. &nbsp;(The framework will take care of closing the
    // old cursor once we return.)
    mAdapter.swapCursor(data);
}</pre>
 <h4 id="onLoaderReset">
  onLoaderReset
 </h4>
 <p>
  This method is called when a previously created loader is being reset,  thus 
making its data unavailable. This callback lets you find  out when the data is
about to be released so you can remove your  reference to it. &nbsp;
 </p>
 <p>
  This implementation calls
  <code>
   <a href="/reference/android/widget/SimpleCursorAdapter.html#swapCursor(android.database.Cursor)">
    swapCursor()
   </a>
  </code>
  with a value of
  <code>
   null
  </code>
  :
 </p>
 <pre>
// This is the Adapter being used to display the list's data.
SimpleCursorAdapter mAdapter;
...

public void onLoaderReset(Loader&lt;Cursor&gt; loader) {
    // This is called when the last Cursor provided to onLoadFinished()
    // above is about to be closed. &nbsp;We need to make sure we are no
    // longer using it.
    mAdapter.swapCursor(null);
}</pre>
 <h2 id="example">
  Example
 </h2>
 <p>
  As an example, here is the full implementation of a
  <code>
   <a href="/reference/android/app/Fragment.html">
    Fragment
   </a>
  </code>
  that displays a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  containing
the results of a query against the contacts content provider. It uses a
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  to manage the query on the provider.
 </p>
 <p>
  For an application to access a user's contacts, as shown in this example, its
manifest must include the permission
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  .
 </p>
 <pre>
public static class CursorLoaderListFragment extends ListFragment
&nbsp; &nbsp; &nbsp; &nbsp; implements OnQueryTextListener, LoaderManager.LoaderCallbacks&lt;Cursor&gt; {

    // This is the Adapter being used to display the list's data.
&nbsp; &nbsp; SimpleCursorAdapter mAdapter;

&nbsp; &nbsp; // If non-null, this is the current filter the user has provided.
&nbsp; &nbsp; String mCurFilter;

&nbsp; &nbsp; @Override public void onActivityCreated(Bundle savedInstanceState) {
&nbsp; &nbsp; &nbsp; &nbsp; super.onActivityCreated(savedInstanceState);

&nbsp; &nbsp; &nbsp; &nbsp; // Give some text to display if there is no data. &nbsp;In a real
&nbsp; &nbsp; &nbsp; &nbsp; // application this would come from a resource.
&nbsp; &nbsp; &nbsp; &nbsp; setEmptyText("No phone numbers");

&nbsp; &nbsp; &nbsp; &nbsp; // We have a menu item to show in action bar.
&nbsp; &nbsp; &nbsp; &nbsp; setHasOptionsMenu(true);

&nbsp; &nbsp; &nbsp; &nbsp; // Create an empty adapter we will use to display the loaded data.
&nbsp; &nbsp; &nbsp; &nbsp; mAdapter = new SimpleCursorAdapter(getActivity(),
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; android.R.layout.simple_list_item_2, null,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new String[] { Contacts.DISPLAY_NAME, Contacts.CONTACT_STATUS },
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new int[] { android.R.id.text1, android.R.id.text2 }, 0);
&nbsp; &nbsp; &nbsp; &nbsp; setListAdapter(mAdapter);

&nbsp; &nbsp; &nbsp; &nbsp; // Prepare the loader. &nbsp;Either re-connect with an existing one,
&nbsp; &nbsp; &nbsp; &nbsp; // or start a new one.
&nbsp; &nbsp; &nbsp; &nbsp; getLoaderManager().initLoader(0, null, this);
&nbsp; &nbsp; }

&nbsp; &nbsp; @Override public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
&nbsp; &nbsp; &nbsp; &nbsp; // Place an action bar item for searching.
&nbsp; &nbsp; &nbsp; &nbsp; MenuItem item = menu.add("Search");
&nbsp; &nbsp; &nbsp; &nbsp; item.setIcon(android.R.drawable.ic_menu_search);
&nbsp; &nbsp; &nbsp; &nbsp; item.setShowAsAction(MenuItem.SHOW_AS_ACTION_IF_ROOM);
&nbsp; &nbsp; &nbsp; &nbsp; SearchView sv = new SearchView(getActivity());
&nbsp; &nbsp; &nbsp; &nbsp; sv.setOnQueryTextListener(this);
&nbsp; &nbsp; &nbsp; &nbsp; item.setActionView(sv);
&nbsp; &nbsp; }

&nbsp; &nbsp; public boolean onQueryTextChange(String newText) {
&nbsp; &nbsp; &nbsp; &nbsp; // Called when the action bar search text has changed. &nbsp;Update
&nbsp; &nbsp; &nbsp; &nbsp; // the search filter, and restart the loader to do a new query
&nbsp; &nbsp; &nbsp; &nbsp; // with this filter.
&nbsp; &nbsp; &nbsp; &nbsp; mCurFilter = !TextUtils.isEmpty(newText) ? newText : null;
&nbsp; &nbsp; &nbsp; &nbsp; getLoaderManager().restartLoader(0, null, this);
&nbsp; &nbsp; &nbsp; &nbsp; return true;
&nbsp; &nbsp; }

&nbsp; &nbsp; @Override public boolean onQueryTextSubmit(String query) {
&nbsp; &nbsp; &nbsp; &nbsp; // Don't care about this.
&nbsp; &nbsp; &nbsp; &nbsp; return true;
&nbsp; &nbsp; }

&nbsp; &nbsp; @Override public void onListItemClick(ListView l, View v, int position, long id) {
&nbsp; &nbsp; &nbsp; &nbsp; // Insert desired behavior here.
&nbsp; &nbsp; &nbsp; &nbsp; Log.i("FragmentComplexList", "Item clicked: " + id);
&nbsp; &nbsp; }

&nbsp; &nbsp; // These are the Contacts rows that we will retrieve.
&nbsp; &nbsp; static final String[] CONTACTS_SUMMARY_PROJECTION = new String[] {
&nbsp; &nbsp; &nbsp; &nbsp; Contacts._ID,
&nbsp; &nbsp; &nbsp; &nbsp; Contacts.DISPLAY_NAME,
&nbsp; &nbsp; &nbsp; &nbsp; Contacts.CONTACT_STATUS,
&nbsp; &nbsp; &nbsp; &nbsp; Contacts.CONTACT_PRESENCE,
&nbsp; &nbsp; &nbsp; &nbsp; Contacts.PHOTO_ID,
&nbsp; &nbsp; &nbsp; &nbsp; Contacts.LOOKUP_KEY,
&nbsp; &nbsp; };
&nbsp; &nbsp; public Loader&lt;Cursor&gt; onCreateLoader(int id, Bundle args) {
&nbsp; &nbsp; &nbsp; &nbsp; // This is called when a new Loader needs to be created. &nbsp;This
&nbsp; &nbsp; &nbsp; &nbsp; // sample only has one Loader, so we don't care about the ID.
&nbsp; &nbsp; &nbsp; &nbsp; // First, pick the base URI to use depending on whether we are
&nbsp; &nbsp; &nbsp; &nbsp; // currently filtering.
&nbsp; &nbsp; &nbsp; &nbsp; Uri baseUri;
&nbsp; &nbsp; &nbsp; &nbsp; if (mCurFilter != null) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; baseUri = Uri.withAppendedPath(Contacts.CONTENT_FILTER_URI,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Uri.encode(mCurFilter));
&nbsp; &nbsp; &nbsp; &nbsp; } else {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; baseUri = Contacts.CONTENT_URI;
&nbsp; &nbsp; &nbsp; &nbsp; }

&nbsp; &nbsp; &nbsp; &nbsp; // Now create and return a CursorLoader that will take care of
&nbsp; &nbsp; &nbsp; &nbsp; // creating a Cursor for the data being displayed.
&nbsp; &nbsp; &nbsp; &nbsp; String select = "((" + Contacts.DISPLAY_NAME + " NOTNULL) AND ("
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + Contacts.HAS_PHONE_NUMBER + "=1) AND ("
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + Contacts.DISPLAY_NAME + " != '' ))";
&nbsp; &nbsp; &nbsp; &nbsp; return new CursorLoader(getActivity(), baseUri,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONTACTS_SUMMARY_PROJECTION, select, null,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Contacts.DISPLAY_NAME + " COLLATE LOCALIZED ASC");
&nbsp; &nbsp; }

&nbsp; &nbsp; public void onLoadFinished(Loader&lt;Cursor&gt; loader, Cursor data) {
&nbsp; &nbsp; &nbsp; &nbsp; // Swap the new cursor in. &nbsp;(The framework will take care of closing the
&nbsp; &nbsp; &nbsp; &nbsp; // old cursor once we return.)
&nbsp; &nbsp; &nbsp; &nbsp; mAdapter.swapCursor(data);
&nbsp; &nbsp; }

&nbsp; &nbsp; public void onLoaderReset(Loader&lt;Cursor&gt; loader) {
&nbsp; &nbsp; &nbsp; &nbsp; // This is called when the last Cursor provided to onLoadFinished()
&nbsp; &nbsp; &nbsp; &nbsp; // above is about to be closed. &nbsp;We need to make sure we are no
&nbsp; &nbsp; &nbsp; &nbsp; // longer using it.
&nbsp; &nbsp; &nbsp; &nbsp; mAdapter.swapCursor(null);
&nbsp; &nbsp; }
}</pre>
 <h3 id="more_examples">
  More Examples
 </h3>
 <p>
  There are a few different samples in
  <strong>
   ApiDemos
  </strong>
  that
illustrate how to use loaders:
 </p>
 <ul>
  <li>
   <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LoaderCursor.html">
    LoaderCursor
   </a>
   &mdash; A complete version of the
snippet shown above.
  </li>
  <li>
   <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LoaderThrottle.html">
    LoaderThrottle
   </a>
   &mdash; An example of how to use throttling to
reduce the number of queries a content provider does when its data changes.
  </li>
 </ul>
 <p>
  For information on downloading and installing the SDK samples, see
  <a href="http://developer.android.com/resources/samples/get.html">
   Getting the
Samples
  </a>
  .
 </p>
</div>
<h1>Tasks and Back Stack</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#ActivityState">
      Saving Activity State
     </a>
    </li>
    <li>
     <a href="#ManagingTasks">
      Managing Tasks
     </a>
     <ol>
      <li>
       <a href="#TaskLaunchModes">
        Defining launch modes
       </a>
      </li>
      <li>
       <a href="#Affinities">
        Handling affinities
       </a>
      </li>
      <li>
       <a href="#Clearing">
        Clearing the back stack
       </a>
      </li>
      <li>
       <a href="#Starting">
        Starting a task
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Articles
   </h2>
   <ol>
    <li>
     <a href="http://android-developers.blogspot.com/2010/04/multitasking-android-way.html">
      Multitasking the Android Way
     </a>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/design/patterns/navigation.html">
      Android Design:
Navigation
     </a>
    </li>
    <li>
     <a href="/guide/topics/manifest/activity-element.html">
      <code>
       &lt;activity&gt;
      </code>
      manifest
element
     </a>
    </li>
    <li>
     <a href="/guide/components/recents.html">
      Overview Screen
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  An application usually contains multiple
  <a href="/guide/components/activities.html">
   activities
  </a>
  . Each activity
should be designed around a specific kind of action the user can perform and can start other
activities. For example, an email application might have one activity to show a list of new messages.
When the user selects a message, a new activity opens to view that message.
 </p>
 <p>
  An activity can even start activities that exist in other applications on the device. For
example, if your application wants to send an email message, you can define an intent to perform a
"send" action and include some data, such as an email address and a message. An activity from another
application that declares itself to handle this kind of intent then opens. In this case, the intent
is to send an email, so an email application's "compose" activity starts (if multiple activities
support the same intent, then the system lets the user select which one to use). When the email is
sent, your activity resumes and it seems as if the email activity was part of your application. Even
though the activities may be from different applications, Android maintains this seamless user
experience by keeping both activities in the same
  <em>
   task
  </em>
  .
 </p>
 <p>
  A task is a collection of activities that users interact with
when performing a certain job. The activities are arranged in a stack (the
  <em>
   back stack
  </em>
  ), in
the order in which each activity is opened.
 </p>
 <!-- SAVE FOR WHEN THE FRAGMENT DOC IS ADDED
<div class="sidebox-wrapper">
<div class="sidebox">
<h3>Adding fragments to a task's back stack</h3>

<p>Your activity can also include <code><a href="/reference/android/app/Fragment.html">Fragment</a></code>s to the back stack. For example,
suppose you have a two-pane layout using fragments, one of which is a list view (fragment A) and the
other being a layout to display an item from the list (fragment B). When the user selects an item
from the list, fragment B is replaced by a new fragment (fragment C). In this case, it might be
desireable for the user to navigate back to reveal fragment B, using the <em>Back</em> button.</p>
<p>In order to add fragment B to the back stack so that this is possible, you must call <code><a href="/reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> before you <code><a href="/reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> the transaction that replaces fragment B with fragment
C.</p>
<p>For more information about using fragments and adding them to the back stack, see the <code><a href="/reference/android/app/Fragment.html">Fragment</a></code> class documentation.</p>

</div>
</div>
-->
 <p>
  The device Home screen is the starting place for most tasks. When the user touches an icon in the
application
launcher (or a shortcut on the Home screen), that application's task comes to the foreground. If no
task exists for the application (the application has not been used recently), then a new task
is created and the "main" activity for that application opens as the root activity in the stack.
 </p>
 <p>
  When the current activity starts another, the new activity is pushed on the top of the stack and
takes focus. The previous activity remains in the stack, but is stopped. When an activity
stops, the system retains the current state of its user interface. When the user presses the
  <em>
   Back
  </em>
  button, the current activity is popped from the top of the stack (the activity is destroyed) and the
previous activity resumes (the previous state of its UI is restored). Activities in the stack are
never rearranged, only pushed and popped from the stack&mdash;pushed onto the stack when started by
the current activity and popped off when the user leaves it using the
  <em>
   Back
  </em>
  button. As such,
the back
stack operates as a "last in, first out" object structure. Figure 1 visualizes
this behavior with a timeline showing the progress between activities along with the current back
stack at each point in time.
 </p>
 <img alt="" src="http://developer.android.com/images/fundamentals/diagram_backstack.png"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  A representation of how each new activity in a
task adds an item to the back stack. When the user presses the
  <em>
   Back
  </em>
  button, the current
activity is
destroyed and the previous activity resumes.
 </p>
 <p>
  If the user continues to press
  <em>
   Back
  </em>
  , then each activity in the stack is popped off to
reveal the
previous one, until the user returns to the Home screen (or to whichever activity was running when
the task began). When all activities are removed from the stack, the task no longer exists.
 </p>
 <div class="figure" style="width:287px">
  <img alt="" src="http://developer.android.com/images/fundamentals/diagram_multitasking.png"/>
  <p class="img-caption">
   <strong>
    Figure 2.
   </strong>
   Two tasks: Task B receives user interaction
in the foreground, while Task A is in the background, waiting to be resumed.
  </p>
 </div>
 <div class="figure" style="width:215px">
  <img alt="" src="http://developer.android.com/images/fundamentals/diagram_multiple_instances.png"/>
  <p class="img-caption">
   <strong>
    Figure 3.
   </strong>
   A single activity is instantiated multiple times.
  </p>
 </div>
 <p>
  A task is a cohesive unit that can move to the "background" when users begin a new task or go
to the Home screen, via the
  <em>
   Home
  </em>
  button. While in the background, all the activities in the
task are
stopped, but the back stack for the task remains intact&mdash;the task has simply lost focus while
another task takes place, as shown in figure 2. A task can then return to the "foreground" so users
can pick up where they left off. Suppose, for example, that the current task (Task A) has three
activities in its stack&mdash;two under the current activity. The user presses the
  <em>
   Home
  </em>
  button, then
starts a new application from the application launcher. When the Home screen appears, Task A goes
into the background. When the new application starts, the system starts a task for that application
(Task B) with its own stack of activities. After interacting with
that application, the user returns Home again and selects the application that originally
started Task A. Now, Task A comes to the
foreground&mdash;all three activities in its stack are intact and the activity at the top of the
stack resumes. At
this point, the user can also switch back to Task B by going Home and selecting the application icon
that started that task (or by selecting the app's task from the
  <a href="/guide/components/recents.html">
   overview screen
  </a>
  ).
This is an example of multitasking on Android.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Multiple tasks can be held in the background at once.
However, if the user is running many background tasks at the same time, the system might begin
destroying background activities in order to recover memory, causing the activity states to be lost.
See the following section about
  <a href="#ActivityState">
   Activity state
  </a>
  .
 </p>
 <p>
  Because the activities in the back stack are never rearranged, if your application allows
users to start a particular activity from more than one activity, a new instance of
that activity is created and pushed onto the stack (rather than bringing any previous instance of
the activity to the top). As such, one activity in your application might be instantiated multiple
times (even from different tasks), as shown in figure 3. As such, if the user navigates backward
using the
  <em>
   Back
  </em>
  button, each instance of the activity is revealed in the order they were
opened (each
with their own UI state). However, you can modify this behavior if you do not want an activity to be
instantiated more than once. How to do so is discussed in the later section about
  <a href="#ManagingTasks">
   Managing Tasks
  </a>
  .
 </p>
 <p>
  To summarize the default behavior for activities and tasks:
 </p>
 <ul>
  <li>
   When Activity A starts Activity B, Activity A is stopped, but the system retains its state
(such as scroll position and text entered into forms).
If the user presses the
   <em>
    Back
   </em>
   button while in Activity B, Activity A resumes with its state
restored.
  </li>
  <li>
   When the user leaves a task by pressing the
   <em>
    Home
   </em>
   button, the current activity is
stopped and
its task goes into the background. The system retains the state of every activity in the task. If
the user later resumes the task by selecting the launcher icon that began the task, the task comes
to the foreground and resumes the activity at the top of the stack.
  </li>
  <li>
   If the user presses the
   <em>
    Back
   </em>
   button, the current activity is popped from the stack
and
destroyed. The previous activity in the stack is resumed. When an activity is destroyed, the system
   <em>
    does not
   </em>
   retain the activity's state.
  </li>
  <li>
   Activities can be instantiated multiple times, even from other tasks.
  </li>
 </ul>
 <div class="note design">
  <p>
   <strong>
    Navigation Design
   </strong>
  </p>
  <p>
   For more about how app navigation works on Android, read Android Design's
   <a href="/design/patterns/navigation.html">
    Navigation
   </a>
   guide.
  </p>
 </div>
 <h2 id="ActivityState">
  Saving Activity State
 </h2>
 <p>
  As discussed above, the system's default behavior preserves the state of an activity when it is
stopped. This way, when users navigate back to a previous activity, its user interface appears
the way they left it. However, you can&mdash;and
  <strong>
   should
  </strong>
  &mdash;proactively retain
the state of your activities using callback methods, in case the activity is destroyed and must
be recreated.
 </p>
 <p>
  When the system stops one of your activities (such as when a new activity starts or the task
moves to the background), the system might destroy that activity completely if it needs to recover
system memory. When this happens, information about the activity state is lost. If this happens, the
system still
knows that the activity has a place in the back stack, but when the activity is brought to the
top of the stack the system must recreate it (rather than resume it). In order to
avoid losing the user's work, you should proactively retain it by implementing the
  <code>
   <a href="/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">
    onSaveInstanceState()
   </a>
  </code>
  callback
methods in your activity.
 </p>
 <p>
  For more information about how to save your activity state, see the
  <a href="/guide/components/activities.html#SavingActivityState">
   Activities
  </a>
  document.
 </p>
 <h2 id="ManagingTasks">
  Managing Tasks
 </h2>
 <p>
  The way Android manages tasks and the back stack, as described above&mdash;by placing all
activities started in succession in the same task and in a "last in, first out" stack&mdash;works
great for most applications and you shouldn't have to worry about how your activities are associated
with tasks or how they exist in the back stack. However, you might decide that you want to interrupt
the normal behavior. Perhaps you want an activity in your application to begin a new task when it is
started (instead of being placed within the current task); or, when you start an activity, you want
to bring forward an existing instance of it (instead of creating a new
instance on top of the back stack); or, you want your back stack to be cleared of all
activities except for the root activity when the user leaves the task.
 </p>
 <p>
  You can do these things and more, with attributes in the
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  manifest element and with flags in the intent that you pass to
  <code>
   <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  .
 </p>
 <p>
  In this regard, the principal
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  attributes you can use are:
 </p>
 <ul class="nolist">
  <li>
   <a href="/guide/topics/manifest/activity-element.html#aff">
    <code>
     taskAffinity
    </code>
   </a>
  </li>
  <li>
   <a href="/guide/topics/manifest/activity-element.html#lmode">
    <code>
     launchMode
    </code>
   </a>
  </li>
  <li>
   <a href="/guide/topics/manifest/activity-element.html#reparent">
    <code>
     allowTaskReparenting
    </code>
   </a>
  </li>
  <li>
   <a href="/guide/topics/manifest/activity-element.html#clear">
    <code>
     clearTaskOnLaunch
    </code>
   </a>
  </li>
  <li>
   <a href="/guide/topics/manifest/activity-element.html#always">
    <code>
     alwaysRetainTaskState
    </code>
   </a>
  </li>
  <li>
   <a href="/guide/topics/manifest/activity-element.html#finish">
    <code>
     finishOnTaskLaunch
    </code>
   </a>
  </li>
 </ul>
 <p>
  And the principal intent flags you can use are:
 </p>
 <ul class="nolist">
  <li>
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">
     FLAG_ACTIVITY_NEW_TASK
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_CLEAR_TOP">
     FLAG_ACTIVITY_CLEAR_TOP
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_SINGLE_TOP">
     FLAG_ACTIVITY_SINGLE_TOP
    </a>
   </code>
  </li>
 </ul>
 <p>
  In the following sections, you'll see how you can use these manifest attributes and intent
flags to define how activities are associated with tasks and how they behave in the back stack.
 </p>
 <p>
  Also, discussed separately are the considerations for how tasks and activites may be represented
and managed in the overview screen. See
  <a href="/guide/components/recents.html">
   Overview Screen
  </a>
  for more information. Normally you should allow the system to define how your task and
activities are represented in the overview screen, and you don't need to modify this behavior.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  Most applications should not interrupt the default
behavior for activities and tasks. If you determine that it's necessary for your activity to modify
the default behaviors, use caution and be sure to test the usability of the activity during
launch and when navigating back to it from other activities and tasks with the
  <em>
   Back
  </em>
  button.
Be sure to test for navigation behaviors that might conflict with the user's expected behavior.
 </p>
 <h3 id="TaskLaunchModes">
  Defining launch modes
 </h3>
 <p>
  Launch modes allow you to define how a new instance of an activity is associated with the
current task. You can define different launch modes in two ways:
 </p>
 <ul class="nolist">
  <li>
   <a href="#ManifestForTasks">
    Using the manifest file
   </a>
   <p>
    When you declare an activity in your manifest file, you can specify how the activity
should associate with tasks when it starts.
   </p>
  </li>
  <li>
   <a href="#IntentFlagsForTasks">
    Using Intent flags
   </a>
   <p>
    When you call
    <code>
     <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
      startActivity()
     </a>
    </code>
    ,
you can include a flag in the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    that declares how (or
whether) the new activity should associate with the current task.
   </p>
  </li>
 </ul>
 <p>
  As such, if Activity A starts Activity B, Activity B can define in its manifest how it
should associate with the current task (if at all) and Activity A can also request how Activity
B should associate with current task. If both activities define how Activity B
should associate with a task, then Activity A's request (as defined in the intent) is honored
over Activity B's request (as defined in its manifest).
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Some launch modes available for the manifest file
are not available as flags for an intent and, likewise, some launch modes available as flags
for an intent cannot be defined in the manifest.
 </p>
 <h4 id="ManifestForTasks">
  Using the manifest file
 </h4>
 <p>
  When declaring an activity in your manifest file, you can specify how the activity should
associate with a task using the
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element's
  <a href="/guide/topics/manifest/activity-element.html#lmode">
   <code>
    launchMode
   </code>
  </a>
  attribute.
 </p>
 <p>
  The
  <a href="/guide/topics/manifest/activity-element.html#lmode">
   <code>
    launchMode
   </code>
  </a>
  attribute specifies an instruction on how the activity should be launched into a
task. There are four different launch modes you can assign to the
  <code>
   <a href="/guide/topics/manifest/activity-element.html#lmode">
    launchMode
   </a>
  </code>
  attribute:
 </p>
 <dl>
  <dt>
   <code>
    "standard"
   </code>
   (the default mode)
  </dt>
  <dd>
   Default. The system creates a new instance of the activity in the task from
which it was started and routes the intent to it. The activity can be instantiated multiple times,
each instance can belong to different tasks, and one task can have multiple instances.
  </dd>
  <dt>
   <code>
    "singleTop"
   </code>
  </dt>
  <dd>
   If an instance of the activity already exists at the top of the current task, the system
routes the intent to that instance through a call to its
   <code>
    <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
     onNewIntent()
    </a>
   </code>
   method, rather than creating a new instance of the
activity. The activity can be instantiated multiple times, each instance can
belong to different tasks, and one task can have multiple instances (but only if the
activity at the top of the back stack is
   <em>
    not
   </em>
   an existing instance of the activity).
   <p>
    For example, suppose a task's back stack consists of root activity A with activities B, C,
and D on top (the stack is A-B-C-D; D is on top). An intent arrives for an activity of type D.
If D has the default
    <code>
     "standard"
    </code>
    launch mode, a new instance of the class is launched and the
stack becomes A-B-C-D-D. However, if D's launch mode is
    <code>
     "singleTop"
    </code>
    , the existing instance
of D receives the intent through
    <code>
     <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
      onNewIntent()
     </a>
    </code>
    , because it's at the top of the stack&mdash;the
stack remains A-B-C-D. However, if an intent arrives for an activity of type B, then a new
instance of B is added to the stack, even if its launch mode is
    <code>
     "singleTop"
    </code>
    .
   </p>
   <p class="note">
    <strong>
     Note:
    </strong>
    When a new instance of an activity is created,
the user can press the
    <em>
     Back
    </em>
    button to return to the previous activity. But when an existing
instance of
an activity handles a new intent, the user cannot press the
    <em>
     Back
    </em>
    button to return to the
state of
the activity before the new intent arrived in
    <code>
     <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
      onNewIntent()
     </a>
    </code>
    .
   </p>
  </dd>
  <dt>
   <code>
    "singleTask"
   </code>
  </dt>
  <dd>
   The system creates a new task and instantiates the activity at the root of the new task.
However, if an instance of the activity already exists in a separate task, the system routes the
intent to the existing instance through a call to its
   <code>
    <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
     onNewIntent()
    </a>
   </code>
   method, rather than creating a new instance. Only
one instance of the activity can exist at a time.
   <p class="note">
    <strong>
     Note:
    </strong>
    Although the activity starts in a new task, the
    <em>
     Back
    </em>
    button still returns the user to the previous activity.
   </p>
  </dd>
  <dt>
   <code>
    "singleInstance"
   </code>
   .
  </dt>
  <dd>
   Same as
   <code>
    "singleTask"
   </code>
   , except that the system doesn't launch any other activities into
the task holding the instance. The activity is always the single and only member of its task;
any activities started by this one open in a separate task.
  </dd>
 </dl>
 <p>
  As another example, the Android Browser application declares that the web browser activity should
always open in its own task&mdash;by specifying the
  <code>
   singleTask
  </code>
  launch mode in the
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element.
This means that if your application issues an
intent to open the Android Browser, its activity is
  <em>
   not
  </em>
  placed in the same
task as your application. Instead, either a new task starts for the Browser or, if the Browser
already has a task running in the background, that task is brought forward to handle the new
intent.
 </p>
 <p>
  Regardless of whether an activity starts in a new task or in the same task as the activity that
started it, the
  <em>
   Back
  </em>
  button always takes the user to the previous activity. However, if you
start an activity that specifies the
  <code>
   singleTask
  </code>
  launch mode, then if an instance of
that activity exists in a background task, that whole task is brought to the foreground. At this
point, the back stack now includes all activities from the task brought forward, at the top of the
stack. Figure 4 illustrates this type of scenario.
 </p>
 <img alt="" src="http://developer.android.com/images/fundamentals/diagram_backstack_singletask_multiactivity.png"/>
 <p class="img-caption">
  <strong>
   Figure 4.
  </strong>
  A representation of how an activity with
launch mode "singleTask" is added to the back stack. If the activity is already a part of a
background task with its own back stack, then the entire back stack also comes
forward, on top of the current task.
 </p>
 <p>
  For more information about using launch modes in the manifest file, see the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  element documentation, where the
  <code>
   launchMode
  </code>
  attribute and the accepted values are
discussed more.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  The behaviors that you specify for your activity with the
  <a href="/guide/topics/manifest/activity-element.html#lmode">
   <code>
    launchMode
   </code>
  </a>
  attribute
can be overridden by flags included with the intent that start your activity, as discussed in the
next section.
 </p>
 <h4 id="#IntentFlagsForTasks">
  Using Intent flags
 </h4>
 <p>
  When starting an activity, you can modify the default association of an activity to its task
by including flags in the intent that you deliver to
  <code>
   <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
    startActivity()
   </a>
  </code>
  . The flags you can use to modify the
default behavior are:
 </p>
 <p>
 </p>
 <dt>
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">
    FLAG_ACTIVITY_NEW_TASK
   </a>
  </code>
 </dt>
 <dd>
  Start the activity in a new task. If a task is already running for the activity you are now
starting, that task is brought to the foreground with its last state restored and the activity
receives the new intent in
  <code>
   <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
    onNewIntent()
   </a>
  </code>
  .
  <p>
   This produces the same behavior as the
   <code>
    "singleTask"
   </code>
   <a href="/guide/topics/manifest/activity-element.html#lmode">
    <code>
     launchMode
    </code>
   </a>
   value,
discussed in the previous section.
  </p>
 </dd>
 <dt>
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_SINGLE_TOP">
    FLAG_ACTIVITY_SINGLE_TOP
   </a>
  </code>
 </dt>
 <dd>
  If the activity being started is the current activity (at the top of the back stack), then
the existing instance receives a call to
  <code>
   <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
    onNewIntent()
   </a>
  </code>
  ,
instead of creating a new instance of the activity.
  <p>
   This produces the same behavior as the
   <code>
    "singleTop"
   </code>
   <a href="/guide/topics/manifest/activity-element.html#lmode">
    <code>
     launchMode
    </code>
   </a>
   value,
discussed in the previous section.
  </p>
 </dd>
 <dt>
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_CLEAR_TOP">
    FLAG_ACTIVITY_CLEAR_TOP
   </a>
  </code>
 </dt>
 <dd>
  If the activity being started is already running in the current task, then instead
of launching a new instance of that activity, all of the other activities on top of it are
destroyed and this intent is delivered to the resumed instance of the activity (now on top),
through
  <code>
   <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
    onNewIntent()
   </a>
  </code>
  ).
  <p>
   There is no value for the
   <a href="/guide/topics/manifest/activity-element.html#lmode">
    <code>
     launchMode
    </code>
   </a>
   attribute that produces this behavior.
  </p>
  <p>
   <code>
    FLAG_ACTIVITY_CLEAR_TOP
   </code>
   is most often used in conjunction with
   <code>
    FLAG_ACTIVITY_NEW_TASK
   </code>
   .
When used together, these flags are a way of locating an existing activity
in another task and putting it in a position where it can respond to the intent.
  </p>
  <p class="note">
   <strong>
    Note:
   </strong>
   If the launch mode of the designated activity is
   <code>
    "standard"
   </code>
   ,
it too is removed from the stack and a new instance is launched in its place to handle
the incoming intent.  That's because a new instance is always created for a new intent when the
launch mode is
   <code>
    "standard"
   </code>
   .
  </p>
 </dd>
 <h3 id="Affinities">
  Handling affinities
 </h3>
 <p>
  The
  <em>
   affinity
  </em>
  indicates which task an activity prefers to belong to. By default, all the
activities from the same application have an affinity for each other. So, by default, all
activities in the same application prefer to be in the same task. However, you can modify
the default affinity for an activity. Activities defined in
different applications can share an affinity, or activities defined in the same application can be
assigned different task affinities.
 </p>
 <p>
  You can modify the affinity for any given activity with the
  <a href="/guide/topics/manifest/activity-element.html#aff">
   <code>
    taskAffinity
   </code>
  </a>
  attribute
of the
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  element.
 </p>
 <p>
  The
  <a href="/guide/topics/manifest/activity-element.html#aff">
   <code>
    taskAffinity
   </code>
  </a>
  attribute takes a string value, which must be unique from the default package name
declared in the
  <a href="/guide/topics/manifest/manifest-element.html">
   <code>
    &lt;manifest&gt;
   </code>
  </a>
  element, because the system uses that name to identify the default task
affinity for the application.
 </p>
 <p>
  The affinity comes into play in two circumstances:
 </p>
 <ul>
  <li>
   When the intent that launches an activity contains the
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">
     FLAG_ACTIVITY_NEW_TASK
    </a>
   </code>
   flag.
   <p>
    A new activity is, by default, launched into the task of the activity
that called
    <code>
     <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
      startActivity()
     </a>
    </code>
    . It's pushed onto the same
back stack as the caller.  However, if the intent passed to
    <code>
     <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
      startActivity()
     </a>
    </code>
    contains the
    <code>
     <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">
      FLAG_ACTIVITY_NEW_TASK
     </a>
    </code>
    flag, the system looks for a different task to house the new activity. Often, it's a new task.
However, it doesn't have to be.  If there's already an existing task with the same affinity as the
new activity, the activity is launched into that task.  If not, it begins a new task.
   </p>
   <p>
    If this flag causes an activity to begin a new task and the user presses the
    <em>
     Home
    </em>
    button
to leave
it, there must be some way for the user to navigate back to the task. Some entities (such as the
notification manager) always start activities in an external task, never as part of their own, so
they always put
    <code>
     FLAG_ACTIVITY_NEW_TASK
    </code>
    in the intents they pass to
    <code>
     <a href="/reference/android/app/Activity.html#startActivity(android.content.Intent)">
      startActivity()
     </a>
    </code>
    .
If you have an activity that can be invoked by
an external entity that might use this flag, take care that the user has a independent way to get
back to the task that's started, such as with a launcher icon (the root activity of the task
has a
    <code>
     <a href="/reference/android/content/Intent.html#CATEGORY_LAUNCHER">
      CATEGORY_LAUNCHER
     </a>
    </code>
    intent filter; see the
    <a href="#Starting">
     Starting a task
    </a>
    section below).
   </p>
  </li>
  <li>
   When an activity has its
   <a href="/guide/topics/manifest/activity-element.html#reparent">
    <code>
     allowTaskReparenting
    </code>
   </a>
   attribute set to
   <code>
    "true"
   </code>
   .
   <p>
    In this case, the activity can move from the task it starts to the task it has an affinity
for, when that task comes to the foreground.
   </p>
   <p>
    For example, suppose that an activity that reports weather conditions in selected cities is
defined as part of a travel application.  It has the same affinity as other activities in the same
application (the default application affinity) and it allows re-parenting with this attribute.
When one of your activities starts the weather reporter activity, it initially belongs to the same
task as your activity. However, when the travel application's task comes to the foreground, the
weather reporter activity is reassigned to that task and displayed within it.
   </p>
  </li>
 </ul>
 <p class="note">
  <strong>
   Tip:
  </strong>
  If an
  <code>
   .apk
  </code>
  file contains more than one "application"
from the user's point of view, you probably want to use the
  <a href="/guide/topics/manifest/activity-element.html#aff">
   <code>
    taskAffinity
   </code>
  </a>
  attribute to assign different affinities to the activities associated with each "application".
 </p>
 <h3 id="Clearing">
  Clearing the back stack
 </h3>
 <p>
  If the user leaves a task for a long time, the system clears the task of all activities except
the root activity.  When the user returns to the task again, only the root activity is restored.
The system behaves this way, because, after an extended amount of time, users likely have abandoned
what they were doing before and are returning to the task to begin something new.
 </p>
 <p>
  There are some activity attributes that you can use to modify this behavior:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/guide/topics/manifest/activity-element.html#always">
     alwaysRetainTaskState
    </a>
   </code>
  </dt>
  <dd>
   If this attribute is set to
   <code>
    "true"
   </code>
   in the root activity of a task,
the default behavior just described does not happen.
The task retains all activities in its stack even after a long period.
  </dd>
  <dt>
   <code>
    <a href="/guide/topics/manifest/activity-element.html#clear">
     clearTaskOnLaunch
    </a>
   </code>
  </dt>
  <dd>
   If this attribute is set to
   <code>
    "true"
   </code>
   in the root activity of a task,
the stack is cleared down to the root activity whenever the user leaves the task
and returns to it.  In other words, it's the opposite of
   <a href="/guide/topics/manifest/activity-element.html#always">
    <code>
     alwaysRetainTaskState
    </code>
   </a>
   . The user always returns to the task in its
initial state, even after a leaving the task for only a moment.
  </dd>
  <dt>
   <code>
    <a href="/guide/topics/manifest/activity-element.html#finish">
     finishOnTaskLaunch
    </a>
   </code>
  </dt>
  <dd>
   This attribute is like
   <a href="/guide/topics/manifest/activity-element.html#clear">
    <code>
     clearTaskOnLaunch
    </code>
   </a>
   ,
but it operates on a
single activity, not an entire task.  It can also cause any activity to go
away, including the root activity.  When it's set to
   <code>
    "true"
   </code>
   , the
activity remains part of the task only for the current session.  If the user
leaves and then returns to the task, it is no longer present.
  </dd>
 </dl>
 <h3 id="Starting">
  Starting a task
 </h3>
 <p>
  You can set up an activity as the entry point for a task by giving it an intent filter with
  <code>
   "android.intent.action.MAIN"
  </code>
  as the specified action and
  <code>
   "android.intent.category.LAUNCHER"
  </code>
  as the specified category. For example:
 </p>
 <pre>
&lt;activity ... &gt;
    &lt;intent-filter ... &gt;
        &lt;action android:name="android.intent.action.MAIN" /&gt;
        &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
    &lt;/intent-filter&gt;
    ...
&lt;/activity&gt;
</pre>
 <p>
  An intent filter of this kind causes an icon and label for the
activity to be displayed in the application launcher, giving users a way to launch the activity and
to return to the task that it creates any time after it has been launched.
 </p>
 <p>
  This second ability is important: Users must be able to leave a task and then come back to it
later using this activity launcher. For this reason, the two
  <a href="#LaunchModes">
   launch
modes
  </a>
  that mark activities as always initiating a task,
  <code>
   "singleTask"
  </code>
  and
  <code>
   "singleInstance"
  </code>
  , should be used only when the activity has an
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_MAIN">
    ACTION_MAIN
   </a>
  </code>
  and a
  <code>
   <a href="/reference/android/content/Intent.html#CATEGORY_LAUNCHER">
    CATEGORY_LAUNCHER
   </a>
  </code>
  filter. Imagine, for example, what could
happen if the filter is missing: An intent launches a
  <code>
   "singleTask"
  </code>
  activity, initiating a
new task, and the user spends some time working in that task. The user then presses the
  <em>
   Home
  </em>
  button. The task is now sent to the background and is not visible. Now the user has no way to return
to the task, because it is not represented in the application launcher.
 </p>
 <p>
  For those cases where you don't want the user to be able to return to an activity, set the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  element's
  <a href="/guide/topics/manifest/activity-element.html#finish">
   <code>
    finishOnTaskLaunch
   </code>
  </a>
  to
  <code>
   "true"
  </code>
  (see
  <a href="#Clearing">
   Clearing the stack
  </a>
  ).
 </p>
 <p>
  Further information about how tasks and activites are represented and managed in
the overview screen is available in
  <a href="/guide/components/recents.html">
   Overview Screen
  </a>
  .
 </p>
 <!--
<h2>Beginner's Path</h2>

<p>For more information about how to use intents to
activate other application components and publish the intents to which your components
respond, continue with the <b><a
href="/guide/components/intents-filters.html">Intents and Intent
Filters</a></b> document.</p>
-->
</div>
<h1>Overview Screen</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#adding">
      Adding Tasks to the Overview Screen
     </a>
     <ol>
      <li>
       <a href="#flag-new-doc">
        Using the Intent flag to add a task
       </a>
      </li>
      <li>
       <a href="#attr-doclaunch">
        Using the Activity attribute to add a task
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#removing">
      Removing Tasks
     </a>
     <ol>
      <li>
       <a href="#apptask-remove">
        Using the AppTask class to remove tasks
       </a>
      </li>
      <li>
       <a href="#retain-finished">
        Retaining finished tasks
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/app/ActivityManager.AppTask.html">
       ActivityManager.AppTask
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/content/Intent.html">
       Intent
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Sample code
   </h2>
   <ol>
    <li>
     <a href="/samples/DocumentCentricApps/index.html">
      Document-centric Apps
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  The overview screen (also referred to as the recents screen, recent task list, or recent apps)
is a system-level UI that lists recently accessed
  <a href="/guide/components/activities.html">
   activities
  </a>
  and
  <a href="/guide/components/tasks-and-back-stack.html">
   tasks
  </a>
  . The
user can navigate through the list and select a task to resume, or the user can remove a task from
the list by swiping it away. With the Android 5.0 release (API level 21), multiple instances of the
same activity containing different documents may appear as tasks in the overview screen. For example,
Google Drive may have a task for each of several Google documents. Each document appears as a
task in the overview screen.
 </p>
 <img alt="" src="http://developer.android.com/images/components/recents.png" width="284"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  The overview screen showing three Google Drive
documents, each represented as a separate task.
 </p>
 <p>
  Normally you should allow the system to define how your tasks and
activities are represented in the overview screen, and you don't need to modify this behavior.
However, your app can determine how and and when activities appear in the overview screen. The
  <code>
   <a href="/reference/android/app/ActivityManager.AppTask.html">
    ActivityManager.AppTask
   </a>
  </code>
  class lets you manage tasks, and the activity flags of
the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  class let you specify when an activity is added or removed from
the overview screen. Also, the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attributes let you set the behavior in the manifest.
 </p>
 <h2 id="adding">
  Adding Tasks to the Overview Screen
 </h2>
 <p>
  Using the flags of the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  class to add a task affords greater control
over when and how a document gets opened or reopened in the overview screen. When you use the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attributes you can choose between always opening the document in a new task or reusing an
existing task for the document.
 </p>
 <h3 id="flag-new-doc">
  Using the Intent flag to add a task
 </h3>
 <p>
  When you create a new document for your activity, you call the
  <code>
   <a href="/reference/android/app/ActivityManager.AppTask.html#startActivity(android.content.Context, android.content.Intent, android.os.Bundle)">
    startActivity()
   </a>
  </code>
  method of the
  <code>
   <a href="/reference/android/app/ActivityManager.AppTask.html">
    ActivityManager.AppTask
   </a>
  </code>
  class, passing to it the intent that
launches the activity. To insert a logical break so that the system treats your activity as a new
task in the overview screen, pass the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_DOCUMENT">
    FLAG_ACTIVITY_NEW_DOCUMENT
   </a>
  </code>
  flag
in the
  <code>
   <a href="/reference/android/content/Intent.html#addFlags(int)">
    addFlags()
   </a>
  </code>
  method of the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  that launches the activity.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  The
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_DOCUMENT">
    FLAG_ACTIVITY_NEW_DOCUMENT
   </a>
  </code>
  flag replaces the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET">
    FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET
   </a>
  </code>
  flag,
which is deprecated as of Android 5.0 (API level 21).
 </p>
 <p>
  If you set the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_MULTIPLE_TASK">
    FLAG_ACTIVITY_MULTIPLE_TASK
   </a>
  </code>
  flag when you create
the new document, the system always creates a new task with the target activity as the root.
This setting allows the same document to be opened in more than one task. The following code demonstrates
how the main activity does this:
 </p>
 <p class="code-caption">
  <a href="/samples/DocumentCentricApps/index.html">
   DocumentCentricActivity.java
  </a>
 </p>
 <pre>
public void createNewDocument(View view) {
      final Intent newDocumentIntent = newDocumentIntent();
      if (useMultipleTasks) {
          newDocumentIntent.addFlags(Intent.FLAG_ACTIVITY_MULTIPLE_TASK);
      }
      startActivity(newDocumentIntent);
  }

  private Intent newDocumentIntent() {
      boolean useMultipleTasks = mCheckbox.isChecked();
      final Intent newDocumentIntent = new Intent(this, NewDocumentActivity.class);
      newDocumentIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_DOCUMENT);
      newDocumentIntent.putExtra(KEY_EXTRA_NEW_DOCUMENT_COUNTER, incrementAndGet());
      return newDocumentIntent;
  }

  private static int incrementAndGet() {
      Log.d(TAG, "incrementAndGet(): " + mDocumentCounter);
      return mDocumentCounter++;
  }
}
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  Activities launched with the
  <code>
   FLAG_ACTIVITY_NEW_DOCUMENT
  </code>
  flag must have the
  <code>
   android:launchMode="standard"
  </code>
  attribute value (the default) set in the
manifest.
 </p>
 <p>
  When the main activity launches a new activity, the system searches through existing tasks for
one whose intent matches the intent component name and the Intent data for the activity. If the task
is not found, or the intent contained the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_MULTIPLE_TASK">
    FLAG_ACTIVITY_MULTIPLE_TASK
   </a>
  </code>
  flag, a new task will be created with the activity as its root. If it finds one, it brings that task
to the front and passes the new intent to
  <code>
   <a href="/reference/android/app/Activity.html#onNewIntent(android.content.Intent)">
    onNewIntent()
   </a>
  </code>
  .
The new activity gets the intent and creates a new document in the overview screen, as in the
following example:
 </p>
 <p class="code-caption">
  <a href="/samples/DocumentCentricApps/index.html">
   NewDocumentActivity.java
  </a>
 </p>
 <pre>
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_new_document);
    mDocumentCount = getIntent()
            .getIntExtra(DocumentCentricActivity.KEY_EXTRA_NEW_DOCUMENT_COUNTER, 0);
    mDocumentCounterTextView = (TextView) findViewById(
            R.id.hello_new_document_text_view);
    setDocumentCounterText(R.string.hello_new_document_counter);
}

@Override
protected void onNewIntent(Intent intent) {
    super.onNewIntent(intent);
    /* If FLAG_ACTIVITY_MULTIPLE_TASK has not been used, this activity
    is reused to create a new document.
     */
    setDocumentCounterText(R.string.reusing_document_counter);
}
</pre>
 <h3 id="#attr-doclaunch">
  Using the activity attribute to add a task
 </h3>
 <p>
  An activity can also specify in its manifest that it always launches into a new task by using
the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attribute,
  <a href="/guide/topics/manifest/activity-element.html#dlmode">
   <code>
    android:documentLaunchMode
   </code>
  </a>
  . This attribute has four values which produce the following
effects when the user opens a document with the application:
 </p>
 <dl>
  <dt>
   "
   <code>
    intoExisting
   </code>
   "
  </dt>
  <dd>
   The activity reuses an existing task for the document. This is the same as setting the
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_DOCUMENT">
     FLAG_ACTIVITY_NEW_DOCUMENT
    </a>
   </code>
   flag
   <em>
    without
   </em>
   setting the
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_MULTIPLE_TASK">
     FLAG_ACTIVITY_MULTIPLE_TASK
    </a>
   </code>
   flag, as described in
   <a href="#flag-new-doc">
    Using the Intent flag to add a task
   </a>
   , above.
  </dd>
  <dt>
   "
   <code>
    always
   </code>
   "
  </dt>
  <dd>
   The activity creates a new task for the document, even if the document is already opened. Using
  this value is the same as setting both the
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_DOCUMENT">
     FLAG_ACTIVITY_NEW_DOCUMENT
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_MULTIPLE_TASK">
     FLAG_ACTIVITY_MULTIPLE_TASK
    </a>
   </code>
   flags.
  </dd>
  <dt>
   "
   <code>
    none&rdquo;
   </code>
   "
  </dt>
  <dd>
   The activity does not create a new task for the document. The overview screen treats the
  activity as it would by default: it displays a single task for the app, which
  resumes from whatever activity the user last invoked.
  </dd>
  <dt>
   "
   <code>
    never
   </code>
   "
  </dt>
  <dd>
   The activity does not create a new task for the document. Setting this value overrides the
  behavior of the
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_DOCUMENT">
     FLAG_ACTIVITY_NEW_DOCUMENT
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_MULTIPLE_TASK">
     FLAG_ACTIVITY_MULTIPLE_TASK
    </a>
   </code>
   flags, if either of these are set
  in the intent, and the overview screen displays a single task for the app, which resumes from
  whatever activity the user last invoked.
  </dd>
 </dl>
 <p class="note">
  <strong>
   Note:
  </strong>
  For values other than
  <code>
   none
  </code>
  and
  <code>
   never
  </code>
  the
activity must be defined with
  <code>
   launchMode="standard"
  </code>
  . If this attribute is not specified,
  <code>
   documentLaunchMode="none"
  </code>
  is used.
 </p>
 <h2 id="removing">
  Removing Tasks
 </h2>
 <p>
  By default a document task is automatically removed from the overview screen when its activity
finishes. You can override this behavior with the
  <code>
   <a href="/reference/android/app/ActivityManager.AppTask.html">
    ActivityManager.AppTask
   </a>
  </code>
  class,
with an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  flag, or with an
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attribute.
 </p>
 <p>
  You can always exclude a task from the overview screen entirely by setting the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attribute,
  <a href="/guide/topics/manifest/activity-element.html#exclude">
   <code>
    android:excludeFromRecents
   </code>
  </a>
  to
  <code>
   true
  </code>
  .
 </p>
 <p>
  You can set the maximum number of tasks that your app can include in the overview screen by setting
the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attribute
  <a href="/guide/topics/manifest/activity-element.html#maxrecents">
   <code>
    android:maxRecents
   </code>
  </a>
  to an integer value. The default is 16. When the maximum number of tasks is reached, the least
recently used task is removed from the overview screen. The
  <code>
   android:maxRecents
  </code>
  maximum value
is 50 (25 on low memory devices); values less than 1 are not valid.
 </p>
 <h3 id="#apptask-remove">
  Using the AppTask class to remove tasks
 </h3>
 <p>
  In the activity that creates a new task in the overview screen, you can
specify when to remove the task and finish all activities associated with it by calling
the
  <code>
   <a href="/reference/android/app/ActivityManager.AppTask.html#finishAndRemoveTask()">
    finishAndRemoveTask()
   </a>
  </code>
  method.
 </p>
 <p class="code-caption">
  <a href="/samples/DocumentCentricApps/index.html">
   NewDocumentActivity.java
  </a>
 </p>
 <pre>
public void onRemoveFromRecents(View view) {
    // The document is no longer needed; remove its task.
    finishAndRemoveTask();
}
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  Using the
  <code>
   <a href="/reference/android/app/ActivityManager.AppTask.html#finishAndRemoveTask()">
    finishAndRemoveTask()
   </a>
  </code>
  method
overrides the use of the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_RETAIN_IN_RECENTS">
    FLAG_ACTIVITY_RETAIN_IN_RECENTS
   </a>
  </code>
  tag,
discussed below.
 </p>
 <h3 id="#retain-finished">
  Retaining finished tasks
 </h3>
 <p>
  If you want to retain a task in the overview screen, even if its activity has finished, pass
the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_RETAIN_IN_RECENTS">
    FLAG_ACTIVITY_RETAIN_IN_RECENTS
   </a>
  </code>
  flag in the
  <code>
   <a href="/reference/android/content/Intent.html#addFlags(int)">
    addFlags()
   </a>
  </code>
  method of the Intent that launches the activity.
 </p>
 <p class="code-caption">
  <a href="/samples/DocumentCentricApps/index.html">
   DocumentCentricActivity.java
  </a>
 </p>
 <pre>
private Intent newDocumentIntent() {
    final Intent newDocumentIntent = new Intent(this, NewDocumentActivity.class);
    newDocumentIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_DOCUMENT |
      android.content.Intent.FLAG_ACTIVITY_RETAIN_IN_RECENTS);
    newDocumentIntent.putExtra(KEY_EXTRA_NEW_DOCUMENT_COUNTER, incrementAndGet());
    return newDocumentIntent;
}
</pre>
 <p>
  To achieve the same effect, set the
  <code>
   <a href="/guide/topics/manifest/activity-element.html">
    &lt;activity&gt;
   </a>
  </code>
  attribute
  <a href="/guide/topics/manifest/activity-element.html#autoremrecents">
   <code>
    android:autoRemoveFromRecents
   </code>
  </a>
  to
  <code>
   false
  </code>
  . The default value is
  <code>
   true
  </code>
  for document activities, and
  <code>
   false
  </code>
  for regular activities. Using this attribute overrides
the
  <code>
   <a href="/reference/android/content/Intent.html#FLAG_ACTIVITY_RETAIN_IN_RECENTS">
    FLAG_ACTIVITY_RETAIN_IN_RECENTS
   </a>
  </code>
  flag, discussed previously.
 </p>
</div>
<h1>Services</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <ol id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Basics">
      The Basics
     </a>
    </li>
    <ol>
     <li>
      <a href="#Declaring">
       Declaring a service in the manifest
      </a>
     </li>
    </ol>
    <li>
     <a href="#CreatingAService">
      Creating a Started Service
     </a>
     <ol>
      <li>
       <a href="#ExtendingIntentService">
        Extending the IntentService class
       </a>
      </li>
      <li>
       <a href="#ExtendingService">
        Extending the Service class
       </a>
      </li>
      <li>
       <a href="#StartingAService">
        Starting a service
       </a>
      </li>
      <li>
       <a href="#Stopping">
        Stopping a service
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#CreatingBoundService">
      Creating a Bound Service
     </a>
    </li>
    <li>
     <a href="#Notifications">
      Sending Notifications to the User
     </a>
    </li>
    <li>
     <a href="#Foreground">
      Running a Service in the Foreground
     </a>
    </li>
    <li>
     <a href="#Lifecycle">
      Managing the Lifecycle of a Service
     </a>
     <ol>
      <li>
       <a href="#LifecycleCallbacks">
        Implementing the lifecycle callbacks
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/app/IntentService.html">
       IntentService
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/ServiceStartArguments.html">
      <code>
       ServiceStartArguments
      </code>
     </a>
    </li>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LocalService.html">
      <code>
       LocalService
      </code>
     </a>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/components/bound-services.html">
      Bound Services
     </a>
    </li>
   </ol>
  </ol>
 </div>
 <p>
  A
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  is an application component that can perform
long-running operations in the background and does not provide a user interface. Another
application component can start a service and it will continue to run in the background even if the
user switches to another application. Additionally, a component can bind to a service to
interact with it and even perform interprocess communication (IPC). For example, a service might
handle network transactions, play music, perform file I/O, or interact with a content provider, all
from the background.
 </p>
 <p>
  A service can essentially take two forms:
 </p>
 <dl>
  <dt>
   Started
  </dt>
  <dd>
   A service is "started" when an application component (such as an activity) starts it by
calling
   <code>
    <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
     startService()
    </a>
   </code>
   . Once started, a service
can run in the background indefinitely, even if the component that started it is destroyed. Usually,
a started service performs a single operation and does not return a result to the caller.
For example, it might download or upload a file over the network. When the operation is done, the
service should stop itself.
  </dd>
  <dt>
   Bound
  </dt>
  <dd>
   A service is "bound" when an application component binds to it by calling
   <code>
    <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
     bindService()
    </a>
   </code>
   . A bound service offers a client-server
interface that allows components to interact with the service, send requests, get results, and even
do so across processes with interprocess communication (IPC). A bound service runs only as long as
another application component is bound to it. Multiple components can bind to the service at once,
but when all of them unbind, the service is destroyed.
  </dd>
 </dl>
 <p>
  Although this documentation generally discusses these two types of services separately, your
service can work both ways&mdash;it can be started (to run indefinitely) and also allow binding.
It's simply a matter of whether you implement a couple callback methods:
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  to allow components to start it and
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  to allow binding.
 </p>
 <p>
  Regardless of whether your application is started, bound, or both, any application component
can use the service (even from a separate application), in the same way that any component can use
an activity&mdash;by starting it with an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  . However, you can declare
the service as private, in the manifest file, and block access from other applications. This is
discussed more in the section about
  <a href="#Declaring">
   Declaring the service in the
manifest
  </a>
  .
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  A service runs in the
main thread of its hosting process&mdash;the service does
  <strong>
   not
  </strong>
  create its own thread
and does
  <strong>
   not
  </strong>
  run in a separate process (unless you specify otherwise). This means
that, if your service is going to do any CPU intensive work or blocking operations (such as MP3
playback or networking), you should create a new thread within the service to do that work. By using
a separate thread, you will reduce the risk of Application Not Responding (ANR) errors and the
application's main thread can remain dedicated to user interaction with your activities.
 </p>
 <h2 id="Basics">
  The Basics
 </h2>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h3>
    Should you use a service or a thread?
   </h3>
   <p>
    A service is simply a component that can run in the background even when the user is not
interacting with your application. Thus, you should create a service only if that is what you
need.
   </p>
   <p>
    If you need to perform work outside your main thread, but only while the user is interacting
with your application, then you should probably instead create a new thread and not a service. For
example, if you want to play some music, but only while your activity is running, you might create
a thread in
    <code>
     <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
      onCreate()
     </a>
    </code>
    , start running it in
    <code>
     <a href="/reference/android/app/Activity.html#onStart()">
      onStart()
     </a>
    </code>
    , then stop it in
    <code>
     <a href="/reference/android/app/Activity.html#onStop()">
      onStop()
     </a>
    </code>
    . Also consider using
    <code>
     <a href="/reference/android/os/AsyncTask.html">
      AsyncTask
     </a>
    </code>
    or
    <code>
     <a href="/reference/android/os/HandlerThread.html">
      HandlerThread
     </a>
    </code>
    ,
instead of the traditional
    <code>
     <a href="/reference/java/lang/Thread.html">
      Thread
     </a>
    </code>
    class. See the
    <a href="/guide/components/processes-and-threads.html#Threads">
     Processes and
Threading
    </a>
    document for more information about threads.
   </p>
   <p>
    Remember that if you do use a service, it still runs in your application's main thread by
default, so you should still create a new thread within the service if it performs intensive or
blocking operations.
   </p>
  </div>
 </div>
 <p>
  To create a service, you must create a subclass of
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  (or one
of its existing subclasses). In your implementation, you need to override some callback methods that
handle key aspects of the service lifecycle and provide a mechanism for components to bind to
the service, if appropriate. The most important callback methods you should override are:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this method when another component, such as an activity,
requests that the service be started, by calling
   <code>
    <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
     startService()
    </a>
   </code>
   . Once this method executes, the service is started and can run in the
background indefinitely. If you implement this, it is your responsibility to stop the service when
its work is done, by calling
   <code>
    <a href="/reference/android/app/Service.html#stopSelf()">
     stopSelf()
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
     stopService()
    </a>
   </code>
   . (If you only want to provide binding, you don't
need to implement this method.)
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this method when another component wants to bind with the
service (such as to perform RPC), by calling
   <code>
    <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
     bindService()
    </a>
   </code>
   . In your implementation of this method, you must provide an interface that clients
use to communicate with the service, by returning an
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   . You must always
implement this method, but if you don't want to allow binding, then you should return null.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#onCreate()">
     onCreate()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this method when the service is first created, to perform one-time setup
procedures (before it calls either
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   ). If the service is already running, this method is not
called.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#onDestroy()">
     onDestroy()
    </a>
   </code>
  </dt>
  <dd>
   The system calls this method when the service is no longer used and is being destroyed.
Your service should implement this to clean up any resources such as threads, registered
listeners, receivers, etc. This is the last call the service receives.
  </dd>
 </dl>
 <p>
  If a component starts the service by calling
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  (which results in a call to
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  ), then the service
remains running until it stops itself with
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  or another
component stops it by calling
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  .
 </p>
 <p>
  If a component calls
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  to create the service (and
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  is
  <em>
   not
  </em>
  called), then the service runs
only as long as the component is bound to it. Once the service is unbound from all clients, the
system destroys it.
 </p>
 <p>
  The Android system will force-stop a service only when memory is low and it must recover system
resources for the activity that has user focus. If the service is bound to an activity that has user
focus, then it's less likely to be killed, and if the service is declared to
  <a href="#Foreground">
   run in the foreground
  </a>
  (discussed later), then it will almost never be killed.
Otherwise, if the service was started and is long-running, then the system will lower its position
in the list of background tasks over time and the service will become highly susceptible to
killing&mdash;if your service is started, then you must design it to gracefully handle restarts
by the system. If the system kills your service, it restarts it as soon as resources become
available again (though this also depends on the value you return from
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  , as discussed later). For more information
about when the system might destroy a service, see the
  <a href="/guide/components/processes-and-threads.html">
   Processes and Threading
  </a>
  document.
 </p>
 <p>
  In the following sections, you'll see how you can create each type of service and how to use
it from other application components.
 </p>
 <h3 id="Declaring">
  Declaring a service in the manifest
 </h3>
 <p>
  Like activities (and other components), you must declare all services in your application's
manifest file.
 </p>
 <p>
  To declare your service, add a
  <a href="/guide/topics/manifest/service-element.html">
   <code>
    &lt;service&gt;
   </code>
  </a>
  element
as a child of the
  <a href="/guide/topics/manifest/application-element.html">
   <code>
    &lt;application&gt;
   </code>
  </a>
  element. For example:
 </p>
 <pre>
&lt;manifest ... &gt;
  ...
  &lt;application ... &gt;
      &lt;service android:name=".ExampleService" /&gt;
      ...
  &lt;/application&gt;
&lt;/manifest&gt;
</pre>
 <p>
  See the
  <a href="/guide/topics/manifest/service-element.html">
   <code>
    &lt;service&gt;
   </code>
  </a>
  element
reference for more information about declaring your service in the manifest.
 </p>
 <p>
  There are other attributes you can include in the
  <a href="/guide/topics/manifest/service-element.html">
   <code>
    &lt;service&gt;
   </code>
  </a>
  element to
define properties such as permissions required to start the service and the process in
which the service should run. The
  <a href="/guide/topics/manifest/service-element.html#nm">
   <code>
    android:name
   </code>
  </a>
  attribute is the only required attribute&mdash;it specifies the class name of the service. Once
you publish your application, you should not change this name, because if you do, you risk breaking
code due to dependence on explicit intents to start or bind the service (read the blog post,
  <a href="http://android-developers.blogspot.com/2011/06/things-that-cannot-change.html">
   Things
That Cannot Change
  </a>
  ).
 </p>
 <p>
  To ensure your app is secure,
  <strong>
   always use an explicit intent when starting or binding
your
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
  </strong>
  and do not declare intent filters for the service. If
it's critical that you allow for some amount of ambiguity as to which service starts, you can
supply intent filters for your services and exclude the component name from the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  , but you then must set the package for the intent with
  <code>
   <a href="/reference/android/content/Intent.html#setPackage(java.lang.String)">
    setPackage()
   </a>
  </code>
  , which provides sufficient disambiguation for the
target service.
 </p>
 <p>
  Additionally, you can ensure that your service is available to only your app by
including the
  <a href="/guide/topics/manifest/service-element.html#exported">
   <code>
    android:exported
   </code>
  </a>
  attribute and setting it to
  <code>
   "false"
  </code>
  . This effectively stops other apps from starting your
service, even when using an explicit intent.
 </p>
 <h2 id="CreatingStartedService">
  Creating a Started Service
 </h2>
 <p>
  A started service is one that another component starts by calling
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  , resulting in a call to the service's
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  method.
 </p>
 <p>
  When a service is started, it has a lifecycle that's independent of the
component that started it and the service can run in the background indefinitely, even if
the component that started it is destroyed. As such, the service should stop itself when its job
is done by calling
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  , or another component can stop it
by calling
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  .
 </p>
 <p>
  An application component such as an activity can start the service by calling
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  and passing an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  that specifies the service and includes any data for the service to use. The service receives
this
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  in the
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  method.
 </p>
 <p>
  For instance, suppose an activity needs to save some data to an online database. The activity can
start a companion service and deliver it the data to save by passing an intent to
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  . The service receives the intent in
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  , connects to the Internet and performs the
database transaction. When the transaction is done, the service stops itself and it is
destroyed.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  A services runs in the same process as the application
in which it is declared and in the main thread of that application, by default. So, if your service
performs intensive or blocking operations while the user interacts with an activity from the same
application, the service will slow down activity performance. To avoid impacting application
performance, you should start a new thread inside the service.
 </p>
 <p>
  Traditionally, there are two classes you can extend to create a started service:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
  </dt>
  <dd>
   This is the base class for all services. When you extend this class, it's important that
you create a new thread in which to do all the service's work, because the service uses your
application's main thread, by default, which could slow the performance of any activity your
application is running.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/IntentService.html">
     IntentService
    </a>
   </code>
  </dt>
  <dd>
   This is a subclass of
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
   that uses a worker thread to handle all
start requests, one at a time. This is the best option if you don't require that your service
handle multiple requests simultaneously. All you need to do is implement
   <code>
    <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
     onHandleIntent()
    </a>
   </code>
   , which receives the intent for each
start request so you can do the background work.
  </dd>
 </dl>
 <p>
  The following sections describe how you can implement your service using either one for these
classes.
 </p>
 <h3 id="ExtendingIntentService">
  Extending the IntentService class
 </h3>
 <p>
  Because most started services don't need to handle multiple requests simultaneously
(which can actually be a dangerous multi-threading scenario), it's probably best if you
implement your service using the
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  class.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  does the following:
 </p>
 <ul>
  <li>
   Creates a default worker thread that executes all intents delivered to
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   separate from your application's main
thread.
  </li>
  <li>
   Creates a work queue that passes one intent at a time to your
   <code>
    <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
     onHandleIntent()
    </a>
   </code>
   implementation, so you never have to
worry about multi-threading.
  </li>
  <li>
   Stops the service after all start requests have been handled, so you never have to call
   <code>
    <a href="/reference/android/app/Service.html#stopSelf()">
     stopSelf()
    </a>
   </code>
   .
  </li>
  <li>
   Provides default implementation of
   <code>
    <a href="/reference/android/app/IntentService.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   that
returns null.
  </li>
  <li>
   Provides a default implementation of
   <code>
    <a href="/reference/android/app/IntentService.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   that sends the intent to the work queue and then to your
   <code>
    <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
     onHandleIntent()
    </a>
   </code>
   implementation.
  </li>
 </ul>
 <p>
  All this adds up to the fact that all you need to do is implement
  <code>
   <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
    onHandleIntent()
   </a>
  </code>
  to do the work provided by the
client. (Though, you also need to provide a small constructor for the service.)
 </p>
 <p>
  Here's an example implementation of
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  :
 </p>
 <pre>
public class HelloIntentService extends IntentService {

  /**
   * A constructor is required, and must call the super <code><a href="/reference/android/app/IntentService.html#IntentService(java.lang.String)">IntentService(String)</a></code>
   * constructor with a name for the worker thread.
   */
  public HelloIntentService() {
      super("HelloIntentService");
  }

  /**
   * The IntentService calls this method from the default worker thread with
   * the intent that started the service. When this method returns, IntentService
   * stops the service, as appropriate.
   */
  @Override
  protected void onHandleIntent(Intent intent) {
      // Normally we would do some work here, like download a file.
      // For our sample, we just sleep for 5 seconds.
      long endTime = System.currentTimeMillis() + 5*1000;
      while (System.currentTimeMillis() &lt; endTime) {
          synchronized (this) {
              try {
                  wait(endTime - System.currentTimeMillis());
              } catch (Exception e) {
              }
          }
      }
  }
}
</pre>
 <p>
  That's all you need: a constructor and an implementation of
  <code>
   <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
    onHandleIntent()
   </a>
  </code>
  .
 </p>
 <p>
  If you decide to also override other callback methods, such as
  <code>
   <a href="/reference/android/app/IntentService.html#onCreate()">
    onCreate()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/app/IntentService.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  , or
  <code>
   <a href="/reference/android/app/IntentService.html#onDestroy()">
    onDestroy()
   </a>
  </code>
  , be sure to call the super implementation, so
that the
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  can properly handle the life of the worker thread.
 </p>
 <p>
  For example,
  <code>
   <a href="/reference/android/app/IntentService.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  must return
the default implementation (which is how the intent gets delivered to
  <code>
   <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
    onHandleIntent()
   </a>
  </code>
  ):
 </p>
 <pre>
@Override
public int onStartCommand(Intent intent, int flags, int startId) {
    Toast.makeText(this, "service starting", Toast.LENGTH_SHORT).show();
    return super.onStartCommand(intent,flags,startId);
}
</pre>
 <p>
  Besides
  <code>
   <a href="/reference/android/app/IntentService.html#onHandleIntent(android.content.Intent)">
    onHandleIntent()
   </a>
  </code>
  , the only method
from which you don't need to call the super class is
  <code>
   <a href="/reference/android/app/IntentService.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  (but you only need to implement that if your service allows binding).
 </p>
 <p>
  In the next section, you'll see how the same kind of service is implemented when extending
the base
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  class, which is a lot more code, but which might be
appropriate if you need to handle simultaneous start requests.
 </p>
 <h3 id="ExtendingService">
  Extending the Service class
 </h3>
 <p>
  As you saw in the previous section, using
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  makes your
implementation of a started service very simple. If, however, you require your service to
perform multi-threading (instead of processing start requests through a work queue), then you
can extend the
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  class to handle each intent.
 </p>
 <p>
  For comparison, the following example code is an implementation of the
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  class that performs the exact same work as the example above using
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  . That is, for each start request, it uses a worker thread to perform the
job and processes only one request at a time.
 </p>
 <pre>
public class HelloService extends Service {
  private Looper mServiceLooper;
  private ServiceHandler mServiceHandler;

  // Handler that receives messages from the thread
  private final class ServiceHandler extends Handler {
      public ServiceHandler(Looper looper) {
          super(looper);
      }
      @Override
      public void handleMessage(Message msg) {
          // Normally we would do some work here, like download a file.
          // For our sample, we just sleep for 5 seconds.
          long endTime = System.currentTimeMillis() + 5*1000;
          while (System.currentTimeMillis() &lt; endTime) {
              synchronized (this) {
                  try {
                      wait(endTime - System.currentTimeMillis());
                  } catch (Exception e) {
                  }
              }
          }
          // Stop the service using the startId, so that we don't stop
          // the service in the middle of handling another job
          stopSelf(msg.arg1);
      }
  }

  @Override
  public void onCreate() {
    // Start up the thread running the service.  Note that we create a
    // separate thread because the service normally runs in the process's
    // main thread, which we don't want to block.  We also make it
    // background priority so CPU-intensive work will not disrupt our UI.
    HandlerThread thread = new HandlerThread("ServiceStartArguments",
            Process.THREAD_PRIORITY_BACKGROUND);
    thread.start();

    // Get the HandlerThread's Looper and use it for our Handler
    mServiceLooper = thread.getLooper();
    mServiceHandler = new ServiceHandler(mServiceLooper);
  }

  @Override
  public int onStartCommand(Intent intent, int flags, int startId) {
      Toast.makeText(this, "service starting", Toast.LENGTH_SHORT).show();

      // For each start request, send a message to start a job and deliver the
      // start ID so we know which request we're stopping when we finish the job
      Message msg = mServiceHandler.obtainMessage();
      msg.arg1 = startId;
      mServiceHandler.sendMessage(msg);

      // If we get killed, after returning from here, restart
      return START_STICKY;
  }

  @Override
  public IBinder onBind(Intent intent) {
      // We don't provide binding, so return null
      return null;
  }

  @Override
  public void onDestroy() {
    Toast.makeText(this, "service done", Toast.LENGTH_SHORT).show();
  }
}
</pre>
 <p>
  As you can see, it's a lot more work than using
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  .
 </p>
 <p>
  However, because you handle each call to
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  yourself, you can perform multiple requests simultaneously. That's not what
this example does, but if that's what you want, then you can create a new thread for each
request and run them right away (instead of waiting for the previous request to finish).
 </p>
 <p>
  Notice that the
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  method must return an
integer. The integer is a value that describes how the system should continue the service in the
event that the system kills it (as discussed above, the default implementation for
  <code>
   <a href="/reference/android/app/IntentService.html">
    IntentService
   </a>
  </code>
  handles this for you, though you are able to modify it). The return value
from
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  must be one of the following
constants:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#START_NOT_STICKY">
     START_NOT_STICKY
    </a>
   </code>
  </dt>
  <dd>
   If the system kills the service after
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   returns,
   <em>
    do not
   </em>
   recreate the service, unless there are pending
intents to deliver. This is the safest option to avoid running your service when not necessary
and when your application can simply restart any unfinished jobs.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#START_STICKY">
     START_STICKY
    </a>
   </code>
  </dt>
  <dd>
   If the system kills the service after
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   returns, recreate the service and call
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   , but
   <em>
    do not
   </em>
   redeliver the last intent.
Instead, the system calls
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   with a
null intent, unless there were pending intents to start the service, in which case,
those intents are delivered. This is suitable for media players (or similar services) that are not
executing commands, but running indefinitely and waiting for a job.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/app/Service.html#START_REDELIVER_INTENT">
     START_REDELIVER_INTENT
    </a>
   </code>
  </dt>
  <dd>
   If the system kills the service after
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   returns, recreate the service and call
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   with the last intent that was delivered to the
service. Any pending intents are delivered in turn. This is suitable for services that are
actively performing a job that should be immediately resumed, such as downloading a file.
  </dd>
 </dl>
 <p>
  For more details about these return values, see the linked reference documentation for each
constant.
 </p>
 <h3 id="StartingAService">
  Starting a Service
 </h3>
 <p>
  You can start a service from an activity or other application component by passing an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  (specifying the service to start) to
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  . The Android system calls the service's
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  method and passes it the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  . (You should never call
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  directly.)
 </p>
 <p>
  For example, an activity can start the example service in the previous section (
  <code>
   HelloSevice
  </code>
  ) using an explicit intent with
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  :
 </p>
 <pre>
Intent intent = new Intent(this, HelloService.class);
startService(intent);
</pre>
 <p>
  The
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  method returns immediately and
the Android system calls the service's
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  method. If the service is not already running, the system first calls
  <code>
   <a href="/reference/android/app/Service.html#onCreate()">
    onCreate()
   </a>
  </code>
  , then calls
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  .
 </p>
 <p>
  If the service does not also provide binding, the intent delivered with
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  is the only mode of communication between the
application component and the service. However, if you want the service to send a result back, then
the client that starts the service can create a
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  for a broadcast
(with
  <code>
   <a href="/reference/android/app/PendingIntent.html#getBroadcast(android.content.Context, int, android.content.Intent, int)">
    getBroadcast()
   </a>
  </code>
  ) and deliver it to the service
in the
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  that starts the service. The service can then use the
broadcast to deliver a result.
 </p>
 <p>
  Multiple requests to start the service result in multiple corresponding calls to the service's
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  . However, only one request to stop
the service (with
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  ) is required to stop it.
 </p>
 <h3 id="Stopping">
  Stopping a service
 </h3>
 <p>
  A started service must manage its own lifecycle. That is, the system does not stop or
destroy the service unless it must recover system memory and the service
continues to run after
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  returns. So,
the service must stop itself by calling
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  or another
component can stop it by calling
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  .
 </p>
 <p>
  Once requested to stop with
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  , the system destroys the service as soon as
possible.
 </p>
 <p>
  However, if your service handles multiple requests to
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  concurrently, then you shouldn't stop the
service when you're done processing a start request, because you might have since received a new
start request (stopping at the end of the first request would terminate the second one). To avoid
this problem, you can use
  <code>
   <a href="/reference/android/app/Service.html#stopSelf(int)">
    stopSelf(int)
   </a>
  </code>
  to ensure that your request to
stop the service is always based on the most recent start request. That is, when you call
  <code>
   <a href="/reference/android/app/Service.html#stopSelf(int)">
    stopSelf(int)
   </a>
  </code>
  , you pass the ID of the start request (the
  <code>
   startId
  </code>
  delivered to
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  ) to which your stop request
corresponds. Then if the service received a new start request before you were able to call
  <code>
   <a href="/reference/android/app/Service.html#stopSelf(int)">
    stopSelf(int)
   </a>
  </code>
  , then the ID will not match and the service will not stop.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  It's important that your application stops its services
when it's done working, to avoid wasting system resources and consuming battery power. If necessary,
other components can stop the service by calling
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  . Even if you enable binding for the service,
you must always stop the service yourself if it ever received a call to
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  .
 </p>
 <p>
  For more information about the lifecycle of a service, see the section below about
  <a href="#Lifecycle">
   Managing the Lifecycle of a Service
  </a>
  .
 </p>
 <h2 id="CreatingBoundService">
  Creating a Bound Service
 </h2>
 <p>
  A bound service is one that allows application components to bind to it by calling
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  in order to create a long-standing connection
(and generally does not allow components to
  <em>
   start
  </em>
  it by calling
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  ).
 </p>
 <p>
  You should create a bound service when you want to interact with the service from activities
and other components in your application or to expose some of your application's functionality to
other applications, through interprocess communication (IPC).
 </p>
 <p>
  To create a bound service, you must implement the
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  callback method to return an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  that
defines the interface for communication with the service. Other application components can then call
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  to retrieve the interface and
begin calling methods on the service. The service lives only to serve the application component that
is bound to it, so when there are no components bound to the service, the system destroys it
(you do
  <em>
   not
  </em>
  need to stop a bound service in the way you must when the service is started
through
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  ).
 </p>
 <p>
  To create a bound service, the first thing you must do is define the interface that specifies
how a client can communicate with the service. This interface between the service
and a client must be an implementation of
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  and is what your service must
return from the
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  callback method. Once the client receives the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  , it can begin
interacting with the service through that interface.
 </p>
 <p>
  Multiple clients can bind to the service at once. When a client is done interacting with the
service, it calls
  <code>
   <a href="/reference/android/content/Context.html#unbindService(android.content.ServiceConnection)">
    unbindService()
   </a>
  </code>
  to unbind. Once
there are no clients bound to the service, the system destroys the service.
 </p>
 <p>
  There are multiple ways to implement a bound service and the implementation is more
complicated than a started service, so the bound service discussion appears in a separate
document about
  <a href="/guide/components/bound-services.html">
   Bound Services
  </a>
  .
 </p>
 <h2 id="Notifications">
  Sending Notifications to the User
 </h2>
 <p>
  Once running, a service can notify the user of events using
  <a href="/guide/topics/ui/notifiers/toasts.html">
   Toast Notifications
  </a>
  or
  <a href="/guide/topics/ui/notifiers/notifications.html">
   Status Bar Notifications
  </a>
  .
 </p>
 <p>
  A toast notification is a message that appears on the surface of the current window for a
moment then disappears, while a status bar notification provides an icon in the status bar with a
message, which the user can select in order to take an action (such as start an activity).
 </p>
 <p>
  Usually, a status bar notification is the best technique when some background work has completed
(such as a file completed
downloading) and the user can now act on it. When the user selects the notification from the
expanded view, the notification can start an activity (such as to view the downloaded file).
 </p>
 <p>
  See the
  <a href="/guide/topics/ui/notifiers/toasts.html">
   Toast Notifications
  </a>
  or
  <a href="/guide/topics/ui/notifiers/notifications.html">
   Status Bar Notifications
  </a>
  developer guides for more information.
 </p>
 <h2 id="Foreground">
  Running a Service in the Foreground
 </h2>
 <p>
  A foreground service is a service that's considered to be something the
user is actively aware of and thus not a candidate for the system to kill when low on memory. A
foreground service must provide a notification for the status bar, which is placed under the
"Ongoing" heading, which means that the notification cannot be dismissed unless the service is
either stopped or removed from the foreground.
 </p>
 <p>
  For example, a music player that plays music from a service should be set to run in the
foreground, because the user is explicitly aware
of its operation. The notification in the status bar might indicate the current song and allow
the user to launch an activity to interact with the music player.
 </p>
 <p>
  To request that your service run in the foreground, call
  <code>
   <a href="/reference/android/app/Service.html#startForeground(int, android.app.Notification)">
    startForeground()
   </a>
  </code>
  . This method takes two parameters: an integer
that uniquely identifies the notification and the
  <code>
   <a href="/reference/android/app/Notification.html">
    Notification
   </a>
  </code>
  for the status bar. For example:
 </p>
 <pre>
Notification notification = new Notification(R.drawable.icon, getText(R.string.ticker_text),
        System.currentTimeMillis());
Intent notificationIntent = new Intent(this, ExampleActivity.class);
PendingIntent pendingIntent = PendingIntent.getActivity(this, 0, notificationIntent, 0);
notification.setLatestEventInfo(this, getText(R.string.notification_title),
        getText(R.string.notification_message), pendingIntent);
startForeground(ONGOING_NOTIFICATION_ID, notification);
</pre>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  The integer ID you give to
  <code>
   <a href="/reference/android/app/Service.html#startForeground(int, android.app.Notification)">
    startForeground()
   </a>
  </code>
  must not be 0.
 </p>
 <p>
  To remove the service from the foreground, call
  <code>
   <a href="/reference/android/app/Service.html#stopForeground(boolean)">
    stopForeground()
   </a>
  </code>
  . This method takes a boolean, indicating
whether to remove the status bar notification as well. This method does
  <em>
   not
  </em>
  stop the
service. However, if you stop the service while it's still running in the foreground, then the
notification is also removed.
 </p>
 <p>
  For more information about notifications, see
  <a href="/guide/topics/ui/notifiers/notifications.html">
   Creating Status Bar
Notifications
  </a>
  .
 </p>
 <h2 id="Lifecycle">
  Managing the Lifecycle of a Service
 </h2>
 <p>
  The lifecycle of a service is much simpler than that of an activity. However, it's even more important
that you pay close attention to how your service is created and destroyed, because a service
can run in the background without the user being aware.
 </p>
 <p>
  The service lifecycle&mdash;from when it's created to when it's destroyed&mdash;can follow two
different paths:
 </p>
 <ul>
  <li>
   A started service
   <p>
    The service is created when another component calls
    <code>
     <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
      startService()
     </a>
    </code>
    . The service then runs indefinitely and must
stop itself by calling
    <code>
     <a href="/reference/android/app/Service.html#stopSelf()">
      stopSelf()
     </a>
    </code>
    . Another component can also stop the
service by calling
    <code>
     <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
      stopService()
     </a>
    </code>
    . When the service is stopped, the system destroys it..
   </p>
  </li>
  <li>
   A bound service
   <p>
    The service is created when another component (a client) calls
    <code>
     <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
      bindService()
     </a>
    </code>
    . The client then communicates with the service
through an
    <code>
     <a href="/reference/android/os/IBinder.html">
      IBinder
     </a>
    </code>
    interface. The client can close the connection by calling
    <code>
     <a href="/reference/android/content/Context.html#unbindService(android.content.ServiceConnection)">
      unbindService()
     </a>
    </code>
    . Multiple clients can bind to
the same service and when all of them unbind, the system destroys the service. (The service
does
    <em>
     not
    </em>
    need to stop itself.)
   </p>
  </li>
 </ul>
 <p>
  These two paths are not entirely separate. That is, you can bind to a service that was already
started with
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  . For example, a background
music service could be started by calling
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  with an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  that identifies the music to play. Later,
possibly when the user wants to exercise some control over the player or get information about the
current song, an activity can bind to the service by calling
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  . In cases like this,
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  does not actually stop the service until all clients unbind.
 </p>
 <h3 id="LifecycleCallbacks">
  Implementing the lifecycle callbacks
 </h3>
 <p>
  Like an activity, a service has lifecycle callback methods that you can implement to monitor
changes in the service's state and perform work at the appropriate times. The following skeleton
service demonstrates each of the lifecycle methods:
 </p>
 <pre>
public class ExampleService extends Service {
    int mStartMode;       // indicates how to behave if the service is killed
    IBinder mBinder;      // interface for clients that bind
    boolean mAllowRebind; // indicates whether onRebind should be used

    @Override
    public void <code><a href="/reference/android/app/Service.html#onCreate()">onCreate</a></code>() {
        // The service is being created
    }
    @Override
    public int <code><a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">onStartCommand</a></code>(Intent intent, int flags, int startId) {
        // The service is starting, due to a call to <code><a href="/reference/android/content/Context.html#startService(android.content.Intent)">startService()</a></code>
        return <em>mStartMode</em>;
    }
    @Override
    public IBinder <code><a href="/reference/android/app/Service.html#onBind(android.content.Intent)">onBind</a></code>(Intent intent) {
        // A client is binding to the service with <code><a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">bindService()</a></code>
        return <em>mBinder</em>;
    }
    @Override
    public boolean <code><a href="/reference/android/app/Service.html#onUnbind(android.content.Intent)">onUnbind</a></code>(Intent intent) {
        // All clients have unbound with <code><a href="/reference/android/content/Context.html#unbindService(android.content.ServiceConnection)">unbindService()</a></code>
        return <em>mAllowRebind</em>;
    }
    @Override
    public void <code><a href="/reference/android/app/Service.html#onRebind(android.content.Intent)">onRebind</a></code>(Intent intent) {
        // A client is binding to the service with <code><a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">bindService()</a></code>,
        // after onUnbind() has already been called
    }
    @Override
    public void <code><a href="/reference/android/app/Service.html#onDestroy()">onDestroy</a></code>() {
        // The service is no longer used and is being destroyed
    }
}
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  Unlike the activity lifecycle callback methods, you are
  <em>
   not
  </em>
  required to call the superclass implementation of these callback methods.
 </p>
 <img alt="" src="http://developer.android.com/images/service_lifecycle.png"/>
 <p class="img-caption">
  <strong>
   Figure 2.
  </strong>
  The service lifecycle. The diagram on the left
shows the lifecycle when the service is created with
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  and the diagram on the right shows the lifecycle when the service is created
with
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  .
 </p>
 <p>
  By implementing these methods, you can monitor two nested loops of the service's lifecycle:
 </p>
 <ul>
  <li>
   The
   <strong>
    entire lifetime
   </strong>
   of a service happens between the time
   <code>
    <a href="/reference/android/app/Service.html#onCreate()">
     onCreate()
    </a>
   </code>
   is called and the time
   <code>
    <a href="/reference/android/app/Service.html#onDestroy()">
     onDestroy()
    </a>
   </code>
   returns. Like an activity, a service does its initial setup in
   <code>
    <a href="/reference/android/app/Service.html#onCreate()">
     onCreate()
    </a>
   </code>
   and releases all remaining resources in
   <code>
    <a href="/reference/android/app/Service.html#onDestroy()">
     onDestroy()
    </a>
   </code>
   .  For example, a
music playback service could create the thread where the music will be played in
   <code>
    <a href="/reference/android/app/Service.html#onCreate()">
     onCreate()
    </a>
   </code>
   , then stop the thread in
   <code>
    <a href="/reference/android/app/Service.html#onDestroy()">
     onDestroy()
    </a>
   </code>
   .
   <p>
    The
    <code>
     <a href="/reference/android/app/Service.html#onCreate()">
      onCreate()
     </a>
    </code>
    and
    <code>
     <a href="/reference/android/app/Service.html#onDestroy()">
      onDestroy()
     </a>
    </code>
    methods are called for all services, whether
they're created by
    <code>
     <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
      startService()
     </a>
    </code>
    or
    <code>
     <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
      bindService()
     </a>
    </code>
    .
   </p>
  </li>
  <li>
   The
   <strong>
    active lifetime
   </strong>
   of a service begins with a call to either
   <code>
    <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
     onStartCommand()
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   .
Each method is handed the
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   that was passed to either
   <code>
    <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
     startService()
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
     bindService()
    </a>
   </code>
   , respectively.
   <p>
    If the service is started, the active lifetime ends the same time that the entire lifetime
ends (the service is still active even after
    <code>
     <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
      onStartCommand()
     </a>
    </code>
    returns). If the service is bound, the active lifetime ends when
    <code>
     <a href="/reference/android/app/Service.html#onUnbind(android.content.Intent)">
      onUnbind()
     </a>
    </code>
    returns.
   </p>
  </li>
 </ul>
 <p class="note">
  <strong>
   Note:
  </strong>
  Although a started service is stopped by a call to
either
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  , there is not a respective callback for the
service (there's no
  <code>
   onStop()
  </code>
  callback). So, unless the service is bound to a client,
the system destroys it when the service is stopped&mdash;
  <code>
   <a href="/reference/android/app/Service.html#onDestroy()">
    onDestroy()
   </a>
  </code>
  is the only callback received.
 </p>
 <p>
  Figure 2 illustrates the typical callback methods for a service. Although the figure separates
services that are created by
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  from those
created by
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  , keep
in mind that any service, no matter how it's started, can potentially allow clients to bind to it.
So, a service that was initially started with
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  (by a client calling
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  )
can still receive a call to
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  (when a client calls
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  ).
 </p>
 <p>
  For more information about creating a service that provides binding, see the
  <a href="/guide/components/bound-services.html">
   Bound Services
  </a>
  document,
which includes more information about the
  <code>
   <a href="/reference/android/app/Service.html#onRebind(android.content.Intent)">
    onRebind()
   </a>
  </code>
  callback method in the section about
  <a href="/guide/components/bound-services.html#Lifecycle">
   Managing the Lifecycle of
a Bound Service
  </a>
  .
 </p>
 <!--
<h2>Beginner's Path</h2>

<p>To learn how to query data from the system or other applications (such as contacts or media
stored on the device), continue with the <b><a
href="/guide/topics/providers/content-providers.html">Content Providers</a></b>
document.</p>
-->
</div>
<h1>Bound Services</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <ol id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Basics">
      The Basics
     </a>
    </li>
    <li>
     <a href="#Creating">
      Creating a Bound Service
     </a>
     <ol>
      <li>
       <a href="#Binder">
        Extending the Binder class
       </a>
      </li>
      <li>
       <a href="#Messenger">
        Using a Messenger
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Binding">
      Binding to a Service
     </a>
    </li>
    <li>
     <a href="#Lifecycle">
      Managing the Lifecycle of a Bound Service
     </a>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/content/ServiceConnection.html">
       ServiceConnection
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/os/IBinder.html">
       IBinder
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/RemoteService.html">
      <code>
       RemoteService
      </code>
     </a>
    </li>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LocalService.html">
      <code>
       LocalService
      </code>
     </a>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/components/services.html">
      Services
     </a>
    </li>
   </ol>
  </ol>
 </div>
 <p>
  A bound service is the server in a client-server interface. A bound service allows components
(such as activities) to bind to the service, send requests, receive responses, and even perform
interprocess communication (IPC). A bound service typically lives only while it serves another
application component and does not run in the background indefinitely.
 </p>
 <p>
  This document shows you how to create a bound service, including how to bind
to the service from other application components. However, you should also refer to the
  <a href="/guide/components/services.html">
   Services
  </a>
  document for additional
information about services in general, such as how to deliver notifications from a service, set
the service to run in the foreground, and more.
 </p>
 <h2 id="Basics">
  The Basics
 </h2>
 <p>
  A bound service is an implementation of the
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  class that allows
other applications to bind to it and interact with it. To provide binding for a
service, you must implement the
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  callback method. This
method returns an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  object that defines the programming interface that
clients can use to interact with the service.
 </p>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h3>
    Binding to a Started Service
   </h3>
   <p>
    As discussed in the
    <a href="/guide/components/services.html">
     Services
    </a>
    document, you can create a service that is both started and bound. That is, the service can be
started by calling
    <code>
     <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
      startService()
     </a>
    </code>
    , which allows the
service to run indefinitely, and also allow a client to bind to the service by calling
    <code>
     <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
      bindService()
     </a>
    </code>
    .
   </p>
   <p>
    If you do allow your service to be started and bound, then when the service has been
started, the system does
    <em>
     not
    </em>
    destroy the service when all clients unbind. Instead, you must
explicitly stop the service, by calling
    <code>
     <a href="/reference/android/app/Service.html#stopSelf()">
      stopSelf()
     </a>
    </code>
    or
    <code>
     <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
      stopService()
     </a>
    </code>
    .
   </p>
   <p>
    Although you should usually implement either
    <code>
     <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
      onBind()
     </a>
    </code>
    <em>
     or
    </em>
    <code>
     <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
      onStartCommand()
     </a>
    </code>
    , it's sometimes necessary to
implement both. For example, a music player might find it useful to allow its service to run
indefinitely and also provide binding. This way, an activity can start the service to play some
music and the music continues to play even if the user leaves the application. Then, when the user
returns to the application, the activity can bind to the service to regain control of playback.
   </p>
   <p>
    Be sure to read the section about
    <a href="#Lifecycle">
     Managing the Lifecycle of a Bound
Service
    </a>
    , for more information about the service lifecycle when adding binding to a
started service.
   </p>
  </div>
 </div>
 <p>
  A client can bind to the service by calling
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  . When it does, it must provide an implementation of
  <code>
   <a href="/reference/android/content/ServiceConnection.html">
    ServiceConnection
   </a>
  </code>
  , which monitors the connection with the service. The
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  method returns immediately without a value, but
when the Android system creates the connection between the
client and service, it calls
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  on the
  <code>
   <a href="/reference/android/content/ServiceConnection.html">
    ServiceConnection
   </a>
  </code>
  , to deliver the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  that
the client can use to communicate with the service.
 </p>
 <p>
  Multiple clients can connect to the service at once. However, the system calls your service's
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  method to retrieve the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  only
when the first client binds. The system then delivers the same
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  to any
additional clients that bind, without calling
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  again.
 </p>
 <p>
  When the last client unbinds from the service, the system destroys the service (unless the
service was also started by
  <code>
   <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
    startService()
   </a>
  </code>
  ).
 </p>
 <p>
  When you implement your bound service, the most important part is defining the interface
that your
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  callback method returns. There are a few
different ways you can define your service's
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  interface and the following
section discusses each technique.
 </p>
 <h2 id="Creating">
  Creating a Bound Service
 </h2>
 <p>
  When creating a service that provides binding, you must provide an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  that provides the programming interface that clients can use to interact with the service. There
are three ways you can define the interface:
 </p>
 <dl>
  <dt>
   <a href="#Binder">
    Extending the Binder class
   </a>
  </dt>
  <dd>
   If your service is private to your own application and runs in the same process as the client
(which is common), you should create your interface by extending the
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   class
and returning an instance of it from
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   . The client receives the
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   and
can use it to directly access public methods available in either the
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   implementation or even the
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
   .
   <p>
    This is the preferred technique when your service is merely a background worker for your own
application. The only reason you would not create your interface this way is because
your service is used by other applications or across separate processes.
   </p>
  </dd>
  <dt>
   <a href="#Messenger">
    Using a Messenger
   </a>
  </dt>
  <dd>
   If you need your interface to work across different processes, you can create
an interface for the service with a
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   . In this manner, the service
defines a
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   that responds to different types of
   <code>
    <a href="/reference/android/os/Message.html">
     Message
    </a>
   </code>
   objects. This
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   is the basis for a
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   that can then share an
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   with the client, allowing the client to send commands to the service using
   <code>
    <a href="/reference/android/os/Message.html">
     Message
    </a>
   </code>
   objects. Additionally, the client can define a
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   of
its own so the service can send messages back.
   <p>
    This is the simplest way to perform interprocess communication (IPC), because the
    <code>
     <a href="/reference/android/os/Messenger.html">
      Messenger
     </a>
    </code>
    queues all requests into a single thread so that you don't have to design
your service to be thread-safe.
   </p>
  </dd>
  <dt>
   Using AIDL
  </dt>
  <dd>
   AIDL (Android Interface Definition Language) performs all the work to decompose objects into
primitives that the operating system can understand and marshall them across processes to perform
IPC. The previous technique, using a
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   , is actually based on AIDL as
its underlying structure. As mentioned above, the
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   creates a queue of
all the client requests in a single thread, so the service receives requests one at a time. If,
however, you want your service to handle multiple requests simultaneously, then you can use AIDL
directly. In this case, your service must be capable of multi-threading and be built thread-safe.
   <p>
    To use AIDL directly, you must
create an
    <code>
     .aidl
    </code>
    file that defines the programming interface. The Android SDK tools use
this file to generate an abstract class that implements the interface and handles IPC, which you
can then extend within your service.
   </p>
  </dd>
 </dl>
 <p class="note">
  <strong>
   Note:
  </strong>
  Most applications
  <strong>
   should not
  </strong>
  use AIDL to
create a bound service, because it may require multithreading capabilities and
can result in a more complicated implementation. As such, AIDL is not suitable for most applications
and this document does not discuss how to use it for your service. If you're certain that you need
to use AIDL directly, see the
  <a href="/guide/components/aidl.html">
   AIDL
  </a>
  document.
 </p>
 <h3 id="Binder">
  Extending the Binder class
 </h3>
 <p>
  If your service is used only by the local application and does not need to work across processes,
then you can implement your own
  <code>
   <a href="/reference/android/os/Binder.html">
    Binder
   </a>
  </code>
  class that provides your client direct
access to public methods in the service.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  This works only if the client and service are in the same
application and process, which is most common. For example, this would work well for a music
application that needs to bind an activity to its own service that's playing music in the
background.
 </p>
 <p>
  Here's how to set it up:
 </p>
 <ol>
  <li>
   In your service, create an instance of
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   that either:
   <ul>
    <li>
     contains public methods that the client can call
    </li>
    <li>
     returns the current
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
     instance, which has public methods the
client can call
    </li>
    <li>
     or, returns an instance of another class hosted by the service with public methods the
client can call
    </li>
   </ul>
  </li>
  <li>
   Return this instance of
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   from the
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   callback method.
  </li>
  <li>
   In the client, receive the
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   from the
   <code>
    <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
     onServiceConnected()
    </a>
   </code>
   callback method and
make calls to the bound service using the methods provided.
  </li>
 </ol>
 <p class="note">
  <strong>
   Note:
  </strong>
  The reason the service and client must be in the same
application is so the client can cast the returned object and properly call its APIs. The service
and client must also be in the same process, because this technique does not perform any
marshalling across processes.
 </p>
 <p>
  For example, here's a service that provides clients access to methods in the service through
a
  <code>
   <a href="/reference/android/os/Binder.html">
    Binder
   </a>
  </code>
  implementation:
 </p>
 <pre>
public class LocalService extends Service {
    // Binder given to clients
    private final IBinder mBinder = new LocalBinder();
    // Random number generator
    private final Random mGenerator = new Random();

    /**
     * Class used for the client Binder.  Because we know this service always
     * runs in the same process as its clients, we don't need to deal with IPC.
     */
    public class LocalBinder extends Binder {
        LocalService getService() {
            // Return this instance of LocalService so clients can call public methods
            return LocalService.this;
        }
    }

    @Override
    public IBinder onBind(Intent intent) {
        return mBinder;
    }

    /** method for clients */
    public int getRandomNumber() {
      return mGenerator.nextInt(100);
    }
}
</pre>
 <p>
  The
  <code>
   LocalBinder
  </code>
  provides the
  <code>
   getService()
  </code>
  method for clients to retrieve the
current instance of
  <code>
   LocalService
  </code>
  . This allows clients to call public methods in the
service. For example, clients can call
  <code>
   getRandomNumber()
  </code>
  from the service.
 </p>
 <p>
  Here's an activity that binds to
  <code>
   LocalService
  </code>
  and calls
  <code>
   getRandomNumber()
  </code>
  when a button is clicked:
 </p>
 <pre>
public class BindingActivity extends Activity {
    LocalService mService;
    boolean mBound = false;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
    }

    @Override
    protected void onStart() {
        super.onStart();
        // Bind to LocalService
        Intent intent = new Intent(this, LocalService.class);
        bindService(intent, mConnection, Context.BIND_AUTO_CREATE);
    }

    @Override
    protected void onStop() {
        super.onStop();
        // Unbind from the service
        if (mBound) {
            unbindService(mConnection);
            mBound = false;
        }
    }

    /** Called when a button is clicked (the button in the layout file attaches to
      * this method with the android:onClick attribute) */
    public void onButtonClick(View v) {
        if (mBound) {
            // Call a method from the LocalService.
            // However, if this call were something that might hang, then this request should
            // occur in a separate thread to avoid slowing down the activity performance.
            int num = mService.getRandomNumber();
            Toast.makeText(this, "number: " + num, Toast.LENGTH_SHORT).show();
        }
    }

    /** Defines callbacks for service binding, passed to bindService() */
    private ServiceConnection mConnection = new ServiceConnection() {

        @Override
        public void onServiceConnected(ComponentName className,
                IBinder service) {
            // We've bound to LocalService, cast the IBinder and get LocalService instance
            LocalBinder binder = (LocalBinder) service;
            mService = binder.getService();
            mBound = true;
        }

        @Override
        public void onServiceDisconnected(ComponentName arg0) {
            mBound = false;
        }
    };
}
</pre>
 <p>
  The above sample shows how the client binds to the service using an implementation of
  <code>
   <a href="/reference/android/content/ServiceConnection.html">
    ServiceConnection
   </a>
  </code>
  and the
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  callback. The next
section provides more information about this process of binding to the service.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  The example above doesn't explicitly unbind from the service,
but all clients should unbind at an appropriate time (such as when the activity pauses).
 </p>
 <p>
  For more sample code, see the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LocalService.html">
   <code>
    LocalService.java
   </code>
  </a>
  class and the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/LocalServiceActivities.html">
   <code>
    LocalServiceActivities.java
   </code>
  </a>
  class in
  <a href="/resources/samples/ApiDemos/index.html">
   ApiDemos
  </a>
  .
 </p>
 <h3 id="Messenger">
  Using a Messenger
 </h3>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h4>
    Compared to AIDL
   </h4>
   <p>
    When you need to perform IPC, using a
    <code>
     <a href="/reference/android/os/Messenger.html">
      Messenger
     </a>
    </code>
    for your interface is
simpler than implementing it with AIDL, because
    <code>
     <a href="/reference/android/os/Messenger.html">
      Messenger
     </a>
    </code>
    queues
all calls to the service, whereas, a pure AIDL interface sends simultaneous requests to the
service, which must then handle multi-threading.
   </p>
   <p>
    For most applications, the service doesn't need to perform multi-threading, so using a
    <code>
     <a href="/reference/android/os/Messenger.html">
      Messenger
     </a>
    </code>
    allows the service to handle one call at a time. If it's important
that your service be multi-threaded, then you should use
    <a href="/guide/components/aidl.html">
     AIDL
    </a>
    to define your interface.
   </p>
  </div>
 </div>
 <p>
  If you need your service to communicate with remote processes, then you can use a
  <code>
   <a href="/reference/android/os/Messenger.html">
    Messenger
   </a>
  </code>
  to provide the interface for your service. This technique allows
you to perform interprocess communication (IPC) without the need to use AIDL.
 </p>
 <p>
  Here's a summary of how to use a
  <code>
   <a href="/reference/android/os/Messenger.html">
    Messenger
   </a>
  </code>
  :
 </p>
 <ul>
  <li>
   The service implements a
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   that receives a callback for each
call from a client.
  </li>
  <li>
   The
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   is used to create a
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   object
(which is a reference to the
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   ).
  </li>
  <li>
   The
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   creates an
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   that the service
returns to clients from
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   .
  </li>
  <li>
   Clients use the
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   to instantiate the
   <code>
    <a href="/reference/android/os/Messenger.html">
     Messenger
    </a>
   </code>
   (that references the service's
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   ), which the client uses to send
   <code>
    <a href="/reference/android/os/Message.html">
     Message
    </a>
   </code>
   objects to the service.
  </li>
  <li>
   The service receives each
   <code>
    <a href="/reference/android/os/Message.html">
     Message
    </a>
   </code>
   in its
   <code>
    <a href="/reference/android/os/Handler.html">
     Handler
    </a>
   </code>
   &mdash;specifically, in the
   <code>
    <a href="/reference/android/os/Handler.html#handleMessage(android.os.Message)">
     handleMessage()
    </a>
   </code>
   method.
  </li>
 </ul>
 <p>
  In this way, there are no "methods" for the client to call on the service. Instead, the
client delivers "messages" (
  <code>
   <a href="/reference/android/os/Message.html">
    Message
   </a>
  </code>
  objects) that the service receives in
its
  <code>
   <a href="/reference/android/os/Handler.html">
    Handler
   </a>
  </code>
  .
 </p>
 <p>
  Here's a simple example service that uses a
  <code>
   <a href="/reference/android/os/Messenger.html">
    Messenger
   </a>
  </code>
  interface:
 </p>
 <pre>
public class MessengerService extends Service {
    /** Command to the service to display a message */
    static final int MSG_SAY_HELLO = 1;

    /**
     * Handler of incoming messages from clients.
     */
    class IncomingHandler extends Handler {
        @Override
        public void handleMessage(Message msg) {
            switch (msg.what) {
                case MSG_SAY_HELLO:
                    Toast.makeText(getApplicationContext(), "hello!", Toast.LENGTH_SHORT).show();
                    break;
                default:
                    super.handleMessage(msg);
            }
        }
    }

    /**
     * Target we publish for clients to send messages to IncomingHandler.
     */
    final Messenger mMessenger = new Messenger(new IncomingHandler());

    /**
     * When binding to the service, we return an interface to our messenger
     * for sending messages to the service.
     */
    @Override
    public IBinder onBind(Intent intent) {
        Toast.makeText(getApplicationContext(), "binding", Toast.LENGTH_SHORT).show();
        return mMessenger.getBinder();
    }
}
</pre>
 <p>
  Notice that the
  <code>
   <a href="/reference/android/os/Handler.html#handleMessage(android.os.Message)">
    handleMessage()
   </a>
  </code>
  method in the
  <code>
   <a href="/reference/android/os/Handler.html">
    Handler
   </a>
  </code>
  is where the service receives the incoming
  <code>
   <a href="/reference/android/os/Message.html">
    Message
   </a>
  </code>
  and decides what to do, based on the
  <code>
   <a href="/reference/android/os/Message.html#what">
    what
   </a>
  </code>
  member.
 </p>
 <p>
  All that a client needs to do is create a
  <code>
   <a href="/reference/android/os/Messenger.html">
    Messenger
   </a>
  </code>
  based on the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  returned by the service and send a message using
  <code>
   <a href="/reference/android/os/Messenger.html#send(android.os.Message)">
    send()
   </a>
  </code>
  . For example, here's a simple activity that binds to the
service and delivers the
  <code>
   MSG_SAY_HELLO
  </code>
  message to the service:
 </p>
 <pre>
public class ActivityMessenger extends Activity {
    /** Messenger for communicating with the service. */
    Messenger mService = null;

    /** Flag indicating whether we have called bind on the service. */
    boolean mBound;

    /**
     * Class for interacting with the main interface of the service.
     */
    private ServiceConnection mConnection = new ServiceConnection() {
        public void onServiceConnected(ComponentName className, IBinder service) {
            // This is called when the connection with the service has been
            // established, giving us the object we can use to
            // interact with the service.  We are communicating with the
            // service using a Messenger, so here we get a client-side
            // representation of that from the raw IBinder object.
            mService = new Messenger(service);
            mBound = true;
        }

        public void onServiceDisconnected(ComponentName className) {
            // This is called when the connection with the service has been
            // unexpectedly disconnected -- that is, its process crashed.
            mService = null;
            mBound = false;
        }
    };

    public void sayHello(View v) {
        if (!mBound) return;
        // Create and send a message to the service, using a supported 'what' value
        Message msg = Message.obtain(null, MessengerService.MSG_SAY_HELLO, 0, 0);
        try {
            mService.send(msg);
        } catch (RemoteException e) {
            e.printStackTrace();
        }
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
    }

    @Override
    protected void onStart() {
        super.onStart();
        // Bind to the service
        bindService(new Intent(this, MessengerService.class), mConnection,
            Context.BIND_AUTO_CREATE);
    }

    @Override
    protected void onStop() {
        super.onStop();
        // Unbind from the service
        if (mBound) {
            unbindService(mConnection);
            mBound = false;
        }
    }
}
</pre>
 <p>
  Notice that this example does not show how the service can respond to the client. If you want the
service to respond, then you need to also create a
  <code>
   <a href="/reference/android/os/Messenger.html">
    Messenger
   </a>
  </code>
  in the client. Then
when the client receives the
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  callback, it sends a
  <code>
   <a href="/reference/android/os/Message.html">
    Message
   </a>
  </code>
  to the service that includes
the client's
  <code>
   <a href="/reference/android/os/Messenger.html">
    Messenger
   </a>
  </code>
  in the
  <code>
   <a href="/reference/android/os/Message.html#replyTo">
    replyTo
   </a>
  </code>
  parameter
of the
  <code>
   <a href="/reference/android/os/Messenger.html#send(android.os.Message)">
    send()
   </a>
  </code>
  method.
 </p>
 <p>
  You can see an example of how to provide two-way messaging in the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/MessengerService.html">
   <code>
    MessengerService.java
   </code>
  </a>
  (service) and
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/MessengerServiceActivities.html">
   <code>
    MessengerServiceActivities.java
   </code>
  </a>
  (client) samples.
 </p>
 <h2 id="Binding">
  Binding to a Service
 </h2>
 <p>
  Application components (clients) can bind to a service by calling
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  . The Android
system then calls the service's
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  method, which returns an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  for interacting with the service.
 </p>
 <p>
  The binding is asynchronous.
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  returns immediately and does
  <em>
   not
  </em>
  return the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  to
the client. To receive the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  , the client must create an instance of
  <code>
   <a href="/reference/android/content/ServiceConnection.html">
    ServiceConnection
   </a>
  </code>
  and pass it to
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  . The
  <code>
   <a href="/reference/android/content/ServiceConnection.html">
    ServiceConnection
   </a>
  </code>
  includes a callback method that the
system calls to deliver the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  .
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Only activities, services, and content providers can bind
to a service&mdash;you
  <strong>
   cannot
  </strong>
  bind to a service from a broadcast receiver.
 </p>
 <p>
  So, to bind to a service from your client, you must:
 </p>
 <ol>
  <li>
   Implement
   <code>
    <a href="/reference/android/content/ServiceConnection.html">
     ServiceConnection
    </a>
   </code>
   .
   <p>
    Your implementation must override two callback methods:
   </p>
   <dl>
    <dt>
     <code>
      <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
       onServiceConnected()
      </a>
     </code>
    </dt>
    <dd>
     The system calls this to deliver the
     <code>
      <a href="/reference/android/os/IBinder.html">
       IBinder
      </a>
     </code>
     returned by
the service's
     <code>
      <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
       onBind()
      </a>
     </code>
     method.
    </dd>
    <dt>
     <code>
      <a href="/reference/android/content/ServiceConnection.html#onServiceDisconnected(android.content.ComponentName)">
       onServiceDisconnected()
      </a>
     </code>
    </dt>
    <dd>
     The Android system calls this when the connection to the service is unexpectedly
lost, such as when the service has crashed or has been killed. This is
     <em>
      not
     </em>
     called when the
client unbinds.
    </dd>
   </dl>
  </li>
  <li>
   Call
   <code>
    <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
     bindService()
    </a>
   </code>
   , passing the
   <code>
    <a href="/reference/android/content/ServiceConnection.html">
     ServiceConnection
    </a>
   </code>
   implementation.
  </li>
  <li>
   When the system calls your
   <code>
    <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
     onServiceConnected()
    </a>
   </code>
   callback method, you can begin making calls to the service, using
the methods defined by the interface.
  </li>
  <li>
   To disconnect from the service, call
   <code>
    <a href="/reference/android/content/Context.html#unbindService(android.content.ServiceConnection)">
     unbindService()
    </a>
   </code>
   .
   <p>
    When your client is destroyed, it will unbind from the service, but you should always unbind
when you're done interacting with the service or when your activity pauses so that the service can
shutdown while its not being used. (Appropriate times to bind and unbind is discussed
more below.)
   </p>
  </li>
 </ol>
 <p>
  For example, the following snippet connects the client to the service created above by
  <a href="#Binder">
   extending the Binder class
  </a>
  , so all it must do is cast the returned
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  to the
  <code>
   LocalService
  </code>
  class and request the
  <code>
   LocalService
  </code>
  instance:
 </p>
 <pre>
LocalService mService;
private ServiceConnection mConnection = new ServiceConnection() {
    // Called when the connection with the service is established
    public void onServiceConnected(ComponentName className, IBinder service) {
        // Because we have bound to an explicit
        // service that is running in our own process, we can
        // cast its IBinder to a concrete class and directly access it.
        LocalBinder binder = (LocalBinder) service;
        mService = binder.getService();
        mBound = true;
    }

    // Called when the connection with the service disconnects unexpectedly
    public void onServiceDisconnected(ComponentName className) {
        Log.e(TAG, "onServiceDisconnected");
        mBound = false;
    }
};
</pre>
 <p>
  With this
  <code>
   <a href="/reference/android/content/ServiceConnection.html">
    ServiceConnection
   </a>
  </code>
  , the client can bind to a service by passing
it to
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  . For example:
 </p>
 <pre>
Intent intent = new Intent(this, LocalService.class);
bindService(intent, mConnection, Context.BIND_AUTO_CREATE);
</pre>
 <ul>
  <li>
   The first parameter of
   <code>
    <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
     bindService()
    </a>
   </code>
   is an
   <code>
    <a href="/reference/android/content/Intent.html">
     Intent
    </a>
   </code>
   that explicitly names the service to bind (thought the intent
could be implicit).
  </li>
  <li>
   The second parameter is the
   <code>
    <a href="/reference/android/content/ServiceConnection.html">
     ServiceConnection
    </a>
   </code>
   object.
  </li>
  <li>
   The third parameter is a flag indicating options for the binding. It should usually be
   <code>
    <a href="/reference/android/content/Context.html#BIND_AUTO_CREATE">
     BIND_AUTO_CREATE
    </a>
   </code>
   in order to create the service if its not already alive.
Other possible values are
   <code>
    <a href="/reference/android/content/Context.html#BIND_DEBUG_UNBIND">
     BIND_DEBUG_UNBIND
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/content/Context.html#BIND_NOT_FOREGROUND">
     BIND_NOT_FOREGROUND
    </a>
   </code>
   , or
   <code>
    0
   </code>
   for none.
  </li>
 </ul>
 <h3>
  Additional notes
 </h3>
 <p>
  Here are some important notes about binding to a service:
 </p>
 <ul>
  <li>
   You should always trap
   <code>
    <a href="/reference/android/os/DeadObjectException.html">
     DeadObjectException
    </a>
   </code>
   exceptions, which are thrown
when the connection has broken. This is the only exception thrown by remote methods.
  </li>
  <li>
   Objects are reference counted across processes.
  </li>
  <li>
   You should usually pair the binding and unbinding during
matching bring-up and tear-down moments of the client's lifecycle. For example:
   <ul>
    <li>
     If you only need to interact with the service while your activity is visible, you
should bind during
     <code>
      <a href="/reference/android/app/Activity.html#onStart()">
       onStart()
      </a>
     </code>
     and unbind during
     <code>
      <a href="/reference/android/app/Activity.html#onStop()">
       onStop()
      </a>
     </code>
     .
    </li>
    <li>
     If you want your activity to receive responses even while it is stopped in the
background, then you can bind during
     <code>
      <a href="/reference/android/app/Activity.html#onCreate(android.os.Bundle)">
       onCreate()
      </a>
     </code>
     and unbind
during
     <code>
      <a href="/reference/android/app/Activity.html#onDestroy()">
       onDestroy()
      </a>
     </code>
     . Beware that this implies that your
activity needs to use the service the entire time it's running (even in the background), so if
the service is in another process, then you increase the weight of the process and it becomes
more likely that the system will kill it.
    </li>
   </ul>
   <p class="note">
    <strong>
     Note:
    </strong>
    You should usually
    <strong>
     not
    </strong>
    bind and unbind
during your activity's
    <code>
     <a href="/reference/android/app/Activity.html#onResume()">
      onResume()
     </a>
    </code>
    and
    <code>
     <a href="/reference/android/app/Activity.html#onPause()">
      onPause()
     </a>
    </code>
    , because these callbacks occur at every lifecycle transition
and you should keep the processing that occurs at these transitions to a minimum. Also, if
multiple activities in your application bind to the same service and there is a transition between
two of those activities, the service may be destroyed and recreated as the current activity unbinds
(during pause) before the next one binds (during resume). (This activity transition for how
activities coordinate their lifecycles is described in the
    <a href="/guide/components/activities.html#CoordinatingActivities">
     Activities
    </a>
    document.)
   </p>
  </li>
 </ul>
 <p>
  For more sample code, showing how to bind to a service, see the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/RemoteService.html">
   <code>
    RemoteService.java
   </code>
  </a>
  class in
  <a href="/resources/samples/ApiDemos/index.html">
   ApiDemos
  </a>
  .
 </p>
 <h2 id="Lifecycle">
  Managing the Lifecycle of a Bound Service
 </h2>
 <p>
  When a service is unbound from all clients, the Android system destroys it (unless it was also
started with
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  ). As such, you don't have
to manage the lifecycle of your service if it's purely a bound
service&mdash;the Android system manages it for you based on whether it is bound to any clients.
 </p>
 <p>
  However, if you choose to implement the
  <code>
   <a href="/reference/android/app/Service.html#onStartCommand(android.content.Intent, int, int)">
    onStartCommand()
   </a>
  </code>
  callback method, then you must explicitly stop the service, because the
service is now considered to be
  <em>
   started
  </em>
  . In this case, the service runs until the service
stops itself with
  <code>
   <a href="/reference/android/app/Service.html#stopSelf()">
    stopSelf()
   </a>
  </code>
  or another component calls
  <code>
   <a href="/reference/android/content/Context.html#stopService(android.content.Intent)">
    stopService()
   </a>
  </code>
  , regardless of whether it is bound to any
clients.
 </p>
 <p>
  Additionally, if your service is started and accepts binding, then when the system calls
your
  <code>
   <a href="/reference/android/app/Service.html#onUnbind(android.content.Intent)">
    onUnbind()
   </a>
  </code>
  method, you can optionally return
  <code>
   true
  </code>
  if you would like to receive a call to
  <code>
   <a href="/reference/android/app/Service.html#onRebind(android.content.Intent)">
    onRebind()
   </a>
  </code>
  the next time a client binds to the service.
  <code>
   <a href="/reference/android/app/Service.html#onRebind(android.content.Intent)">
    onRebind()
   </a>
  </code>
  returns void, but the client still receives the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  in its
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  callback.
Below, figure 1 illustrates the logic for this kind of lifecycle.
 </p>
 <img alt="" src="http://developer.android.com/images/fundamentals/service_binding_tree_lifecycle.png"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  The lifecycle for a service that is started
and also allows binding.
 </p>
 <p>
  For more information about the lifecycle of a started service, see the
  <a href="/guide/components/services.html#Lifecycle">
   Services
  </a>
  document.
 </p>
</div>
<h1>Android Interface Definition Language (AIDL)</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Defining">
      Defining an AIDL Interface
     </a>
     <ol>
      <li>
       <a href="#Create">
        Create the .aidl file
       </a>
      </li>
      <li>
       <a href="#Implement">
        Implement the interface
       </a>
      </li>
      <li>
       <a href="#Expose">
        Expose the interface to clients
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#PassingObjects">
      Passing Objects over IPC
     </a>
    </li>
    <li>
     <a href="#Calling">
      Calling an IPC Method
     </a>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/components/bound-services.html">
      Bound Services
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  AIDL (Android Interface Definition Language) is similar to other IDLs you might have
worked with. It allows you to define the programming interface that both
the client and service agree upon in order to communicate with each other using
interprocess communication (IPC). On Android, one process cannot normally access the
memory of another process. So to talk, they need to decompose their objects into primitives that the
operating system can understand, and marshall the objects across that boundary for you. The code to
do that marshalling is tedious to write, so Android handles it for you with AIDL.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Using AIDL is necessary only if you allow clients from
different applications to access your service for IPC and want to handle multithreading in your
service. If you do not need to perform concurrent IPC across
different applications, you should create your interface by
  <a href="/guide/components/bound-services.html#Binder">
   implementing a
Binder
  </a>
  or, if you want to perform IPC, but do
  <em>
   not
  </em>
  need to handle multithreading,
implement your interface
  <a href="/guide/components/bound-services.html#Messenger">
   using a Messenger
  </a>
  .
Regardless, be sure that you understand
  <a href="/guide/components/bound-services.html">
   Bound Services
  </a>
  before
implementing an AIDL.
 </p>
 <p>
  Before you begin designing your AIDL interface, be aware that calls to an AIDL interface are
direct function calls.  You should not make assumptions about the thread in which the call
occurs.  What happens is different depending on whether the call is from a thread in the
local process or a remote process. Specifically:
 </p>
 <ul>
  <li>
   Calls made from the local process are executed in the same thread that is making the call. If
this is your main UI thread, that thread continues to execute in the AIDL interface.  If it is
another thread, that is the one that executes your code in the service.  Thus, if only local
threads are accessing the service, you can completely control which threads are executing in it (but
if that is the case, then you shouldn't be using AIDL at all, but should instead create the
interface by
   <a href="/guide/components/bound-services.html#Binder">
    implementing a
Binder
   </a>
   ).
  </li>
  <li>
   Calls from a remote process are dispatched from a thread pool the platform maintains inside of
your own process.  You must be prepared for incoming calls from unknown threads, with multiple calls
happening at the same time.  In other words, an implementation of an AIDL interface must be
completely thread-safe.
  </li>
  <li>
   The
   <code>
    oneway
   </code>
   keyword modifies the behavior of remote calls.  When used, a remote call does
not block; it simply sends the transaction data and immediately returns.
The implementation of the interface eventually receives this as a regular call from the
   <code>
    <a href="/reference/android/os/Binder.html">
     Binder
    </a>
   </code>
   thread pool as a normal remote call. If
   <code>
    oneway
   </code>
   is used with a local call,
there is no impact and the call is still synchronous.
  </li>
 </ul>
 <h2 id="Defining">
  Defining an AIDL Interface
 </h2>
 <p>
  You must define your AIDL interface in an
  <code>
   .aidl
  </code>
  file using the Java
programming language syntax, then save it in the source code (in the
  <code>
   src/
  </code>
  directory) of both
the application hosting the service and any other application that binds to the service.
 </p>
 <p>
  When you build each application that contains the
  <code>
   .aidl
  </code>
  file, the Android SDK tools
generate an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  interface based on the
  <code>
   .aidl
  </code>
  file and save it in
the project's
  <code>
   gen/
  </code>
  directory. The service must implement the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  interface as appropriate. The client applications can then bind to the service and call methods from
the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  to perform IPC.
 </p>
 <p>
  To create a bounded service using AIDL, follow these steps:
 </p>
 <ol>
  <li>
   <a href="#CreateAidl">
    Create the .aidl file
   </a>
   <p>
    This file defines the programming interface with method signatures.
   </p>
  </li>
  <li>
   <a href="#ImplementTheInterface">
    Implement the interface
   </a>
   <p>
    The Android SDK tools generate an interface in the Java programming language, based on your
    <code>
     .aidl
    </code>
    file. This interface has an inner abstract class named
    <code>
     Stub
    </code>
    that extends
    <code>
     <a href="/reference/android/os/Binder.html">
      Binder
     </a>
    </code>
    and implements methods from your AIDL interface. You must extend the
    <code>
     Stub
    </code>
    class and implement the methods.
   </p>
  </li>
  <li>
   <a href="#ExposeTheInterface">
    Expose the interface to clients
   </a>
   <p>
    Implement a
    <code>
     <a href="/reference/android/app/Service.html">
      Service
     </a>
    </code>
    and override
    <code>
     <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
      onBind()
     </a>
    </code>
    to return your implementation of the
    <code>
     Stub
    </code>
    class.
   </p>
  </li>
 </ol>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  Any changes that you make to your AIDL interface after
your first release must remain backward compatible in order to avoid breaking other applications
that use your service. That is, because your
  <code>
   .aidl
  </code>
  file must be copied to other applications
in order for them to access your service's interface, you must maintain support for the original
interface.
 </p>
 <h3 id="Create">
  1. Create the .aidl file
 </h3>
 <p>
  AIDL uses a simple syntax that lets you declare an interface with one or more methods that can
take parameters and return values. The parameters and return values can be of any type, even other
AIDL-generated interfaces.
 </p>
 <p>
  You must construct the
  <code>
   .aidl
  </code>
  file using the Java programming language. Each
  <code>
   .aidl
  </code>
  file must define a single interface and requires only the interface declaration and method
signatures.
 </p>
 <p>
  By default, AIDL supports the following data types:
 </p>
 <ul>
  <li>
   All primitive types in the Java programming language (such as
   <code>
    int
   </code>
   ,
   <code>
    long
   </code>
   ,
   <code>
    char
   </code>
   ,
   <code>
    boolean
   </code>
   , and so on)
  </li>
  <li>
   <code>
    <a href="/reference/java/lang/String.html">
     String
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/java/lang/CharSequence.html">
     CharSequence
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/java/util/List.html">
     List
    </a>
   </code>
   <p>
    All elements in the
    <code>
     <a href="/reference/java/util/List.html">
      List
     </a>
    </code>
    must be one of the supported data types in this
list or one of the other AIDL-generated interfaces or parcelables you've declared. A
    <code>
     <a href="/reference/java/util/List.html">
      List
     </a>
    </code>
    may optionally be used as a "generic" class (for example,
    <code>
     List&lt;String&gt;
    </code>
    ).
The actual concrete class that the other side receives is always an
    <code>
     <a href="/reference/java/util/ArrayList.html">
      ArrayList
     </a>
    </code>
    , although the method is generated to use the
    <code>
     <a href="/reference/java/util/List.html">
      List
     </a>
    </code>
    interface.
   </p>
  </li>
  <li>
   <code>
    <a href="/reference/java/util/Map.html">
     Map
    </a>
   </code>
   <p>
    All elements in the
    <code>
     <a href="/reference/java/util/Map.html">
      Map
     </a>
    </code>
    must be one of the supported data types in this
list or one of the other AIDL-generated interfaces or parcelables you've declared.  Generic maps,
(such as those of the form
    <code>
     Map&lt;String,Integer&gt;
    </code>
    are not supported. The actual concrete class that the other side
receives is always a
    <code>
     <a href="/reference/java/util/HashMap.html">
      HashMap
     </a>
    </code>
    , although the method is generated to
use the
    <code>
     <a href="/reference/java/util/Map.html">
      Map
     </a>
    </code>
    interface.
   </p>
  </li>
 </ul>
 <p>
  You must include an
  <code>
   import
  </code>
  statement for each additional type not listed above, even if
they are defined in the same package as your interface.
 </p>
 <p>
  When defining your service interface, be aware that:
 </p>
 <ul>
  <li>
   Methods can take zero or more parameters, and return a value or void.
  </li>
  <li>
   All non-primitive parameters require a directional tag indicating which way the data goes.
Either
   <code>
    in
   </code>
   ,
   <code>
    out
   </code>
   , or
   <code>
    inout
   </code>
   (see the example below).
   <p>
    Primitives are
    <code>
     in
    </code>
    by default, and cannot be otherwise.
   </p>
   <p class="caution">
    <strong>
     Caution:
    </strong>
    You should limit the direction to what is truly
needed, because marshalling parameters is expensive.
   </p>
  </li>
  <li>
   All code comments included in the
   <code>
    .aidl
   </code>
   file are included in the generated
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   interface (except for comments before the import and package
statements).
  </li>
  <li>
   Only methods are supported; you cannot expose static fields in AIDL.
  </li>
 </ul>
 <p>
  Here is an example
  <code>
   .aidl
  </code>
  file:
 </p>
 <pre>
// IRemoteService.aidl
package com.example.android;

// Declare any non-default types here with import statements

/** Example service interface */
interface IRemoteService {
    /** Request the process ID of this service, to do evil things with it. */
    int getPid();

    /** Demonstrates some basic types that you can use as parameters
     * and return values in AIDL.
     */
    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
            double aDouble, String aString);
}
</pre>
 <p>
  Simply save your
  <code>
   .aidl
  </code>
  file in your project's
  <code>
   src/
  </code>
  directory and when you
build your application, the SDK tools generate the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  interface file in your
project's
  <code>
   gen/
  </code>
  directory. The generated file name matches the
  <code>
   .aidl
  </code>
  file name, but
with a
  <code>
   .java
  </code>
  extension (for example,
  <code>
   IRemoteService.aidl
  </code>
  results in
  <code>
   IRemoteService.java
  </code>
  ).
 </p>
 <p>
  If you use Eclipse, the incremental build generates the binder class almost immediately. If you
do not use Eclipse, then the Ant tool generates the binder class next time you build your
application&mdash;you should build your project with
  <code>
   ant debug
  </code>
  (or
  <code>
   ant
release
  </code>
  ) as soon as you're finished writing the
  <code>
   .aidl
  </code>
  file, so that your code can
link against the generated class.
 </p>
 <h3 id="Implement">
  2. Implement the interface
 </h3>
 <p>
  When you build your application, the Android SDK tools generate a
  <code>
   .java
  </code>
  interface file
named after your
  <code>
   .aidl
  </code>
  file. The generated interface includes a subclass named
  <code>
   Stub
  </code>
  that is an abstract implementation of its parent interface (for example,
  <code>
   YourInterface.Stub
  </code>
  ) and declares all the methods from the
  <code>
   .aidl
  </code>
  file.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  <code>
   Stub
  </code>
  also
defines a few helper methods, most notably
  <code>
   asInterface()
  </code>
  , which takes an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  (usually the one passed to a client's
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  callback method) and
returns an instance of the stub interface. See the section
  <a href="#Calling">
   Calling an IPC
Method
  </a>
  for more details on how to make this cast.
 </p>
 <p>
  To implement the interface generated from the
  <code>
   .aidl
  </code>
  , extend the generated
  <code>
   <a href="/reference/android/os/Binder.html">
    Binder
   </a>
  </code>
  interface (for example,
  <code>
   YourInterface.Stub
  </code>
  ) and implement the methods
inherited from the
  <code>
   .aidl
  </code>
  file.
 </p>
 <p>
  Here is an example implementation of an interface called
  <code>
   IRemoteService
  </code>
  (defined by the
  <code>
   IRemoteService.aidl
  </code>
  example, above) using an anonymous instance:
 </p>
 <pre>
private final IRemoteService.Stub mBinder = new IRemoteService.Stub() {
    public int getPid(){
        return Process.myPid();
    }
    public void basicTypes(int anInt, long aLong, boolean aBoolean,
        float aFloat, double aDouble, String aString) {
        // Does nothing
    }
};
</pre>
 <p>
  Now the
  <code>
   mBinder
  </code>
  is an instance of the
  <code>
   Stub
  </code>
  class (a
  <code>
   <a href="/reference/android/os/Binder.html">
    Binder
   </a>
  </code>
  ),
which defines the RPC interface for the service. In the next step, this instance is exposed to
clients so they can interact with the service.
 </p>
 <p>
  There are a few rules you should be aware of when implementing your AIDL interface:
 </p>
 <ul>
  <li>
   Incoming calls are not guaranteed to be executed on the main thread, so you need to think
about multithreading from the start and properly build your service to be thread-safe.
  </li>
  <li>
   By default, RPC calls are synchronous. If you know that the service takes more than a few
milliseconds to complete a request, you should not call it from the activity's main thread, because
it might hang the application (Android might display an "Application is Not Responding"
dialog)&mdash;you should usually call them from a separate thread in the client.
  </li>
  <li>
   No exceptions that you throw are sent back to the caller.
  </li>
 </ul>
 <h3 id="Expose">
  3. Expose the interface to clients
 </h3>
 <p>
  Once you've implemented the interface for your service, you need to expose it to
clients so they can bind to it. To expose the interface
for your service, extend
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  and implement
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  to return an instance of your class that implements
the generated
  <code>
   Stub
  </code>
  (as discussed in the previous section). Here's an example
service that exposes the
  <code>
   IRemoteService
  </code>
  example interface to clients.
 </p>
 <pre>
public class RemoteService extends Service {
    @Override
    public void onCreate() {
        super.onCreate();
    }

    @Override
    public IBinder onBind(Intent intent) {
        // Return the interface
        return mBinder;
    }

    private final IRemoteService.Stub mBinder = new IRemoteService.Stub() {
        public int getPid(){
            return Process.myPid();
        }
        public void basicTypes(int anInt, long aLong, boolean aBoolean,
            float aFloat, double aDouble, String aString) {
            // Does nothing
        }
    };
}
</pre>
 <p>
  Now, when a client (such as an activity) calls
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  to connect to this service, the client's
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  callback receives the
  <code>
   mBinder
  </code>
  instance returned by the service's
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  method.
 </p>
 <p>
  The client must also have access to the interface class, so if the client and service are in
separate applications, then the client's application must have a copy of the
  <code>
   .aidl
  </code>
  file
in its
  <code>
   src/
  </code>
  directory (which generates the
  <code>
   android.os.Binder
  </code>
  interface&mdash;providing the client access to the AIDL methods).
 </p>
 <p>
  When the client receives the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  in the
  <code>
   <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
    onServiceConnected()
   </a>
  </code>
  callback, it must call
  <code>
   <em>
    YourServiceInterface
   </em>
   .Stub.asInterface(service)
  </code>
  to cast the returned
parameter to
  <code>
   <em>
    YourServiceInterface
   </em>
  </code>
  type. For example:
 </p>
 <pre>
IRemoteService mIRemoteService;
private ServiceConnection mConnection = new ServiceConnection() {
    // Called when the connection with the service is established
    public void onServiceConnected(ComponentName className, IBinder service) {
        // Following the example above for an AIDL interface,
        // this gets an instance of the IRemoteInterface, which we can use to call on the service
        mIRemoteService = IRemoteService.Stub.asInterface(service);
    }

    // Called when the connection with the service disconnects unexpectedly
    public void onServiceDisconnected(ComponentName className) {
        Log.e(TAG, "Service has unexpectedly disconnected");
        mIRemoteService = null;
    }
};
</pre>
 <p>
  For more sample code, see the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/app/RemoteService.html">
   <code>
    RemoteService.java
   </code>
  </a>
  class in
  <a href="/resources/samples/ApiDemos/index.html">
   ApiDemos
  </a>
  .
 </p>
 <h2 id="PassingObjects">
  Passing Objects over IPC
 </h2>
 <p>
  If you have a class that you would like to send from one process to another through
an IPC interface, you can do that. However, you must ensure that the code for your class is
available to the other side of the IPC channel and your class must support the
  <code>
   <a href="/reference/android/os/Parcelable.html">
    Parcelable
   </a>
  </code>
  interface. Supporting the
  <code>
   <a href="/reference/android/os/Parcelable.html">
    Parcelable
   </a>
  </code>
  interface is
important because it allows the Android system to decompose objects into primitives that can be
marshalled across processes.
 </p>
 <p>
  To create a class that supports the
  <code>
   <a href="/reference/android/os/Parcelable.html">
    Parcelable
   </a>
  </code>
  protocol, you must do the
following:
 </p>
 <ol>
  <li>
   Make your class implement the
   <code>
    <a href="/reference/android/os/Parcelable.html">
     Parcelable
    </a>
   </code>
   interface.
  </li>
  <li>
   Implement
   <code>
    <a href="/reference/android/os/Parcelable.html#writeToParcel(android.os.Parcel, int)">
     writeToParcel
    </a>
   </code>
   , which takes the
current state of the object and writes it to a
   <code>
    <a href="/reference/android/os/Parcel.html">
     Parcel
    </a>
   </code>
   .
  </li>
  <li>
   Add a static field called
   <code>
    CREATOR
   </code>
   to your class which is an object implementing
the
   <code>
    <a href="/reference/android/os/Parcelable.Creator.html">
     Parcelable.Creator
    </a>
   </code>
   interface.
  </li>
  <li>
   Finally, create an
   <code>
    .aidl
   </code>
   file that declares your parcelable class (as shown for the
   <code>
    Rect.aidl
   </code>
   file, below).
   <p>
    If you are using a custom build process, do
    <em>
     not
    </em>
    add the
    <code>
     .aidl
    </code>
    file to your
build. Similar to a header file in the C language, this
    <code>
     .aidl
    </code>
    file isn't compiled.
   </p>
  </li>
 </ol>
 <p>
  AIDL uses these methods and fields in the code it generates to marshall and unmarshall
your objects.
 </p>
 <p>
  For example, here is a
  <code>
   Rect.aidl
  </code>
  file to create a
  <code>
   Rect
  </code>
  class that's
parcelable:
 </p>
 <pre>
package android.graphics;

// Declare Rect so AIDL can find it and knows that it implements
// the parcelable protocol.
parcelable Rect;
</pre>
 <p>
  And here is an example of how the
  <code>
   <a href="/reference/android/graphics/Rect.html">
    Rect
   </a>
  </code>
  class implements the
  <code>
   <a href="/reference/android/os/Parcelable.html">
    Parcelable
   </a>
  </code>
  protocol.
 </p>
 <pre>
import android.os.Parcel;
import android.os.Parcelable;

public final class Rect implements Parcelable {
    public int left;
    public int top;
    public int right;
    public int bottom;

    public static final Parcelable.Creator&lt;Rect&gt; CREATOR = new
Parcelable.Creator&lt;Rect&gt;() {
        public Rect createFromParcel(Parcel in) {
            return new Rect(in);
        }

        public Rect[] newArray(int size) {
            return new Rect[size];
        }
    };

    public Rect() {
    }

    private Rect(Parcel in) {
        readFromParcel(in);
    }

    public void writeToParcel(Parcel out) {
        out.writeInt(left);
        out.writeInt(top);
        out.writeInt(right);
        out.writeInt(bottom);
    }

    public void readFromParcel(Parcel in) {
        left = in.readInt();
        top = in.readInt();
        right = in.readInt();
        bottom = in.readInt();
    }
}
</pre>
 <p>
  The marshalling in the
  <code>
   Rect
  </code>
  class is pretty simple.  Take a look at the other
methods on
  <code>
   <a href="/reference/android/os/Parcel.html">
    Parcel
   </a>
  </code>
  to see the other kinds of values you can write
to a Parcel.
 </p>
 <p class="warning">
  <strong>
   Warning:
  </strong>
  Don't forget the security implications of receiving
data from other processes.  In this case, the
  <code>
   Rect
  </code>
  reads four numbers from the
  <code>
   <a href="/reference/android/os/Parcel.html">
    Parcel
   </a>
  </code>
  , but it is up to you to ensure that these are within the acceptable range of
values for whatever the caller is trying to do.  See
  <a href="/guide/topics/security/security.html">
   Security and Permissions
  </a>
  for more
information about how to keep your application secure from malware.
 </p>
 <h2 id="Calling">
  Calling an IPC Method
 </h2>
 <p>
  Here are the steps a calling class must take to call a remote interface defined with AIDL:
 </p>
 <ol>
  <li>
   Include the
   <code>
    .aidl
   </code>
   file in the project
   <code>
    src/
   </code>
   directory.
  </li>
  <li>
   Declare an instance of the
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   interface (generated based on the
AIDL).
  </li>
  <li>
   Implement
   <code>
    <a href="/reference/android/content/ServiceConnection.html">
     ServiceConnection
    </a>
   </code>
   .
  </li>
  <li>
   Call
   <code>
    <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
     Context.bindService()
    </a>
   </code>
   , passing in your
   <code>
    <a href="/reference/android/content/ServiceConnection.html">
     ServiceConnection
    </a>
   </code>
   implementation.
  </li>
  <li>
   In your implementation of
   <code>
    <a href="/reference/android/content/ServiceConnection.html#onServiceConnected(android.content.ComponentName, android.os.IBinder)">
     onServiceConnected()
    </a>
   </code>
   ,
you will receive an
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   instance (called
   <code>
    service
   </code>
   ). Call
   <code>
    <em>
     YourInterfaceName
    </em>
    .Stub.asInterface((IBinder)
    <em>
     service
    </em>
    )
   </code>
   to
        cast the returned parameter to
   <em>
    YourInterface
   </em>
   type.
  </li>
  <li>
   Call the methods that you defined on your interface. You should always trap
   <code>
    <a href="/reference/android/os/DeadObjectException.html">
     DeadObjectException
    </a>
   </code>
   exceptions, which are thrown when
        the connection has broken; this will be the only exception thrown by remote
        methods.
  </li>
  <li>
   To disconnect, call
   <code>
    <a href="/reference/android/content/Context.html#unbindService(android.content.ServiceConnection)">
     Context.unbindService()
    </a>
   </code>
   with the instance of your interface.
  </li>
 </ol>
 <p>
  A few comments on calling an IPC service:
 </p>
 <ul>
  <li>
   Objects are reference counted across processes.
  </li>
  <li>
   You can send anonymous objects
        as method arguments.
  </li>
 </ul>
 <p>
  For more information about binding to a service, read the
  <a href="/guide/components/bound-services.html#Binding">
   Bound Services
  </a>
  document.
 </p>
 <p>
  Here is some sample code demonstrating calling an AIDL-created service, taken
    from the Remote Service sample in the ApiDemos project.
 </p>
 <p>
 </p>
 <pre>public static class Binding extends Activity {
    /** The primary interface we will be calling on the service. */
    IRemoteService mService = null;
    /** Another interface we use on the service. */
    ISecondary mSecondaryService = null;

    Button mKillButton;
    TextView mCallbackText;

    private boolean mIsBound;

    /**
     * Standard initialization of this activity.  Set up the UI, then wait
     * for the user to poke it before doing anything.
     */
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        setContentView(R.layout.remote_service_binding);

        // Watch for button clicks.
        Button button = (Button)findViewById(R.id.bind);
        button.setOnClickListener(mBindListener);
        button = (Button)findViewById(R.id.unbind);
        button.setOnClickListener(mUnbindListener);
        mKillButton = (Button)findViewById(R.id.kill);
        mKillButton.setOnClickListener(mKillListener);
        mKillButton.setEnabled(false);

        mCallbackText = (TextView)findViewById(R.id.callback);
        mCallbackText.setText("Not attached.");
    }

    /**
     * Class for interacting with the main interface of the service.
     */
    private ServiceConnection mConnection = new ServiceConnection() {
        public void onServiceConnected(ComponentName className,
                IBinder service) {
            // This is called when the connection with the service has been
            // established, giving us the service object we can use to
            // interact with the service.  We are communicating with our
            // service through an IDL interface, so get a client-side
            // representation of that from the raw service object.
            mService = IRemoteService.Stub.asInterface(service);
            mKillButton.setEnabled(true);
            mCallbackText.setText("Attached.");

            // We want to monitor the service for as long as we are
            // connected to it.
            try {
                mService.registerCallback(mCallback);
            } catch (RemoteException e) {
                // In this case the service has crashed before we could even
                // do anything with it; we can count on soon being
                // disconnected (and then reconnected if it can be restarted)
                // so there is no need to do anything here.
            }

            // As part of the sample, tell the user what happened.
            Toast.makeText(Binding.this, R.string.remote_service_connected,
                    Toast.LENGTH_SHORT).show();
        }

        public void onServiceDisconnected(ComponentName className) {
            // This is called when the connection with the service has been
            // unexpectedly disconnected -- that is, its process crashed.
            mService = null;
            mKillButton.setEnabled(false);
            mCallbackText.setText("Disconnected.");

            // As part of the sample, tell the user what happened.
            Toast.makeText(Binding.this, R.string.remote_service_disconnected,
                    Toast.LENGTH_SHORT).show();
        }
    };

    /**
     * Class for interacting with the secondary interface of the service.
     */
    private ServiceConnection mSecondaryConnection = new ServiceConnection() {
        public void onServiceConnected(ComponentName className,
                IBinder service) {
            // Connecting to a secondary interface is the same as any
            // other interface.
            mSecondaryService = ISecondary.Stub.asInterface(service);
            mKillButton.setEnabled(true);
        }

        public void onServiceDisconnected(ComponentName className) {
            mSecondaryService = null;
            mKillButton.setEnabled(false);
        }
    };

    private OnClickListener mBindListener = new OnClickListener() {
        public void onClick(View v) {
            // Establish a couple connections with the service, binding
            // by interface names.  This allows other applications to be
            // installed that replace the remote service by implementing
            // the same interface.
            bindService(new Intent(IRemoteService.class.getName()),
                    mConnection, Context.BIND_AUTO_CREATE);
            bindService(new Intent(ISecondary.class.getName()),
                    mSecondaryConnection, Context.BIND_AUTO_CREATE);
            mIsBound = true;
            mCallbackText.setText("Binding.");
        }
    };

    private OnClickListener mUnbindListener = new OnClickListener() {
        public void onClick(View v) {
            if (mIsBound) {
                // If we have received the service, and hence registered with
                // it, then now is the time to unregister.
                if (mService != null) {
                    try {
                        mService.unregisterCallback(mCallback);
                    } catch (RemoteException e) {
                        // There is nothing special we need to do if the service
                        // has crashed.
                    }
                }

                // Detach our existing connection.
                unbindService(mConnection);
                unbindService(mSecondaryConnection);
                mKillButton.setEnabled(false);
                mIsBound = false;
                mCallbackText.setText("Unbinding.");
            }
        }
    };

    private OnClickListener mKillListener = new OnClickListener() {
        public void onClick(View v) {
            // To kill the process hosting our service, we need to know its
            // PID.  Conveniently our service has a call that will return
            // to us that information.
            if (mSecondaryService != null) {
                try {
                    int pid = mSecondaryService.getPid();
                    // Note that, though this API allows us to request to
                    // kill any process based on its PID, the kernel will
                    // still impose standard restrictions on which PIDs you
                    // are actually able to kill.  Typically this means only
                    // the process running your application and any additional
                    // processes created by that app as shown here; packages
                    // sharing a common UID will also be able to kill each
                    // other's processes.
                    Process.killProcess(pid);
                    mCallbackText.setText("Killed service process.");
                } catch (RemoteException ex) {
                    // Recover gracefully from the process hosting the
                    // server dying.
                    // Just for purposes of the sample, put up a notification.
                    Toast.makeText(Binding.this,
                            R.string.remote_call_failed,
                            Toast.LENGTH_SHORT).show();
                }
            }
        }
    };

    // ----------------------------------------------------------------------
    // Code showing how to deal with callbacks.
    // ----------------------------------------------------------------------

    /**
     * This implementation is used to receive callbacks from the remote
     * service.
     */
    private IRemoteServiceCallback mCallback = new IRemoteServiceCallback.Stub() {
        /**
         * This is called by the remote service regularly to tell us about
         * new values.  Note that IPC calls are dispatched through a thread
         * pool running in each process, so the code executing here will
         * NOT be running in our main thread like most other things -- so,
         * to update the UI, we need to use a Handler to hop over there.
         */
        public void valueChanged(int value) {
            mHandler.sendMessage(mHandler.obtainMessage(BUMP_MSG, value, 0));
        }
    };

    private static final int BUMP_MSG = 1;

    private Handler mHandler = new Handler() {
        @Override public void handleMessage(Message msg) {
            switch (msg.what) {
                case BUMP_MSG:
                    mCallbackText.setText("Received from service: " + msg.arg1);
                    break;
                default:
                    super.handleMessage(msg);
            }
        }

    };
}</pre>
</div>
<h1>Content Providers</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <!-- In this document -->
   <h2>
    Topics
   </h2>
   <ol>
    <li>
     <a href="/guide/topics/providers/content-provider-basics.html">
      Content Provider Basics
     </a>
    </li>
    <li>
     <a href="/guide/topics/providers/content-provider-creating.html">
      Creating a Content Provider
     </a>
    </li>
    <li>
     <a href="/guide/topics/providers/calendar-provider.html">
      Calendar Provider
     </a>
    </li>
    <li>
     <a href="/guide/topics/providers/contacts-provider.html">
      Contacts Provider
     </a>
    </li>
   </ol>
   <!-- Related Samples -->
   <h2>
    Related Samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/ContactManager/index.html">
      Contact Manager
     </a>
     application
    </li>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/view/List2.html">
      "Cursor (People)"
     </a>
    </li>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/view/List7.html">
      "Cursor (Phones)"
     </a>
    </li>
    <li>
     <a href="/resources/samples/SampleSyncAdapter/index.html">
      Sample Sync Adapter
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  Content providers manage access to a structured set of data. They encapsulate the
    data, and provide mechanisms for defining data security. Content providers are the standard
    interface that connects data in one process with code running in another process.
 </p>
 <p>
  When you want to access data in a content provider, you use the
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  object in your
    application's
  <code>
   <a href="/reference/android/content/Context.html">
    Context
   </a>
  </code>
  to communicate with the provider as a client.
    The
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  object communicates with the provider object, an
    instance of a class that implements
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  . The provider
    object receives data requests from clients, performs the requested action, and
    returns the results.
 </p>
 <p>
  You don't need to develop your own provider if you don't intend to share your data with
    other applications. However, you do need your own provider to provide custom search
    suggestions in your own application. You also need your own provider if you want to copy and
    paste complex data or files from your application to other applications.
 </p>
 <p>
  Android itself includes content providers that manage data such as audio, video, images, and
    personal contact information. You can see some of them listed in the reference
    documentation for the
  <code>
   <a href="/reference/android/provider/package-summary.html">
    android.provider
   </a>
  </code>
  package. With some restrictions, these providers are accessible to any Android
    application.
 </p>
 <p>
  The following topics describe content providers in more detail:
 </p>
 <dl>
  <dt>
   <strong>
    <a href="/guide/topics/providers/content-provider-basics.html">
     Content Provider Basics
    </a>
   </strong>
  </dt>
  <dd>
   How to access data in a content provider when the data is organized in tables.
  </dd>
  <dt>
   <strong>
    <a href="/guide/topics/providers/content-provider-creating.html">
     Creating a Content Provider
    </a>
   </strong>
  </dt>
  <dd>
   How to create your own content provider.
  </dd>
  <dt>
   <strong>
    <a href="/guide/topics/providers/calendar-provider.html">
     Calendar Provider
    </a>
   </strong>
  </dt>
  <dd>
   How to access the Calendar Provider that is part of the Android platform.
  </dd>
  <dt>
   <strong>
    <a href="/guide/topics/providers/contacts-provider.html">
     Contacts Provider
    </a>
   </strong>
  </dt>
  <dd>
   How to access the Contacts Provider that is part of the Android platform.
  </dd>
 </dl>
</div>
<h1>Content Provider Basics</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <!-- In this document -->
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Basics">
      Overview
     </a>
     <ol>
      <li>
       <a href="#ClientProvider">
        Accessing a provider
       </a>
      </li>
      <li>
       <a href="#ContentURIs">
        Content URIs
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#SimpleQuery">
      Retrieving Data from the Provider
     </a>
     <ol>
      <li>
       <a href="#RequestPermissions">
        Requesting read access permission
       </a>
      </li>
      <li>
       <a href="#Query">
        Constructing the query
       </a>
      </li>
      <li>
       <a href="#DisplayResults">
        Displaying query results
       </a>
      </li>
      <li>
       <a href="#GettingResults">
        Getting data from query results
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Permissions">
      Content Provider Permissions
     </a>
    </li>
    <li>
     <a href="#Modifications">
      Inserting, Updating, and Deleting Data
     </a>
     <ol>
      <li>
       <a href="#Inserting">
        Inserting data
       </a>
      </li>
      <li>
       <a href="#Updating">
        Updating data
       </a>
      </li>
      <li>
       <a href="#Deleting">
        Deleting data
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#DataTypes">
      Provider Data Types
     </a>
    </li>
    <li>
     <a href="#AltForms">
      Alternative Forms of Provider Access
     </a>
     <ol>
      <li>
       <a href="#Batch">
        Batch access
       </a>
      </li>
      <li>
       <a href="#Intents">
        Data access via intents
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#ContractClasses">
      Contract Classes
     </a>
    </li>
    <li>
     <a href="#MIMETypeReference">
      MIME Type Reference
     </a>
    </li>
   </ol>
   <!-- Key Classes -->
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/content/ContentProvider.html">
       ContentProvider
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/content/ContentResolver.html">
       ContentResolver
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/database/Cursor.html">
       Cursor
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
    </li>
   </ol>
   <!-- Related Samples -->
   <h2>
    Related Samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/view/List2.html">
      Cursor (People)
     </a>
    </li>
    <li>
     <a href="/resources/samples/ApiDemos/src/com/example/android/apis/view/List7.html">
      Cursor (Phones)
     </a>
    </li>
   </ol>
   <!-- See also -->
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/topics/providers/content-provider-creating.html">
      Creating a Content Provider
     </a>
    </li>
    <li>
     <a href="/guide/topics/providers/calendar-provider.html">
      Calendar Provider
     </a>
    </li>
   </ol>
  </div>
 </div>
 <!-- Intro paragraphs -->
 <p>
  A content provider manages access to a central repository of data. A provider
    is part of an Android application, which often provides its own UI for working with
    the data. However, content providers are primarily intended to be used by other
    applications, which access the provider using a provider client object. Together, providers
    and provider clients offer a consistent, standard interface to data that also handles
    inter-process communication and secure data access.
 </p>
 <p>
  This topic describes the basics of the following:
 </p>
 <ul>
  <li>
   How content providers work.
  </li>
  <li>
   The API you use retrieve data from a content provider.
  </li>
  <li>
   The API you use to insert, update, or delete data in a content provider.
  </li>
  <li>
   Other API features that facilitate working with providers.
  </li>
 </ul>
 <!-- Basics -->
 <h2 id="Basics">
  Overview
 </h2>
 <p>
  A content provider presents data to external applications as one or more tables that are
    similar to the tables found in a relational database. A row represents an instance of some type
    of data the provider collects, and each column in the row represents an individual piece of
    data collected for an instance.
 </p>
 <p>
  For example, one of the built-in providers in the Android platform is the user dictionary, which
    stores the spellings of non-standard words that the user wants to keep. Table 1 illustrates what
    the data might look like in this provider's table:
 </p>
 <p class="table-caption">
  <strong>
   Table 1:
  </strong>
  Sample user dictionary table.
 </p>
 <table id="table1" style="width: 50%;">
  <tr>
   <th align="center" scope="col" style="width:20%">
    word
   </th>
   <th align="center" scope="col" style="width:20%">
    app id
   </th>
   <th align="center" scope="col" style="width:20%">
    frequency
   </th>
   <th align="center" scope="col" style="width:20%">
    locale
   </th>
   <th align="center" scope="col" style="width:20%">
    _ID
   </th>
  </tr>
  <tr>
   <td align="center" scope="row">
    mapreduce
   </td>
   <td align="center">
    user1
   </td>
   <td align="center">
    100
   </td>
   <td align="center">
    en_US
   </td>
   <td align="center">
    1
   </td>
  </tr>
  <tr>
   <td align="center" scope="row">
    precompiler
   </td>
   <td align="center">
    user14
   </td>
   <td align="center">
    200
   </td>
   <td align="center">
    fr_FR
   </td>
   <td align="center">
    2
   </td>
  </tr>
  <tr>
   <td align="center" scope="row">
    applet
   </td>
   <td align="center">
    user2
   </td>
   <td align="center">
    225
   </td>
   <td align="center">
    fr_CA
   </td>
   <td align="center">
    3
   </td>
  </tr>
  <tr>
   <td align="center" scope="row">
    const
   </td>
   <td align="center">
    user1
   </td>
   <td align="center">
    255
   </td>
   <td align="center">
    pt_BR
   </td>
   <td align="center">
    4
   </td>
  </tr>
  <tr>
   <td align="center" scope="row">
    int
   </td>
   <td align="center">
    user5
   </td>
   <td align="center">
    100
   </td>
   <td align="center">
    en_UK
   </td>
   <td align="center">
    5
   </td>
  </tr>
 </table>
 <p>
  In table 1, each row represents an instance of a word that might not be
    found in a standard dictionary. Each column represents some data for that word, such as the
    locale in which it was first encountered. The column headers are column names that are stored in
    the provider. To refer to a row's locale, you refer to its
  <code>
   locale
  </code>
  column. For
    this provider, the
  <code>
   _ID
  </code>
  column serves as a "primary key" column that
    the provider automatically maintains.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  A provider isn't required to have a primary key, and it isn't required
    to use
  <code>
   _ID
  </code>
  as the column name of a primary key if one is present. However,
    if you want to bind data from a provider to a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  , one of the
    column names has to be
  <code>
   _ID
  </code>
  . This requirement is explained in more detail in the
    section
  <a href="#DisplayResults">
   Displaying query results
  </a>
  .
 </p>
 <h3 id="ClientProvider">
  Accessing a provider
 </h3>
 <p>
  An application accesses the data from a content provider with
    a
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  client object. This object has methods that call
    identically-named methods in the provider object, an instance of one of the concrete
    subclasses of
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  . The
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  methods provide the basic
    "CRUD" (create, retrieve, update, and delete) functions of persistent storage.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  object in the client application's
    process and the
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  object in the application that owns
    the provider automatically handle inter-process communication.
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  also acts as an abstraction layer between its
    repository of data and the external appearance of data as tables.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  To access a provider, your application usually has to request specific
    permissions in its manifest file. This is described in more detail in the section
  <a href="#Permissions">
   Content Provider Permissions
  </a>
 </p>
 <p>
  For example, to get a list of the words and their locales from the User Dictionary Provider,
    you call
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentResolver.query()
   </a>
  </code>
  .
    The
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    query()
   </a>
  </code>
  method calls the
  <code>
   <a href="/reference/android/content/ContentProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentProvider.query()
   </a>
  </code>
  method defined by the 
    User Dictionary Provider. The following lines of code show a
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentResolver.query()
   </a>
  </code>
  call:
 </p>
 <p>
 </p>
 <pre>
// Queries the user dictionary and returns results
mCursor = getContentResolver().query(
    UserDictionary.Words.CONTENT_URI,   // The content URI of the words table
    mProjection,                        // The columns to return for each row
    mSelectionClause                    // Selection criteria
    mSelectionArgs,                     // Selection criteria
    mSortOrder);                        // The sort order for the returned rows
</pre>
 <p>
  Table 2 shows how the arguments to
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    query(Uri,projection,selection,selectionArgs,sortOrder)
   </a>
  </code>
  match an SQL SELECT statement:
 </p>
 <p class="table-caption">
  <strong>
   Table 2:
  </strong>
  Query() compared to SQL query.
 </p>
 <table id="table2" style="width: 75%;">
  <tr>
   <th align="center" scope="col" style="width:25%">
    query() argument
   </th>
   <th align="center" scope="col" style="width:25%">
    SELECT keyword/parameter
   </th>
   <th align="center" scope="col" style="width:50%">
    Notes
   </th>
  </tr>
  <tr>
   <td align="center">
    <code>
     Uri
    </code>
   </td>
   <td align="center">
    <code>
     FROM
     <em>
      table_name
     </em>
    </code>
   </td>
   <td>
    <code>
     Uri
    </code>
    maps to the table in the provider named
    <em>
     table_name
    </em>
    .
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     projection
    </code>
   </td>
   <td align="center">
    <code>
     <em>
      col,col,col,...
     </em>
    </code>
   </td>
   <td>
    <code>
     projection
    </code>
    is an array of columns that should be included for each row
            retrieved.
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     selection
    </code>
   </td>
   <td align="center">
    <code>
     WHERE
     <em>
      col
     </em>
     =
     <em>
      value
     </em>
    </code>
   </td>
   <td>
    <code>
     selection
    </code>
    specifies the criteria for selecting rows.
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     selectionArgs
    </code>
   </td>
   <td align="center">
    (No exact equivalent. Selection arguments replace
    <code>
     ?
    </code>
    placeholders in the
            selection clause.)
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     sortOrder
    </code>
   </td>
   <td align="center">
    <code>
     ORDER BY
     <em>
      col,col,...
     </em>
    </code>
   </td>
   <td>
    <code>
     sortOrder
    </code>
    specifies the order in which rows appear in the returned
    <code>
     <a href="/reference/android/database/Cursor.html">
      Cursor
     </a>
    </code>
    .
   </td>
  </tr>
 </table>
 <h3 id="ContentURIs">
  Content URIs
 </h3>
 <p>
  A
  <strong>
   content URI
  </strong>
  is a URI that identifies data in a provider. Content URIs
    include the symbolic name of the entire provider (its
  <strong>
   authority
  </strong>
  ) and a
    name that points to a table (a
  <strong>
   path
  </strong>
  ). When you call
    a client method to access a table in a provider, the content URI for the table is one of
    the arguments.
 </p>
 <p>
  In the preceding lines of code, the constant
  <code>
   <a href="/reference/android/provider/UserDictionary.Words.html#CONTENT_URI">
    CONTENT_URI
   </a>
  </code>
  contains the content URI of
    the user dictionary's "words" table. The
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  object parses out the URI's authority, and uses it to "resolve" the provider by
    comparing the authority to a system table of known providers. The
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  can then dispatch the query arguments to the correct
    provider.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  uses the path part of the content URI to choose the
    table to access. A provider usually has a
  <strong>
   path
  </strong>
  for each table it exposes.
 </p>
 <p>
  In the previous lines of code, the full URI for the "words" table is:
 </p>
 <pre>
content://user_dictionary/words
</pre>
 <p>
  where the
  <code>
   user_dictionary
  </code>
  string is the provider's authority, and
  <code>
   words
  </code>
  string is the table's path. The string
  <code>
   content://
  </code>
  (the
  <strong>
   scheme
  </strong>
  ) is always present,
    and identifies this as a content URI.
 </p>
 <p>
  Many providers allow you to access a single row in a table by appending an ID value
    to the end of the URI. For example, to retrieve a row whose
  <code>
   _ID
  </code>
  is
  <code>
   4
  </code>
  from user dictionary, you can use this content URI:
 </p>
 <pre>
Uri singleUri = ContentUris.withAppendedId(UserDictionary.Words.CONTENT_URI,4);
</pre>
 <p>
  You often use id values when you've retrieved a set of rows and then want to update or delete
    one of them.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  The
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/net/Uri.Builder.html">
    Uri.Builder
   </a>
  </code>
  classes
    contain convenience methods for constructing well-formed Uri objects from strings. The
  <code>
   <a href="/reference/android/content/ContentUris.html">
    ContentUris
   </a>
  </code>
  contains convenience methods for appending id values to
    a URI. The previous snippet uses
  <code>
   <a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">
    withAppendedId()
   </a>
  </code>
  to append an id to the UserDictionary content URI.
 </p>
 <!-- Retrieving Data from the Provider -->
 <h2 id="SimpleQuery">
  Retrieving Data from the Provider
 </h2>
 <p>
  This section describes how to retrieve data from a provider, using the User Dictionary Provider
    as an example.
 </p>
 <p class="note">
  For the sake of clarity, the code snippets in this section call
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentResolver.query()
   </a>
  </code>
  on the "UI thread"". In 
    actual code, however, you should do queries asynchronously on a separate thread. One way to do 
    this is to use the
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  class, which is described
    in more detail in the
  <a href="/guide/components/loaders.html">
   Loaders
  </a>
  guide. Also, the lines of code are snippets only; they don't show a complete
    application.
 </p>
 <p>
  To retrieve data from a provider, follow these basic steps:
 </p>
 <ol>
  <li>
   Request the read access permission for the provider.
  </li>
  <li>
   Define the code that sends a query to the provider.
  </li>
 </ol>
 <h3 id="RequestPermissions">
  Requesting read access permission
 </h3>
 <p>
  To retrieve data from a provider, your application needs "read access permission" for the
    provider. You can't request this permission at run-time; instead, you have to specify that
    you need this permission in your manifest, using the
  <code>
   <a href="/guide/topics/manifest/uses-permission-element.html">
    &lt;uses-permission&gt;
   </a>
  </code>
  element and the exact permission name defined by the
    provider. When you specify this element in your manifest, you are in effect "requesting" this
    permission for your application. When users install your application, they implicitly grant
    this request.
 </p>
 <p>
  To find the exact name of the read access permission for the provider you're using, as well
    as the names for other access permissions used by the provider, look in the provider's
    documentation.
 </p>
 <p>
  The role of permissions in accessing providers is described in more detail in the section
  <a href="#Permissions">
   Content Provider Permissions
  </a>
  .
 </p>
 <p>
  The User Dictionary Provider defines the permission
  <code>
   android.permission.READ_USER_DICTIONARY
  </code>
  in its manifest file, so an
    application that wants to read from the provider must request this permission.
 </p>
 <!-- Constructing the query -->
 <h3 id="Query">
  Constructing the query
 </h3>
 <p>
  The next step in retrieving data a provider is to construct a query. This first snippet
    defines some variables for accessing the User Dictionary Provider:
 </p>
 <pre class="prettyprint">

// A "projection" defines the columns that will be returned for each row
String[] mProjection =
{
    UserDictionary.Words._ID,    // Contract class constant for the _ID column name
    UserDictionary.Words.WORD,   // Contract class constant for the word column name
    UserDictionary.Words.LOCALE  // Contract class constant for the locale column name
};

// Defines a string to contain the selection clause
String mSelectionClause = null;

// Initializes an array to contain selection arguments
String[] mSelectionArgs = {""};

</pre>
 <p>
  The next snippet shows how to use
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentResolver.query()
   </a>
  </code>
  , using the User Dictionary
    Provider as an example. A provider client query is similar to an SQL query, and it contains a 
    set of columns to return, a set of selection criteria, and a sort order.
 </p>
 <p>
  The set of columns that the query should return is called a
  <strong>
   projection
  </strong>
  (the variable
  <code>
   mProjection
  </code>
  ).
 </p>
 <p>
  The expression that specifies the rows to retrieve is split into a selection clause and
    selection arguments. The selection clause is a combination of logical and Boolean expressions,
    column names, and values (the variable
  <code>
   mSelectionClause
  </code>
  ). If you specify the 
    replaceable parameter
  <code>
   ?
  </code>
  instead of a value, the query method retrieves the value 
    from the selection arguments array (the variable
  <code>
   mSelectionArgs
  </code>
  ).
 </p>
 <p>
  In the next snippet, if the user doesn't enter a word, the selection clause is set to
  <code>
   null
  </code>
  , and the query returns all the words in the provider. If the user enters
    a word, the selection clause is set to
  <code>
   UserDictionary.Words.WORD + " = ?"
  </code>
  and
    the first element of selection arguments array is set to the word the user enters.
 </p>
 <pre class="prettyprint">
/*
 * This defines a one-element String array to contain the selection argument.
 */
String[] mSelectionArgs = {""};

// Gets a word from the UI
mSearchString = mSearchWord.getText().toString();

// Remember to insert code here to check for invalid or malicious input.

// If the word is the empty string, gets everything
if (TextUtils.isEmpty(mSearchString)) {
    // Setting the selection clause to null will return all words
    mSelectionClause = null;
    mSelectionArgs[0] = "";

} else {
    // Constructs a selection clause that matches the word that the user entered.
    mSelectionClause = UserDictionary.Words.WORD + " = ?";

    // Moves the user's input string to the selection arguments.
    mSelectionArgs[0] = mSearchString;

}

// Does a query against the table and returns a Cursor object
mCursor = getContentResolver().query(
    UserDictionary.Words.CONTENT_URI,  // The content URI of the words table
    mProjection,                       // The columns to return for each row
    mSelectionClause                   // Either null, or the word the user entered
    mSelectionArgs,                    // Either empty, or the string the user entered
    mSortOrder);                       // The sort order for the returned rows

// Some providers return null if an error occurs, others throw an exception
if (null == mCursor) {
    /*
     * Insert code here to handle the error. Be sure not to use the cursor! You may want to
     * call android.util.Log.e() to log this error.
     *
     */
// If the Cursor is empty, the provider found no matches
} else if (mCursor.getCount() &lt; 1) {

    /*
     * Insert code here to notify the user that the search was unsuccessful. This isn't necessarily
     * an error. You may want to offer the user the option to insert a new row, or re-type the
     * search term.
     */

} else {
    // Insert code here to do something with the results

}
</pre>
 <p>
  This query is analogous to the SQL statement:
 </p>
 <pre>
SELECT _ID, word, locale FROM words WHERE word = &lt;userinput&gt; ORDER BY word ASC;
</pre>
 <p>
  In this SQL statement, the actual column names are used instead of contract class constants.
 </p>
 <h4 id="Injection">
  Protecting against malicious input
 </h4>
 <p>
  If the data managed by the content provider is in an SQL database, including external untrusted
    data into raw SQL statements can lead to SQL injection.
 </p>
 <p>
  Consider this selection clause:
 </p>
 <pre>
// Constructs a selection clause by concatenating the user's input to the column name
String mSelectionClause =  "var = " + mUserInput;
</pre>
 <p>
  If you do this, you're allowing the user to concatenate malicious SQL onto your SQL statement.
    For example, the user could enter "nothing; DROP TABLE *;"  for
  <code>
   mUserInput
  </code>
  , which
    would result in the selection clause
  <code>
   var = nothing; DROP TABLE *;
  </code>
  . Since the
    selection clause is treated as an SQL statement, this might cause the provider to erase all of
    the tables in the underlying SQLite database (unless the provider is set up to catch
  <a href="http://en.wikipedia.org/wiki/SQL_injection">
   SQL injection
  </a>
  attempts).
 </p>
 <p>
  To avoid this problem, use a selection clause that uses
  <code>
   ?
  </code>
  as a replaceable
    parameter and a separate array of selection arguments. When you do this, the user input
    is bound directly to the query rather than being interpreted as part of an SQL statement.
    Because it's not treated as SQL, the user input can't inject malicious SQL. Instead of using
    concatenation to include the user input, use this selection clause:
 </p>
 <pre>
// Constructs a selection clause with a replaceable parameter
String mSelectionClause =  "var = ?";
</pre>
 <p>
  Set up the array of selection arguments like this:
 </p>
 <pre>
// Defines an array to contain the selection arguments
String[] selectionArgs = {""};
</pre>
 <p>
  Put a value in the selection arguments array like this:
 </p>
 <pre>
// Sets the selection argument to the user's input
selectionArgs[0] = mUserInput;
</pre>
 <p>
  A selection clause that uses
  <code>
   ?
  </code>
  as a replaceable parameter and an array of
    selection arguments array are preferred way to specify a selection, even if the provider isn't
    based on an SQL database.
 </p>
 <!-- Displaying the results -->
 <h3 id="DisplayResults">
  Displaying query results
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentResolver.query()
   </a>
  </code>
  client method always 
    returns a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  containing the columns specified by the query's 
    projection for the rows that match the query's selection criteria. A
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  object provides random read access to the rows and columns it 
    contains. Using
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  methods, you can iterate over the rows in the 
    results, determine the data type of each column, get the data out of a column, and examine other
    properties of the results. Some
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  implementations automatically 
    update the object when the provider's data changes, or trigger methods in an observer object 
    when the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  changes, or both.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  A provider may restrict access to columns based on the nature of the
    object making the query. For example, the Contacts Provider restricts access for some columns to
    sync adapters, so it won't return them to an activity or service.
 </p>
 <p>
  If no rows match the selection criteria, the provider
    returns a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  object for which
  <code>
   <a href="/reference/android/database/Cursor.html#getCount()">
    Cursor.getCount()
   </a>
  </code>
  is 0 (an empty cursor).
 </p>
 <p>
  If an internal error occurs, the results of the query depend on the particular provider. It may
    choose to return
  <code>
   null
  </code>
  , or it may throw an
  <code>
   <a href="/reference/java/lang/Exception.html">
    Exception
   </a>
  </code>
  .
 </p>
 <p>
  Since a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  is a "list" of rows, a good way to display the
    contents of a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  is to link it to a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  via a
  <code>
   <a href="/reference/android/widget/SimpleCursorAdapter.html">
    SimpleCursorAdapter
   </a>
  </code>
  .
 </p>
 <p>
  The following snippet continues the code from the previous snippet. It creates a
  <code>
   <a href="/reference/android/widget/SimpleCursorAdapter.html">
    SimpleCursorAdapter
   </a>
  </code>
  object containing the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  retrieved by the query, and sets this object to be the adapter for a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  :
 </p>
 <pre class="prettyprint">
// Defines a list of columns to retrieve from the Cursor and load into an output row
String[] mWordListColumns =
{
    UserDictionary.Words.WORD,   // Contract class constant containing the word column name
    UserDictionary.Words.LOCALE  // Contract class constant containing the locale column name
};

// Defines a list of View IDs that will receive the Cursor columns for each row
int[] mWordListItems = { R.id.dictWord, R.id.locale};

// Creates a new SimpleCursorAdapter
mCursorAdapter = new SimpleCursorAdapter(
    getApplicationContext(),               // The application's Context object
    R.layout.wordlistrow,                  // A layout in XML for one row in the ListView
    mCursor,                               // The result from the query
    mWordListColumns,                      // A string array of column names in the cursor
    mWordListItems,                        // An integer array of view IDs in the row layout
    0);                                    // Flags (usually none are needed)

// Sets the adapter for the ListView
mWordList.setAdapter(mCursorAdapter);
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  To back a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  with a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  , the cursor must contain a column named
  <code>
   _ID
  </code>
  .
    Because of this, the query shown previously retrieves the
  <code>
   _ID
  </code>
  column for the
    "words" table, even though the
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  doesn't display it.
    This restriction also explains why most providers have a
  <code>
   _ID
  </code>
  column for each of
    their tables.
 </p>
 <!-- Getting data from query results -->
 <h3 id="GettingResults">
  Getting data from query results
 </h3>
 <p>
  Rather than simply displaying query results, you can use them for other tasks. For
    example, you can retrieve spellings from the user dictionary and then look them up in
    other providers. To do this, you iterate over the rows in the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  :
 </p>
 <pre class="prettyprint">

// Determine the column index of the column named "word"
int index = mCursor.getColumnIndex(UserDictionary.Words.WORD);

/*
 * Only executes if the cursor is valid. The User Dictionary Provider returns null if
 * an internal error occurs. Other providers may throw an Exception instead of returning null.
 */

if (mCursor != null) {
    /*
     * Moves to the next row in the cursor. Before the first movement in the cursor, the
     * "row pointer" is -1, and if you try to retrieve data at that position you will get an
     * exception.
     */
    while (mCursor.moveToNext()) {

        // Gets the value from the column.
        newWord = mCursor.getString(index);

        // Insert code here to process the retrieved word.

        ...

        // end of while loop
    }
} else {

    // Insert code here to report an error if the cursor is null or the provider threw an exception.
}
</pre>
 <p>
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  implementations contain several "get" methods for
    retrieving different types of data from the object. For example, the previous snippet
    uses
  <code>
   <a href="/reference/android/database/Cursor.html#getString(int)">
    getString()
   </a>
  </code>
  . They also have a
  <code>
   <a href="/reference/android/database/Cursor.html#getType(int)">
    getType()
   </a>
  </code>
  method that returns a value indicating
    the data type of the column.
 </p>
 <!-- Requesting permissions -->
 <h2 id="Permissions">
  Content Provider Permissions
 </h2>
 <p>
  A provider's application can specify permissions that other applications must have in order to
    access the provider's data. These permissions ensure that the user knows what data
    an application will try to access. Based on the provider's requirements, other applications
    request the permissions they need in order to access the provider. End users see the requested
    permissions when they install the application.
 </p>
 <p>
  If a provider's application doesn't specify any permissions, then other applications have no
    access to the provider's data. However, components in the provider's application always have
    full read and write access, regardless of the specified permissions.
 </p>
 <p>
  As noted previously, the User Dictionary Provider requires the
  <code>
   android.permission.READ_USER_DICTIONARY
  </code>
  permission to retrieve data from it.
    The provider has the separate
  <code>
   android.permission.WRITE_USER_DICTIONARY
  </code>
  permission for inserting, updating, or deleting data.
 </p>
 <p>
  To get the permissions needed to access a provider, an application requests them with a
  <code>
   <a href="/guide/topics/manifest/uses-permission-element.html">
    &lt;uses-permission&gt;
   </a>
  </code>
  element in its manifest file. When the Android Package Manager installs the application, a user 
    must approve all of the permissions the application requests. If the user approves all of them, 
    Package Manager continues the installation; if the user doesn't approve them, Package Manager
    aborts the installation.
 </p>
 <p>
  The following
  <code>
   <a href="/guide/topics/manifest/uses-permission-element.html">
    &lt;uses-permission&gt;
   </a>
  </code>
  element requests read access to the User Dictionary Provider:
 </p>
 <pre>
    &lt;uses-permission android:name="android.permission.READ_USER_DICTIONARY"&gt;
</pre>
 <p>
  The impact of permissions on provider access is explained in more detail in the
  <a href="/guide/topics/security/security.html">
   Security and Permissions
  </a>
  guide.
 </p>
 <!-- Inserting, Updating, and Deleting Data -->
 <h2 id="Modifications">
  Inserting, Updating, and Deleting Data
 </h2>
 <p>
  In the same way that you retrieve data from a provider, you also use the interaction between
    a provider client and the provider's
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  to modify data.
    You call a method of
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  with arguments that are passed to
    the corresponding method of
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  . The provider and provider
    client automatically handle security and inter-process communication.
 </p>
 <h3 id="Inserting">
  Inserting data
 </h3>
 <p>
  To insert data into a provider, you call the
  <code>
   <a href="/reference/android/content/ContentResolver.html#insert(android.net.Uri, android.content.ContentValues)">
    ContentResolver.insert()
   </a>
  </code>
  method. This method inserts a new row into the provider and returns a content URI for that row.
    This snippet shows how to insert a new word into the User Dictionary Provider:
 </p>
 <pre class="prettyprint">
// Defines a new Uri object that receives the result of the insertion
Uri mNewUri;

...

// Defines an object to contain the new values to insert
ContentValues mNewValues = new ContentValues();

/*
 * Sets the values of each column and inserts the word. The arguments to the "put"
 * method are "column name" and "value"
 */
mNewValues.put(UserDictionary.Words.APP_ID, "example.user");
mNewValues.put(UserDictionary.Words.LOCALE, "en_US");
mNewValues.put(UserDictionary.Words.WORD, "insert");
mNewValues.put(UserDictionary.Words.FREQUENCY, "100");

mNewUri = getContentResolver().insert(
    UserDictionary.Word.CONTENT_URI,   // the user dictionary content URI
    mNewValues                          // the values to insert
);
</pre>
 <p>
  The data for the new row goes into a single
  <code>
   <a href="/reference/android/content/ContentValues.html">
    ContentValues
   </a>
  </code>
  object, which
    is similar in form to a one-row cursor. The columns in this object don't need to have the
    same data type, and if you don't want to specify a value at all, you can set a column
    to
  <code>
   null
  </code>
  using
  <code>
   <a href="/reference/android/content/ContentValues.html#putNull(java.lang.String)">
    ContentValues.putNull()
   </a>
  </code>
  .
 </p>
 <p>
  The snippet doesn't add the
  <code>
   _ID
  </code>
  column, because this column is maintained
    automatically. The provider assigns a unique value of
  <code>
   _ID
  </code>
  to every row that is
    added. Providers usually use this value as the table's primary key.
 </p>
 <p>
  The content URI returned in
  <code>
   newUri
  </code>
  identifies the newly-added row, with
    the following format:
 </p>
 <pre>
content://user_dictionary/words/&lt;id_value&gt;
</pre>
 <p>
  The
  <code>
   &lt;id_value&gt;
  </code>
  is the contents of
  <code>
   _ID
  </code>
  for the new row.
    Most providers can detect this form of content URI automatically and then perform the requested
    operation on that particular row.
 </p>
 <p>
  To get the value of
  <code>
   _ID
  </code>
  from the returned
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  , call
  <code>
   <a href="/reference/android/content/ContentUris.html#parseId(android.net.Uri)">
    ContentUris.parseId()
   </a>
  </code>
  .
 </p>
 <h3 id="Updating">
  Updating data
 </h3>
 <p>
  To update a row, you use a
  <code>
   <a href="/reference/android/content/ContentValues.html">
    ContentValues
   </a>
  </code>
  object with the updated
    values just as you do with an insertion, and selection criteria just as you do with a query.
    The client method you use is
  <code>
   <a href="/reference/android/content/ContentResolver.html#update(android.net.Uri, android.content.ContentValues, java.lang.String, java.lang.String[])">
    ContentResolver.update()
   </a>
  </code>
  . You only need to add 
    values to the
  <code>
   <a href="/reference/android/content/ContentValues.html">
    ContentValues
   </a>
  </code>
  object for columns you're updating. If you 
    want to clear the contents of a column, set the value to
  <code>
   null
  </code>
  .
 </p>
 <p>
  The following snippet changes all the rows whose locale has the language "en" to a
    have a locale of
  <code>
   null
  </code>
  . The return value is the number of rows that were updated:
 </p>
 <pre>
// Defines an object to contain the updated values
ContentValues mUpdateValues = new ContentValues();

// Defines selection criteria for the rows you want to update
String mSelectionClause = UserDictionary.Words.LOCALE +  "LIKE ?";
String[] mSelectionArgs = {"en_%"};

// Defines a variable to contain the number of updated rows
int mRowsUpdated = 0;

...

/*
 * Sets the updated value and updates the selected words.
 */
mUpdateValues.putNull(UserDictionary.Words.LOCALE);

mRowsUpdated = getContentResolver().update(
    UserDictionary.Words.CONTENT_URI,   // the user dictionary content URI
    mUpdateValues                       // the columns to update
    mSelectionClause                    // the column to select on
    mSelectionArgs                      // the value to compare to
);
</pre>
 <p>
  You should also sanitize user input when you call
  <code>
   <a href="/reference/android/content/ContentResolver.html#update(android.net.Uri, android.content.ContentValues, java.lang.String, java.lang.String[])">
    ContentResolver.update()
   </a>
  </code>
  . To learn more about 
    this, read the section
  <a href="#Injection">
   Protecting against malicious input
  </a>
  .
 </p>
 <h3 id="Deleting">
  Deleting data
 </h3>
 <p>
  Deleting rows is similar to retrieving row data: you specify selection criteria for the rows
    you want to delete and the client method returns the number of deleted rows.
    The following snippet deletes rows whose appid matches "user". The method returns the
    number of deleted rows.
 </p>
 <pre>

// Defines selection criteria for the rows you want to delete
String mSelectionClause = UserDictionary.Words.APP_ID + " LIKE ?";
String[] mSelectionArgs = {"user"};

// Defines a variable to contain the number of rows deleted
int mRowsDeleted = 0;

...

// Deletes the words that match the selection criteria
mRowsDeleted = getContentResolver().delete(
    UserDictionary.Words.CONTENT_URI,   // the user dictionary content URI
    mSelectionClause                    // the column to select on
    mSelectionArgs                      // the value to compare to
);
</pre>
 <p>
  You should also sanitize user input when you call
  <code>
   <a href="/reference/android/content/ContentResolver.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">
    ContentResolver.delete()
   </a>
  </code>
  . To learn more about 
    this, read the section
  <a href="#Injection">
   Protecting against malicious input
  </a>
  .
 </p>
 <!-- Provider Data Types -->
 <h2 id="DataTypes">
  Provider Data Types
 </h2>
 <p>
  Content providers can offer many different data types. The User Dictionary Provider offers only
    text, but providers can also offer the following formats:
 </p>
 <ul>
  <li>
   integer
  </li>
  <li>
   long integer (long)
  </li>
  <li>
   floating point
  </li>
  <li>
   long floating point (double)
  </li>
 </ul>
 <p>
  Another data type that providers often use is Binary Large OBject (BLOB) implemented as a
    64KB byte array. You can see the available data types by looking at the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  class "get" methods.
 </p>
 <p>
  The data type for each column in a provider is usually listed in its documentation.
    The data types for the User Dictionary Provider are listed in the reference documentation
    for its contract class
  <code>
   <a href="/reference/android/provider/UserDictionary.Words.html">
    UserDictionary.Words
   </a>
  </code>
  (contract classes are
    described in the section
  <a href="#ContractClasses">
   Contract Classes
  </a>
  ).
    You can also determine the data type by calling
  <code>
   <a href="/reference/android/database/Cursor.html#getType(int)">
    Cursor.getType()
   </a>
  </code>
  .
 </p>
 <p>
  Providers also maintain MIME data type information for each content URI they define. You can
    use the MIME type information to find out if your application can handle data that the
    provider offers, or to choose a type of handling based on the MIME type. You usually need the
    MIME type when you are working with a provider that contains complex
    data structures or files. For example, the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table in the Contacts Provider uses MIME types to label the type of contact data stored in each
    row. To get the MIME type corresponding to a content URI, call
  <code>
   <a href="/reference/android/content/ContentResolver.html#getType(android.net.Uri)">
    ContentResolver.getType()
   </a>
  </code>
  .
 </p>
 <p>
  The section
  <a href="#MIMETypeReference">
   MIME Type Reference
  </a>
  describes the
    syntax of both standard and custom MIME types.
 </p>
 <!-- Alternative Forms of Provider Access -->
 <h2 id="AltForms">
  Alternative Forms of Provider Access
 </h2>
 <p>
  Three alternative forms of provider access are important in application development:
 </p>
 <ul>
  <li>
   <a href="#Batch">
    Batch access
   </a>
   : You can create a batch of access calls with methods in
        the
   <code>
    <a href="/reference/android/content/ContentProviderOperation.html">
     ContentProviderOperation
    </a>
   </code>
   class, and then apply them with
   <code>
    <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
     ContentResolver.applyBatch()
    </a>
   </code>
   .
  </li>
  <li>
   Asynchronous queries: You should do queries in a separate thread. One way to do this is to
        use a
   <code>
    <a href="/reference/android/content/CursorLoader.html">
     CursorLoader
    </a>
   </code>
   object. The examples in the
   <a href="/guide/components/loaders.html">
    Loaders
   </a>
   guide demonstrate
        how to do this.
  </li>
  <li>
   <a href="#Intents">
    Data access via intents
   </a>
   : Although you can't send an intent
        directly to a provider, you can send an intent to the provider's application, which is
        usually the best-equipped to modify the provider's data.
  </li>
 </ul>
 <p>
  Batch access and modification via intents are described in the following sections.
 </p>
 <h3 id="Batch">
  Batch access
 </h3>
 <p>
  Batch access to a provider is useful for inserting a large number of rows, or for inserting
    rows in multiple tables in the same method call, or in general for performing a set of
    operations across process boundaries as a transaction (an atomic operation).
 </p>
 <p>
  To access a provider in "batch mode",
    you create an array of
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  objects and then
    dispatch them to a content provider with
  <code>
   <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
    ContentResolver.applyBatch()
   </a>
  </code>
  . You pass the 
    content provider's
  <em>
   authority
  </em>
  to this  method, rather than a particular content URI. 
    This allows each
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  object in the array to work 
    against a different table. A call to
  <code>
   <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
    ContentResolver.applyBatch()
   </a>
  </code>
  returns an array of results.
 </p>
 <p>
  The description of the
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  contract class
    includes a code snippet that demonstrates batch insertion. The
  <a href="/resources/samples/ContactManager/index.html">
   Contact Manager
  </a>
  sample application contains an example of batch access in its
  <code>
   ContactAdder.java
  </code>
  source file.
 </p>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h2>
    Displaying data using a helper app
   </h2>
   <p>
    If your application
    <em>
     does
    </em>
    have access permissions, you still may want to use an
    intent to display data in another application. For example, the Calendar application accepts an
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_VIEW">
      ACTION_VIEW
     </a>
    </code>
    intent, which displays a particular date or event.
    This allows you to display calendar information without having to create your own UI.
    To learn more about this feature, see the
    <a href="/guide/topics/providers/calendar-provider.html">
     Calendar Provider
    </a>
    guide.
   </p>
   <p>
    The application to which you send the intent doesn't have to be the application
    associated with the provider. For example, you can retrieve a contact from the
    Contact Provider, then send an
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_VIEW">
      ACTION_VIEW
     </a>
    </code>
    intent
    containing the content URI for the contact's image to an image viewer.
   </p>
  </div>
 </div>
 <h3 id="Intents">
  Data access via intents
 </h3>
 <p>
  Intents can provide indirect access to a content provider. You allow the user to access
    data in a provider even if your application doesn't have access permissions, either by
    getting a result intent back from an application that has permissions, or by activating an
    application that has permissions and letting the user do work in it.
 </p>
 <h4>
  Getting access with temporary permissions
 </h4>
 <p>
  You can access data in a content provider, even if you don't have the proper access
    permissions, by sending an intent to an application that does have the permissions and
    receiving back a result intent containing "URI" permissions.
    These are permissions for a specific content URI that last until the activity that receives
    them is finished. The application that has permanent permissions grants temporary
    permissions by setting a flag in the result intent:
 </p>
 <ul>
  <li>
   <strong>
    Read permission:
   </strong>
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_GRANT_READ_URI_PERMISSION">
     FLAG_GRANT_READ_URI_PERMISSION
    </a>
   </code>
  </li>
  <li>
   <strong>
    Write permission:
   </strong>
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_GRANT_WRITE_URI_PERMISSION">
     FLAG_GRANT_WRITE_URI_PERMISSION
    </a>
   </code>
  </li>
 </ul>
 <p class="note">
  <strong>
   Note:
  </strong>
  These flags don't give general read or write access to the provider
    whose authority is contained in the content URI. The access is only for the URI itself.
 </p>
 <p>
  A provider defines URI permissions for content URIs in its manifest, using the
  <code>
   <a href="/guide/topics/manifest/provider-element.html#gprmsn">
    android:grantUriPermission
   </a>
  </code>
  attribute of the
  <code>
   <a href="/guide/topics/manifest/provider-element.html">
    &lt;provider&gt;
   </a>
  </code>
  element, as well as the
  <code>
   <a href="/guide/topics/manifest/grant-uri-permission-element.html">
    &lt;grant-uri-permission&gt;
   </a>
  </code>
  child element of the
  <code>
   <a href="/guide/topics/manifest/provider-element.html">
    &lt;provider&gt;
   </a>
  </code>
  element. The URI permissions mechanism is explained in more detail in the
  <a href="/guide/topics/security/security.html">
   Security and Permissions
  </a>
  guide,
    in the section "URI Permissions".
 </p>
 <p>
  For example, you can retrieve data for a contact in the Contacts Provider, even if you don't
    have the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  permission. You might want to do
    this in an application that sends e-greetings to a contact on his or her birthday. Instead of
    requesting
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  , which gives you access to all of
    the user's contacts and all of their information, you prefer to let the user control which
    contacts are used by your application. To do this, you use the following process:
 </p>
 <ol>
  <li>
   Your application sends an intent containing the action
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_PICK">
     ACTION_PICK
    </a>
   </code>
   and the "contacts" MIME type
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html#CONTENT_ITEM_TYPE">
     CONTENT_ITEM_TYPE
    </a>
   </code>
   , using the
        method
   <code>
    <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
     startActivityForResult()
    </a>
   </code>
   .
  </li>
  <li>
   Because this intent matches the intent filter for the
        People app's "selection" activity, the activity will come to the foreground.
  </li>
  <li>
   In the selection activity, the user selects a
        contact to update. When this happens, the selection activity calls
   <code>
    <a href="/reference/android/app/Activity.html#setResult(int)">
     setResult(resultcode, intent)
    </a>
   </code>
   to set up a intent to give back to your application. The intent contains the content URI
        of the contact the user selected, and the "extras" flags
   <code>
    <a href="/reference/android/content/Intent.html#FLAG_GRANT_READ_URI_PERMISSION">
     FLAG_GRANT_READ_URI_PERMISSION
    </a>
   </code>
   . These flags grant URI
        permission to your app to read data for the contact pointed to by the
        content URI. The selection activity then calls
   <code>
    <a href="/reference/android/app/Activity.html#finish()">
     finish()
    </a>
   </code>
   to
        return control to your application.
  </li>
  <li>
   Your activity returns to the foreground, and the system calls your activity's
   <code>
    <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
     onActivityResult()
    </a>
   </code>
   method. This method receives the result intent created by the selection activity in
        the People app.
  </li>
  <li>
   With the content URI from the result intent, you can read the contact's data
        from the Contacts Provider, even though you didn't request permanent read access permission
        to the provider in your manifest. You can then get the contact's birthday information
        or his or her email address and then send the e-greeting.
  </li>
 </ol>
 <h4>
  Using another application
 </h4>
 <p>
  A simple way to allow the user to modify data to which you don't have access permissions is to
    activate an application that has permissions and let the user do the work there.
 </p>
 <p>
  For example, the Calendar application accepts an
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    ACTION_INSERT
   </a>
  </code>
  intent, which allows you to activate the
    application's insert UI. You can pass "extras" data in this intent, which the application
    uses to pre-populate the UI. Because recurring events have a complex syntax, the preferred
    way of inserting events into the Calendar Provider is to activate the Calendar app with an
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    ACTION_INSERT
   </a>
  </code>
  and then let the user insert the event there.
 </p>
 <!-- Contract Classes -->
 <h2 id="ContractClasses">
  Contract Classes
 </h2>
 <p>
  A contract class defines constants that help applications work with the content URIs, column
    names, intent actions, and other features of a content provider. Contract classes are not
    included automatically with a provider; the provider's developer has to define them and then
    make them available to other developers. Many of the providers included with the Android
    platform have corresponding contract classes in the package
  <code>
   <a href="/reference/android/provider/package-summary.html">
    android.provider
   </a>
  </code>
  .
 </p>
 <p>
  For example, the User Dictionary Provider has a contract class
  <code>
   <a href="/reference/android/provider/UserDictionary.html">
    UserDictionary
   </a>
  </code>
  containing content URI and column name constants. The
    content URI for the "words" table is defined in the constant
  <code>
   <a href="/reference/android/provider/UserDictionary.Words.html#CONTENT_URI">
    UserDictionary.Words.CONTENT_URI
   </a>
  </code>
  .
    The
  <code>
   <a href="/reference/android/provider/UserDictionary.Words.html">
    UserDictionary.Words
   </a>
  </code>
  class also contains column name constants,
    which are used in the example snippets in this guide. For example, a query projection can be
    defined as:
 </p>
 <pre>
String[] mProjection =
{
    UserDictionary.Words._ID,
    UserDictionary.Words.WORD,
    UserDictionary.Words.LOCALE
};
</pre>
 <p>
  Another contract class is
  <code>
   <a href="/reference/android/provider/ContactsContract.html">
    ContactsContract
   </a>
  </code>
  for the Contacts Provider.
    The reference documentation for this class includes example code snippets. One of its
    subclasses,
  <code>
   <a href="/reference/android/provider/ContactsContract.Intents.Insert.html">
    ContactsContract.Intents.Insert
   </a>
  </code>
  , is a contract
    class that contains constants for intents and intent data.
 </p>
 <!-- MIME Type Reference -->
 <h2 id="MIMETypeReference">
  MIME Type Reference
 </h2>
 <p>
  Content providers can return standard MIME media types, or custom MIME type strings, or both.
 </p>
 <p>
  MIME types have the format
 </p>
 <pre>
<em>type</em>/<em>subtype</em>
</pre>
 <p>
  For example, the well-known MIME type
  <code>
   text/html
  </code>
  has the
  <code>
   text
  </code>
  type and
    the
  <code>
   html
  </code>
  subtype. If the provider returns this type for a URI, it means that a
    query using that URI will return text containing HTML tags.
 </p>
 <p>
  Custom MIME type strings, also called "vendor-specific" MIME types, have more
    complex
  <em>
   type
  </em>
  and
  <em>
   subtype
  </em>
  values. The
  <em>
   type
  </em>
  value is always
 </p>
 <pre>
vnd.android.cursor.<strong>dir</strong>
</pre>
 <p>
  for multiple rows, or
 </p>
 <pre>
vnd.android.cursor.<strong>item</strong>
</pre>
 <p>
  for a single row.
 </p>
 <p>
  The
  <em>
   subtype
  </em>
  is provider-specific. The Android built-in providers usually have a simple
    subtype. For example, the when the Contacts application creates a row for a telephone number,
    it sets the following MIME type in the row:
 </p>
 <pre>
vnd.android.cursor.item/phone_v2
</pre>
 <p>
  Notice that the subtype value is simply
  <code>
   phone_v2
  </code>
  .
 </p>
 <p>
  Other provider developers may create their own pattern of subtypes based on the provider's
    authority and table names. For example, consider a provider that contains train timetables.
    The provider's authority is
  <code>
   com.example.trains
  </code>
  , and it contains the tables
    Line1, Line2, and Line3. In response to the content URI
 </p>
 <p>
 </p>
 <pre>
content://com.example.trains/Line1
</pre>
 <p>
  for table Line1, the provider returns the MIME type
 </p>
 <pre>
vnd.android.cursor.<strong>dir</strong>/vnd.example.line1
</pre>
 <p>
  In response to the content URI
 </p>
 <pre>
content://com.example.trains/Line2/5
</pre>
 <p>
  for row 5 in table Line2, the provider returns the MIME type
 </p>
 <pre>
vnd.android.cursor.<strong>item</strong>/vnd.example.line2
</pre>
 <p>
  Most content providers define contract class constants for the MIME types they use. The
    Contacts Provider contract class
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  ,
    for example, defines the constant
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html#CONTENT_ITEM_TYPE">
    CONTENT_ITEM_TYPE
   </a>
  </code>
  for the MIME type of
    a single raw contact row.
 </p>
 <p>
  Content URIs for single rows are described in the section
  <a href="#ContentURIs">
   Content URIs
  </a>
  .
 </p>
</div>
<h1>Creating a Content Provider</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#DataStorage">
      Designing Data Storage
     </a>
    </li>
    <li>
     <a href="#ContentURI">
      Designing Content URIs
     </a>
    </li>
    <li>
     <a href="#ContentProvider">
      Implementing the ContentProvider Class
     </a>
     <ol>
      <li>
       <a href="#RequiredAccess">
        Required Methods
       </a>
      </li>
      <li>
       <a href="#Query">
        Implementing the query() method
       </a>
      </li>
      <li>
       <a href="#Insert">
        Implementing the insert() method
       </a>
      </li>
      <li>
       <a href="#Delete">
        Implementing the delete() method
       </a>
      </li>
      <li>
       <a href="#Update">
        Implementing the update() method
       </a>
      </li>
      <li>
       <a href="#OnCreate">
        Implementing the onCreate() method
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#MIMETypes">
      Implementing Content Provider MIME Types
     </a>
     <ol>
      <li>
       <a href="#TableMIMETypes">
        MIME types for tables
       </a>
      </li>
      <li>
       <a href="#FileMIMETypes">
        MIME types for files
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#ContractClass">
      Implementing a Contract Class
     </a>
    </li>
    <li>
     <a href="#Permissions">
      Implementing Content Provider Permissions
     </a>
    </li>
    <li>
     <a href="#ProviderElement">
      The &lt;provider&gt; Element
     </a>
    </li>
    <li>
     <a href="#Intents">
      Intents and Data Access
     </a>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/content/ContentProvider.html">
       ContentProvider
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/database/Cursor.html">
       Cursor
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/net/Uri.html">
       Uri
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Related Samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/NotePad/index.html">
      Note Pad sample application
     </a>
    </li>
   </ol>
   <h2>
    See also
   </h2>
   <ol>
    <li>
     <a href="/guide/topics/providers/content-provider-basics.html">
      Content Provider Basics
     </a>
    </li>
    <li>
     <a href="/guide/topics/providers/calendar-provider.html">
      Calendar Provider
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  A content provider manages access to a central repository of data. You implement a
    provider as one or more classes in an Android application, along with elements in
    the manifest file. One of your classes implements a subclass
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  , which is the interface between your provider and
    other applications. Although content providers are meant to make data available to other
    applications, you may of course have activities in your application that allow the user
    to query and modify the data managed by your provider.
 </p>
 <p>
  The rest of this topic is a basic list of steps for building a content provider and a list
    of APIs to use.
 </p>
 <!-- Before You Start Building -->
 <h2 id="BeforeYouStart">
  Before You Start Building
 </h2>
 <p>
  Before you start building a provider, do the following:
 </p>
 <ol>
  <li>
   <strong>
    Decide if you need a content provider
   </strong>
   . You need to build a content
        provider if you want to provide one or more of the following features:
   <ul>
    <li>
     You want to offer complex data or files to other applications.
    </li>
    <li>
     You want to allow users to copy complex data from your app into other apps.
    </li>
    <li>
     You want to provide custom search suggestions using the search framework.
    </li>
   </ul>
   <p>
    You
    <em>
     don't
    </em>
    need a provider to use an SQLite database if the use is entirely within
        your own application.
   </p>
  </li>
  <li>
   If you haven't done so already, read the topic
   <a href="/guide/topics/providers/content-provider-basics.html">
    Content Provider Basics
   </a>
   to learn more about providers.
  </li>
 </ol>
 <p>
  Next, follow these steps to build your provider:
 </p>
 <ol>
  <li>
   Design the raw storage for your data. A content provider offers data in two ways:
   <dl>
    <dt>
     File data
    </dt>
    <dd>
     Data that normally goes into files, such as
                photos, audio, or videos. Store the files in your application's private
                space. In response to a request for a file from another application, your
                provider can offer a handle to the file.
    </dd>
    <dt>
     "Structured" data
    </dt>
    <dd>
     Data that normally goes into a database, array, or similar structure.
                Store the data in a form that's compatible with tables of rows and columns. A row
                represents an entity, such as a person or an item in inventory. A column represents
                some data for the entity, such a person's name or an item's price. A common way to
                store this type of data is in an SQLite database, but you can use any type of
                persistent storage. To learn more about the storage types available in the
                Android system, see the section
     <a href="#DataStorage">
      Designing Data Storage
     </a>
     .
    </dd>
   </dl>
  </li>
  <li>
   Define a concrete implementation of the
   <code>
    <a href="/reference/android/content/ContentProvider.html">
     ContentProvider
    </a>
   </code>
   class and
        its required methods. This class is the interface between your data and the rest of the
        Android system. For more information about this class, see the section
   <a href="#ContentProvider">
    Implementing the ContentProvider Class
   </a>
   .
  </li>
  <li>
   Define the provider's authority string, its content URIs, and column names. If you want
        the provider's application to handle intents, also define intent actions, extras data,
        and flags. Also define the permissions that you will require for applications that want
        to access your data. You should consider defining all of these values as constants in a
        separate contract class; later, you can expose this class to other developers. For more
        information about content URIs, see the
        section
   <a href="#ContentURI">
    Designing Content URIs
   </a>
   .
        For more information about intents, see the
        section
   <a href="#Intents">
    Intents and Data Access
   </a>
   .
  </li>
  <li>
   Add other optional pieces, such as sample data or an implementation
        of
   <code>
    <a href="/reference/android/content/AbstractThreadedSyncAdapter.html">
     AbstractThreadedSyncAdapter
    </a>
   </code>
   that can synchronize data between
        the provider and cloud-based data.
  </li>
 </ol>
 <!-- Designing Data Storage -->
 <h2 id="DataStorage">
  Designing Data Storage
 </h2>
 <p>
  A content provider is the interface to data saved in a structured format. Before you create
    the interface, you must decide how to store the data. You can store the data in any form you
    like, and then design the interface to read and write the data as necessary.
 </p>
 <p>
  These are some of the data storage technologies that are available in Android:
 </p>
 <ul>
  <li>
   The Android system includes an SQLite database API that Android's own providers use
        to store table-oriented data. The
   <code>
    <a href="/reference/android/database/sqlite/SQLiteOpenHelper.html">
     SQLiteOpenHelper
    </a>
   </code>
   class helps you create databases, and the
   <code>
    <a href="/reference/android/database/sqlite/SQLiteDatabase.html">
     SQLiteDatabase
    </a>
   </code>
   class is the base class for accessing
        databases.
   <p>
    Remember that you don't have to use a database to implement your repository. A provider
            appears externally as a set of tables, similar to a relational database, but this is
            not a requirement for the provider's internal implementation.
   </p>
  </li>
  <li>
   For storing file data, Android has a variety of file-oriented APIs.
        To learn more about file storage, read the topic
   <a href="/guide/topics/data/data-storage.html">
    Data Storage
   </a>
   . If you're
        designing a provider that offers media-related data such as music or videos, you can
        have a provider that combines table data and files.
  </li>
  <li>
   For working with network-based data, use classes in
   <code>
    <a href="/reference/java/net/package-summary.html">
     java.net
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/net/package-summary.html">
     android.net
    </a>
   </code>
   . You can also synchronize network-based data to a local data
        store such as a database, and then offer the data as tables or files.
        The
   <a href="/resources/samples/SampleSyncAdapter/index.html">
    Sample Sync Adapter
   </a>
   sample application demonstrates this type of synchronization.
  </li>
 </ul>
 <h3 id="DataDesign">
  Data design considerations
 </h3>
 <p>
  Here are some tips for designing your provider's data structure:
 </p>
 <ul>
  <li>
   Table data should always have a "primary key" column that the provider maintains
        as a unique numeric value for each row. You can use this value to link the row to related
        rows in other tables (using it as a "foreign key"). Although you can use any name
        for this column, using
   <code>
    <a href="/reference/android/provider/BaseColumns.html#_ID">
     BaseColumns._ID
    </a>
   </code>
   is the best
        choice, because linking the results of a provider query to a
   <code>
    <a href="/reference/android/widget/ListView.html">
     ListView
    </a>
   </code>
   requires one of the retrieved columns to have the name
   <code>
    _ID
   </code>
   .
  </li>
  <li>
   If you want to provide bitmap images or other very large pieces of file-oriented data, store
        the data in a file and then provide it indirectly rather than storing it directly in a
        table. If you do this, you need to tell users of your provider that they need to use a
   <code>
    <a href="/reference/android/content/ContentResolver.html">
     ContentResolver
    </a>
   </code>
   file method to access the data.
  </li>
  <li>
   Use the Binary Large OBject (BLOB) data type to store data that varies in size or has a
        varying structure. For example, you can use a BLOB column to store a
   <a href="http://code.google.com/p/protobuf">
    protocol buffer
   </a>
   or
   <a href="http://www.json.org">
    JSON structure
   </a>
   .
   <p>
    You can also use a BLOB to implement a
    <em>
     schema-independent
    </em>
    table. In
            this type of table, you define a primary key column, a MIME type column, and one or
            more generic columns as BLOB. The meaning of the data in the BLOB columns is indicated
            by the value in the MIME type column. This allows you to store different row types in
            the same table. The Contacts Provider's "data" table
    <code>
     <a href="/reference/android/provider/ContactsContract.Data.html">
      ContactsContract.Data
     </a>
    </code>
    is an example of a schema-independent
            table.
   </p>
  </li>
 </ul>
 <!-- Designing Content URIs -->
 <h2 id="ContentURI">
  Designing Content URIs
 </h2>
 <p>
  A
  <strong>
   content URI
  </strong>
  is a URI that identifies data in a provider. Content URIs include
    the symbolic name of the entire provider (its
  <strong>
   authority
  </strong>
  ) and a
    name that points to a table or file (a
  <strong>
   path
  </strong>
  ). The optional id part points to
    an individual row in a table. Every data access method of
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  has a content URI as an argument; this allows you to
    determine the table, row, or file to access.
 </p>
 <p>
  The basics of content URIs are described in the topic
  <a href="/guide/topics/providers/content-provider-basics.html">
   Content Provider Basics
  </a>
  .
 </p>
 <h3>
  Designing an authority
 </h3>
 <p>
  A provider usually has a single authority, which serves as its Android-internal name. To
    avoid conflicts with other providers, you should use Internet domain ownership (in reverse)
    as the basis of your provider authority. Because this recommendation is also true for Android
    package names, you can define your provider authority as an extension of the name
    of the package containing the provider. For example, if your Android package name is
  <code>
   com.example.&lt;appname&gt;
  </code>
  , you should give your provider the
    authority
  <code>
   com.example.&lt;appname&gt;.provider
  </code>
  .
 </p>
 <h3>
  Designing a path structure
 </h3>
 <p>
  Developers usually create content URIs from the authority by appending paths that point to
    individual tables. For example, if you have two tables
  <em>
   table1
  </em>
  and
  <em>
   table2
  </em>
  , you combine the authority from the previous example to yield the
    content URIs
  <code>
   com.example.&lt;appname&gt;.provider/table1
  </code>
  and
  <code>
   com.example.&lt;appname&gt;.provider/table2
  </code>
  . Paths aren't
    limited to a single segment, and there doesn't have to be a table for each level of the path.
 </p>
 <h3>
  Handling content URI IDs
 </h3>
 <p>
  By convention, providers offer access to a single row in a table by accepting a content URI
    with an ID value for the row at the end of the URI. Also by convention, providers match the
    ID value to the table's
  <code>
   _ID
  </code>
  column, and perform the requested access against the
    row that matches.
 </p>
 <p>
  This convention facilitates a common design pattern for apps accessing a provider. The app
    does a query against the provider and displays the resulting
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  in a
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  using a
  <code>
   <a href="/reference/android/widget/CursorAdapter.html">
    CursorAdapter
   </a>
  </code>
  .
    The definition of
  <code>
   <a href="/reference/android/widget/CursorAdapter.html">
    CursorAdapter
   </a>
  </code>
  requires one of the columns in the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  to be
  <code>
   _ID
  </code>
 </p>
 <p>
  The user then picks one of the displayed rows from the UI in order to look at or modify the
    data. The app gets the corresponding row from the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  backing the
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  , gets the
  <code>
   _ID
  </code>
  value for this row, appends it to
    the content URI, and sends the access request to the provider. The provider can then do the
    query or modification against the exact row the user picked.
 </p>
 <h3>
  Content URI patterns
 </h3>
 <p>
  To help you choose which action to take for an incoming content URI, the provider API includes
    the convenience class
  <code>
   <a href="/reference/android/content/UriMatcher.html">
    UriMatcher
   </a>
  </code>
  , which maps content URI "patterns" to
    integer values. You can use the integer values in a
  <code>
   switch
  </code>
  statement that
    chooses the desired action for the content URI or URIs that match a particular pattern.
 </p>
 <p>
  A content URI pattern matches content URIs using wildcard characters:
 </p>
 <ul>
  <li>
   <strong>
    <code>
     *
    </code>
    :
   </strong>
   Matches a string of any valid characters of any length.
  </li>
  <li>
   <strong>
    <code>
     #
    </code>
    :
   </strong>
   Matches a string of numeric characters of any length.
  </li>
 </ul>
 <p>
  As an example of designing and coding content URI handling, consider a provider with the
    authority
  <code>
   com.example.app.provider
  </code>
  that recognizes the following content URIs
    pointing to tables:
 </p>
 <ul>
  <li>
   <code>
    content://com.example.app.provider/table1
   </code>
   : A table called
   <code>
    table1
   </code>
   .
  </li>
  <li>
   <code>
    content://com.example.app.provider/table2/dataset1
   </code>
   : A table called
   <code>
    dataset1
   </code>
   .
  </li>
  <li>
   <code>
    content://com.example.app.provider/table2/dataset2
   </code>
   : A table called
   <code>
    dataset2
   </code>
   .
  </li>
  <li>
   <code>
    content://com.example.app.provider/table3
   </code>
   : A table called
   <code>
    table3
   </code>
   .
  </li>
 </ul>
 <p>
  The provider also recognizes these content URIs if they have a row ID appended to them, as
    for example
  <code>
   content://com.example.app.provider/table3/1
  </code>
  for the row identified by
  <code>
   1
  </code>
  in
  <code>
   table3
  </code>
  .
 </p>
 <p>
  The following content URI patterns would be possible:
 </p>
 <dl>
  <dt>
   <code>
    content://com.example.app.provider/*
   </code>
  </dt>
  <dd>
   Matches any content URI in the provider.
  </dd>
  <dt>
   <code>
    content://com.example.app.provider/table2/*
   </code>
   :
  </dt>
  <dd>
   Matches a content URI for the tables
   <code>
    dataset1
   </code>
   and
   <code>
    dataset2
   </code>
   , but doesn't match content URIs for
   <code>
    table1
   </code>
   or
   <code>
    table3
   </code>
   .
  </dd>
  <dt>
   <code>
    content://com.example.app.provider/table3/#
   </code>
   : Matches a content URI
        for single rows in
   <code>
    table3
   </code>
   , such as
   <code>
    content://com.example.app.provider/table3/6
   </code>
   for the row identified by
   <code>
    6
   </code>
   .
  </dt>
 </dl>
 <p>
  The following code snippet shows how the methods in
  <code>
   <a href="/reference/android/content/UriMatcher.html">
    UriMatcher
   </a>
  </code>
  work.
    This code handles URIs for an entire table differently from URIs for a
    single row, by using the content URI pattern
  <code>
   content://&lt;authority&gt;/&lt;path&gt;
  </code>
  for tables, and
  <code>
   content://&lt;authority&gt;/&lt;path&gt;/&lt;id&gt;
  </code>
  for single rows.
 </p>
 <p>
  The method
  <code>
   <a href="/reference/android/content/UriMatcher.html#addURI(java.lang.String, java.lang.String, int)">
    addURI()
   </a>
  </code>
  maps an
    authority and path to an integer value. The method
  <code>
   <a href="/reference/android/content/UriMatcher.html#match(android.net.Uri)">
    match()
   </a>
  </code>
  returns the integer value for a URI. A
  <code>
   switch
  </code>
  statement
    chooses between querying the entire table, and querying for a single record:
 </p>
 <pre class="prettyprint">
public class ExampleProvider extends ContentProvider {
...
    // Creates a UriMatcher object.
    private static final UriMatcher sUriMatcher;
...
    /*
     * The calls to addURI() go here, for all of the content URI patterns that the provider
     * should recognize. For this snippet, only the calls for table 3 are shown.
     */
...
    /*
     * Sets the integer value for multiple rows in table 3 to 1. Notice that no wildcard is used
     * in the path
     */
    sUriMatcher.addURI("com.example.app.provider", "table3", 1);

    /*
     * Sets the code for a single row to 2. In this case, the "#" wildcard is
     * used. "content://com.example.app.provider/table3/3" matches, but
     * "content://com.example.app.provider/table3 doesn't.
     */
    sUriMatcher.addURI("com.example.app.provider", "table3/#", 2);
...
    // Implements ContentProvider.query()
    public Cursor query(
        Uri uri,
        String[] projection,
        String selection,
        String[] selectionArgs,
        String sortOrder) {
...
        /*
         * Choose the table to query and a sort order based on the code returned for the incoming
         * URI. Here, too, only the statements for table 3 are shown.
         */
        switch (sUriMatcher.match(uri)) {


            // If the incoming URI was for all of table3
            case 1:

                if (TextUtils.isEmpty(sortOrder)) sortOrder = "_ID ASC";
                break;

            // If the incoming URI was for a single row
            case 2:

                /*
                 * Because this URI was for a single row, the _ID value part is
                 * present. Get the last path segment from the URI; this is the _ID value.
                 * Then, append the value to the WHERE clause for the query
                 */
                selection = selection + "_ID = " uri.getLastPathSegment();
                break;

            default:
            ...
                // If the URI is not recognized, you should do some error handling here.
        }
        // call the code to actually do the query
    }
</pre>
 <p>
  Another class,
  <code>
   <a href="/reference/android/content/ContentUris.html">
    ContentUris
   </a>
  </code>
  , provides convenience methods for working
    with the
  <code>
   id
  </code>
  part of content URIs. The classes
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/net/Uri.Builder.html">
    Uri.Builder
   </a>
  </code>
  include convenience methods for parsing existing
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  objects and building new ones.
 </p>
 <!-- Implementing the ContentProvider class -->
 <h2 id="ContentProvider">
  Implementing the ContentProvider Class
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  instance manages access
    to a structured set of data by handling requests from other applications. All forms
    of access eventually call
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  , which then calls a concrete
    method of
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  to get access.
 </p>
 <h3 id="RequiredAccess">
  Required methods
 </h3>
 <p>
  The abstract class
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  defines six abstract methods that
    you must implement as part of your own concrete subclass. All of these methods except
  <code>
   <a href="/reference/android/content/ContentProvider.html#onCreate()">
    onCreate()
   </a>
  </code>
  are called by a client application
    that is attempting to access your content provider:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
     query()
    </a>
   </code>
  </dt>
  <dd>
   Retrieve data from your provider. Use the arguments to select the table to
        query, the rows and columns to return, and the sort order of the result.
        Return the data as a
   <code>
    <a href="/reference/android/database/Cursor.html">
     Cursor
    </a>
   </code>
   object.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#insert(android.net.Uri, android.content.ContentValues)">
     insert()
    </a>
   </code>
  </dt>
  <dd>
   Insert a new row into your provider. Use the arguments to select the
        destination table and to get the column values to use. Return a content URI for the
        newly-inserted row.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#update(android.net.Uri, android.content.ContentValues, java.lang.String, java.lang.String[])">
     update()
    </a>
   </code>
  </dt>
  <dd>
   Update existing rows in your provider. Use the arguments to select the table and rows
        to update and to get the updated column values. Return the number of rows updated.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">
     delete()
    </a>
   </code>
  </dt>
  <dd>
   Delete rows from your provider. Use the arguments to select the table and the rows to
        delete. Return the number of rows deleted.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#getType(android.net.Uri)">
     getType()
    </a>
   </code>
  </dt>
  <dd>
   Return the MIME type corresponding to a content URI. This method is described in more
        detail in the section
   <a href="#MIMETypes">
    Implementing Content Provider MIME Types
   </a>
   .
  </dd>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#onCreate()">
     onCreate()
    </a>
   </code>
  </dt>
  <dd>
   Initialize your provider. The Android system calls this method immediately after it
        creates your provider. Notice that your provider is not created until a
   <code>
    <a href="/reference/android/content/ContentResolver.html">
     ContentResolver
    </a>
   </code>
   object tries to access it.
  </dd>
 </dl>
 <p>
  Notice that these methods have the same signature as the identically-named
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  methods.
 </p>
 <p>
  Your implementation of these methods should account for the following:
 </p>
 <ul>
  <li>
   All of these methods except
   <code>
    <a href="/reference/android/content/ContentProvider.html#onCreate()">
     onCreate()
    </a>
   </code>
   can be called by multiple threads at once, so they must be thread-safe. To learn
        more about multiple threads, see the topic
   <a href="/guide/components/processes-and-threads.html">
    Processes and Threads
   </a>
   .
  </li>
  <li>
   Avoid doing lengthy operations in
   <code>
    <a href="/reference/android/content/ContentProvider.html#onCreate()">
     onCreate()
    </a>
   </code>
   . Defer initialization tasks until they are actually needed.
        The section
   <a href="#OnCreate">
    Implementing the onCreate() method
   </a>
   discusses this in more detail.
  </li>
  <li>
   Although you must implement these methods, your code does not have to do anything except
        return the expected data type. For example, you may want to prevent other applications
        from inserting data into some tables. To do this, you can ignore the call to
   <code>
    <a href="/reference/android/content/ContentProvider.html#insert(android.net.Uri, android.content.ContentValues)">
     insert()
    </a>
   </code>
   and return
        0.
  </li>
 </ul>
 <h3 id="Query">
  Implementing the query() method
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentProvider.query()
   </a>
  </code>
  method must return a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  object, or if it
    fails, throw an
  <code>
   <a href="/reference/java/lang/Exception.html">
    Exception
   </a>
  </code>
  . If you are using an SQLite database as your data
    storage, you can simply return the
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  returned by one of the
  <code>
   query()
  </code>
  methods of the
  <code>
   <a href="/reference/android/database/sqlite/SQLiteDatabase.html">
    SQLiteDatabase
   </a>
  </code>
  class.
    If the query does not match any rows, you should return a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  instance whose
  <code>
   <a href="/reference/android/database/Cursor.html#getCount()">
    getCount()
   </a>
  </code>
  method returns 0.
    You should return
  <code>
   null
  </code>
  only if an internal error occurred during the query process.
 </p>
 <p>
  If you aren't using an SQLite database as your data storage, use one of the concrete subclasses
    of
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  . For example, the
  <code>
   <a href="/reference/android/database/MatrixCursor.html">
    MatrixCursor
   </a>
  </code>
  class
    implements a cursor in which each row is an array of
  <code>
   <a href="/reference/java/lang/Object.html">
    Object
   </a>
  </code>
  . With this class,
    use
  <code>
   <a href="/reference/android/database/MatrixCursor.html#addRow(java.lang.Object[])">
    addRow()
   </a>
  </code>
  to add a new row.
 </p>
 <p>
  Remember that the Android system must be able to communicate the
  <code>
   <a href="/reference/java/lang/Exception.html">
    Exception
   </a>
  </code>
  across process boundaries. Android can do this for the following exceptions that may be useful
    in handling query errors:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/java/lang/IllegalArgumentException.html">
     IllegalArgumentException
    </a>
   </code>
   (You may choose to throw this if your provider
        receives an invalid content URI)
  </li>
  <li>
   <code>
    <a href="/reference/java/lang/NullPointerException.html">
     NullPointerException
    </a>
   </code>
  </li>
 </ul>
 <h3 id="Insert">
  Implementing the insert() method
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html#insert(android.net.Uri, android.content.ContentValues)">
    insert()
   </a>
  </code>
  method adds a
    new row to the appropriate table, using the values in the
  <code>
   <a href="/reference/android/content/ContentValues.html">
    ContentValues
   </a>
  </code>
  argument. If a column name is not in the
  <code>
   <a href="/reference/android/content/ContentValues.html">
    ContentValues
   </a>
  </code>
  argument, you
    may want to provide a default value for it either in your provider code or in your database
    schema.
 </p>
 <p>
  This method should return the content URI for the new row. To construct this, append the new
    row's
  <code>
   _ID
  </code>
  (or other primary key) value to the table's content URI, using
  <code>
   <a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">
    withAppendedId()
   </a>
  </code>
  .
 </p>
 <h3 id="Delete">
  Implementing the delete() method
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">
    delete()
   </a>
  </code>
  method
    does not have to physically delete rows from your data storage. If you are using a sync adapter
    with your provider, you should consider marking a deleted row
    with a "delete" flag rather than removing the row entirely. The sync adapter can
    check for deleted rows and remove them from the server before deleting them from the provider.
 </p>
 <h3 id="Update">
  Implementing the update() method
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html#update(android.net.Uri, android.content.ContentValues, java.lang.String, java.lang.String[])">
    update()
   </a>
  </code>
  method takes the same
  <code>
   <a href="/reference/android/content/ContentValues.html">
    ContentValues
   </a>
  </code>
  argument used by
  <code>
   <a href="/reference/android/content/ContentProvider.html#insert(android.net.Uri, android.content.ContentValues)">
    insert()
   </a>
  </code>
  , and the
    same
  <code>
   selection
  </code>
  and
  <code>
   selectionArgs
  </code>
  arguments used by
  <code>
   <a href="/reference/android/content/ContentProvider.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">
    delete()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/content/ContentProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentProvider.query()
   </a>
  </code>
  . This may allow you to re-use code between these methods.
 </p>
 <h3 id="OnCreate">
  Implementing the onCreate() method
 </h3>
 <p>
  The Android system calls
  <code>
   <a href="/reference/android/content/ContentProvider.html#onCreate()">
    onCreate()
   </a>
  </code>
  when it starts up the provider. You should perform only fast-running initialization
    tasks in this method, and defer database creation and data loading until the provider actually
    receives a request for the data. If you do lengthy tasks in
  <code>
   <a href="/reference/android/content/ContentProvider.html#onCreate()">
    onCreate()
   </a>
  </code>
  , you will slow down your
    provider's startup. In turn, this will slow down the response from the provider to other
    applications.
 </p>
 <p>
  For example, if you are using an SQLite database you can create
    a new
  <code>
   <a href="/reference/android/database/sqlite/SQLiteOpenHelper.html">
    SQLiteOpenHelper
   </a>
  </code>
  object in
  <code>
   <a href="/reference/android/content/ContentProvider.html#onCreate()">
    ContentProvider.onCreate()
   </a>
  </code>
  ,
    and then create the SQL tables the first time you open the database. To facilitate this, the
    first time you call
  <code>
   <a href="/reference/android/database/sqlite/SQLiteOpenHelper.html#getWritableDatabase()">
    getWritableDatabase()
   </a>
  </code>
  , it automatically calls the
  <code>
   <a href="/reference/android/database/sqlite/SQLiteOpenHelper.html#onCreate(android.database.sqlite.SQLiteDatabase)">
    SQLiteOpenHelper.onCreate()
   </a>
  </code>
  method.
 </p>
 <p>
  The following two snippets demonstrate the interaction between
  <code>
   <a href="/reference/android/content/ContentProvider.html#onCreate()">
    ContentProvider.onCreate()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/database/sqlite/SQLiteOpenHelper.html#onCreate(android.database.sqlite.SQLiteDatabase)">
    SQLiteOpenHelper.onCreate()
   </a>
  </code>
  . The first snippet is the implementation of
  <code>
   <a href="/reference/android/content/ContentProvider.html#onCreate()">
    ContentProvider.onCreate()
   </a>
  </code>
  :
 </p>
 <pre class="prettyprint">
public class ExampleProvider extends ContentProvider

    /*
     * Defines a handle to the database helper object. The MainDatabaseHelper class is defined
     * in a following snippet.
     */
    private MainDatabaseHelper mOpenHelper;

    // Defines the database name
    private static final String DBNAME = "mydb";

    // Holds the database object
    private SQLiteDatabase db;

    public boolean onCreate() {

        /*
         * Creates a new helper object. This method always returns quickly.
         * Notice that the database itself isn't created or opened
         * until SQLiteOpenHelper.getWritableDatabase is called
         */
        mOpenHelper = new MainDatabaseHelper(
            getContext(),        // the application context
            DBNAME,              // the name of the database)
            null,                // uses the default SQLite cursor
            1                    // the version number
        );

        return true;
    }

    ...

    // Implements the provider's insert method
    public Cursor insert(Uri uri, ContentValues values) {
        // Insert code here to determine which table to open, handle error-checking, and so forth

        ...

        /*
         * Gets a writeable database. This will trigger its creation if it doesn't already exist.
         *
         */
        db = mOpenHelper.getWritableDatabase();
    }
}
</pre>
 <p>
  The next snippet is the implementation of
  <code>
   <a href="/reference/android/database/sqlite/SQLiteOpenHelper.html#onCreate(android.database.sqlite.SQLiteDatabase)">
    SQLiteOpenHelper.onCreate()
   </a>
  </code>
  , including a helper class:
 </p>
 <pre class="prettyprint">
...
// A string that defines the SQL statement for creating a table
private static final String SQL_CREATE_MAIN = "CREATE TABLE " +
    "main " +                       // Table's name
    "(" +                           // The columns in the table
    " _ID INTEGER PRIMARY KEY, " +
    " WORD TEXT"
    " FREQUENCY INTEGER " +
    " LOCALE TEXT )";
...
/**
 * Helper class that actually creates and manages the provider's underlying data repository.
 */
protected static final class MainDatabaseHelper extends SQLiteOpenHelper {

    /*
     * Instantiates an open helper for the provider's SQLite data repository
     * Do not do database creation and upgrade here.
     */
    MainDatabaseHelper(Context context) {
        super(context, DBNAME, null, 1);
    }

    /*
     * Creates the data repository. This is called when the provider attempts to open the
     * repository and SQLite reports that it doesn't exist.
     */
    public void onCreate(SQLiteDatabase db) {

        // Creates the main table
        db.execSQL(SQL_CREATE_MAIN);
    }
}
</pre>
 <!-- Implementing ContentProvider MIME Types -->
 <h2 id="MIMETypes">
  Implementing ContentProvider MIME Types
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  class has two methods for returning MIME types:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#getType(android.net.Uri)">
     getType()
    </a>
   </code>
  </dt>
  <dd>
   One of the required methods that you must implement for any provider.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/content/ContentProvider.html#getStreamTypes(android.net.Uri, java.lang.String)">
     getStreamTypes()
    </a>
   </code>
  </dt>
  <dd>
   A method that you're expected to implement if your provider offers files.
  </dd>
 </dl>
 <h3 id="TableMIMETypes">
  MIME types for tables
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProvider.html#getType(android.net.Uri)">
    getType()
   </a>
  </code>
  method returns a
  <code>
   <a href="/reference/java/lang/String.html">
    String
   </a>
  </code>
  in MIME format that describes the type of data returned by the content
    URI argument. The
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  argument can be a pattern rather than a specific URI;
    in this case, you should return the type of data associated with content URIs that match the
    pattern.
 </p>
 <p>
  For common types of data such as as text, HTML, or JPEG,
  <code>
   <a href="/reference/android/content/ContentProvider.html#getType(android.net.Uri)">
    getType()
   </a>
  </code>
  should return the standard
    MIME type for that data. A full list of these standard types is available on the
  <a href="http://www.iana.org/assignments/media-types/index.htm">
   IANA MIME Media Types
  </a>
  website.
 </p>
 <p>
  For content URIs that point to a row or rows of table data,
  <code>
   <a href="/reference/android/content/ContentProvider.html#getType(android.net.Uri)">
    getType()
   </a>
  </code>
  should return
    a MIME type in Android's vendor-specific MIME format:
 </p>
 <ul>
  <li>
   Type part:
   <code>
    vnd
   </code>
  </li>
  <li>
   Subtype part:
   <ul>
    <li>
     If the URI pattern is for a single row:
     <code>
      android.cursor.
      <strong>
       item
      </strong>
      /
     </code>
    </li>
    <li>
     If the URI pattern is for more than one row:
     <code>
      android.cursor.
      <strong>
       dir
      </strong>
      /
     </code>
    </li>
   </ul>
  </li>
  <li>
   Provider-specific part:
   <code>
    vnd.&lt;name&gt;
   </code>
   .
   <code>
    &lt;type&gt;
   </code>
   <p>
    You supply the
    <code>
     &lt;name&gt;
    </code>
    and
    <code>
     &lt;type&gt;
    </code>
    .
            The
    <code>
     &lt;name&gt;
    </code>
    value should be globally unique,
            and the
    <code>
     &lt;type&gt;
    </code>
    value should be unique to the corresponding URI
            pattern. A good choice for
    <code>
     &lt;name&gt;
    </code>
    is your company's name or
            some part of your application's Android package name. A good choice for the
    <code>
     &lt;type&gt;
    </code>
    is a string that identifies the table associated with the
            URI.
   </p>
  </li>
 </ul>
 <p>
  For example, if a provider's authority is
  <code>
   com.example.app.provider
  </code>
  , and it exposes a table named
  <code>
   table1
  </code>
  , the MIME type for multiple rows in
  <code>
   table1
  </code>
  is:
 </p>
 <pre>
vnd.android.cursor.<strong>dir</strong>/vnd.com.example.provider.table1
</pre>
 <p>
  For a single row of
  <code>
   table1
  </code>
  , the MIME type is:
 </p>
 <pre>
vnd.android.cursor.<strong>item</strong>/vnd.com.example.provider.table1
</pre>
 <h3 id="FileMIMETypes">
  MIME types for files
 </h3>
 <p>
  If your provider offers files, implement
  <code>
   <a href="/reference/android/content/ContentProvider.html#getStreamTypes(android.net.Uri, java.lang.String)">
    getStreamTypes()
   </a>
  </code>
  .
    The method returns a
  <code>
   <a href="/reference/java/lang/String.html">
    String
   </a>
  </code>
  array of MIME types for the files your provider
    can return for a given content URI. You should filter the MIME types you offer by the MIME type
    filter argument, so that you return only those MIME types that the client wants to handle.
 </p>
 <p>
  For example, consider a provider that offers photo images as files in
  <code>
   .jpg
  </code>
  ,
  <code>
   .png
  </code>
  , and
  <code>
   .gif
  </code>
  format.
    If an application calls
  <code>
   <a href="/reference/android/content/ContentResolver.html#getStreamTypes(android.net.Uri, java.lang.String)">
    ContentResolver.getStreamTypes()
   </a>
  </code>
  with the filter string
  <code>
   image/*
  </code>
  (something that
    is an "image"),
    then the
  <code>
   <a href="/reference/android/content/ContentProvider.html#getStreamTypes(android.net.Uri, java.lang.String)">
    ContentProvider.getStreamTypes()
   </a>
  </code>
  method should return the array:
 </p>
 <pre>
{ "image/jpeg", "image/png", "image/gif"}
</pre>
 <p>
  If the app is only interested in
  <code>
   .jpg
  </code>
  files, then it can call
  <code>
   <a href="/reference/android/content/ContentResolver.html#getStreamTypes(android.net.Uri, java.lang.String)">
    ContentResolver.getStreamTypes()
   </a>
  </code>
  with the filter string
  <code>
   *\/jpeg
  </code>
  , and
  <code>
   <a href="/reference/android/content/ContentProvider.html#getStreamTypes(android.net.Uri, java.lang.String)">
    ContentProvider.getStreamTypes()
   </a>
  </code>
  should return:
 </p>
 <pre>
{"image/jpeg"}
</pre>
 <p>
  If your provider doesn't offer any of the MIME types requested in the filter string,
  <code>
   <a href="/reference/android/content/ContentProvider.html#getStreamTypes(android.net.Uri, java.lang.String)">
    getStreamTypes()
   </a>
  </code>
  should return
  <code>
   null
  </code>
  .
 </p>
 <!--  Implementing a Contract Class -->
 <h2 id="ContractClass">
  Implementing a Contract Class
 </h2>
 <p>
  A contract class is a
  <code>
   public final
  </code>
  class that contains constant definitions for the
    URIs, column names, MIME types, and other meta-data that pertain to the provider. The class
    establishes a contract between the provider and other applications by ensuring that the provider
    can be correctly accessed even if there are changes to the actual values of URIs, column names,
    and so forth.
 </p>
 <p>
  A contract class also helps developers because it usually has mnemonic names for its constants,
    so developers are less likely to use incorrect values for column names or URIs. Since it's a
    class, it can contain Javadoc documentation. Integrated development environments such as
    Eclipse can auto-complete constant names from the contract class and display Javadoc for the
    constants.
 </p>
 <p>
  Developers can't access the contract class's class file from your application, but they can
    statically compile it into their application from a
  <code>
   .jar
  </code>
  file you provide.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.html">
    ContactsContract
   </a>
  </code>
  class and its nested classes are examples of
    contract classes.
 </p>
 <h2 id="Permissions">
  Implementing Content Provider Permissions
 </h2>
 <p>
  Permissions and access for all aspects of the Android system are described in detail in the
    topic
  <a href="/guide/topics/security/security.html">
   Security and Permissions
  </a>
  .
    The topic
  <a href="/guide/topics/data/data-storage.html">
   Data Storage
  </a>
  also
    described the security and permissions in effect for various types of storage.
    In brief, the important points are:
 </p>
 <ul>
  <li>
   By default, data files stored on the device's internal storage are private to your
        application and provider.
  </li>
  <li>
   <code>
    <a href="/reference/android/database/sqlite/SQLiteDatabase.html">
     SQLiteDatabase
    </a>
   </code>
   databases you create are private to your
        application and provider.
  </li>
  <li>
   By default, data files that you save to external storage are
   <em>
    public
   </em>
   and
   <em>
    world-readable
   </em>
   . You can't use a content provider to restrict access to files in
        external storage, because other applications can use other API calls to read and write them.
  </li>
  <li>
   The method calls for opening or creating files or SQLite databases on your device's internal
        storage can potentially give both read and write access to all other applications. If you
        use an internal file or database as your provider's repository, and you give it
        "world-readable" or "world-writeable" access, the permissions you set for your provider in
        its manifest won't protect your data. The default access for files and databases in
        internal storage is "private", and for your provider's repository you shouldn't change this.
  </li>
 </ul>
 <p>
  If you want to use content provider permissions to control access to your data, then you should
    store your data in internal files, SQLite databases, or the "cloud" (for example,
    on a remote server), and you should keep files and databases private to your application.
 </p>
 <h3>
  Implementing permissions
 </h3>
 <p>
  All applications can read from or write to your provider, even if the underlying data is
    private, because by default your provider does not have permissions set. To change this,
    set permissions for your provider in your manifest file, using attributes or child
    elements of the
  <code>
   <a href="/guide/topics/manifest/provider-element.html">
    &lt;provider&gt;
   </a>
  </code>
  element. You can set permissions that apply to the entire provider,
    or to certain tables, or even to certain records, or all three.
 </p>
 <p>
  You define permissions for your provider with one or more
  <code>
   <a href="/guide/topics/manifest/permission-element.html">
    &lt;permission&gt;
   </a>
  </code>
  elements in your manifest file. To make the
    permission unique to your provider, use Java-style scoping for the
  <code>
   <a href="/guide/topics/manifest/permission-element.html#nm">
    android:name
   </a>
  </code>
  attribute. For example, name the read permission
  <code>
   com.example.app.provider.permission.READ_PROVIDER
  </code>
  .
 </p>
 <p>
  The following list describes the scope of provider permissions, starting with the
    permissions that apply to the entire provider and then becoming more fine-grained.
    More fine-grained permissions take precedence over ones with larger scope:
 </p>
 <dl>
  <dt>
   Single read-write provider-level permission
  </dt>
  <dd>
   One permission that controls both read and write access to the entire provider, specified
        with the
   <code>
    <a href="/guide/topics/manifest/provider-element.html#prmsn">
     android:permission
    </a>
   </code>
   attribute of the
   <code>
    <a href="/guide/topics/manifest/provider-element.html">
     &lt;provider&gt;
    </a>
   </code>
   element.
  </dd>
  <dt>
   Separate read and write provider-level permission
  </dt>
  <dd>
   A read permission and a write permission for the entire provider. You specify them
        with the
   <code>
    <a href="/guide/topics/manifest/provider-element.html#rprmsn">
     android:readPermission
    </a>
   </code>
   and
   <code>
    <a href="/guide/topics/manifest/provider-element.html#wprmsn">
     android:writePermission
    </a>
   </code>
   attributes of the
   <code>
    <a href="/guide/topics/manifest/provider-element.html">
     &lt;provider&gt;
    </a>
   </code>
   element. They take precedence over the permission required by
   <code>
    <a href="/guide/topics/manifest/provider-element.html#prmsn">
     android:permission
    </a>
   </code>
   .
  </dd>
  <dt>
   Path-level permission
  </dt>
  <dd>
   Read, write, or read/write permission for a content URI in your provider. You specify
        each URI you want to control with a
   <code>
    <a href="/guide/topics/manifest/path-permission-element.html">
     &lt;path-permission&gt;
    </a>
   </code>
   child element of the
   <code>
    <a href="/guide/topics/manifest/provider-element.html">
     &lt;provider&gt;
    </a>
   </code>
   element. For each content URI you specify, you can specify a
        read/write permission, a read permission, or a write permission, or all three. The read and
        write permissions take precedence over the read/write permission. Also, path-level
        permission takes precedence over provider-level permissions.
  </dd>
  <dt>
   Temporary permission
  </dt>
  <dd>
   A permission level that grants temporary access to an application, even if the application
        doesn't have the permissions that are normally required. The temporary
        access feature reduces the number of permissions an application has to request in
        its manifest. When you turn on temporary permissions, the only applications that need
        "permanent" permissions for your provider are ones that continually access all
        your data.
   <p>
    Consider the permissions you need to implement an email provider and app, when you
            want to allow an outside image viewer application to display photo attachments from your
            provider. To give the image viewer the necessary access without requiring permissions,
            set up temporary permissions for content URIs for photos. Design your email app so
            that when the user wants to display a photo, the app sends an intent containing the
            photo's content URI and permission flags to the image viewer. The image viewer can
            then query your email provider to retrieve the photo, even though the viewer doesn't
            have the normal read permission for your provider.
   </p>
   <p>
    To turn on temporary permissions, either set the
    <code>
     <a href="/guide/topics/manifest/provider-element.html#gprmsn">
      android:grantUriPermissions
     </a>
    </code>
    attribute of the
    <code>
     <a href="/guide/topics/manifest/provider-element.html">
      &lt;provider&gt;
     </a>
    </code>
    element, or add one or more
    <code>
     <a href="/guide/topics/manifest/grant-uri-permission-element.html">
      &lt;grant-uri-permission&gt;
     </a>
    </code>
    child elements to your
    <code>
     <a href="/guide/topics/manifest/provider-element.html">
      &lt;provider&gt;
     </a>
    </code>
    element. If you use temporary permissions, you have to call
    <code>
     <a href="/reference/android/content/Context.html#revokeUriPermission(android.net.Uri, int)">
      Context.revokeUriPermission()
     </a>
    </code>
    whenever you remove support for a content URI from your
            provider, and the content URI is associated with a temporary permission.
   </p>
   <p>
    The attribute's value determines how much of your provider is made accessible.
            If the attribute is set to
    <code>
     true
    </code>
    , then the system will grant temporary
            permission to your entire provider, overriding any other permissions that are required
            by your provider-level or path-level permissions.
   </p>
   <p>
    If this flag is set to
    <code>
     false
    </code>
    , then you must add
    <code>
     <a href="/guide/topics/manifest/grant-uri-permission-element.html">
      &lt;grant-uri-permission&gt;
     </a>
    </code>
    child elements to your
    <code>
     <a href="/guide/topics/manifest/provider-element.html">
      &lt;provider&gt;
     </a>
    </code>
    element. Each child element specifies the content URI or
            URIs for which temporary access is granted.
   </p>
   <p>
    To delegate temporary access to an application, an intent must contain
            the
    <code>
     <a href="/reference/android/content/Intent.html#FLAG_GRANT_READ_URI_PERMISSION">
      FLAG_GRANT_READ_URI_PERMISSION
     </a>
    </code>
    or the
    <code>
     <a href="/reference/android/content/Intent.html#FLAG_GRANT_WRITE_URI_PERMISSION">
      FLAG_GRANT_WRITE_URI_PERMISSION
     </a>
    </code>
    flags, or both. These
            are set with the
    <code>
     <a href="/reference/android/content/Intent.html#setFlags(int)">
      setFlags()
     </a>
    </code>
    method.
   </p>
   <p>
    If the
    <code>
     <a href="/guide/topics/manifest/provider-element.html#gprmsn">
      android:grantUriPermissions
     </a>
    </code>
    attribute is not present, it's assumed to be
    <code>
     false
    </code>
    .
   </p>
  </dd>
 </dl>
 <!-- The Provider Element -->
 <h2 id="ProviderElement">
  The &lt;provider&gt; Element
 </h2>
 <p>
  Like
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  components,
    a subclass of
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  must be defined in the manifest file for its application, using the
  <code>
   <a href="/guide/topics/manifest/provider-element.html">
    &lt;provider&gt;
   </a>
  </code>
  element. The Android system gets the following information from
    the element:
 </p>
 <dl>
  <dt>
   Authority
        (
   <a href="/guide/topics/manifest/provider-element.html#auth">
    <code>
     android:authorities
    </code>
   </a>
   )
  </dt>
  <dd>
   Symbolic names that identify the entire provider within the system. This
        attribute is described in more detail in the section
   <a href="#ContentURI">
    Designing Content URIs
   </a>
   .
  </dd>
  <dt>
   Provider class name
        (
   <code>
    <a href="/guide/topics/manifest/provider-element.html#nm">
     android:name
    </a>
   </code>
   )
  </dt>
  <dd>
   The class that implements
   <code>
    <a href="/reference/android/content/ContentProvider.html">
     ContentProvider
    </a>
   </code>
   . This class is
        described in more detail in the section
   <a href="#ContentProvider">
    Implementing the ContentProvider Class
   </a>
   .
  </dd>
  <dt>
   Permissions
  </dt>
  <dd>
   Attributes that specify the permissions that other applications must have in order to access
        the provider's data:
   <ul>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#gprmsn">
       android:grantUriPermssions
      </a>
     </code>
     : Temporary permission flag.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#prmsn">
       android:permission
      </a>
     </code>
     : Single provider-wide read/write permission.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#rprmsn">
       android:readPermission
      </a>
     </code>
     : Provider-wide read permission.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#wprmsn">
       android:writePermission
      </a>
     </code>
     : Provider-wide write permission.
    </li>
   </ul>
   <p>
    Permissions and their corresponding attributes are described in more
            detail in the section
    <a href="#Permissions">
     Implementing Content Provider Permissions
    </a>
    .
   </p>
  </dd>
  <dt>
   Startup and control attributes
  </dt>
  <dd>
   These attributes determine how and when the Android system starts the provider, the
        process characteristics of the provider, and other run-time settings:
   <ul>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#enabled">
       android:enabled
      </a>
     </code>
     : Flag allowing the system to start the provider.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#exported">
       android:exported
      </a>
     </code>
     : Flag allowing other applications to use this provider.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#init">
       android:initOrder
      </a>
     </code>
     : The order in which this provider should be started,
                relative to other providers in the same process.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#multi">
       android:multiProcess
      </a>
     </code>
     : Flag allowing the system to start the provider
                in the same process as the calling client.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#proc">
       android:process
      </a>
     </code>
     : The name of the process in which the provider should
                run.
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#sync">
       android:syncable
      </a>
     </code>
     : Flag indicating that the provider's data is to be
                sync'ed with data on a server.
    </li>
   </ul>
   <p>
    The attributes are fully documented in the dev guide topic for the
    <code>
     <a href="/guide/topics/manifest/provider-element.html">
      &lt;provider&gt;
     </a>
    </code>
    element.
   </p>
  </dd>
  <dt>
   Informational attributes
  </dt>
  <dd>
   An optional icon and label for the provider:
   <ul>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#icon">
       android:icon
      </a>
     </code>
     : A drawable resource containing an icon for the provider.
                The icon appears next to the provider's label in the list of apps in
     <em>
      Settings
     </em>
     &gt;
     <em>
      Apps
     </em>
     &gt;
     <em>
      All
     </em>
     .
    </li>
    <li>
     <code>
      <a href="/guide/topics/manifest/provider-element.html#label">
       android:label
      </a>
     </code>
     : An informational label describing the provider or its
                data, or both. The label appears in the list of apps in
     <em>
      Settings
     </em>
     &gt;
     <em>
      Apps
     </em>
     &gt;
     <em>
      All
     </em>
     .
    </li>
   </ul>
   <p>
    The attributes are fully documented in the dev guide topic for the
    <code>
     <a href="/guide/topics/manifest/provider-element.html">
      &lt;provider&gt;
     </a>
    </code>
    element.
   </p>
  </dd>
 </dl>
 <!-- Intent Access -->
 <h2 id="Intents">
  Intents and Data Access
 </h2>
 <p>
  Applications can access a content provider indirectly with an
  <code>
   <a href="/reference/android/content/Intent.html">
    Intent
   </a>
  </code>
  .
    The application does not call any of the methods of
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  . Instead, it sends an intent that starts an activity,
    which is often part of the provider's own application. The destination activity is in charge of
    retrieving and displaying the data in its UI. Depending on the action in the intent, the
    destination activity may also prompt the user to make modifications to the provider's data.
    An intent may also contain "extras" data that the destination activity displays
    in the UI; the user then has the option of changing this data before using it to modify the
    data in the provider.
 </p>
 <p>
 </p>
 <p>
  You may want to use intent access to help ensure data integrity. Your provider may depend
    on having data inserted, updated, and deleted according to strictly defined business logic. If
    this is the case, allowing other applications to directly modify your data may lead to
    invalid data. If you want developers to use intent access, be sure to document it thoroughly.
    Explain to them why intent access using your own application's UI is better than trying to
    modify the data with their code.
 </p>
 <p>
  Handling an incoming intent that wishes to modify your provider's data is no different from
    handling other intents. You can learn more about using intents by reading the topic
  <a href="/guide/components/intents-filters.html">
   Intents and Intent Filters
  </a>
  .
 </p>
</div>
<h1>Calendar Provider</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#overview">
      Basics
     </a>
    </li>
    <li>
     <a href="#manifest">
      User Permissions
     </a>
    </li>
    <li>
     <a href="#calendar">
      Calendars table
     </a>
     <ol>
      <li>
       <a href="#query">
        Querying a calendar
       </a>
      </li>
      <li>
       <a href="#modify-calendar">
        Modifying a calendar
       </a>
      </li>
      <li>
       <a href="#insert-calendar">
        Inserting a calendar
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#events">
      Events table
     </a>
     <ol>
      <li>
       <a href="#add-event">
        Adding Events
       </a>
      </li>
      <li>
       <a href="#update-event">
        Updating Events
       </a>
      </li>
      <li>
       <a href="#delete-event">
        Deleting Events
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#attendees">
      Attendees table
     </a>
     <ol>
      <li>
       <a href="#add-attendees">
        Adding Attendees
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#reminders">
      Reminders table
     </a>
     <ol>
      <li>
       <a href="#add-reminders">
        Adding Reminders
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#instances">
      Instances table
     </a>
     <ol>
      <li>
       <a href="#query-instances">
        Querying the Instances table
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#intents">
      Calendar Intents
     </a>
     <ol>
      <li>
       <a href="#intent-insert">
        Using an intent to insert an event
       </a>
      </li>
      <li>
       <a href="#intent-edit">
        Using an intent to edit an event
       </a>
      </li>
      <li>
       <a href="#intent-view">
        Using intents to view calendar data
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#sync-adapter">
      Sync Adapters
     </a>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/provider/CalendarContract.Calendars.html">
       CalendarContract.Calendars
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/CalendarContract.Events.html">
       CalendarContract.Events
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/CalendarContract.Attendees.html">
       CalendarContract.Attendees
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/CalendarContract.Reminders.html">
       CalendarContract.Reminders
      </a>
     </code>
    </li>
   </ol>
  </div>
 </div>
 <p>
  The Calendar Provider is a repository for a user's calendar events. The
Calendar Provider API allows you to perform query, insert, update, and delete
operations on calendars, events, attendees, reminders, and so on.
 </p>
 <p>
  The Calender Provider API can be used by applications and sync adapters. The
rules vary depending on what type of program is making the calls. This document
focuses primarily on using the Calendar Provider API as an application. For 
a discussion of how sync adapters are different, see
  <a href="#sync-adapter">
   Sync Adapters
  </a>
  .
 </p>
 <p>
  Normally, to read or write calendar data, an application's manifest must
include the proper permissions, described in
  <a href="#manifest">
   User
Permissions
  </a>
  . To make performing common operations easier, the Calendar
Provider offers a set of intents, as described in
  <a href="#intents">
   Calendar
Intents
  </a>
  . These intents take users to the Calendar application to insert, view,
and edit events. The user interacts with the Calendar application and then
returns to the original application. Thus your application doesn't need to request permissions,
nor does it need to provide a user interface to view or create events.
 </p>
 <h2 id="overview">
  Basics
 </h2>
 <p>
  <a href="/guide/topics/providers/content-providers.html">
   Content providers
  </a>
  store data and make it accessible to 
applications. The content providers offered by the Android platform (including the Calendar Provider) typically expose data as a set of tables based on a
relational database model, where each row is a record and each column is data of
a particular type and meaning. Through the Calendar Provider API, applications
and sync adapters can get read/write access to the database tables that hold a
user's calendar data.
 </p>
 <p>
  Every content provider exposes a public URI (wrapped as a
  <code>
   <a href="/reference/android/net/Uri.html">
    Uri
   </a>
  </code>
  object) that uniquely identifies its data set.  A content provider that controls
 multiple data sets (multiple tables) exposes a separate URI for each one.  All 
URIs for providers begin with the string "content://".  This
identifies the data as being controlled by a content provider. The Calendar
Provider defines constants for the URIs for each of its classes (tables). These
URIs have the format
  <code>
   <em>
    &lt;class&gt;
   </em>
   .CONTENT_URI
  </code>
  . For
example,
  <code>
   <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
    Events.CONTENT_URI
   </a>
  </code>
  .
 </p>
 <p>
  Figure 1 shows a graphical representation of the Calendar Provider data model. It shows the
main tables and the fields that link them to each other.
 </p>
 <img alt="Calendar Provider Data Model" src="http://developer.android.com/images/providers/datamodel.png"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  Calendar Provider data model.
 </p>
 <p>
  A user can have multiple calendars, and different calendars can be associated with different types of accounts (Google Calendar, Exchange, and so on).
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/provider/CalendarContract.html">
    CalendarContract
   </a>
  </code>
  defines the data model of calendar and event related information. This data is stored in a number of tables, listed below.
 </p>
 <table>
  <tr>
   <th>
    Table (Class)
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <p>
     <code>
      <a href="/reference/android/provider/CalendarContract.Calendars.html">
       CalendarContract.Calendars
      </a>
     </code>
    </p>
   </td>
   <td>
    This table holds 
the calendar-specific information. Each  row in this table contains the details for
a single calendar, such as the  name, color, sync information, and so on.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Events.html">
      CalendarContract.Events
     </a>
    </code>
   </td>
   <td>
    This table holds the
event-specific information. Each row  in this table has the information for a single
event&mdash;for example, event title, location, start time, end
time, and so on. The event can occur one-time or can recur multiple times. Attendees,
reminders, and extended  properties are stored in separate tables. 
They each have an
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#EVENT_ID">
      EVENT_ID
     </a>
    </code>
    that references the
    <code>
     <a href="/reference/android/provider/BaseColumns.html#_ID">
      _ID
     </a>
    </code>
    in the Events table.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html">
      CalendarContract.Instances
     </a>
    </code>
   </td>
   <td>
    This table holds the
start and end time for each occurrence of an event. Each row in this table
represents a single event occurrence. For one-time events there is a 1:1 mapping
of instances to events. For recurring events, multiple rows are automatically
 generated that correspond to multiple occurrences of that event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Attendees.html">
      CalendarContract.Attendees
     </a>
    </code>
   </td>
   <td>
    This table holds the
event attendee (guest) information. Each row represents a single guest of an
event. It specifies the type of guest and the guest's attendance response
for the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Reminders.html">
      CalendarContract.Reminders
     </a>
    </code>
   </td>
   <td>
    This table holds the
alert/notification data. Each row represents a single alert for an event. An
event can have multiple reminders. The maximum number of reminders per event is
specified in
    <code>
     <a href="/reference/android/provider/CalendarContract.CalendarColumns.html#MAX_REMINDERS">
      MAX_REMINDERS
     </a>
    </code>
    , 
which is set by the sync adapter that
owns  the given calendar. Reminders are specified in minutes before the event
and have a method that determines how the user will be alerted.
   </td>
  </tr>
 </table>
 <p>
  The Calendar Provider API is designed to be flexible and powerful. At the
same time, it's important to provide a good end user experience and
protect the integrity of the calendar and its data. To this end, here are
some things to keep in mind when using the API:
 </p>
 <ul>
  <li>
   <strong>
    Inserting, updating, and viewing calendar events.
   </strong>
   To directly insert, modify, and read events from the Calendar Provider, you need the appropriate
   <a href="#manifest">
    permissions
   </a>
   . However, if you're not building a full-fledged calendar application or sync adapter, requesting these permissions isn't necessary. You can instead use intents supported by Android's Calendar application to hand off read and write operations to that application. When you use the intents, your application sends users to the Calendar application to perform the desired operation
in a pre-filled form. After they're done, they're returned to your application.
By designing your application to perform common operations through the Calendar,
you provide users with a consistent, robust user interface. This is the
recommended approach. For more information, see
   <a href="#intents">
    Calendar
Intents
   </a>
   .
  </li>
  <li>
   <strong>
    Sync adapters.
   </strong>
   A sync adapter synchronizes the calendar data
on a user's device with another server or data source. In the
   <code>
    <a href="/reference/android/provider/CalendarContract.Calendars.html">
     CalendarContract.Calendars
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/provider/CalendarContract.Events.html">
     CalendarContract.Events
    </a>
   </code>
   tables, 
there are columns that are reserved for the sync adapters to use.
The provider and applications should not modify them. In fact, they are not
visible unless they are accessed as a sync adapter. For more information about
sync adapters, see
   <a href="#sync-adapter">
    Sync Adapters
   </a>
   .
  </li>
 </ul>
 <h2 id="manifest">
  User Permissions
 </h2>
 <p>
  To read calendar data, an application must include the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CALENDAR">
    READ_CALENDAR
   </a>
  </code>
  permission in its manifest file. It
must include the
  <code>
   <a href="/reference/android/Manifest.permission.html#WRITE_CALENDAR">
    WRITE_CALENDAR
   </a>
  </code>
  permission
to delete, insert or update calendar data:
 </p>
 <pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"...&gt;
    &lt;uses-sdk android:minSdkVersion="14" /&gt;
    &lt;uses-permission android:name="android.permission.READ_CALENDAR" /&gt;
    &lt;uses-permission android:name="android.permission.WRITE_CALENDAR" /&gt;
    ...
&lt;/manifest&gt;
</pre>
 <h2 id="calendar">
  Calendars Table
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/provider/CalendarContract.Calendars.html">
    CalendarContract.Calendars
   </a>
  </code>
  table contains details 
for individual calendars. The following
Calendars columns are writable by both an application and a
  <a href="#sync-adapter">
   sync adapter
  </a>
  . 
For a full list of supported fields, see the
  <code>
   <a href="/reference/android/provider/CalendarContract.Calendars.html">
    CalendarContract.Calendars
   </a>
  </code>
  reference.
 </p>
 <table>
  <tr>
   <th>
    Constant
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Calendars.html#NAME">
      NAME
     </a>
    </code>
   </td>
   <td>
    The name of the calendar.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.CalendarColumns.html#CALENDAR_DISPLAY_NAME">
      CALENDAR_DISPLAY_NAME
     </a>
    </code>
   </td>
   <td>
    The name of this calendar that is displayed to the user.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.CalendarColumns.html#VISIBLE">
      VISIBLE
     </a>
    </code>
   </td>
   <td>
    A boolean indicating whether the calendar is selected to be displayed. A
value of 0 indicates that events associated with this calendar should not be
shown.  A value of 1 indicates that events associated with this calendar should
be shown. This value affects the generation of rows in the
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html">
      CalendarContract.Instances
     </a>
    </code>
    table.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.CalendarColumns.html#SYNC_EVENTS">
      SYNC_EVENTS
     </a>
    </code>
   </td>
   <td>
    A boolean indicating whether the calendar should be synced and have its
events stored on the device. A value of 0 says do not sync this calendar or
store its events on the device.  A value of 1 says sync events for this calendar
and store its events on the device.
   </td>
  </tr>
 </table>
 <h3 id="query">
  Querying a calendar
 </h3>
 <p>
  Here is an example that shows how to get the calendars that are owned by a particular
user. For simplicity's sake, in this example the query operation is shown in the
user interface thread ("main thread"). In practice, this should be done in an asynchronous
thread instead of on the main thread. For more discussion, see
  <a href="/guide/components/loaders.html">
   Loaders
  </a>
  . If you are not just 
reading data but modifying it, see
  <code>
   <a href="/reference/android/content/AsyncQueryHandler.html">
    AsyncQueryHandler
   </a>
  </code>
  .
 </p>
 <pre>
// Projection array. Creating indices for this array instead of doing
// dynamic lookups improves performance.
public static final String[] EVENT_PROJECTION = new String[] {
    Calendars._ID,                           // 0
    Calendars.ACCOUNT_NAME,                  // 1
    Calendars.CALENDAR_DISPLAY_NAME,         // 2
    Calendars.OWNER_ACCOUNT                  // 3
};
  
// The indices for the projection array above.
private static final int PROJECTION_ID_INDEX = 0;
private static final int PROJECTION_ACCOUNT_NAME_INDEX = 1;
private static final int PROJECTION_DISPLAY_NAME_INDEX = 2;
private static final int PROJECTION_OWNER_ACCOUNT_INDEX = 3;</pre>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h3>
    Why must you include
ACCOUNT_TYPE?
   </h3>
   <p>
    If you query on a
    <code>
     <a href="/reference/android/provider/CalendarContract.SyncColumns.html#ACCOUNT_NAME">
      Calendars.ACCOUNT_NAME
     </a>
    </code>
    , you must also include
    <code>
     <a href="/reference/android/provider/CalendarContract.SyncColumns.html#ACCOUNT_TYPE">
      Calendars.ACCOUNT_TYPE
     </a>
    </code>
    in the selection. That is because a given account is
only considered unique given both its
    <code>
     ACCOUNT_NAME
    </code>
    and its
    <code>
     ACCOUNT_TYPE
    </code>
    . The
    <code>
     ACCOUNT_TYPE
    </code>
    is the string corresponding to the
account authenticator that was used when the account was registered with the
    <code>
     <a href="/reference/android/accounts/AccountManager.html">
      AccountManager
     </a>
    </code>
    . There is also a special type of account called
    <code>
     <a href="/reference/android/provider/CalendarContract.html#ACCOUNT_TYPE_LOCAL">
      ACCOUNT_TYPE_LOCAL
     </a>
    </code>
    for calendars not
associated with a device account.
    <code>
     <a href="/reference/android/provider/CalendarContract.html#ACCOUNT_TYPE_LOCAL">
      ACCOUNT_TYPE_LOCAL
     </a>
    </code>
    accounts do not get
synced.
   </p>
  </div>
 </div>
 <p>
  In the next part of the example, you construct your query. The selection
specifies the criteria for the query. In this example the query is looking for
calendars that have the
  <code>
   ACCOUNT_NAME
  </code>
  "sampleuser@google.com", the
  <code>
   ACCOUNT_TYPE
  </code>
  "com.google", and the
  <code>
   OWNER_ACCOUNT
  </code>
  "sampleuser@google.com". If you want to see all calendars that a user
has viewed, not just calendars the user owns, omit the
  <code>
   OWNER_ACCOUNT
  </code>
  .
The query returns a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  object that you can use to traverse the result set returned by the database
query. For more discussion of using queries in content providers, 
see
  <a href="/guide/topics/providers/content-providers.html">
   Content Providers
  </a>
  .
 </p>
 <pre>// Run query
Cursor cur = null;
ContentResolver cr = getContentResolver();
Uri uri = Calendars.CONTENT_URI;   
String selection = "((" + Calendars.ACCOUNT_NAME + " = ?) AND (" 
                        + Calendars.ACCOUNT_TYPE + " = ?) AND ("
                        + Calendars.OWNER_ACCOUNT + " = ?))";
String[] selectionArgs = new String[] {"sampleuser@gmail.com", "com.google",
        "sampleuser@gmail.com"}; 
// Submit the query and get a Cursor object back. 
cur = cr.query(uri, EVENT_PROJECTION, selection, selectionArgs, null);</pre>
 <p>
  This next section uses the cursor to step through the result set. It uses the
constants that were set up at the beginning of the example to return the values
for each field.
 </p>
 <pre>// Use the cursor to step through the returned records
while (cur.moveToNext()) {
    long calID = 0;
    String displayName = null;
    String accountName = null;
    String ownerName = null;
      
    // Get the field values
    calID = cur.getLong(PROJECTION_ID_INDEX);
    displayName = cur.getString(PROJECTION_DISPLAY_NAME_INDEX);
    accountName = cur.getString(PROJECTION_ACCOUNT_NAME_INDEX);
    ownerName = cur.getString(PROJECTION_OWNER_ACCOUNT_INDEX);
              
    // Do something with the values...

   ...
}
</pre>
 <h3 id="modify-calendar">
  Modifying a calendar
 </h3>
 <p>
  To perform an update of an calendar, you can provide the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  of the calendar either as an appended ID to
the Uri 

(
  <code>
   <a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">
    withAppendedId()
   </a>
  </code>
  ) 
or as the first selection item. The  selection
should start with
  <code>
   "_id=?"
  </code>
  , and the first
  <code>
   selectionArg
  </code>
  should be  the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  of the calendar. 
You can also do updates by encoding the ID in the URI. This example changes a
calendar's display name using the 
(
  <code>
   <a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">
    withAppendedId()
   </a>
  </code>
  ) 
approach:
 </p>
 <pre>private static final String DEBUG_TAG = "MyActivity";
...
long calID = 2;
ContentValues values = new ContentValues();
// The new display name for the calendar
values.put(Calendars.CALENDAR_DISPLAY_NAME, "Trevor's Calendar");
Uri updateUri = ContentUris.withAppendedId(Calendars.CONTENT_URI, calID);
int rows = getContentResolver().update(updateUri, values, null, null);
Log.i(DEBUG_TAG, "Rows updated: " + rows);</pre>
 <h3 id="insert-calendar">
  Inserting a calendar
 </h3>
 <p>
  Calendars are  designed to be primarily managed by a sync adapter, so you
should only insert new calendars as a sync adapter. For the most part,
applications can only make superficial changes to calendars, such as changing the display name. If
an application needs to create a local calendar, it can do this by performing
the calendar insertion as a sync adapter, using an
  <code>
   <a href="/reference/android/provider/CalendarContract.SyncColumns.html#ACCOUNT_TYPE">
    ACCOUNT_TYPE
   </a>
  </code>
  of
  <code>
   <a href="/reference/android/provider/CalendarContract.html#ACCOUNT_TYPE_LOCAL">
    ACCOUNT_TYPE_LOCAL
   </a>
  </code>
  .
  <code>
   <a href="/reference/android/provider/CalendarContract.html#ACCOUNT_TYPE_LOCAL">
    ACCOUNT_TYPE_LOCAL
   </a>
  </code>
  is a special account type for calendars that are not
associated with a device account. Calendars of this type are not synced to a server. For a
discussion of sync adapters, see
  <a href="#sync-adapter">
   Sync Adapters
  </a>
  .
 </p>
 <h2 id="events">
  Events Table
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/provider/CalendarContract.Events.html">
    CalendarContract.Events
   </a>
  </code>
  table contains details
for individual events. To add, update, or delete  events, an application must
include the
  <code>
   <a href="/reference/android/Manifest.permission.html#WRITE_CALENDAR">
    WRITE_CALENDAR
   </a>
  </code>
  permission in its
  <a href="#manifest">
   manifest file
  </a>
  .
 </p>
 <p>
  The following Events columns are writable by both an application and a sync
adapter. For a full list of supported fields, see the
  <code>
   <a href="/reference/android/provider/CalendarContract.Events.html">
    CalendarContract.Events
   </a>
  </code>
  reference.
 </p>
 <table>
  <tr>
   <th>
    Constant
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#CALENDAR_ID">
      CALENDAR_ID
     </a>
    </code>
   </td>
   <td>
    The
    <code>
     <a href="/reference/android/provider/BaseColumns.html#_ID">
      _ID
     </a>
    </code>
    of the calendar the event belongs to.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#ORGANIZER">
      ORGANIZER
     </a>
    </code>
   </td>
   <td>
    Email of the organizer (owner) of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#TITLE">
      TITLE
     </a>
    </code>
   </td>
   <td>
    The title of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#EVENT_LOCATION">
      EVENT_LOCATION
     </a>
    </code>
   </td>
   <td>
    Where the event takes place.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DESCRIPTION">
      DESCRIPTION
     </a>
    </code>
   </td>
   <td>
    The description of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DTSTART">
      DTSTART
     </a>
    </code>
   </td>
   <td>
    The time the event starts in UTC milliseconds since the epoch.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DTEND">
      DTEND
     </a>
    </code>
   </td>
   <td>
    The time the event ends in UTC milliseconds since the epoch.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#EVENT_TIMEZONE">
      EVENT_TIMEZONE
     </a>
    </code>
   </td>
   <td>
    The time zone for the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#EVENT_END_TIMEZONE">
      EVENT_END_TIMEZONE
     </a>
    </code>
   </td>
   <td>
    The time zone for the end time of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DURATION">
      DURATION
     </a>
    </code>
   </td>
   <td>
    The duration of the event in
    <a href="http://tools.ietf.org/html/rfc5545#section-3.8.2.5">
     RFC5545
    </a>
    format.
For example, a value of
    <code>
     "PT1H"
    </code>
    states that the event
should last one hour, and a value of
    <code>
     "P2W"
    </code>
    indicates a
duration of 2 weeks.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#ALL_DAY">
      ALL_DAY
     </a>
    </code>
   </td>
   <td>
    A value of 1 indicates this event occupies the entire day, as defined by
the local time zone. A value of 0 indicates it is a regular event that may start
and end at any time during a day.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RRULE">
      RRULE
     </a>
    </code>
   </td>
   <td>
    The recurrence rule for the event format. For
example,
    <code>
     "FREQ=WEEKLY;COUNT=10;WKST=SU"
    </code>
    . You can find
more examples
    <a href="http://tools.ietf.org/html/rfc5545#section-3.8.5.3">
     here
    </a>
    .
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RDATE">
      RDATE
     </a>
    </code>
   </td>
   <td>
    The recurrence dates for the event. 
    You typically use
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RDATE">
      RDATE
     </a>
    </code>
    in conjunction with
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RRULE">
      RRULE
     </a>
    </code>
    to define an aggregate set of
repeating occurrences. For more discussion, see the
    <a href="http://tools.ietf.org/html/rfc5545#section-3.8.5.2">
     RFC5545 spec
    </a>
    .
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#AVAILABILITY">
      AVAILABILITY
     </a>
    </code>
   </td>
   <td>
    If this event counts as busy time or is free time that can be 
scheduled over.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#GUESTS_CAN_MODIFY">
      GUESTS_CAN_MODIFY
     </a>
    </code>
   </td>
   <td>
    Whether guests can modify the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#GUESTS_CAN_INVITE_OTHERS">
      GUESTS_CAN_INVITE_OTHERS
     </a>
    </code>
   </td>
   <td>
    Whether guests can invite other guests.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#GUESTS_CAN_SEE_GUESTS">
      GUESTS_CAN_SEE_GUESTS
     </a>
    </code>
   </td>
   <td>
    Whether guests can see the list of attendees.
   </td>
  </tr>
 </table>
 <h3 id="add-event">
  Adding Events
 </h3>
 <p>
  When your application inserts a new event, we recommend that you use an
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    INSERT
   </a>
  </code>
  Intent, as described in
  <a href="#intent-insert">
   Using an intent to insert an event
  </a>
  . However, if you
need to, you can insert events directly. This section describes how to do
this.
 </p>
 <p>
  Here are the rules for inserting a new event:
 </p>
 <ul>
  <li>
   You must include
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#CALENDAR_ID">
     CALENDAR_ID
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DTSTART">
     DTSTART
    </a>
   </code>
   .
  </li>
  <li>
   You must include an
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#EVENT_TIMEZONE">
     EVENT_TIMEZONE
    </a>
   </code>
   . To get a list
of the system's installed time zone IDs, use
   <code>
    <a href="/reference/java/util/TimeZone.html#getAvailableIDs()">
     getAvailableIDs()
    </a>
   </code>
   . Note that this rule does not apply if
you're inserting an event through the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_INSERT">
     INSERT
    </a>
   </code>
   Intent, described in
   <a href="#intent-insert">
    Using an intent to insert an event
   </a>
   &mdash;in that
scenario, a default time zone is supplied.
  </li>
  <li>
   For non-recurring events, you must include
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DTEND">
     DTEND
    </a>
   </code>
   .
  </li>
  <li>
   For recurring events, you must include a
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DURATION">
     DURATION
    </a>
   </code>
   in addition to
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RRULE">
     RRULE
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RDATE">
     RDATE
    </a>
   </code>
   . Note that this rule does not apply if
you're inserting an event through the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_INSERT">
     INSERT
    </a>
   </code>
   Intent, described in
   <a href="#intent-insert">
    Using an intent to insert an event
   </a>
   &mdash;in that
scenario, you can use an
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RRULE">
     RRULE
    </a>
   </code>
   in conjunction with
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DTSTART">
     DTSTART
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DTEND">
     DTEND
    </a>
   </code>
   , and the Calendar application 
converts it to a duration automatically.
  </li>
 </ul>
 <p>
  Here is an example of inserting an event. This is being performed in the UI
thread for simplicity. In practice, inserts and updates should be done in an
asynchronous thread to move the action into a background thread. For more
information, see
  <code>
   <a href="/reference/android/content/AsyncQueryHandler.html">
    AsyncQueryHandler
   </a>
  </code>
  .
 </p>
 <pre>
long calID = 3;
long startMillis = 0; 
long endMillis = 0;     
Calendar beginTime = Calendar.getInstance();
beginTime.set(2012, 9, 14, 7, 30);
startMillis = beginTime.getTimeInMillis();
Calendar endTime = Calendar.getInstance();
endTime.set(2012, 9, 14, 8, 45);
endMillis = endTime.getTimeInMillis();
...

ContentResolver cr = getContentResolver();
ContentValues values = new ContentValues();
values.put(Events.DTSTART, startMillis);
values.put(Events.DTEND, endMillis);
values.put(Events.TITLE, "Jazzercise");
values.put(Events.DESCRIPTION, "Group workout");
values.put(Events.CALENDAR_ID, calID);
values.put(Events.EVENT_TIMEZONE, "America/Los_Angeles");
Uri uri = cr.insert(Events.CONTENT_URI, values);

// get the event ID that is the last element in the Uri
long eventID = Long.parseLong(uri.getLastPathSegment());
// 
// ... do something with event ID
//
//</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  See how this example captures the event
ID after the event is created. This is the easiest way to get an event ID. You often
need the event ID to perform other calendar operations&mdash;for example, to add
attendees or reminders to an event.
 </p>
 <h3 id="update-event">
  Updating Events
 </h3>
 <p>
  When your application wants to allow the user to edit an event, we recommend
that you use an
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_EDIT">
    EDIT
   </a>
  </code>
  Intent, as
described in
  <a href="#intent-edit">
   Using an intent to edit an  event
  </a>
  .
However, if you need to, you can edit events directly. To perform an update of
an Event, you can provide the
  <code>
   _ID
  </code>
  of the 
event either as an appended ID to the Uri (
  <code>
   <a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">
    withAppendedId()
   </a>
  </code>
  ) 
or as the first selection item. 
The selection should start with
  <code>
   "_id=?"
  </code>
  , and the first
  <code>
   selectionArg
  </code>
  should be  the
  <code>
   _ID
  </code>
  of the event. You can
also do updates using a selection with no ID. Here is an example of updating an
event. It changes the title of the event using the
  <code>
   <a href="/reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">
    withAppendedId()
   </a>
  </code>
  approach:
 </p>
 <pre>private static final String DEBUG_TAG = "MyActivity";
...
long eventID = 188;
...
ContentResolver cr = getContentResolver();
ContentValues values = new ContentValues();
Uri updateUri = null;
// The new title for the event
values.put(Events.TITLE, "Kickboxing"); 
updateUri = ContentUris.withAppendedId(Events.CONTENT_URI, eventID);
int rows = getContentResolver().update(updateUri, values, null, null);
Log.i(DEBUG_TAG, "Rows updated: " + rows);  </pre>
 <h3 id="delete-event">
  Deleting Events
 </h3>
 <p>
  You can delete an event either by its
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  as an appended  ID on the URI, or by using
standard selection. If you use an appended ID, you can't also do a selection.
There are two versions of delete: as an application and as a sync adapter. An
application delete sets the
  <em>
   deleted
  </em>
  column to 1. This flag that tells
the sync adapter that the row was deleted and that this deletion should be
propagated to the server. A sync adapter delete removes the event from the
database along with all its associated data. Here is an example of application
deleting an event through its
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  :
 </p>
 <pre>private static final String DEBUG_TAG = "MyActivity";
...
long eventID = 201;
...
ContentResolver cr = getContentResolver();
ContentValues values = new ContentValues();
Uri deleteUri = null;
deleteUri = ContentUris.withAppendedId(Events.CONTENT_URI, eventID);
int rows = getContentResolver().delete(deleteUri, null, null);
Log.i(DEBUG_TAG, "Rows deleted: " + rows);  
</pre>
 <h2 id="attendees">
  Attendees Table
 </h2>
 <p>
  Each row of the
  <code>
   <a href="/reference/android/provider/CalendarContract.Attendees.html">
    CalendarContract.Attendees
   </a>
  </code>
  table
represents a single attendee or guest of an event. Calling
  <code>
   <a href="/reference/android/provider/CalendarContract.Reminders.html#query(android.content.ContentResolver, long, java.lang.String[])">
    query()
   </a>
  </code>
  returns a list of attendees for  the
event with the given
  <code>
   <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#EVENT_ID">
    EVENT_ID
   </a>
  </code>
  . 
This
  <code>
   <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#EVENT_ID">
    EVENT_ID
   </a>
  </code>
  must match the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  of a particular event.
 </p>
 <p>
  The following table lists the
writable fields. When inserting a new attendee, you must include all of them 
except
  <code>
   ATTENDEE_NAME
  </code>
  .
 </p>
 <table>
  <tr>
   <th>
    Constant
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#EVENT_ID">
      EVENT_ID
     </a>
    </code>
   </td>
   <td>
    The ID of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_NAME">
      ATTENDEE_NAME
     </a>
    </code>
   </td>
   <td>
    The name of the attendee.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_EMAIL">
      ATTENDEE_EMAIL
     </a>
    </code>
   </td>
   <td>
    The email address of the attendee.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_RELATIONSHIP">
      ATTENDEE_RELATIONSHIP
     </a>
    </code>
   </td>
   <td>
    <p>
     The relationship of the attendee to the event. One of:
    </p>
    <ul>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#RELATIONSHIP_ATTENDEE">
        RELATIONSHIP_ATTENDEE
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#RELATIONSHIP_NONE">
        RELATIONSHIP_NONE
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#RELATIONSHIP_ORGANIZER">
        RELATIONSHIP_ORGANIZER
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#RELATIONSHIP_PERFORMER">
        RELATIONSHIP_PERFORMER
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#RELATIONSHIP_SPEAKER">
        RELATIONSHIP_SPEAKER
       </a>
      </code>
     </li>
    </ul>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_TYPE">
      ATTENDEE_TYPE
     </a>
    </code>
   </td>
   <td>
    <p>
     The type of attendee. One of:
    </p>
    <ul>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#TYPE_REQUIRED">
        TYPE_REQUIRED
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#TYPE_OPTIONAL">
        TYPE_OPTIONAL
       </a>
      </code>
     </li>
    </ul>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_STATUS">
      ATTENDEE_STATUS
     </a>
    </code>
   </td>
   <td>
    <p>
     The attendance status of the attendee. One of:
    </p>
    <ul>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_STATUS_ACCEPTED">
        ATTENDEE_STATUS_ACCEPTED
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_STATUS_DECLINED">
        ATTENDEE_STATUS_DECLINED
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_STATUS_INVITED">
        ATTENDEE_STATUS_INVITED
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_STATUS_NONE">
        ATTENDEE_STATUS_NONE
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#ATTENDEE_STATUS_TENTATIVE">
        ATTENDEE_STATUS_TENTATIVE
       </a>
      </code>
     </li>
    </ul>
   </td>
  </tr>
 </table>
 <h3 id="add-attendees">
  Adding Attendees
 </h3>
 <p>
  Here is an example that adds a single attendee to an event. Note that the
  <code>
   <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#EVENT_ID">
    EVENT_ID
   </a>
  </code>
  is required:
 </p>
 <pre>
long eventID = 202;
...
ContentResolver cr = getContentResolver();
ContentValues values = new ContentValues();
values.put(Attendees.ATTENDEE_NAME, "Trevor");
values.put(Attendees.ATTENDEE_EMAIL, "trevor@example.com");
values.put(Attendees.ATTENDEE_RELATIONSHIP, Attendees.RELATIONSHIP_ATTENDEE);
values.put(Attendees.ATTENDEE_TYPE, Attendees.TYPE_OPTIONAL);
values.put(Attendees.ATTENDEE_STATUS, Attendees.ATTENDEE_STATUS_INVITED);
values.put(Attendees.EVENT_ID, eventID);
Uri uri = cr.insert(Attendees.CONTENT_URI, values);
</pre>
 <h2 id="reminders">
  Reminders Table
 </h2>
 <p>
  Each row of the
  <code>
   <a href="/reference/android/provider/CalendarContract.Reminders.html">
    CalendarContract.Reminders
   </a>
  </code>
  table
represents a single reminder for an event. Calling
  <code>
   <a href="/reference/android/provider/CalendarContract.Reminders.html#query(android.content.ContentResolver, long, java.lang.String[])">
    query()
   </a>
  </code>
  returns a list of reminders for the
event with the given
  <code>
   <a href="/reference/android/provider/CalendarContract.AttendeesColumns.html#EVENT_ID">
    EVENT_ID
   </a>
  </code>
  .
 </p>
 <p>
  The following table lists the writable fields for reminders. All of them must
be included when inserting a new reminder. Note that sync adapters specify the
types of reminders they support in the
  <code>
   <a href="/reference/android/provider/CalendarContract.Calendars.html">
    CalendarContract.Calendars
   </a>
  </code>
  table. See
  <code>
   <a href="/reference/android/provider/CalendarContract.CalendarColumns.html#ALLOWED_REMINDERS">
    ALLOWED_REMINDERS
   </a>
  </code>
  for details.
 </p>
 <table>
  <tr>
   <th>
    Constant
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#EVENT_ID">
      EVENT_ID
     </a>
    </code>
   </td>
   <td>
    The ID of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#MINUTES">
      MINUTES
     </a>
    </code>
   </td>
   <td>
    The minutes prior to the event that the reminder should fire.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#METHOD">
      METHOD
     </a>
    </code>
   </td>
   <td>
    <p>
     The alarm method, as set on the server. One of:
    </p>
    <ul>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#METHOD_ALERT">
        METHOD_ALERT
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#METHOD_DEFAULT">
        METHOD_DEFAULT
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#METHOD_EMAIL">
        METHOD_EMAIL
       </a>
      </code>
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/CalendarContract.RemindersColumns.html#METHOD_SMS">
        METHOD_SMS
       </a>
      </code>
     </li>
    </ul>
   </td>
  </tr>
 </table>
 <h3 id="add-reminders">
  Adding Reminders
 </h3>
 <p>
  This example adds a reminder to an event. The reminder fires 15
minutes before the event.
 </p>
 <pre>
long eventID = 221;
...
ContentResolver cr = getContentResolver();
ContentValues values = new ContentValues();
values.put(Reminders.MINUTES, 15);
values.put(Reminders.EVENT_ID, eventID);
values.put(Reminders.METHOD, Reminders.METHOD_ALERT);
Uri uri = cr.insert(Reminders.CONTENT_URI, values);</pre>
 <h2 id="instances">
  Instances Table
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/provider/CalendarContract.Instances.html">
    CalendarContract.Instances
   </a>
  </code>
  table holds the
start and end time for occurrences of an event. Each row in this table
represents a single event occurrence. The instances table is not writable and only
provides a  way to query event occurrences.
 </p>
 <p>
  The following table lists some of the fields you can query on for an instance. Note 
that time zone is defined by
  <code>
   <a href="/reference/android/provider/CalendarContract.CalendarCache.html#KEY_TIMEZONE_TYPE">
    KEY_TIMEZONE_TYPE
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/provider/CalendarContract.CalendarCache.html#KEY_TIMEZONE_INSTANCES">
    KEY_TIMEZONE_INSTANCES
   </a>
  </code>
  .
 </p>
 <table>
  <tr>
   <th>
    Constant
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#BEGIN">
      BEGIN
     </a>
    </code>
   </td>
   <td>
    The beginning time of the instance, in UTC milliseconds.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#END">
      END
     </a>
    </code>
   </td>
   <td>
    The ending time of the instance, in UTC milliseconds.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#END_DAY">
      END_DAY
     </a>
    </code>
   </td>
   <td>
    The Julian end day of the instance, relative to the Calendar's time
zone.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#END_MINUTE">
      END_MINUTE
     </a>
    </code>
   </td>
   <td>
    The end minute of the instance measured from midnight in the
Calendar's time zone.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#EVENT_ID">
      EVENT_ID
     </a>
    </code>
   </td>
   <td>
    The
    <code>
     _ID
    </code>
    of the event for this instance.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#START_DAY">
      START_DAY
     </a>
    </code>
   </td>
   <td>
    The Julian start day of the instance, relative to the Calendar's time zone.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.Instances.html#START_MINUTE">
      START_MINUTE
     </a>
    </code>
   </td>
   <td>
    The start minute of the instance measured from midnight, relative to the
Calendar's time zone.
   </td>
  </tr>
 </table>
 <h3 id="query-instances">
  Querying the Instances table
 </h3>
 <p>
  To query the Instances table, you need to specify a range time for the query
in the URI. In this example,
  <code>
   <a href="/reference/android/provider/CalendarContract.Instances.html">
    CalendarContract.Instances
   </a>
  </code>
  gets access to the
  <code>
   <a href="/reference/android/provider/CalendarContract.EventsColumns.html#TITLE">
    TITLE
   </a>
  </code>
  field through its
implementation of the
  <code>
   <a href="/reference/android/provider/CalendarContract.EventsColumns.html">
    CalendarContract.EventsColumns
   </a>
  </code>
  interface. 
In other words,
  <code>
   <a href="/reference/android/provider/CalendarContract.EventsColumns.html#TITLE">
    TITLE
   </a>
  </code>
  is returned through a
database view, not through querying the raw
  <code>
   <a href="/reference/android/provider/CalendarContract.Instances.html">
    CalendarContract.Instances
   </a>
  </code>
  table.
 </p>
 <pre>
private static final String DEBUG_TAG = "MyActivity";
public static final String[] INSTANCE_PROJECTION = new String[] {
    Instances.EVENT_ID,      // 0
    Instances.BEGIN,         // 1
    Instances.TITLE          // 2
  };
  
// The indices for the projection array above.
private static final int PROJECTION_ID_INDEX = 0;
private static final int PROJECTION_BEGIN_INDEX = 1;
private static final int PROJECTION_TITLE_INDEX = 2;
...

// Specify the date range you want to search for recurring
// event instances
Calendar beginTime = Calendar.getInstance();
beginTime.set(2011, 9, 23, 8, 0);
long startMillis = beginTime.getTimeInMillis();
Calendar endTime = Calendar.getInstance();
endTime.set(2011, 10, 24, 8, 0);
long endMillis = endTime.getTimeInMillis();
  
Cursor cur = null;
ContentResolver cr = getContentResolver();

// The ID of the recurring event whose instances you are searching
// for in the Instances table
String selection = Instances.EVENT_ID + " = ?";
String[] selectionArgs = new String[] {"207"};

// Construct the query with the desired date range.
Uri.Builder builder = Instances.CONTENT_URI.buildUpon();
ContentUris.appendId(builder, startMillis);
ContentUris.appendId(builder, endMillis);

// Submit the query
cur =  cr.query(builder.build(), 
    INSTANCE_PROJECTION, 
    selection, 
    selectionArgs, 
    null);
   
while (cur.moveToNext()) {
    String title = null;
    long eventID = 0;
    long beginVal = 0;    
    
    // Get the field values
    eventID = cur.getLong(PROJECTION_ID_INDEX);
    beginVal = cur.getLong(PROJECTION_BEGIN_INDEX);
    title = cur.getString(PROJECTION_TITLE_INDEX);
              
    // Do something with the values. 
    Log.i(DEBUG_TAG, "Event:  " + title); 
    Calendar calendar = Calendar.getInstance();
    calendar.setTimeInMillis(beginVal);  
    DateFormat formatter = new SimpleDateFormat("MM/dd/yyyy");
    Log.i(DEBUG_TAG, "Date: " + formatter.format(calendar.getTime()));    
    }
 }</pre>
 <h2 id="intents">
  Calendar Intents
 </h2>
 <p>
  Your application doesn't need
  <a href="#manifest">
   permissions
  </a>
  to read and write calendar data. It can instead use intents supported by Android's Calendar application to hand off read and write operations to that application. The following table lists the intents supported by the Calendar Provider:
 </p>
 <table>
  <tr>
   <th>
    Action
   </th>
   <th>
    URI
   </th>
   <th>
    Description
   </th>
   <th>
    Extras
   </th>
  </tr>
  <tr>
   <td>
    <br/>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_VIEW">
      VIEW
     </a>
    </code>
    <br/>
   </td>
   <td>
    <p>
     <code>
      content://com.android.calendar/time/&lt;ms_since_epoch&gt;
     </code>
    </p>
    You can also refer to the URI with
    <code>
     <a href="/reference/android/provider/CalendarContract.html#CONTENT_URI">
      CalendarContract.CONTENT_URI
     </a>
    </code>
    . 
For an example of using this intent, see
    <a href="/guide/topics/providers/calendar-provider.html#intent-view">
     Using intents to view calendar data
    </a>
    .
   </td>
   <td>
    Open calendar to the time specified by
    <code>
     &lt;ms_since_epoch&gt;
    </code>
    .
   </td>
   <td>
    None.
   </td>
  </tr>
  <tr>
   <td>
    <p>
     <code>
      <a href="/reference/android/content/Intent.html#ACTION_VIEW">
       VIEW
      </a>
     </code>
    </p>
   </td>
   <td>
    <p>
     <code>
      content://com.android.calendar/events/&lt;event_id&gt;
     </code>
    </p>
    You can also refer to the URI with
    <code>
     <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
      Events.CONTENT_URI
     </a>
    </code>
    . 
For an example of using this intent, see
    <a href="/guide/topics/providers/calendar-provider.html#intent-view">
     Using intents to view calendar data
    </a>
    .
   </td>
   <td>
    View the event specified by
    <code>
     &lt;event_id&gt;
    </code>
    .
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_BEGIN_TIME">
      CalendarContract.EXTRA_EVENT_BEGIN_TIME
     </a>
    </code>
    <br/>
    <br/>
    <br/>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_END_TIME">
      CalendarContract.EXTRA_EVENT_END_TIME
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_EDIT">
      EDIT
     </a>
    </code>
   </td>
   <td>
    <p>
     <code>
      content://com.android.calendar/events/&lt;event_id&gt;
     </code>
    </p>
    You can also refer to the URI with
    <code>
     <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
      Events.CONTENT_URI
     </a>
    </code>
    . 
For an example of using this intent, see
    <a href="/guide/topics/providers/calendar-provider.html#intent-edit">
     Using an intent to edit an event
    </a>
    .
   </td>
   <td>
    Edit the event specified by
    <code>
     &lt;event_id&gt;
    </code>
    .
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_BEGIN_TIME">
      CalendarContract.EXTRA_EVENT_BEGIN_TIME
     </a>
    </code>
    <br/>
    <br/>
    <br/>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_END_TIME">
      CalendarContract.EXTRA_EVENT_END_TIME
     </a>
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_EDIT">
      EDIT
     </a>
    </code>
    <br/>
    <br/>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_INSERT">
      INSERT
     </a>
    </code>
   </td>
   <td>
    <p>
     <code>
      content://com.android.calendar/events
     </code>
    </p>
    You can also refer to the URI with
    <code>
     <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
      Events.CONTENT_URI
     </a>
    </code>
    . 
For an example of using this intent, see
    <a href="/guide/topics/providers/calendar-provider.html#intent-insert">
     Using an intent to insert an event
    </a>
    .
   </td>
   <td>
    Create an event.
   </td>
   <td>
    Any of the extras listed in the table below.
   </td>
  </tr>
 </table>
 <p>
  The following table lists the intent extras supported by the Calendar Provider:
 </p>
 <table>
  <tr>
   <th>
    Intent Extra
   </th>
   <th>
    Description
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#TITLE">
      Events.TITLE
     </a>
    </code>
   </td>
   <td>
    Name for the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_BEGIN_TIME">
      CalendarContract.EXTRA_EVENT_BEGIN_TIME
     </a>
    </code>
   </td>
   <td>
    Event begin time in milliseconds from the epoch.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_END_TIME">
      CalendarContract.EXTRA_EVENT_END_TIME
     </a>
    </code>
   </td>
   <td>
    Event end time in milliseconds from the epoch.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_ALL_DAY">
      CalendarContract.EXTRA_EVENT_ALL_DAY
     </a>
    </code>
   </td>
   <td>
    A boolean that indicates that an event is all day. Value can be
    <code>
     true
    </code>
    or
    <code>
     false
    </code>
    .
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#EVENT_LOCATION">
      Events.EVENT_LOCATION
     </a>
    </code>
   </td>
   <td>
    Location of the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#DESCRIPTION">
      Events.DESCRIPTION
     </a>
    </code>
   </td>
   <td>
    Event description.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#EXTRA_EMAIL">
      Intent.EXTRA_EMAIL
     </a>
    </code>
   </td>
   <td>
    Email addresses of those to invite as a comma-separated list.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#RRULE">
      Events.RRULE
     </a>
    </code>
   </td>
   <td>
    The recurrence rule for the event.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#ACCESS_LEVEL">
      Events.ACCESS_LEVEL
     </a>
    </code>
   </td>
   <td>
    Whether the event is private or public.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/CalendarContract.EventsColumns.html#AVAILABILITY">
      Events.AVAILABILITY
     </a>
    </code>
   </td>
   <td>
    If this event counts as busy time or is free time that can be scheduled over.
   </td>
  </tr>
 </table>
 <p>
  The following sections describe how to use these intents.
 </p>
 <h3 id="intent-insert">
  Using an intent to insert an event
 </h3>
 <p>
  Using the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    INSERT
   </a>
  </code>
  Intent
lets your application hand off the event insertion task to the Calendar itself.
With this approach, your application doesn't even need to have the
  <code>
   <a href="/reference/android/Manifest.permission.html#WRITE_CALENDAR">
    WRITE_CALENDAR
   </a>
  </code>
  permission included in its
  <a href="#manifest">
   manifest file
  </a>
  .
 </p>
 <p>
  When users run an application that uses this approach, the application sends
them to the Calendar to finish adding the event. The
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_INSERT">
    INSERT
   </a>
  </code>
  Intent uses extra fields to
pre-populate a form with the details of the event in the Calendar. Users can
then cancel the event, edit the form as needed, or save the event to their
calendars.
 </p>
 <p>
  Here is a code snippet that schedules an event on January 19, 2012, that runs
from 7:30 a.m. to 8:30 a.m. Note the following about this code snippet:
 </p>
 <ul>
  <li>
   It specifies
   <code>
    <a href="/reference/android/provider/CalendarContract.Events.html#CONTENT_URI">
     Events.CONTENT_URI
    </a>
   </code>
   as the Uri.
  </li>
  <li>
   It uses the
   <code>
    <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_BEGIN_TIME">
     CalendarContract.EXTRA_EVENT_BEGIN_TIME
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/provider/CalendarContract.html#EXTRA_EVENT_END_TIME">
     CalendarContract.EXTRA_EVENT_END_TIME
    </a>
   </code>
   extra fields to pre-populate the form
with the time of the event. The values  for these times must be in UTC milliseconds
from the epoch.
  </li>
  <li>
   It uses the
   <code>
    <a href="/reference/android/content/Intent.html#EXTRA_EMAIL">
     Intent.EXTRA_EMAIL
    </a>
   </code>
   extra field to provide a comma-separated list of invitees, specified by email address.
  </li>
 </ul>
 <pre>
Calendar beginTime = Calendar.getInstance();
beginTime.set(2012, 0, 19, 7, 30);
Calendar endTime = Calendar.getInstance();
endTime.set(2012, 0, 19, 8, 30);
Intent intent = new Intent(Intent.ACTION_INSERT)
        .setData(Events.CONTENT_URI)
        .putExtra(CalendarContract.EXTRA_EVENT_BEGIN_TIME, beginTime.getTimeInMillis())
        .putExtra(CalendarContract.EXTRA_EVENT_END_TIME, endTime.getTimeInMillis())
        .putExtra(Events.TITLE, "Yoga")
        .putExtra(Events.DESCRIPTION, "Group class")
        .putExtra(Events.EVENT_LOCATION, "The gym")
        .putExtra(Events.AVAILABILITY, Events.AVAILABILITY_BUSY)
        .putExtra(Intent.EXTRA_EMAIL, "rowan@example.com,trevor@example.com");
startActivity(intent);
</pre>
 <h3 id="intent-edit">
  Using an intent to edit an event
 </h3>
 <p>
  You can update an event directly, as described in
  <a href="#update-event">
   Updating events
  </a>
  . But using the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_EDIT">
    EDIT
   </a>
  </code>
  Intent allows an application that
doesn't have permission to hand off event editing to the Calendar application.
When users finish editing their event in Calendar, they're returned to the
original application.
 </p>
 <p>
  Here is an example of an intent that sets a new
title for a specified event and lets users edit the event in the Calendar.
 </p>
 <pre>long eventID = 208;
Uri uri = ContentUris.withAppendedId(Events.CONTENT_URI, eventID);
Intent intent = new Intent(Intent.ACTION_EDIT)
    .setData(uri)
    .putExtra(Events.TITLE, "My New Title");
startActivity(intent);</pre>
 <h3 id="intent-view">
  Using  intents to view calendar data
 </h3>
 <p>
  Calender Provider offers two different ways to use the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_VIEW">
    VIEW
   </a>
  </code>
  Intent:
 </p>
 <ul>
  <li>
   To open the Calendar to a particular date.
  </li>
  <li>
   To view an event.
  </li>
 </ul>
 <p>
  Here is an example that shows how to open the Calendar to a particular date:
 </p>
 <pre>// A date-time specified in milliseconds since the epoch.
long startMillis;
...
Uri.Builder builder = CalendarContract.CONTENT_URI.buildUpon();
builder.appendPath("time");
ContentUris.appendId(builder, startMillis);
Intent intent = new Intent(Intent.ACTION_VIEW)
    .setData(builder.build());
startActivity(intent);</pre>
 <p>
  Here is an example that shows how to open an event for viewing:
 </p>
 <pre>long eventID = 208;
...
Uri uri = ContentUris.withAppendedId(Events.CONTENT_URI, eventID);
Intent intent = new Intent(Intent.ACTION_VIEW)
   .setData(uri);
startActivity(intent);
</pre>
 <h2 id="sync-adapter">
  Sync Adapters
 </h2>
 <p>
  There are only minor differences in how an application and a sync adapter
access the Calendar Provider:
 </p>
 <ul>
  <li>
   A sync adapter needs to specify that it's a sync adapter by setting
   <code>
    <a href="/reference/android/provider/CalendarContract.html#CALLER_IS_SYNCADAPTER">
     CALLER_IS_SYNCADAPTER
    </a>
   </code>
   to
   <code>
    true
   </code>
   .
  </li>
  <li>
   A sync adapter needs to provide an
   <code>
    <a href="/reference/android/provider/CalendarContract.SyncColumns.html#ACCOUNT_NAME">
     ACCOUNT_NAME
    </a>
   </code>
   and an
   <code>
    <a href="/reference/android/provider/CalendarContract.SyncColumns.html#ACCOUNT_TYPE">
     ACCOUNT_TYPE
    </a>
   </code>
   as query parameters in the URI.
  </li>
  <li>
   A sync adapter has write access to more columns than an application or widget.
  For example, an application can only modify a few characteristics of a calendar, 
  such as its name, display name, visibility setting, and whether the calendar is
  synced. By comparison, a sync adapter can access not only those columns, but many others,
  such as calendar color, time zone, access level, location, and so on.
However, a sync adapter is restricted to the
   <code>
    ACCOUNT_NAME
   </code>
   and
   <code>
    ACCOUNT_TYPE
   </code>
   it specified.
  </li>
 </ul>
 <p>
  Here is a helper method you can use to return a URI for use with a sync adapter:
 </p>
 <pre> static Uri asSyncAdapter(Uri uri, String account, String accountType) {
    return uri.buildUpon()
        .appendQueryParameter(android.provider.CalendarContract.CALLER_IS_SYNCADAPTER,"true")
        .appendQueryParameter(Calendars.ACCOUNT_NAME, account)
        .appendQueryParameter(Calendars.ACCOUNT_TYPE, accountType).build();
 }
</pre>
 <p>
  For a sample implementation of a sync adapter (not specifically related to Calendar), see
  <a href="/resources/samples/SampleSyncAdapter/index.html">
   SampleSyncAdapter
  </a>
  .
 </p>
</div>
<h1>Contacts Provider</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    Quickview
   </h2>
   <ul>
    <li>
     Android's repository of information about people.
    </li>
    <li>
     Syncs with the web.
    </li>
    <li>
     Integrates social stream data.
    </li>
   </ul>
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#InformationTypes">
      Contacts Provider Organization
     </a>
    </li>
    <li>
     <a href="#RawContactBasics">
      Raw contacts
     </a>
    </li>
    <li>
     <a href="#DataBasics">
      Data
     </a>
    </li>
    <li>
     <a href="#ContactBasics">
      Contacts
     </a>
    </li>
    <li>
     <a href="#Sources">
      Data From Sync Adapters
     </a>
    </li>
    <li>
     <a href="#Permissions">
      Required Permissions
     </a>
    </li>
    <li>
     <a href="#UserProfile">
      The User Profile
     </a>
    </li>
    <li>
     <a href="#ContactsProviderMetadata">
      Contacts Provider Metadata
     </a>
    </li>
    <li>
     <a href="#Access">
      Contacts Provider Access
     </a>
    </li>
    <li>
    </li>
    <li>
     <a href="#SyncAdapters">
      Contacts Provider Sync Adapters
     </a>
    </li>
    <li>
     <a href="#SocialStream">
      Social Stream Data
     </a>
    </li>
    <li>
     <a href="#AdditionalFeatures">
      Additional Contacts Provider Features
     </a>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.Contacts.html">
       ContactsContract.Contacts
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.RawContacts.html">
       ContactsContract.RawContacts
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.Data.html">
       ContactsContract.Data
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.StreamItems.html">
       ContactsContract.StreamItems
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Related Samples
   </h2>
   <ol>
    <li>
     <a href="/resources/samples/ContactManager/index.html">
      Contact Manager
     </a>
    </li>
    <li>
     <a href="/resources/samples/SampleSyncAdapter/index.html">
      Sample Sync Adapter
     </a>
    </li>
   </ol>
   <h2>
    See Also
   </h2>
   <ol>
    <li>
     <a href="/guide/topics/providers/content-provider-basics.html">
      Content Provider Basics
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  The Contacts Provider is a powerful and flexible Android component that manages the
    device's central repository of data about people. The Contacts Provider is the source of data
    you see in the device's contacts application, and you can also access its data in your own
    application and transfer data between the device and online services. The provider accommodates
    a wide range of data sources and tries to manage as much data as possible for each person, with
    the result that its organization is complex. Because of this, the provider's API includes an
    extensive set of contract classes and interfaces that facilitate both data retrieval and
    modification.
 </p>
 <p>
  This guide describes the following:
 </p>
 <ul>
  <li>
   The basic provider structure.
  </li>
  <li>
   How to retrieve data from the provider.
  </li>
  <li>
   How to modify data in the provider.
  </li>
  <li>
   How to write a sync adapter for synchronizing data from your server to the
            Contacts Provider.
  </li>
 </ul>
 <p>
  This guide assumes that you know the basics of Android content providers. To learn more
    about Android content providers, read the
  <a href="/guide/topics/providers/content-provider-basics.html">
   Content Provider Basics
  </a>
  guide. The
  <a href="/resources/samples/SampleSyncAdapter/index.html">
   Sample Sync Adapter
  </a>
  sample app is an example of using a sync adapter to transfer data between the Contacts
    Provider and a sample application hosted by Google Web Services.
 </p>
 <h2 id="InformationTypes">
  Contacts Provider Organization
 </h2>
 <p>
  The Contacts Provider is an Android content provider component. It maintains three types of
    data about a person, each of which corresponds to a table offered by the provider, as
    illustrated in figure 1:
 </p>
 <img alt="" height="364" id="figure1" src="http://developer.android.com/images/providers/contacts_structure.png"/>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  Contacts Provider table structure.
 </p>
 <p>
  The three tables are commonly referred to by the names of their contract classes. The classes
    define constants for content URIs, column names, and column values used by the tables:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.Contacts.html">
     ContactsContract.Contacts
    </a>
   </code>
   table
  </dt>
  <dd>
   Rows representing different people, based on aggregations of raw contact rows.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html">
     ContactsContract.RawContacts
    </a>
   </code>
   table
  </dt>
  <dd>
   Rows containing a summary of a person's data, specific to a user account and type.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   table
  </dt>
  <dd>
   Rows containing the details for raw contact, such as email addresses or phone numbers.
  </dd>
 </dl>
 <p>
  The other tables represented by contract classes in
  <code>
   <a href="/reference/android/provider/ContactsContract.html">
    ContactsContract
   </a>
  </code>
  are auxiliary tables that the Contacts Provider uses to manage its operations or support
    specific functions in the device's contacts or telephony applications.
 </p>
 <h2 id="RawContactBasics">
  Raw contacts
 </h2>
 <p>
  A raw contact represents a person's data coming from a single account type and account
    name. Because the Contacts Provider allows more than one online service as the source of
    data for a person, the Contacts Provider allows multiple raw contacts for the same person.
    Multiple raw contacts also allow a user to combine a person's data from more than one account
    from the same account type.
 </p>
 <p>
  Most of the data for a raw contact isn't stored in the
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  table. Instead, it's stored in one or more
    rows in the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table. Each data row has a column
  <code>
   <a href="/reference/android/provider/ContactsContract.DataColumns.html#RAW_CONTACT_ID">
    Data.RAW_CONTACT_ID
   </a>
  </code>
  that
    contains the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    RawContacts._ID
   </a>
  </code>
  value of its
    parent
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  row.
 </p>
 <h3 id="RawContactsColumns">
  Important raw contact columns
 </h3>
 <p>
  The important columns in the
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  table are
    listed in table 1. Please read the notes that follow after the table:
 </p>
 <p class="table-caption" id="table1">
  <strong>
   Table 1.
  </strong>
  Important raw contact columns.
 </p>
 <table>
  <tr>
   <th scope="col">
    Column name
   </th>
   <th scope="col">
    Use
   </th>
   <th scope="col">
    Notes
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#ACCOUNT_NAME">
      ACCOUNT_NAME
     </a>
    </code>
   </td>
   <td>
    The account name for the account type that's the source of this raw contact.
            For example, the account name of a Google account is one of the device owner's Gmail
            addresses. See the next entry for
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#ACCOUNT_TYPE">
      ACCOUNT_TYPE
     </a>
    </code>
    for more
            information.
   </td>
   <td>
    The format of this name is specific to its account type. It is not
            necessarily an email address.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#ACCOUNT_TYPE">
      ACCOUNT_TYPE
     </a>
    </code>
   </td>
   <td>
    The account type that's the source of this raw contact. For example, the account
            type of a Google account is
    <code>
     com.google
    </code>
    . Always qualify your account type
            with a domain identifier for a domain you own or control. This will ensure that your
            account type is unique.
   </td>
   <td>
    An account type that offers contacts data usually has an associated sync adapter that
            synchronizes with the Contacts Provider.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.RawContactsColumns.html#DELETED">
      DELETED
     </a>
    </code>
   </td>
   <td>
    The "deleted" flag for a raw contact.
   </td>
   <td>
    This flag allows the Contacts Provider to maintain the row internally until sync
            adapters are able to delete the row from their servers and then finally delete the row
            from the repository.
   </td>
  </tr>
 </table>
 <h4>
  Notes
 </h4>
 <p>
  The following are important notes about the
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  table:
 </p>
 <ul>
  <li>
   A raw contact's name is not stored in its row in
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html">
     ContactsContract.RawContacts
    </a>
   </code>
   . Instead, it's stored in
        the
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   table, in a
   <code>
    <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredName.html">
     ContactsContract.CommonDataKinds.StructuredName
    </a>
   </code>
   row. A raw contact
        has only one row of this type in the
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   table.
  </li>
  <li>
   <strong>
    Caution:
   </strong>
   To use your own account data in a raw contact row, it must
        first be registered with the
   <code>
    <a href="/reference/android/accounts/AccountManager.html">
     AccountManager
    </a>
   </code>
   . To do this, prompt
        users to add the account type and their account name to the list of accounts. If you don't
        do this, the Contacts Provider will automatically delete your raw contact row.
   <p>
    For example, if you want your app to maintain contacts data for your web-based service
            with the domain
    <code>
     com.example.dataservice
    </code>
    , and the user's account for your service
            is
    <code>
     becky.sharp@dataservice.example.com
    </code>
    , the user must first add the account
            "type" (
    <code>
     com.example.dataservice
    </code>
    ) and account "name"
            (
    <code>
     becky.smart@dataservice.example.com
    </code>
    ) before your app can add raw contact rows.
            You can explain this requirement to the user in documentation, or you can prompt the
            user to add the type and name, or both. Account types and account names
            are described in more detail in the next section.
   </p>
  </li>
 </ul>
 <h3 id="RawContactsExample">
  Sources of raw contacts data
 </h3>
 <p>
  To understand how raw contacts work, consider the user "Emily Dickinson" who has the following
    three user accounts defined on her device:
 </p>
 <ul>
  <li>
   <code>
    emily.dickinson@gmail.com
   </code>
  </li>
  <li>
   <code>
    emilyd@gmail.com
   </code>
  </li>
  <li>
   Twitter account "belle_of_amherst"
  </li>
 </ul>
 <p>
  This user has enabled
  <em>
   Sync Contacts
  </em>
  for all three of these accounts in the
  <em>
   Accounts
  </em>
  settings.
 </p>
 <p>
  Suppose Emily Dickinson opens a browser window, logs into Gmail as
  <code>
   emily.dickinson@gmail.com
  </code>
  , opens
    Contacts, and adds "Thomas Higginson". Later on, she logs into Gmail as
  <code>
   emilyd@gmail.com
  </code>
  and sends an email to "Thomas Higginson", which automatically
    adds him as a contact. She also follows "colonel_tom" (Thomas Higginson's Twitter ID) on
    Twitter.
 </p>
 <p>
  The Contacts Provider creates three raw contacts as a result of this work:
 </p>
 <ol>
  <li>
   A raw contact for "Thomas Higginson" associated with
   <code>
    emily.dickinson@gmail.com
   </code>
   .
        The user account type is Google.
  </li>
  <li>
   A second raw contact for "Thomas Higginson" associated with
   <code>
    emilyd@gmail.com
   </code>
   .
        The user account type is also Google. There is a second raw contact even
        though the name is identical to a previous name, because the person was added for a
        different user account.
  </li>
  <li>
   A third raw contact for "Thomas Higginson" associated with "belle_of_amherst". The user
        account type is Twitter.
  </li>
 </ol>
 <h2 id="DataBasics">
  Data
 </h2>
 <p>
  As noted previously, the data for a raw contact is stored in a
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  row that is linked to the raw contact's
  <code>
   _ID
  </code>
  value. This allows a single raw contact to have multiple instances of the same
    type of data such as email addresses or phone numbers. For example, if
    "Thomas Higginson" for
  <code>
   emilyd@gmail.com
  </code>
  (the raw contact row for Thomas Higginson
    associated with the Google account
  <code>
   emilyd@gmail.com
  </code>
  ) has a home email address of
  <code>
   thigg@gmail.com
  </code>
  and a work email address of
  <code>
   thomas.higginson@gmail.com
  </code>
  , the Contacts Provider stores the two email address
    rows and links them both to the raw contact.
 </p>
 <p>
  Notice that different types of data are stored in this single table. Display name,
    phone number, email, postal address, photo, and website detail rows are all found in the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table. To help manage this, the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table has some columns with descriptive names,
    and others with generic names. The contents of a descriptive-name column have the same meaning
    regardless of the type of data in the row, while the contents of a generic-name column have
    different meanings depending on the type of data.
 </p>
 <h3 id="DescriptiveColumns">
  Descriptive column names
 </h3>
 <p>
  Some examples of descriptive column names are:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.DataColumns.html#RAW_CONTACT_ID">
     RAW_CONTACT_ID
    </a>
   </code>
  </dt>
  <dd>
   The value of the
   <code>
    _ID
   </code>
   column of the raw contact for this data.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.DataColumns.html#MIMETYPE">
     MIMETYPE
    </a>
   </code>
  </dt>
  <dd>
   The type of data stored in this row, expressed as a custom MIME type. The Contacts Provider
        uses the MIME types defined in the subclasses of
   <code>
    <a href="/reference/android/provider/ContactsContract.CommonDataKinds.html">
     ContactsContract.CommonDataKinds
    </a>
   </code>
   . These MIME types are open source,
        and can be used by any application or sync adapter that works with the Contacts Provider.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.DataColumns.html#IS_PRIMARY">
     IS_PRIMARY
    </a>
   </code>
  </dt>
  <dd>
   If this type of data row can occur more than once for a raw contact, the
   <code>
    <a href="/reference/android/provider/ContactsContract.DataColumns.html#IS_PRIMARY">
     IS_PRIMARY
    </a>
   </code>
   column flags
        the data row that contains the primary data for the type. For example, if
        the user long-presses a phone number for a contact and selects
   <strong>
    Set default
   </strong>
   ,
        then the
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   row containing that number
        has its
   <code>
    <a href="/reference/android/provider/ContactsContract.DataColumns.html#IS_PRIMARY">
     IS_PRIMARY
    </a>
   </code>
   column set to a
        non-zero value.
  </dd>
 </dl>
 <h3 id="GenericColumns">
  Generic column names
 </h3>
 <p>
  There are 15 generic columns named
  <code>
   DATA1
  </code>
  through
  <code>
   DATA15
  </code>
  that are generally available and an additional four generic
    columns
  <code>
   SYNC1
  </code>
  through
  <code>
   SYNC4
  </code>
  that should only be used by sync
    adapters. The generic column name constants always work, regardless of the type of
    data the row contains.
 </p>
 <p>
  The
  <code>
   DATA1
  </code>
  column is indexed.  The Contacts Provider always uses this column for
    the data that the provider expects will be the most frequent target of a query. For example,
    in an email row, this column contains the actual email address.
 </p>
 <p>
  By convention, the column
  <code>
   DATA15
  </code>
  is reserved for storing Binary Large Object
    (BLOB) data such as photo thumbnails.
 </p>
 <h3 id="TypeSpecificNames">
  Type-specific column names
 </h3>
 <p>
  To facilitate working with the columns for a particular type of row, the Contacts Provider
    also provides type-specific column name constants, defined in subclasses of
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.html">
    ContactsContract.CommonDataKinds
   </a>
  </code>
  . The constants simply give a
    different constant name to the same column name, which helps you access data in a row of a
    particular type.
 </p>
 <p>
  For example, the
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html">
    ContactsContract.CommonDataKinds.Email
   </a>
  </code>
  class defines
    type-specific column name constants for a
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  row
    that has the MIME type
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html#CONTENT_ITEM_TYPE">
    Email.CONTENT_ITEM_TYPE
   </a>
  </code>
  . The class contains the constant
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html#ADDRESS">
    ADDRESS
   </a>
  </code>
  for the email address
    column. The actual value of
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html#ADDRESS">
    ADDRESS
   </a>
  </code>
  is "data1", which is
    the same as the column's generic name.
 </p>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  Don't add your own custom data to the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table using a row that has one of the
    provider's pre-defined MIME types. If you do, you may lose the data or cause the provider to
    malfunction. For example, you should not add a row with the MIME type
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html#CONTENT_ITEM_TYPE">
    Email.CONTENT_ITEM_TYPE
   </a>
  </code>
  that contains a user name instead of an email address in the
    column
  <code>
   DATA1
  </code>
  . If you use your own custom MIME type for the row, then you are free
    to define your own type-specific column names and use the columns however you wish.
 </p>
 <p>
  Figure 2 shows how descriptive columns and data columns appear in a
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  row, and how type-specific column names "overlay"
    the generic column names
 </p>
 <img alt="How type-specific column names map to generic column names" height="311" id="figure2" src="http://developer.android.com/images/providers/data_columns.png"/>
 <p class="img-caption">
  <strong>
   Figure 2.
  </strong>
  Type-specific column names and generic column names.
 </p>
 <h3 id="ColumnMaps">
  Type-specific column name classes
 </h3>
 <p>
  Table 2 lists the most commonly-used type-specific column name classes:
 </p>
 <p class="table-caption" id="table2">
  <strong>
   Table 2.
  </strong>
  Type-specific column name classes
 </p>
 <table>
  <tr>
   <th scope="col">
    Mapping class
   </th>
   <th scope="col">
    Type of data
   </th>
   <th scope="col">
    Notes
   </th>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredName.html">
      ContactsContract.CommonDataKinds.StructuredName
     </a>
    </code>
   </td>
   <td>
    The name data for the raw contact associated with this data row.
   </td>
   <td>
    A raw contact has only one of these rows.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Photo.html">
      ContactsContract.CommonDataKinds.Photo
     </a>
    </code>
   </td>
   <td>
    The main photo for the raw contact associated with this data row.
   </td>
   <td>
    A raw contact has only one of these rows.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html">
      ContactsContract.CommonDataKinds.Email
     </a>
    </code>
   </td>
   <td>
    An email address for the raw contact associated with this data row.
   </td>
   <td>
    A raw contact can have multiple email addresses.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredPostal.html">
      ContactsContract.CommonDataKinds.StructuredPostal
     </a>
    </code>
   </td>
   <td>
    A postal address for the raw contact associated with this data row.
   </td>
   <td>
    A raw contact can have multiple postal addresses.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.CommonDataKinds.GroupMembership.html">
      ContactsContract.CommonDataKinds.GroupMembership
     </a>
    </code>
   </td>
   <td>
    An identifier that links the raw contact to one of the groups in the Contacts Provider.
   </td>
   <td>
    Groups are an optional feature of an account type and account name. They're described in
        more detail in the section
    <a href="#Groups">
     Contact groups
    </a>
    .
   </td>
  </tr>
 </table>
 <h3 id="ContactBasics">
  Contacts
 </h3>
 <p>
  The Contacts Provider combines the raw contact rows across all account types and account names
    to form a
  <strong>
   contact
  </strong>
  . This facilitates displaying and modifying all the data a
    user has collected for a person. The Contacts Provider manages the creation of new contact
    rows, and the aggregation of raw contacts with an existing contact row. Neither applications nor
    sync adapters are allowed to add contacts, and some columns in a contact row are read-only.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  If you try to add a contact to the Contacts Provider with an
  <code>
   <a href="/reference/android/content/ContentResolver.html#insert(android.net.Uri, android.content.ContentValues)">
    insert()
   </a>
  </code>
  , you'll get
    an
  <code>
   <a href="/reference/java/lang/UnsupportedOperationException.html">
    UnsupportedOperationException
   </a>
  </code>
  exception. If you try to update a column
    that's listed as "read-only," the update is ignored.
 </p>
 <p>
  The Contacts Provider creates a new contact in response to the addition of a new raw contact
    that doesn't match any existing contacts. The provider also does this if an existing raw
    contact's data changes in such a way that it no longer matches the contact to which it was
    previously attached. If an application or sync adapter creates a new raw contact that
  <em>
   does
  </em>
  match an existing contact, the new raw contact is aggregated to the existing
    contact.
 </p>
 <p>
  The Contacts Provider links a contact row to its raw contact rows with the contact row's
  <code>
   _ID
  </code>
  column in the
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html">
    Contacts
   </a>
  </code>
  table. The
  <code>
   CONTACT_ID
  </code>
  column of the raw contacts table
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  contains
  <code>
   _ID
  </code>
  values for
    the contacts row associated with each raw contacts row.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html">
    ContactsContract.Contacts
   </a>
  </code>
  table also has the column
  <code>
   <a href="/reference/android/provider/ContactsContract.ContactsColumns.html#LOOKUP_KEY">
    LOOKUP_KEY
   </a>
  </code>
  that is a
    "permanent" link to the contact row. Because the Contacts Provider maintains contacts
    automatically, it may change a contact row's
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  value
    in response to an aggregation or sync. Even If this happens, the content URI
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_LOOKUP_URI">
    CONTENT_LOOKUP_URI
   </a>
  </code>
  combined with
    contact's
  <code>
   <a href="/reference/android/provider/ContactsContract.ContactsColumns.html#LOOKUP_KEY">
    LOOKUP_KEY
   </a>
  </code>
  will still
    point to the contact row, so you can use
  <code>
   <a href="/reference/android/provider/ContactsContract.ContactsColumns.html#LOOKUP_KEY">
    LOOKUP_KEY
   </a>
  </code>
  to maintain links to "favorite" contacts, and so forth. This column has its own format that is
    unrelated to the format of the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  column.
 </p>
 <p>
  Figure 3 shows how the three main tables relate to each other.
 </p>
 <img alt="Contacts provider main tables" height="514" id="figure4" src="http://developer.android.com/images/providers/contacts_tables.png"/>
 <p class="img-caption">
  <strong>
   Figure 3.
  </strong>
  Contacts, Raw Contacts, and Details table relationships.
 </p>
 <h2 id="Sources">
  Data From Sync Adapters
 </h2>
 <p>
  Users enter contacts data directly into the device, but data also flows into the Contacts
    Provider from web services via
  <strong>
   sync adapters
  </strong>
  , which automate
    the transfer of data between the device and services. Sync adapters run in the background
    under the control of the system, and they call
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  methods
    to manage data.
 </p>
 <p>
  In Android, the web service that a sync adapter works with is identified by an account type.
    Each sync adapter works with one account type, but it can support multiple account names for
    that type. Account types and account names are described briefly in the section
  <a href="#RawContactsExample">
   Sources of raw contacts data
  </a>
  . The following definitions offer
    more detail, and describe how account type and name relate to sync adapters and services.
 </p>
 <dl>
  <dt>
   Account type
  </dt>
  <dd>
   Identifies a service in which the user has stored data. Most of the time, the user has to
        authenticate with the service. For example, Google Contacts is an account type, identified
        by the code
   <code>
    google.com
   </code>
   . This value corresponds to the account type used by
   <code>
    <a href="/reference/android/accounts/AccountManager.html">
     AccountManager
    </a>
   </code>
   .
  </dd>
  <dt>
   Account name
  </dt>
  <dd>
   Identifies a particular account or login for an account type. Google Contacts accounts
        are the same as Google accounts, which have an email address as an account name.
        Other services may use a single-word username or numeric id.
  </dd>
 </dl>
 <p>
  Account types don't have to be unique. A user can configure multiple Google Contacts accounts
    and download their data to the Contacts Provider; this may happen if the user has one set of
    personal contacts for a personal account name, and another set for work. Account names are
    usually unique. Together, they identify a specific data flow between the Contacts Provider and
    an external service.
 </p>
 <p>
  If you want to transfer your service's data to the Contacts Provider, you need to write your
    own sync adapter. This is described in more detail in the section
  <a href="#SyncAdapters">
   Contacts Provider Sync Adapters
  </a>
  .
 </p>
 <p>
  Figure 4 shows how the Contacts Provider fits into the flow of data
    about people. In the box marked "sync adapters," each adapter is labeled by its account type.
 </p>
 <img alt="Flow of data about people" height="252" id="figure5" src="http://developer.android.com/images/providers/ContactsDataFlow.png"/>
 <p class="img-caption">
  <strong>
   Figure 4.
  </strong>
  The Contacts Provider flow of data.
 </p>
 <h2 id="Permissions">
  Required Permissions
 </h2>
 <p>
  Applications that want to access the Contacts Provider must request the following
    permissions:
 </p>
 <dl>
  <dt>
   Read access to one or more tables
  </dt>
  <dd>
   <code>
    <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
     READ_CONTACTS
    </a>
   </code>
   , specified in
   <code>
    AndroidManifest.xml
   </code>
   with the
   <code>
    <a href="/guide/topics/manifest/uses-permission-element.html">
     &lt;uses-permission&gt;
    </a>
   </code>
   element as
   <code>
    &lt;uses-permission android:name="android.permission.READ_CONTACTS"&gt;
   </code>
   .
  </dd>
  <dt>
   Write access to one or more tables
  </dt>
  <dd>
   <code>
    <a href="/reference/android/Manifest.permission.html#WRITE_CONTACTS">
     WRITE_CONTACTS
    </a>
   </code>
   , specified in
   <code>
    AndroidManifest.xml
   </code>
   with the
   <code>
    <a href="/guide/topics/manifest/uses-permission-element.html">
     &lt;uses-permission&gt;
    </a>
   </code>
   element as
   <code>
    &lt;uses-permission android:name="android.permission.WRITE_CONTACTS"&gt;
   </code>
   .
  </dd>
 </dl>
 <p>
  These permissions do not extend to the user profile data. The user profile and its
    required permissions are discussed in the following section,
  <a href="#UserProfile">
   The User Profile
  </a>
  .
 </p>
 <p>
  Remember that the user's contacts data is personal and sensitive. Users are concerned about
    their privacy, so they don't want applications collecting data about them or their contacts.
    If it's not obvious why you need permission to access their contacts data, they may give
    your application low ratings or simply refuse to install it.
 </p>
 <h2 id="UserProfile">
  The User Profile
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html">
    ContactsContract.Contacts
   </a>
  </code>
  table has a single row containing
    profile data for the device's user. This data describes the device's
  <code>
   user
  </code>
  rather
    than one of the user's contacts. The profile contacts row is linked to a raw
    contacts row for each system that uses a profile.
    Each profile raw contact row can have multiple data rows. Constants for accessing the user
    profile are available in the
  <code>
   <a href="/reference/android/provider/ContactsContract.Profile.html">
    ContactsContract.Profile
   </a>
  </code>
  class.
 </p>
 <p>
  Access to the user profile requires special permissions. In addition to the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_CONTACTS">
    READ_CONTACTS
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/Manifest.permission.html#WRITE_CONTACTS">
    WRITE_CONTACTS
   </a>
  </code>
  permissions needed to read and write, access
    to the user profile requires the
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_PROFILE">
    READ_PROFILE
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/Manifest.permission.html#WRITE_PROFILE">
    WRITE_PROFILE
   </a>
  </code>
  permissions for read and write access,
    respectively.
 </p>
 <p>
  Remember that you should consider a user's profile to be sensitive. The permission
  <code>
   <a href="/reference/android/Manifest.permission.html#READ_PROFILE">
    READ_PROFILE
   </a>
  </code>
  allows you to access the device user's
    personally-identifying data. Make sure to tell the user why
    you need user profile access permissions in the description of your application.
 </p>
 <p>
  To retrieve the contact row that contains the user's profile,
    call
  <code>
   <a href="/reference/android/content/ContentResolver.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    ContentResolver.query()
   </a>
  </code>
  . Set the content URI to
  <code>
   <a href="/reference/android/provider/ContactsContract.Profile.html#CONTENT_URI">
    CONTENT_URI
   </a>
  </code>
  and don't provide any
    selection criteria. You can also use this content URI as the base URI for retrieving raw
    contacts or data for the profile. For example, this snippet retrieves data for the profile:
 </p>
 <pre>
// Sets the columns to retrieve for the user profile
mProjection = new String[]
    {
        Profile._ID,
        Profile.DISPLAY_NAME_PRIMARY,
        Profile.LOOKUP_KEY,
        Profile.PHOTO_THUMBNAIL_URI
    };

// Retrieves the profile from the Contacts Provider
mProfileCursor =
        getContentResolver().query(
                Profile.CONTENT_URI,
                mProjection ,
                null,
                null,
                null);
</pre>
 <p class="note">
  <strong>
   Note:
  </strong>
  If you retrieve multiple contact rows, and you want to determine if one of them
    is the user profile, test the row's
  <code>
   <a href="/reference/android/provider/ContactsContract.ContactsColumns.html#IS_USER_PROFILE">
    IS_USER_PROFILE
   </a>
  </code>
  column. This column
    is set to "1" if the contact is the user profile.
 </p>
 <h2 id="ContactsProviderMetadata">
  Contacts Provider Metadata
 </h2>
 <p>
  The Contacts Provider manages data that keeps track of the state of contacts data in the
    repository. This metadata about the repository is stored in various places, including the
    Raw Contacts, Data, and Contacts table rows, the
  <code>
   <a href="/reference/android/provider/ContactsContract.Settings.html">
    ContactsContract.Settings
   </a>
  </code>
  table, and the
  <code>
   <a href="/reference/android/provider/ContactsContract.SyncState.html">
    ContactsContract.SyncState
   </a>
  </code>
  table. The following table shows the
    effect of each of these pieces of metadata:
 </p>
 <p class="table-caption" id="table3">
  <strong>
   Table 3.
  </strong>
  Metadata in the Contacts Provider
 </p>
 <table>
  <tr>
   <th scope="col">
    Table
   </th>
   <th scope="col">
    Column
   </th>
   <th scope="col">
    Values
   </th>
   <th scope="col">
    Meaning
   </th>
  </tr>
  <tr>
   <td rowspan="2">
    <code>
     <a href="/reference/android/provider/ContactsContract.RawContacts.html">
      ContactsContract.RawContacts
     </a>
    </code>
   </td>
   <td rowspan="2">
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#DIRTY">
      DIRTY
     </a>
    </code>
   </td>
   <td>
    "0" - not changed since the last sync.
   </td>
   <td rowspan="2">
    Marks raw contacts that were changed on the device and have to be synced back to the
            server. The value is set automatically by the Contacts Provider when Android
            applications update a row.
    <p>
     Sync adapters that modify the raw contact or data tables should always append the
                string
     <code>
      <a href="/reference/android/provider/ContactsContract.html#CALLER_IS_SYNCADAPTER">
       CALLER_IS_SYNCADAPTER
      </a>
     </code>
     to the
                content URI they use. This prevents the provider from marking rows as dirty.
                Otherwise, sync adapter modifications appear to be local modifications and are
                sent to the server, even though the server was the source of the modification.
    </p>
   </td>
  </tr>
  <tr>
   <td>
    "1" - changed since last sync, needs to be synced back to the server.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.RawContacts.html">
      ContactsContract.RawContacts
     </a>
    </code>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#VERSION">
      VERSION
     </a>
    </code>
   </td>
   <td>
    The version number of this row.
   </td>
   <td>
    The Contacts Provider automatically increments this value whenever the row or
            its related data changes.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.Data.html">
      ContactsContract.Data
     </a>
    </code>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.DataColumns.html#DATA_VERSION">
      DATA_VERSION
     </a>
    </code>
   </td>
   <td>
    The version number of this row.
   </td>
   <td>
    The Contacts Provider automatically increments this value whenever the data row
            is changed.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.RawContacts.html">
      ContactsContract.RawContacts
     </a>
    </code>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#SOURCE_ID">
      SOURCE_ID
     </a>
    </code>
   </td>
   <td>
    A string value that uniquely identifies this raw contact to the account in
            which it was created.
   </td>
   <td>
    When a sync adapter creates a new raw contact, this column should be set to the
            server's unique ID for the raw contact. When an Android application creates a new
            raw contact, the application should leave this column empty. This signals the sync
            adapter that it should create a new raw contact on the server, and get a
            value for the
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncColumns.html#SOURCE_ID">
      SOURCE_ID
     </a>
    </code>
    .
    <p>
     In particular, the source id must be
     <strong>
      unique
     </strong>
     for each account
                type and should be stable across syncs:
    </p>
    <ul>
     <li>
      Unique: Each raw contact for an account must have its own source id. If you
                        don't enforce this, you'll cause problems in the contacts application.
                        Notice that two raw contacts for the same account
      <em>
       type
      </em>
      may have
                        the same source id. For example, the raw contact "Thomas Higginson" for the
                        account
      <code>
       emily.dickinson@gmail.com
      </code>
      is allowed to have the same source
                        id as the raw contact "Thomas Higginson" for the account
      <code>
       emilyd@gmail.com
      </code>
      .
     </li>
     <li>
      Stable: Source ids are a permanent part of the online service's data for
                        the raw contact. For example, if the user clears Contacts Storage from the
                        Apps settings and re-syncs, the restored raw contacts should have the same
                        source ids as before. If you don't enforce this, shortcuts will stop
                        working.
     </li>
    </ul>
   </td>
  </tr>
  <tr>
   <td rowspan="2">
    <code>
     <a href="/reference/android/provider/ContactsContract.Groups.html">
      ContactsContract.Groups
     </a>
    </code>
   </td>
   <td rowspan="2">
    <code>
     <a href="/reference/android/provider/ContactsContract.GroupsColumns.html#GROUP_VISIBLE">
      GROUP_VISIBLE
     </a>
    </code>
   </td>
   <td>
    "0" - Contacts in this group should not be visible in Android application UIs.
   </td>
   <td>
    This column is for compatibility with servers that allow a user to hide contacts in
            certain groups.
   </td>
  </tr>
  <tr>
   <td>
    "1" - Contacts in this group are allowed to be visible in application UIs.
   </td>
  </tr>
  <tr>
   <td rowspan="2">
    <code>
     <a href="/reference/android/provider/ContactsContract.Settings.html">
      ContactsContract.Settings
     </a>
    </code>
   </td>
   <td rowspan="2">
    <code>
     <a href="/reference/android/provider/ContactsContract.SettingsColumns.html#UNGROUPED_VISIBLE">
      UNGROUPED_VISIBLE
     </a>
    </code>
   </td>
   <td>
    "0" - For this account and account type, contacts that don't belong to a group are
            invisible to Android application UIs.
   </td>
   <td rowspan="2">
    By default, contacts are invisible if none of their raw contacts belongs to a group
            (Group membership for a raw contact is indicated by one or more
    <code>
     <a href="/reference/android/provider/ContactsContract.CommonDataKinds.GroupMembership.html">
      ContactsContract.CommonDataKinds.GroupMembership
     </a>
    </code>
    rows
            in the
    <code>
     <a href="/reference/android/provider/ContactsContract.Data.html">
      ContactsContract.Data
     </a>
    </code>
    table).
            By setting this flag in the
    <code>
     <a href="/reference/android/provider/ContactsContract.Settings.html">
      ContactsContract.Settings
     </a>
    </code>
    table row
            for an account type and account, you can force contacts without groups to be visible.
            One use of this flag is to show contacts from servers that don't use groups.
   </td>
  </tr>
  <tr>
   <td>
    "1" - For this account and account type, contacts that don't belong to a group are
            visible to application UIs.
   </td>
  </tr>
  <tr>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.SyncState.html">
      ContactsContract.SyncState
     </a>
    </code>
   </td>
   <td>
    (all)
   </td>
   <td>
    Use this table to store metadata for your sync adapter.
   </td>
   <td>
    With this table you can store sync state and other sync-related data persistently on
            the device.
   </td>
  </tr>
 </table>
 <h2 id="Access">
  Contacts Provider Access
 </h2>
 <p>
  This section describes guidelines for accessing data from the Contacts Provider, focusing on
    the following:
 </p>
 <ul>
  <li>
   Entity queries.
  </li>
  <li>
   Batch modification.
  </li>
  <li>
   Retrieval and modification with intents.
  </li>
  <li>
   Data integrity.
  </li>
 </ul>
 <p>
  Making modifications from a sync adapter is also covered in more detail in the section
  <a href="#SyncAdapters">
   Contacts Provider Sync Adapters
  </a>
  .
 </p>
 <h3 id="Entities">
  Querying entities
 </h3>
 <p>
  Because the Contacts Provider tables are organized in a hierarchy, it's often useful to
    retrieve a row and all of the "child" rows that are linked to it. For example, to display
    all the information for a person, you may want to retrieve all the
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  rows for a single
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html">
    ContactsContract.Contacts
   </a>
  </code>
  row, or all the
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html">
    ContactsContract.CommonDataKinds.Email
   </a>
  </code>
  rows for a single
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  row. To facilitate this, the Contacts
    Provider offers
  <strong>
   entity
  </strong>
  constructs, which act like database joins between
    tables.
 </p>
 <p>
  An entity is like a table composed of selected columns from a parent table and its child table.
    When you query an entity, you supply a projection and search criteria based on the columns
    available from the entity. The result is a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  that contains
    contains one row for each child table row that was retrieved. For example, if you query
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.Entity.html">
    ContactsContract.Contacts.Entity
   </a>
  </code>
  for a contact name
    and all the
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html">
    ContactsContract.CommonDataKinds.Email
   </a>
  </code>
  rows for all the
    raw contacts for that name, you get back a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  containing one row
    for each
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html">
    ContactsContract.CommonDataKinds.Email
   </a>
  </code>
  row.
 </p>
 <p>
  Entities simplify queries. Using an entity, you can retrieve all of the contacts data for a
    contact or raw contact at once, instead of having to query the parent table first to get an
    ID, and then having to query the child table with that ID. Also, the Contacts Provider processes
    a query against an entity in a single transaction, which ensures that the retrieved data is
    internally consistent.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  An entity usually doesn't contain all the columns of the parent and
    child table. If you attempt to work with a column name that isn't in the list of column name
    constants for the entity, you'll get an
  <code>
   <a href="/reference/java/lang/Exception.html">
    Exception
   </a>
  </code>
  .
 </p>
 <p>
  The following snippet shows how to retrieve all the raw contact rows for a contact. The snippet
    is part of a larger application that has two activities, "main" and "detail". The main activity
    shows a list of contact rows; when the user select one, the activity sends its ID to the detail
    activity. The detail activity uses the
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.Entity.html">
    ContactsContract.Contacts.Entity
   </a>
  </code>
  to display all of the data rows from all of the raw contacts associated with the selected
    contact.
 </p>
 <p>
  This snippet is taken from the "detail" activity:
 </p>
 <pre>
...
    /*
     * Appends the entity path to the URI. In the case of the Contacts Provider, the
     * expected URI is content://com.google.contacts/#/entity (# is the ID value).
     */
    mContactUri = Uri.withAppendedPath(
            mContactUri,
            ContactsContract.Contacts.Entity.CONTENT_DIRECTORY);

    // Initializes the loader identified by LOADER_ID.
    getLoaderManager().initLoader(
            LOADER_ID,  // The identifier of the loader to initialize
            null,       // Arguments for the loader (in this case, none)
            this);      // The context of the activity

    // Creates a new cursor adapter to attach to the list view
    mCursorAdapter = new SimpleCursorAdapter(
            this,                        // the context of the activity
            R.layout.detail_list_item,   // the view item containing the detail widgets
            mCursor,                     // the backing cursor
            mFromColumns,                // the columns in the cursor that provide the data
            mToViews,                    // the views in the view item that display the data
            0);                          // flags

    // Sets the ListView's backing adapter.
    mRawContactList.setAdapter(mCursorAdapter);
...
@Override
public Loader&lt;Cursor&gt; onCreateLoader(int id, Bundle args) {

    /*
     * Sets the columns to retrieve.
     * RAW_CONTACT_ID is included to identify the raw contact associated with the data row.
     * DATA1 contains the first column in the data row (usually the most important one).
     * MIMETYPE indicates the type of data in the data row.
     */
    String[] projection =
        {
            ContactsContract.Contacts.Entity.RAW_CONTACT_ID,
            ContactsContract.Contacts.Entity.DATA1,
            ContactsContract.Contacts.Entity.MIMETYPE
        };

    /*
     * Sorts the retrieved cursor by raw contact id, to keep all data rows for a single raw
     * contact collated together.
     */
    String sortOrder =
            ContactsContract.Contacts.Entity.RAW_CONTACT_ID +
            " ASC";

    /*
     * Returns a new CursorLoader. The arguments are similar to
     * ContentResolver.query(), except for the Context argument, which supplies the location of
     * the ContentResolver to use.
     */
    return new CursorLoader(
            getApplicationContext(),  // The activity's context
            mContactUri,              // The entity content URI for a single contact
            projection,               // The columns to retrieve
            null,                     // Retrieve all the raw contacts and their data rows.
            null,                     //
            sortOrder);               // Sort by the raw contact ID.
}
</pre>
 <p>
  When the load is finished,
  <code>
   <a href="/reference/android/app/LoaderManager.html">
    LoaderManager
   </a>
  </code>
  invokes a callback to
  <code>
   <a href="/reference/android/app/LoaderManager.LoaderCallbacks.html#onLoadFinished(android.content.Loader&lt;D&gt;, D)">
    onLoadFinished()
   </a>
  </code>
  . One of the incoming arguments to this method is a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  with the results of the query. In your own app, you can get the
    data from this
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  to display it or work with it further.
 </p>
 <h3 id="Transactions">
  Batch modification
 </h3>
 <p>
  Whenever possible, you should insert, update, and delete data in the Contacts Provider in
    "batch mode", by creating an
  <code>
   <a href="/reference/java/util/ArrayList.html">
    ArrayList
   </a>
  </code>
  of
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  objects and calling
  <code>
   <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
    applyBatch()
   </a>
  </code>
  . Because
    the Contacts Provider performs all of the operations in an
  <code>
   <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
    applyBatch()
   </a>
  </code>
  in a single
    transaction, your modifications will never leave the contacts repository in an inconsistent
    state. A batch modification also facilitates inserting a raw contact and its detail data at
    the same time.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  To modify a
  <em>
   single
  </em>
  raw contact, consider sending an intent to
    the device's contacts application rather than handling the modification in your app.
    Doing this is described in more detail in the section
  <a href="#Intents">
   Retrieval and modification with intents
  </a>
  .
 </p>
 <h4>
  Yield points
 </h4>
 <p>
  A batch modification containing a large number of operations can block other processes,
    resulting in a bad overall user experience. To organize all the modifications you want to
    perform in as few separate lists as possible, and at the same time prevent them from
    blocking the system, you should set
  <strong>
   yield points
  </strong>
  for one or more operations.
    A yield point is a
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  object that has its
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html#isYieldAllowed()">
    isYieldAllowed()
   </a>
  </code>
  value set to
  <code>
   true
  </code>
  . When the Contacts Provider encounters a yield point, it pauses its work to
    let other processes run and closes the current transaction. When the provider starts again, it
    continues with the next operation in the
  <code>
   <a href="/reference/java/util/ArrayList.html">
    ArrayList
   </a>
  </code>
  and starts a new
    transaction.
 </p>
 <p>
  Yield points do result in more than one transaction per call to
  <code>
   <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
    applyBatch()
   </a>
  </code>
  . Because of
    this, you should set a yield point for the last operation for a set of related rows.
    For example, you should set a yield point for the last operation in a set that adds a
    raw contact rows and its associated data rows, or the last operation for a set of rows related
    to a single contact.
 </p>
 <p>
  Yield points are also a unit of atomic operation. All accesses between two yield points will
    either succeed or fail as a single unit. If you don't set any yield points, the smallest
    atomic operation is the entire batch of operations. If you do use yield points, you prevent
    operations from degrading system performance, while at the same time ensuring that a subset of
    operations is atomic.
 </p>
 <h4>
  Modification back references
 </h4>
 <p>
  When you're inserting a new raw contact row and its associated data rows as a set of
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  objects, you have to link the data rows to
    the raw contact row by inserting the raw contact's
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  value as the
  <code>
   <a href="/reference/android/provider/ContactsContract.DataColumns.html#RAW_CONTACT_ID">
    RAW_CONTACT_ID
   </a>
  </code>
  value. However, this
    value isn't available when you're creating the
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  for the data row, because you haven't yet applied the
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  for the raw contact row. To work around this,
    the
  <code>
   <a href="/reference/android/content/ContentProviderOperation.Builder.html">
    ContentProviderOperation.Builder
   </a>
  </code>
  class has the method
  <code>
   <a href="/reference/android/content/ContentProviderOperation.Builder.html#withValueBackReference(java.lang.String, int)">
    withValueBackReference()
   </a>
  </code>
  .
    This method allows you to insert or modify a column with the
    result of a previous operation.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProviderOperation.Builder.html#withValueBackReference(java.lang.String, int)">
    withValueBackReference()
   </a>
  </code>
  method has two arguments:
 </p>
 <dl>
  <dt>
   <code>
    key
   </code>
  </dt>
  <dd>
   The key of a key-value pair. The value of this argument should be the name of a column
            in the table that you're modifying.
  </dd>
  <dt>
   <code>
    previousResult
   </code>
  </dt>
  <dd>
   The 0-based index of a value in the array of
   <code>
    <a href="/reference/android/content/ContentProviderResult.html">
     ContentProviderResult
    </a>
   </code>
   objects from
   <code>
    <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
     applyBatch()
    </a>
   </code>
   . As
            the batch operations are applied, the result of each operation is stored in an
            intermediate array of results. The
   <code>
    previousResult
   </code>
   value is the index
            of one of these results, which is retrieved and stored with the
   <code>
    key
   </code>
   value. This allows you to insert a new raw contact record and get back its
   <code>
    <a href="/reference/android/provider/BaseColumns.html#_ID">
     _ID
    </a>
   </code>
   value, then make a "back reference" to the
            value when you add a
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   row.
   <p>
    The entire result array is created when you first call
    <code>
     <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
      applyBatch()
     </a>
    </code>
    ,
                with a size equal to the size of the
    <code>
     <a href="/reference/java/util/ArrayList.html">
      ArrayList
     </a>
    </code>
    of
    <code>
     <a href="/reference/android/content/ContentProviderOperation.html">
      ContentProviderOperation
     </a>
    </code>
    objects you provide. However, all
                the elements in the result array are set to
    <code>
     null
    </code>
    , and if you try
                to do a back reference to a result for an operation that hasn't yet been applied,
    <code>
     <a href="/reference/android/content/ContentProviderOperation.Builder.html#withValueBackReference(java.lang.String, int)">
      withValueBackReference()
     </a>
    </code>
    throws an
    <code>
     <a href="/reference/java/lang/Exception.html">
      Exception
     </a>
    </code>
    .
   </p>
  </dd>
 </dl>
 <p>
  The following snippets show how to insert a new raw contact and data in batch. They
    includes code that establishes a yield point and uses a back reference. The snippets are an
    expanded version of the
  <code>
   createContacEntry()
  </code>
  method, which is part of the
  <code>
   ContactAdder
  </code>
  class in the
  <code>
   <a href="/resources/samples/ContactManager/index.html">
    Contact Manager
   </a>
  </code>
  sample application.
 </p>
 <p>
  The first snippet retrieves contact data from the UI. At this point, the user has already
    selected the account for which the new raw contact should be added.
 </p>
 <pre>
// Creates a contact entry from the current UI values, using the currently-selected account.
protected void createContactEntry() {
    /*
     * Gets values from the UI
     */
    String name = mContactNameEditText.getText().toString();
    String phone = mContactPhoneEditText.getText().toString();
    String email = mContactEmailEditText.getText().toString();

    int phoneType = mContactPhoneTypes.get(
            mContactPhoneTypeSpinner.getSelectedItemPosition());

    int emailType = mContactEmailTypes.get(
            mContactEmailTypeSpinner.getSelectedItemPosition());
</pre>
 <p>
  The next snippet creates an operation to insert the raw contact row into the
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  table:
 </p>
 <pre>
    /*
     * Prepares the batch operation for inserting a new raw contact and its data. Even if
     * the Contacts Provider does not have any data for this person, you can't add a Contact,
     * only a raw contact. The Contacts Provider will then add a Contact automatically.
     */

     // Creates a new array of ContentProviderOperation objects.
    ArrayList&lt;ContentProviderOperation&gt; ops =
            new ArrayList&lt;ContentProviderOperation&gt;();

    /*
     * Creates a new raw contact with its account type (server type) and account name
     * (user's account). Remember that the display name is not stored in this row, but in a
     * StructuredName data row. No other data is required.
     */
    ContentProviderOperation.Builder op =
            ContentProviderOperation.newInsert(ContactsContract.RawContacts.CONTENT_URI)
            .withValue(ContactsContract.RawContacts.ACCOUNT_TYPE, mSelectedAccount.getType())
            .withValue(ContactsContract.RawContacts.ACCOUNT_NAME, mSelectedAccount.getName());

    // Builds the operation and adds it to the array of operations
    ops.add(op.build());
</pre>
 <p>
  Next, the code creates data rows for the display name, phone, and email rows.
 </p>
 <p>
  Each operation builder object uses
  <code>
   <a href="/reference/android/content/ContentProviderOperation.Builder.html#withValueBackReference(java.lang.String, int)">
    withValueBackReference()
   </a>
  </code>
  to get the
  <code>
   <a href="/reference/android/provider/ContactsContract.DataColumns.html#RAW_CONTACT_ID">
    RAW_CONTACT_ID
   </a>
  </code>
  . The reference points
    back to the
  <code>
   <a href="/reference/android/content/ContentProviderResult.html">
    ContentProviderResult
   </a>
  </code>
  object from the first operation,
    which adds the raw contact row and returns its new
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  value. As a result, each data row is automatically linked by its
  <code>
   <a href="/reference/android/provider/ContactsContract.DataColumns.html#RAW_CONTACT_ID">
    RAW_CONTACT_ID
   </a>
  </code>
  to the new
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  row to which it belongs.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/content/ContentProviderOperation.Builder.html">
    ContentProviderOperation.Builder
   </a>
  </code>
  object that adds the email row is
    flagged with
  <code>
   <a href="/reference/android/content/ContentProviderOperation.Builder.html#withYieldAllowed(boolean)">
    withYieldAllowed()
   </a>
  </code>
  , which sets a yield point:
 </p>
 <pre>
    // Creates the display name for the new raw contact, as a StructuredName data row.
    op =
            ContentProviderOperation.newInsert(ContactsContract.Data.CONTENT_URI)
            /*
             * withValueBackReference sets the value of the first argument to the value of
             * the ContentProviderResult indexed by the second argument. In this particular
             * call, the raw contact ID column of the StructuredName data row is set to the
             * value of the result returned by the first operation, which is the one that
             * actually adds the raw contact row.
             */
            .withValueBackReference(ContactsContract.Data.RAW_CONTACT_ID, 0)

            // Sets the data row's MIME type to StructuredName
            .withValue(ContactsContract.Data.MIMETYPE,
                    ContactsContract.CommonDataKinds.StructuredName.CONTENT_ITEM_TYPE)

            // Sets the data row's display name to the name in the UI.
            .withValue(ContactsContract.CommonDataKinds.StructuredName.DISPLAY_NAME, name);

    // Builds the operation and adds it to the array of operations
    ops.add(op.build());

    // Inserts the specified phone number and type as a Phone data row
    op =
            ContentProviderOperation.newInsert(ContactsContract.Data.CONTENT_URI)
            /*
             * Sets the value of the raw contact id column to the new raw contact ID returned
             * by the first operation in the batch.
             */
            .withValueBackReference(ContactsContract.Data.RAW_CONTACT_ID, 0)

            // Sets the data row's MIME type to Phone
            .withValue(ContactsContract.Data.MIMETYPE,
                    ContactsContract.CommonDataKinds.Phone.CONTENT_ITEM_TYPE)

            // Sets the phone number and type
            .withValue(ContactsContract.CommonDataKinds.Phone.NUMBER, phone)
            .withValue(ContactsContract.CommonDataKinds.Phone.TYPE, phoneType);

    // Builds the operation and adds it to the array of operations
    ops.add(op.build());

    // Inserts the specified email and type as a Phone data row
    op =
            ContentProviderOperation.newInsert(ContactsContract.Data.CONTENT_URI)
            /*
             * Sets the value of the raw contact id column to the new raw contact ID returned
             * by the first operation in the batch.
             */
            .withValueBackReference(ContactsContract.Data.RAW_CONTACT_ID, 0)

            // Sets the data row's MIME type to Email
            .withValue(ContactsContract.Data.MIMETYPE,
                    ContactsContract.CommonDataKinds.Email.CONTENT_ITEM_TYPE)

            // Sets the email address and type
            .withValue(ContactsContract.CommonDataKinds.Email.ADDRESS, email)
            .withValue(ContactsContract.CommonDataKinds.Email.TYPE, emailType);

    /*
     * Demonstrates a yield point. At the end of this insert, the batch operation's thread
     * will yield priority to other threads. Use after every set of operations that affect a
     * single contact, to avoid degrading performance.
     */
    op.withYieldAllowed(true);

    // Builds the operation and adds it to the array of operations
    ops.add(op.build());
</pre>
 <p>
  The last snippet shows the call to
  <code>
   <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
    applyBatch()
   </a>
  </code>
  that
    inserts the new raw contact and data rows.
 </p>
 <pre>
    // Ask the Contacts Provider to create a new contact
    Log.d(TAG,"Selected account: " + mSelectedAccount.getName() + " (" +
            mSelectedAccount.getType() + ")");
    Log.d(TAG,"Creating contact: " + name);

    /*
     * Applies the array of ContentProviderOperation objects in batch. The results are
     * discarded.
     */
    try {

            getContentResolver().applyBatch(ContactsContract.AUTHORITY, ops);
    } catch (Exception e) {

            // Display a warning
            Context ctx = getApplicationContext();

            CharSequence txt = getString(R.string.contactCreationFailure);
            int duration = Toast.LENGTH_SHORT;
            Toast toast = Toast.makeText(ctx, txt, duration);
            toast.show();

            // Log exception
            Log.e(TAG, "Exception encountered while inserting contact: " + e);
    }
}
</pre>
 <p>
  Batch operations also allow you to implement
  <strong>
   optimistic concurrency control
  </strong>
  ,
    a method of applying modification transactions without having to lock the underlying repository.
    To use this method, you apply the transaction and then check for other modifications that
    may have been made at the same time. If you find an inconsistent modification has occurred, you
    roll back your transaction and retry it.
 </p>
 <p>
  Optimistic concurrency control is useful for a mobile device, where there's only one user at
    a time, and simultaneous accesses to a data repository are rare. Because locking isn't used,
    no time is wasted on setting locks or waiting for other transactions to release their locks.
 </p>
 <p>
  To use optimistic concurrency control while updating a single
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  row, follow these steps:
 </p>
 <ol>
  <li>
   Retrieve the raw contact's
   <code>
    <a href="/reference/android/provider/ContactsContract.SyncColumns.html#VERSION">
     VERSION
    </a>
   </code>
   column along with the other data you retrieve.
  </li>
  <li>
   Create a
   <code>
    <a href="/reference/android/content/ContentProviderOperation.Builder.html">
     ContentProviderOperation.Builder
    </a>
   </code>
   object suitable for
        enforcing a constraint, using the method
   <code>
    <a href="/reference/android/content/ContentProviderOperation.html#newAssertQuery(android.net.Uri)">
     newAssertQuery(Uri)
    </a>
   </code>
   . For the content URI,
        use
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html#CONTENT_URI">
     RawContacts.CONTENT_URI
    </a>
   </code>
   with the raw contact's
   <code>
    <a href="/reference/android/provider/BaseColumns.html#_ID">
     _ID
    </a>
   </code>
   appended to it.
  </li>
  <li>
   For the
   <code>
    <a href="/reference/android/content/ContentProviderOperation.Builder.html">
     ContentProviderOperation.Builder
    </a>
   </code>
   object, call
   <code>
    <a href="/reference/android/content/ContentProviderOperation.Builder.html#withValue(java.lang.String, java.lang.Object)">
     withValue()
    </a>
   </code>
   to compare the
   <code>
    <a href="/reference/android/provider/ContactsContract.SyncColumns.html#VERSION">
     VERSION
    </a>
   </code>
   column to the version number you just retrieved.
  </li>
  <li>
   For the same
   <code>
    <a href="/reference/android/content/ContentProviderOperation.Builder.html">
     ContentProviderOperation.Builder
    </a>
   </code>
   , call
   <code>
    <a href="/reference/android/content/ContentProviderOperation.Builder.html#withExpectedCount(int)">
     withExpectedCount()
    </a>
   </code>
   to ensure that only one row is tested by this assertion.
  </li>
  <li>
   Call
   <code>
    <a href="/reference/android/content/ContentProviderOperation.Builder.html#build()">
     build()
    </a>
   </code>
   to create the
   <code>
    <a href="/reference/android/content/ContentProviderOperation.html">
     ContentProviderOperation
    </a>
   </code>
   object, then add this object as the
        first object in the
   <code>
    <a href="/reference/java/util/ArrayList.html">
     ArrayList
    </a>
   </code>
   that you pass to
   <code>
    <a href="/reference/android/content/ContentResolver.html#applyBatch(java.lang.String, java.util.ArrayList&lt;android.content.ContentProviderOperation&gt;)">
     applyBatch()
    </a>
   </code>
   .
  </li>
  <li>
   Apply the batch transaction.
  </li>
 </ol>
 <p>
  If the raw contact row is updated by another operation between the time you read the row and
    the time you attempt to modify it, the "assert"
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  will fail, and the entire batch of operations will be backed out. You can then choose to retry
    the batch or take some other action.
 </p>
 <p>
  The following snippet demonstrates how to create an "assert"
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html">
    ContentProviderOperation
   </a>
  </code>
  after querying for a single raw contact using
    a
  <code>
   <a href="/reference/android/content/CursorLoader.html">
    CursorLoader
   </a>
  </code>
  :
 </p>
 <pre>
/*
 * The application uses CursorLoader to query the raw contacts table. The system calls this method
 * when the load is finished.
 */
public void onLoadFinished(Loader&lt;Cursor&gt; loader, Cursor cursor) {

    // Gets the raw contact's _ID and VERSION values
    mRawContactID = cursor.getLong(cursor.getColumnIndex(BaseColumns._ID));
    mVersion = cursor.getInt(cursor.getColumnIndex(SyncColumns.VERSION));
}

...

// Sets up a Uri for the assert operation
Uri rawContactUri = ContentUris.withAppendedId(RawContacts.CONTENT_URI, mRawContactID);

// Creates a builder for the assert operation
ContentProviderOperation.Builder assertOp = ContentProviderOperation.netAssertQuery(rawContactUri);

// Adds the assertions to the assert operation: checks the version and count of rows tested
assertOp.withValue(SyncColumns.VERSION, mVersion);
assertOp.withExpectedCount(1);

// Creates an ArrayList to hold the ContentProviderOperation objects
ArrayList ops = new ArrayList&lt;ContentProviderOperationg&gt;;

ops.add(assertOp.build());

// You would add the rest of your batch operations to "ops" here

...

// Applies the batch. If the assert fails, an Exception is thrown
try
    {
        ContentProviderResult[] results =
                getContentResolver().applyBatch(AUTHORITY, ops);

    } catch (OperationApplicationException e) {

        // Actions you want to take if the assert operation fails go here
    }
</pre>
 <h3 id="Intents">
  Retrieval and modification with intents
 </h3>
 <p>
  Sending an intent to the device's contacts application allows you to access the Contacts
    Provider indirectly. The intent starts the device's contacts application UI, in which users can
    do contacts-related work. With this type of access, users can:
 </p>
 <ul>
  <li>
   Pick a contact from a list and have it returned to your app for further work.
  </li>
  <li>
   Edit an existing contact's data.
  </li>
  <li>
   Insert a new raw contact for any of their accounts.
  </li>
  <li>
   Delete a contact or contacts data.
  </li>
 </ul>
 <p>
  If the user is inserting or updating data, you can collect the data first and send it as
    part of the intent.
 </p>
 <p>
  When you use intents to access the Contacts Provider via the device's contacts application, you
    don't have to write your own UI or code for accessing the provider. You also don't have to
    request permission to read or write to the provider. The device's contacts application can
    delegate read permission for a contact to you, and because you're making modifications to the
    provider through another application, you don't have to have write permissions.
 </p>
 <p>
  The general process of sending an intent to access a provider is described in detail in the
  <a href="/guide/topics/providers/content-provider-basics.html">
   Content Provider Basics
  </a>
  guide in the section "Data access via intents." The action,
    MIME type, and data values you use for the available tasks are summarized in Table 4, while the
    extras values you can use with
  <code>
   <a href="/reference/android/content/Intent.html#putExtra(java.lang.String, java.lang.String)">
    putExtra()
   </a>
  </code>
  are listed in the
    reference documentation for
  <code>
   <a href="/reference/android/provider/ContactsContract.Intents.Insert.html">
    ContactsContract.Intents.Insert
   </a>
  </code>
  :
 </p>
 <p class="table-caption" id="table4">
  <strong>
   Table 4.
  </strong>
  Contacts Provider Intents.
 </p>
 <table style="width:75%">
  <tr>
   <th scope="col" style="width:10%">
    Task
   </th>
   <th scope="col" style="width:5%">
    Action
   </th>
   <th scope="col" style="width:10%">
    Data
   </th>
   <th scope="col" style="width:10%">
    MIME type
   </th>
   <th scope="col" style="width:25%">
    Notes
   </th>
  </tr>
  <tr>
   <td>
    <strong>
     Pick a contact from a list
    </strong>
   </td>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_PICK">
      ACTION_PICK
     </a>
    </code>
   </td>
   <td>
    One of:
    <ul>
     <li>
      <code>
       <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_URI">
        Contacts.CONTENT_URI
       </a>
      </code>
      ,
                    which displays a list of contacts.
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Phone.html#CONTENT_URI">
        Phone.CONTENT_URI
       </a>
      </code>
      ,
                    which displays a list of phone numbers for a raw contact.
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredPostal.html#CONTENT_URI">
        StructuredPostal.CONTENT_URI
       </a>
      </code>
      ,
                    which displays a list of postal addresses for a raw contact.
     </li>
     <li>
      <code>
       <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Email.html#CONTENT_URI">
        Email.CONTENT_URI
       </a>
      </code>
      ,
                    which displays a list of email addresses for a raw contact.
     </li>
    </ul>
   </td>
   <td>
    Not used
   </td>
   <td>
    Displays a list of raw contacts or a list of data from a raw contact, depending on the
            content URI type you supply.
    <p>
     Call
     <code>
      <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
       startActivityForResult()
      </a>
     </code>
     ,
                which returns the content URI of the selected row. The form of the URI is the
                table's content URI with the row's
     <code>
      LOOKUP_ID
     </code>
     appended to it.
                The device's contacts app delegates read and write permissions to this content URI
                for the life of your activity. See the
     <a href="/guide/topics/providers/content-provider-basics.html">
      Content Provider Basics
     </a>
     guide for more details.
    </p>
   </td>
  </tr>
  <tr>
   <td>
    <strong>
     Insert a new raw contact
    </strong>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.Intents.Insert.html#ACTION">
      Insert.ACTION
     </a>
    </code>
   </td>
   <td>
    N/A
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.RawContacts.html#CONTENT_TYPE">
      RawContacts.CONTENT_TYPE
     </a>
    </code>
    , MIME type for a set of raw contacts.
   </td>
   <td>
    Displays the device's contacts application's
    <strong>
     Add Contact
    </strong>
    screen. The
            extras values you add to the intent are displayed. If sent with
    <code>
     <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
      startActivityForResult()
     </a>
    </code>
    ,
            the content URI of the newly-added raw contact is passed back to your activity's
    <code>
     <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
      onActivityResult()
     </a>
    </code>
    callback method in the
    <code>
     <a href="/reference/android/content/Intent.html">
      Intent
     </a>
    </code>
    argument, in the
            "data" field. To get the value, call
    <code>
     <a href="/reference/android/content/Intent.html#getData()">
      getData()
     </a>
    </code>
    .
   </td>
  </tr>
  <tr>
   <td>
    <strong>
     Edit a contact
    </strong>
   </td>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_EDIT">
      ACTION_EDIT
     </a>
    </code>
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_LOOKUP_URI">
      CONTENT_LOOKUP_URI
     </a>
    </code>
    for
            the contact. The editor activity will allow the user to edit any of the data associated
            with this contact.
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_ITEM_TYPE">
      Contacts.CONTENT_ITEM_TYPE
     </a>
    </code>
    , a single contact.
   </td>
   <td>
    Displays the Edit Contact screen in the contacts application. The extras values you add
            to the intent are displayed. When the user clicks
    <strong>
     Done
    </strong>
    to save the
            edits, your activity returns to the foreground.
   </td>
  </tr>
  <tr>
   <td>
    <strong>
     Display a picker that can also add data.
    </strong>
   </td>
   <td>
    <code>
     <a href="/reference/android/content/Intent.html#ACTION_INSERT_OR_EDIT">
      ACTION_INSERT_OR_EDIT
     </a>
    </code>
   </td>
   <td>
    N/A
   </td>
   <td>
    <code>
     <a href="/reference/android/provider/ContactsContract.Contacts.html#CONTENT_ITEM_TYPE">
      CONTENT_ITEM_TYPE
     </a>
    </code>
   </td>
   <td>
    This intent always displays the contacts app's picker screen. The user can either
            pick a contact to edit, or add a new contact. Either the edit or the add screen
            appears, depending on the user's choice, and the extras data you pass in the intent
            is displayed. If your app displays contact data such as an email or phone number, use
            this intent to allow the user to add the data to an existing contact.
            contact,
    <p class="note">
     <strong>
      Note:
     </strong>
     There's no need to send a name value in this intent's extras,
                because the user always picks an existing name or adds a new one. Moreover,
                if you send a name, and the user chooses to do an edit, the contacts app will
                display the name you send, overwriting the previous value. If the user doesn't
                notice this and saves the edit, the old value is lost.
    </p>
   </td>
  </tr>
 </table>
 <p>
  The device's contacts app doesn't allow you to delete a raw contact or any of its data with an
    intent. Instead, to delete a raw contact, use
  <code>
   <a href="/reference/android/content/ContentResolver.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">
    ContentResolver.delete()
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/content/ContentProviderOperation.html#newDelete(android.net.Uri)">
    ContentProviderOperation.newDelete()
   </a>
  </code>
  .
 </p>
 <p>
  The following snippet shows how to construct and send an intent that inserts a new raw
    contact and data:
 </p>
 <pre>
// Gets values from the UI
String name = mContactNameEditText.getText().toString();
String phone = mContactPhoneEditText.getText().toString();
String email = mContactEmailEditText.getText().toString();

String company = mCompanyName.getText().toString();
String jobtitle = mJobTitle.getText().toString();

// Creates a new intent for sending to the device's contacts application
Intent insertIntent = new Intent(ContactsContract.Intents.Insert.ACTION);

// Sets the MIME type to the one expected by the insertion activity
insertIntent.setType(ContactsContract.RawContacts.CONTENT_TYPE);

// Sets the new contact name
insertIntent.putExtra(ContactsContract.Intents.Insert.NAME, name);

// Sets the new company and job title
insertIntent.putExtra(ContactsContract.Intents.Insert.COMPANY, company);
insertIntent.putExtra(ContactsContract.Intents.Insert.JOB_TITLE, jobtitle);

/*
 * Demonstrates adding data rows as an array list associated with the DATA key
 */

// Defines an array list to contain the ContentValues objects for each row
ArrayList&lt;ContentValues&gt; contactData = new ArrayList&lt;ContentValues&gt;();


/*
 * Defines the raw contact row
 */

// Sets up the row as a ContentValues object
ContentValues rawContactRow = new ContentValues();

// Adds the account type and name to the row
rawContactRow.put(ContactsContract.RawContacts.ACCOUNT_TYPE, mSelectedAccount.getType());
rawContactRow.put(ContactsContract.RawContacts.ACCOUNT_NAME, mSelectedAccount.getName());

// Adds the row to the array
contactData.add(rawContactRow);

/*
 * Sets up the phone number data row
 */

// Sets up the row as a ContentValues object
ContentValues phoneRow = new ContentValues();

// Specifies the MIME type for this data row (all data rows must be marked by their type)
phoneRow.put(
        ContactsContract.Data.MIMETYPE,
        ContactsContract.CommonDataKinds.Phone.CONTENT_ITEM_TYPE
);

// Adds the phone number and its type to the row
phoneRow.put(ContactsContract.CommonDataKinds.Phone.NUMBER, phone);

// Adds the row to the array
contactData.add(phoneRow);

/*
 * Sets up the email data row
 */

// Sets up the row as a ContentValues object
ContentValues emailRow = new ContentValues();

// Specifies the MIME type for this data row (all data rows must be marked by their type)
emailRow.put(
        ContactsContract.Data.MIMETYPE,
        ContactsContract.CommonDataKinds.Email.CONTENT_ITEM_TYPE
);

// Adds the email address and its type to the row
emailRow.put(ContactsContract.CommonDataKinds.Email.ADDRESS, email);

// Adds the row to the array
contactData.add(emailRow);

/*
 * Adds the array to the intent's extras. It must be a parcelable object in order to
 * travel between processes. The device's contacts app expects its key to be
 * Intents.Insert.DATA
 */
insertIntent.putParcelableArrayListExtra(ContactsContract.Intents.Insert.DATA, contactData);

// Send out the intent to start the device's contacts app in its add contact activity.
startActivity(insertIntent);
</pre>
 <h3 id="DataIntegrity">
  Data integrity
 </h3>
 <p>
  Because the contacts repository contains important and sensitive data that users expect to be
    correct and up-to-date, the Contacts Provider has well-defined rules for data integrity. It's
    your responsibility to conform to these rules when you modify contacts data. The important
    rules are listed here:
 </p>
 <dl>
  <dt>
   Always add a
   <code>
    <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredName.html">
     ContactsContract.CommonDataKinds.StructuredName
    </a>
   </code>
   row
        for every
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html">
     ContactsContract.RawContacts
    </a>
   </code>
   row you add.
  </dt>
  <dd>
   A
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html">
     ContactsContract.RawContacts
    </a>
   </code>
   row without a
   <code>
    <a href="/reference/android/provider/ContactsContract.CommonDataKinds.StructuredName.html">
     ContactsContract.CommonDataKinds.StructuredName
    </a>
   </code>
   row in the
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   table may cause problems during
        aggregation.
  </dd>
  <dt>
   Always link new
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   rows to their parent
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html">
     ContactsContract.RawContacts
    </a>
   </code>
   row.
  </dt>
  <dd>
   A
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   row that isn't linked to a
   <code>
    <a href="/reference/android/provider/ContactsContract.RawContacts.html">
     ContactsContract.RawContacts
    </a>
   </code>
   won't be visible in the device's
        contacts application, and it might cause problems with sync adapters.
  </dd>
  <dt>
   Change data only for those raw contacts that you own.
  </dt>
  <dd>
   Remember that the Contacts Provider is usually managing data from several different
        account types/online services. You need to ensure that your application only modifies
        or deletes data for rows that belong to you, and that it only inserts data with an
        account type and name that you control.
  </dd>
  <dt>
   Always use the constants defined in
   <code>
    <a href="/reference/android/provider/ContactsContract.html">
     ContactsContract
    </a>
   </code>
   and its
        subclasses for authorities, content URIs, URI paths, column names, MIME types, and
   <code>
    <a href="/reference/android/provider/ContactsContract.CommonDataKinds.CommonColumns.html#TYPE">
     TYPE
    </a>
   </code>
   values.
  </dt>
  <dd>
   Using these constants helps you to avoid errors. You'll also be notified with compiler
        warnings if any of the constants is deprecated.
  </dd>
 </dl>
 <h3 id="CustomData">
  Custom data rows
 </h3>
 <p>
  By creating and using your own custom MIME types, you can insert, edit, delete, and retrieve
    your own data rows in the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table. Your rows
    are limited to using the column defined in
  <code>
   <a href="/reference/android/provider/ContactsContract.DataColumns.html">
    ContactsContract.DataColumns
   </a>
  </code>
  , although you can map your own
    type-specific column names to the default column names. In the device's contacts application,
    the data for your rows is displayed but can't be edited or deleted, and users can't add
    additional data. To allow users to modify your custom data rows, you must provide an editor
    activity in your own application.
 </p>
 <p>
  To display your custom data, provide a
  <code>
   contacts.xml
  </code>
  file containing a
  <code>
   &lt;ContactsAccountType&gt;
  </code>
  element and one or more of its
  <code>
   &lt;ContactsDataKind&gt;
  </code>
  child elements. This is described in more detail in the
    section
  <a href="#SocialStreamDataKind">
   <code>
    &lt;ContactsDataKind&gt; element
   </code>
  </a>
  .
 </p>
 <p>
  To learn more about custom MIME types, read the
  <a href="/guide/topics/providers/content-provider-creating.html">
   Creating a Content Provider
  </a>
  guide.
 </p>
 <h2 id="SyncAdapters">
  Contacts Provider Sync Adapters
 </h2>
 <p>
  The Contacts Provider is specifically designed for handling
  <strong>
   synchronization
  </strong>
  of contacts data between a device and an online service. This allows users to download
    existing data to a new device and upload existing data to a new account.
    Synchronization also ensures that users have the latest data at hand, regardless
    of the source of additions and changes. Another advantage of synchronization is that it makes
    contacts data available even when the device is not connected to the network.
 </p>
 <p>
  Although you can implement synchronization in a variety of ways, the Android system provides
    a plug-in synchronization framework that automates the following tasks:
 </p>
 <ul>
  <li>
   Checking network availability.
  </li>
  <li>
   Scheduling and executing synchronization, based on user preferences.
  </li>
  <li>
   Restarting synchronizations that have stopped.
  </li>
 </ul>
 <p>
  To use this framework, you supply a sync adapter plug-in. Each sync adapter is unique to a
    service and content provider, but can handle multiple account names for the same service. The
    framework also allows multiple sync adapters for the same service and provider.
 </p>
 <h3 id="SyncClassesFiles">
  Sync adapter classes and files
 </h3>
 <p>
  You implement a sync adapter as a subclass of
  <code>
   <a href="/reference/android/content/AbstractThreadedSyncAdapter.html">
    AbstractThreadedSyncAdapter
   </a>
  </code>
  and install it as part of an Android
    application. The system learns about the sync adapter from elements in your application
    manifest, and from a special XML file pointed to by the manifest. The XML file defines the
    account type for the online service and the authority for the content provider, which together
    uniquely identify the adapter. The sync adapter does not become active until the user adds an
    account for the sync adapter's  account type and enables synchronization for the content
    provider the sync adapter syncs with.  At that point, the system starts managing the adapter,
    calling it as necessary to synchronize between the content provider and the server.
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Using an account type as part of the sync adapter's identification allows
    the system to detect and group together sync adapters that access different services from the
    same organization. For example, sync adapters for Google online services all have the same
    account type
  <code>
   com.google
  </code>
  . When users add a Google account to their devices, all
    of the installed sync adapters for Google services are listed together; each sync adapter
    listed syncs with a different content provider on the device.
 </p>
 <p>
  Because most services require users to verify their identity before accessing
    data, the Android system offers an authentication framework that is similar to, and often
    used in conjunction with, the sync adapter framework. The authentication framework uses
    plug-in authenticators that are subclasses of
  <code>
   <a href="/reference/android/accounts/AbstractAccountAuthenticator.html">
    AbstractAccountAuthenticator
   </a>
  </code>
  . An authenticator verifies
    the user's identity in the following steps:
 </p>
 <ol>
  <li>
   Collects the user's name, password or similar information (the user's
   <strong>
    credentials
   </strong>
   ).
  </li>
  <li>
   Sends the credentials to the service
  </li>
  <li>
   Examines the service's reply.
  </li>
 </ol>
 <p>
  If the service accepts the credentials, the authenticator can
    store the credentials for later use. Because of the plug-in authenticator framework, the
  <code>
   <a href="/reference/android/accounts/AccountManager.html">
    AccountManager
   </a>
  </code>
  can provide access to any authtokens an authenticator
    supports and chooses to expose, such as OAuth2 authtokens.
 </p>
 <p>
  Although authentication is not required, most contacts services use it.
    However, you're not required to use the Android authentication framework to do authentication.
 </p>
 <h3 id="SyncAdapterImplementing">
  Sync adapter implementation
 </h3>
 <p>
  To implement a sync adapter for the Contacts Provider, you start by creating an
    Android application that contains the following:
 </p>
 <dl>
  <dt>
   A
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
   component that responds to requests from the system to
            bind to the sync adapter.
  </dt>
  <dd>
   When the system wants to run a synchronization, it calls the service's
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   method to get an
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   for the sync adapter. This allows the system to do
            cross-process calls to the adapter's methods.
   <p>
    In the
    <a href="/resources/samples/SampleSyncAdapter/index.html">
     Sample Sync Adapter
    </a>
    sample app, the class name of this service is
    <code>
     com.example.android.samplesync.syncadapter.SyncService
    </code>
    .
   </p>
  </dd>
  <dt>
   The actual sync adapter, implemented as a concrete subclass of
   <code>
    <a href="/reference/android/content/AbstractThreadedSyncAdapter.html">
     AbstractThreadedSyncAdapter
    </a>
   </code>
   .
  </dt>
  <dd>
   This class does the work of downloading data from the server, uploading data from the
            device, and resolving conflicts. The main work of the adapter is
            done in the method
   <code>
    <a href="/reference/android/content/AbstractThreadedSyncAdapter.html#onPerformSync(android.accounts.Account, android.os.Bundle, java.lang.String, android.content.ContentProviderClient, android.content.SyncResult)">
     onPerformSync()
    </a>
   </code>
   . This class must be instantiated as a singleton.
   <p>
    In the
    <a href="/resources/samples/SampleSyncAdapter/index.html">
     Sample Sync Adapter
    </a>
    sample app, the sync adapter is defined in the class
    <code>
     com.example.android.samplesync.syncadapter.SyncAdapter
    </code>
    .
   </p>
  </dd>
  <dt>
   A subclass of
   <code>
    <a href="/reference/android/app/Application.html">
     Application
    </a>
   </code>
   .
  </dt>
  <dd>
   This class acts as a factory for the sync adapter singleton. Use the
   <code>
    <a href="/reference/android/app/Application.html#onCreate()">
     onCreate()
    </a>
   </code>
   method to instantiate the sync adapter, and
            provide a static "getter" method to return the singleton to the
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   method of the sync adapter's
            service.
  </dd>
  <dt>
   <strong>
    Optional:
   </strong>
   A
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
   component that responds to
            requests from the system for user authentication.
  </dt>
  <dd>
   <code>
    <a href="/reference/android/accounts/AccountManager.html">
     AccountManager
    </a>
   </code>
   starts this service to begin the authentication
            process. The service's
   <code>
    <a href="/reference/android/app/Service.html#onCreate()">
     onCreate()
    </a>
   </code>
   method instantiates an
            authenticator object. When the system wants to authenticate a user account for the
            application's sync adapter, it calls the service's
   <code>
    <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
     onBind()
    </a>
   </code>
   method to get an
   <code>
    <a href="/reference/android/os/IBinder.html">
     IBinder
    </a>
   </code>
   for the authenticator. This allows the system to do
            cross-process calls to the authenticator's methods..
   <p>
    In the
    <a href="/resources/samples/SampleSyncAdapter/index.html">
     Sample Sync Adapter
    </a>
    sample app, the class name of this service is
    <code>
     com.example.android.samplesync.authenticator.AuthenticationService
    </code>
    .
   </p>
  </dd>
  <dt>
   <strong>
    Optional:
   </strong>
   A concrete subclass of
   <code>
    <a href="/reference/android/accounts/AbstractAccountAuthenticator.html">
     AbstractAccountAuthenticator
    </a>
   </code>
   that handles requests for
            authentication.
  </dt>
  <dd>
   This class provides methods that the
   <code>
    <a href="/reference/android/accounts/AccountManager.html">
     AccountManager
    </a>
   </code>
   invokes
            to authenticate the user's credentials with the server. The details of the
            authentication process vary widely, based on the server technology in use. You should
            refer to the documentation for your server software to learn more about authentication.
   <p>
    In the
    <a href="/resources/samples/SampleSyncAdapter/index.html">
     Sample Sync Adapter
    </a>
    sample app, the authenticator is defined in the class
    <code>
     com.example.android.samplesync.authenticator.Authenticator
    </code>
    .
   </p>
  </dd>
  <dt>
   XML files that define the sync adapter and authenticator to the system.
  </dt>
  <dd>
   The sync adapter and authenticator service components described previously are
            defined in
   <code>
    &lt;
    <a href="/guide/topics/manifest/service-element.html">
     service
    </a>
    &gt;
   </code>
   elements in the application manifest. These elements
            contain
   <code>
    &lt;
    <a href="/guide/topics/manifest/meta-data-element.html">
     meta-data
    </a>
    &gt;
   </code>
   child elements that provide specific data to the
            system:
   <ul>
    <li>
     The
     <code>
      &lt;
      <a href="/guide/topics/manifest/meta-data-element.html">
       meta-data
      </a>
      &gt;
     </code>
     element for the sync adapter service points to the
                    XML file
     <code>
      res/xml/syncadapter.xml
     </code>
     . In turn, this file specifies
                    a URI for the web service that will be synchronized with the Contacts Provider,
                    and an account type for the web service.
    </li>
    <li>
     <strong>
      Optional:
     </strong>
     The
     <code>
      &lt;
      <a href="/guide/topics/manifest/meta-data-element.html">
       meta-data
      </a>
      &gt;
     </code>
     element for the authenticator points to the XML file
     <code>
      res/xml/authenticator.xml
     </code>
     . In turn, this file specifies the
                    account type that this authenticator supports, as well as UI resources that
                    appear during the authentication process. The account type specified in this
                    element must be the same as the account type specified for the sync
                    adapter.
    </li>
   </ul>
  </dd>
 </dl>
 <h2 id="SocialStream">
  Social Stream Data
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItems.html">
    ContactsContract.StreamItems
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemPhotos.html">
    ContactsContract.StreamItemPhotos
   </a>
  </code>
  tables
    manage incoming data from social networks. You can write a sync adapter that adds stream data
    from your own network to these tables, or you can read stream data from these tables and
    display it in your own application, or both. With these features, your social networking
    services and applications can be integrated into Android's social networking experience.
 </p>
 <h3 id="StreamText">
  Social stream text
 </h3>
 <p>
  Stream items are always associated with a raw contact. The
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#RAW_CONTACT_ID">
    RAW_CONTACT_ID
   </a>
  </code>
  links to the
  <code>
   _ID
  </code>
  value for the raw contact. The account type and account name of the raw
    contact are also stored in the stream item row.
 </p>
 <p>
  Store the data from your stream in the following columns:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#ACCOUNT_TYPE">
     ACCOUNT_TYPE
    </a>
   </code>
  </dt>
  <dd>
   <strong>
    Required.
   </strong>
   The user's account type for the raw contact associated with this
        stream item. Remember to set this value when you insert a stream item.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#ACCOUNT_NAME">
     ACCOUNT_NAME
    </a>
   </code>
  </dt>
  <dd>
   <strong>
    Required.
   </strong>
   The user's account name for the raw contact associated with this
        stream item. Remember to set this value when you insert a stream item.
  </dd>
  <dt>
   Identifier columns
  </dt>
  <dd>
   <strong>
    Required.
   </strong>
   You must insert the following identifier columns when you
        insert a stream item:
   <ul>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#CONTACT_ID">
       CONTACT_ID
      </a>
     </code>
     : The
     <code>
      <a href="/reference/android/provider/BaseColumns.html#_ID">
       _ID
      </a>
     </code>
     value of the contact that this stream
                item is associated with.
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#CONTACT_LOOKUP_KEY">
       CONTACT_LOOKUP_KEY
      </a>
     </code>
     : The
     <code>
      <a href="/reference/android/provider/ContactsContract.ContactsColumns.html#LOOKUP_KEY">
       LOOKUP_KEY
      </a>
     </code>
     value of the
                contact this stream item is associated with.
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#RAW_CONTACT_ID">
       RAW_CONTACT_ID
      </a>
     </code>
     : The
     <code>
      <a href="/reference/android/provider/BaseColumns.html#_ID">
       _ID
      </a>
     </code>
     value of the raw contact that this stream
                item is associated with.
    </li>
   </ul>
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#COMMENTS">
     COMMENTS
    </a>
   </code>
  </dt>
  <dd>
   Optional. Stores summary information that you can display at the beginning of a stream item.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#TEXT">
     TEXT
    </a>
   </code>
  </dt>
  <dd>
   The text of the stream item, either the content that was posted by the source of the item,
        or a description of some action that generated the stream item. This column can contain
        any formatting and embedded resource images that can be rendered by
   <code>
    <a href="/reference/android/text/Html.html#fromHtml(java.lang.String)">
     fromHtml()
    </a>
   </code>
   . The provider may truncate or
        ellipsize long content, but it will try to avoid breaking tags.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#TIMESTAMP">
     TIMESTAMP
    </a>
   </code>
  </dt>
  <dd>
   A text string containing the time the stream item was inserted or updated, in the form
        of
   <em>
    milliseconds
   </em>
   since epoch. Applications that insert or update stream items are
        responsible for maintaining this column; it is not automatically maintained by the
        Contacts Provider.
  </dd>
 </dl>
 <p>
  To display identifying information for your stream items, use the
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#RES_ICON">
    RES_ICON
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#RES_LABEL">
    RES_LABEL
   </a>
  </code>
  , and
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#RES_PACKAGE">
    RES_PACKAGE
   </a>
  </code>
  to link to resources
    in your application.
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItems.html">
    ContactsContract.StreamItems
   </a>
  </code>
  table also contains the columns
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#SYNC1">
    SYNC1
   </a>
  </code>
  through
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#SYNC4">
    SYNC4
   </a>
  </code>
  for the exclusive use of
    sync adapters.
 </p>
 <h3 id="StreamPhotos">
  Social stream photos
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemPhotos.html">
    ContactsContract.StreamItemPhotos
   </a>
  </code>
  table stores photos associated
   with a stream item. The table's
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemPhotosColumns.html#STREAM_ITEM_ID">
    STREAM_ITEM_ID
   </a>
  </code>
  column
   links to values in the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  column of
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItems.html">
    ContactsContract.StreamItems
   </a>
  </code>
  table. Photo references are stored in the
   table in these columns:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemPhotos.html#PHOTO">
     PHOTO
    </a>
   </code>
   column (a BLOB).
  </dt>
  <dd>
   A binary representation of the photo, resized by the provider for storage and display.
        This column is available for backwards compatibility with previous versions of the Contacts
        Provider that used it for storing photos. However, in the current version
        you should not use this column to store photos. Instead, use
        either
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemPhotosColumns.html#PHOTO_FILE_ID">
     PHOTO_FILE_ID
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemPhotosColumns.html#PHOTO_URI">
     PHOTO_URI
    </a>
   </code>
   (both of
        which are described in the following points) to store photos in a file. This column now
        contains a thumbnail of the photo, which is available for reading.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemPhotosColumns.html#PHOTO_FILE_ID">
     PHOTO_FILE_ID
    </a>
   </code>
  </dt>
  <dd>
   A numeric identifier of a photo for a raw contact. Append this value to the constant
   <code>
    <a href="/reference/android/provider/ContactsContract.DisplayPhoto.html#CONTENT_URI">
     DisplayPhoto.CONTENT_URI
    </a>
   </code>
   to get a content URI pointing to a single photo file, and then call
   <code>
    <a href="/reference/android/content/ContentResolver.html#openAssetFileDescriptor(android.net.Uri, java.lang.String)">
     openAssetFileDescriptor()
    </a>
   </code>
   to get a handle to the photo file.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemPhotosColumns.html#PHOTO_URI">
     PHOTO_URI
    </a>
   </code>
  </dt>
  <dd>
   A content URI pointing directly to the photo file for the photo represented by this row.
        Call
   <code>
    <a href="/reference/android/content/ContentResolver.html#openAssetFileDescriptor(android.net.Uri, java.lang.String)">
     openAssetFileDescriptor()
    </a>
   </code>
   with this URI to get a handle to the photo file.
  </dd>
 </dl>
 <h3 id="SocialStreamTables">
  Using the social stream tables
 </h3>
 <p>
  These tables work the same as the other main tables in the Contacts Provider, except that:
 </p>
 <ul>
  <li>
   These tables require additional access permissions. To read from them, your application
            must have the permission
   <code>
    <a href="/reference/android/Manifest.permission.html#READ_SOCIAL_STREAM">
     READ_SOCIAL_STREAM
    </a>
   </code>
   . To
            modify them, your application must have the permission
   <code>
    <a href="/reference/android/Manifest.permission.html#WRITE_SOCIAL_STREAM">
     WRITE_SOCIAL_STREAM
    </a>
   </code>
   .
  </li>
  <li>
   For the
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItems.html">
     ContactsContract.StreamItems
    </a>
   </code>
   table, the number of rows
            stored for each raw contact is limited. Once this limit is reached,
            the Contacts Provider makes space for new stream item rows by automatically deleting
            the rows having the oldest
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemsColumns.html#TIMESTAMP">
     TIMESTAMP
    </a>
   </code>
   . To get the
            limit, issue a query to the content URI
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItems.html#CONTENT_LIMIT_URI">
     CONTENT_LIMIT_URI
    </a>
   </code>
   . You can leave
            all the arguments other than the content URI set to
   <code>
    null
   </code>
   . The query
            returns a Cursor containing a single row, with the single column
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItems.html#MAX_ITEMS">
     MAX_ITEMS
    </a>
   </code>
   .
  </li>
 </ul>
 <p>
  The class
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItems.StreamItemPhotos.html">
    ContactsContract.StreamItems.StreamItemPhotos
   </a>
  </code>
  defines a
    sub-table of
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemPhotos.html">
    ContactsContract.StreamItemPhotos
   </a>
  </code>
  containing the photo
    rows for a single stream item.
 </p>
 <h3 id="SocialStreamInteraction">
  Social stream interactions
 </h3>
 <p>
  The social stream data managed by the Contacts Provider, in conjunction with the
    device's contacts application, offers a powerful way to connect your social networking system
    with existing contacts. The following features are available:
 </p>
 <ul>
  <li>
   By syncing your social networking service to the Contacts Provider with a sync
            adapter, you can retrieve recent activity for a user's contacts and store it in
            the
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItems.html">
     ContactsContract.StreamItems
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/provider/ContactsContract.StreamItemPhotos.html">
     ContactsContract.StreamItemPhotos
    </a>
   </code>
   tables for later use.
  </li>
  <li>
   Besides regular synchronization, you can trigger your sync adapter to retrieve
            additional data when the user selects a contact to view. This allows your sync adapter
            to retrieve high-resolution photos and the most recent stream items for the contact.
  </li>
  <li>
   By registering a notification with the device's contacts application and the Contacts
            Provider, you can
   <em>
    receive
   </em>
   an intent when a contact is viewed, and at that point
            update the contact's status from your service. This approach may be faster and use less
            bandwidth than doing a full sync with a sync adapter.
  </li>
  <li>
   Users can add a contact to your social networking service while looking at the contact
            in the device's contacts application. You enable this with the "invite contact" feature,
            which you enable with a combination of an activity that adds an existing contact to your
            network, and an XML file that provides the device's contacts application and the
            Contacts Provider with the details of your application.
  </li>
 </ul>
 <p>
  Regular synchronization of stream items with the Contacts Provider is the same as
    other synchronizations. To learn more about synchronization, see the section
  <a href="#SyncAdapters">
   Contacts Provider Sync Adapters
  </a>
  . Registering notifications and
    inviting contacts are covered in the next two sections.
 </p>
 <h4>
  Registering to handle social networking views
 </h4>
 <p>
  To register your sync adapter to receive notifications when the user views a contact that's
    managed by your sync adapter:
 </p>
 <ol>
  <li>
   Create a file named
   <code>
    contacts.xml
   </code>
   in your project's
   <code>
    res/xml/
   </code>
   directory. If you already have this file, you can skip this step.
  </li>
  <li>
   In this file, add the element
   <code>
    &lt;ContactsAccountType xmlns:android="http://schemas.android.com/apk/res/android"&gt;
   </code>
   .
        If this element already exists, you can skip this step.
  </li>
  <li>
   To register a service that is notified when the user opens a contact's detail page in
        the device's contacts application, add the attribute
   <code>
    viewContactNotifyService="
    <em>
     serviceclass
    </em>
    "
   </code>
   to the element, where
   <code>
    <em>
     serviceclass
    </em>
   </code>
   is the fully-qualified classname of the service
        that should receive the intent from the device's contacts application. For the notifier
        service, use a class that extends
   <code>
    <a href="/reference/android/app/IntentService.html">
     IntentService
    </a>
   </code>
   , to allow the service to
        receive intents. The data in the incoming intent contains the content URI of the raw
        contact the user clicked. From the notifier service, you can bind to and then call your
        sync adapter to update the data for the raw contact.
  </li>
 </ol>
 <p>
  To register an activity to be called when the user clicks on a stream item or photo or both:
 </p>
 <ol>
  <li>
   Create a file named
   <code>
    contacts.xml
   </code>
   in your project's
   <code>
    res/xml/
   </code>
   directory. If you already have this file, you can skip this step.
  </li>
  <li>
   In this file, add the element
   <code>
    &lt;ContactsAccountType xmlns:android="http://schemas.android.com/apk/res/android"&gt;
   </code>
   .
        If this element already exists, you can skip this step.
  </li>
  <li>
   To register one of your activities to handle the user clicking on a stream item in the
        device's contacts application, add the attribute
   <code>
    viewStreamItemActivity="
    <em>
     activityclass
    </em>
    "
   </code>
   to the element, where
   <code>
    <em>
     activityclass
    </em>
   </code>
   is the fully-qualified classname of the activity
        that should receive the intent from the device's contacts application.
  </li>
  <li>
   To register one of your activities to handle the user clicking on a stream photo in the
        device's contacts application, add the attribute
   <code>
    viewStreamItemPhotoActivity="
    <em>
     activityclass
    </em>
    "
   </code>
   to the element, where
   <code>
    <em>
     activityclass
    </em>
   </code>
   is the fully-qualified classname of the activity
        that should receive the intent from the device's contacts application.
  </li>
 </ol>
 <p>
  The
  <code>
   &lt;ContactsAccountType&gt;
  </code>
  element is described in more detail in the
    section
  <a href="#SocialStreamAcctType">
   &lt;ContactsAccountType&gt; element
  </a>
  .
 </p>
 <p>
  The incoming intent contains the content URI of the item or photo that the user clicked.
    To have separate activities for text items and for photos, use both attributes in the same file.
 </p>
 <h4>
  Interacting with your social networking service
 </h4>
 <p>
  Users don't have to leave the device's contacts application to invite a contact to your social
    networking site. Instead, you can have the device's contacts app send an intent for inviting the
    contact to one of your activities. To set this up:
 </p>
 <ol>
  <li>
   Create a file named
   <code>
    contacts.xml
   </code>
   in your project's
   <code>
    res/xml/
   </code>
   directory. If you already have this file, you can skip this step.
  </li>
  <li>
   In this file, add the element
   <code>
    &lt;ContactsAccountType xmlns:android="http://schemas.android.com/apk/res/android"&gt;
   </code>
   .
        If this element already exists, you can skip this step.
  </li>
  <li>
   Add the following attributes:
   <ul>
    <li>
     <code>
      inviteContactActivity="
      <em>
       activityclass
      </em>
      "
     </code>
    </li>
    <li>
     <code>
      inviteContactActionLabel="@string/
      <em>
       invite_action_label
      </em>
      "
     </code>
    </li>
   </ul>
   The
   <code>
    <em>
     activityclass
    </em>
   </code>
   value is the fully-qualified classname of the
        activity that should receive the intent. The
   <code>
    <em>
     invite_action_label
    </em>
   </code>
   value is a text string that's displayed in the
   <strong>
    Add Connection
   </strong>
   menu in the
        device's contacts application.
  </li>
 </ol>
 <p class="note">
  <strong>
   Note:
  </strong>
  <code>
   ContactsSource
  </code>
  is a deprecated tag name for
  <code>
   ContactsAccountType
  </code>
  .
 </p>
 <h3 id="ContactsFile">
  contacts.xml reference
 </h3>
 <p>
  The file
  <code>
   contacts.xml
  </code>
  contains XML elements that control the interaction of your
    sync adapter and application with the contacts application and the Contacts Provider. These
    elements are described in the following sections.
 </p>
 <h4 id="SocialStreamAcctType">
  &lt;ContactsAccountType&gt; element
 </h4>
 <p>
  The
  <code>
   &lt;ContactsAccountType&gt;
  </code>
  element controls the interaction of your
    application with the contacts application. It has the following syntax:
 </p>
 <pre>
&lt;ContactsAccountType
        xmlns:android="http://schemas.android.com/apk/res/android"
        inviteContactActivity="<em>activity_name</em>"
        inviteContactActionLabel="<em>invite_command_text</em>"
        viewContactNotifyService="<em>view_notify_service</em>"
        viewGroupActivity="<em>group_view_activity</em>"
        viewGroupActionLabel="<em>group_action_text</em>"
        viewStreamItemActivity="<em>viewstream_activity_name</em>"
        viewStreamItemPhotoActivity="<em>viewphotostream_activity_name</em>"&gt;
</pre>
 <p>
  <strong>
   contained in:
  </strong>
 </p>
 <p>
  <code>
   res/xml/contacts.xml
  </code>
 </p>
 <p>
  <strong>
   can contain:
  </strong>
 </p>
 <p>
  <strong>
   <code>
    &lt;ContactsDataKind&gt;
   </code>
  </strong>
 </p>
 <p>
  <strong>
   Description:
  </strong>
 </p>
 <p>
  Declares Android components and UI labels that allow users to invite one of their contacts to
    a social network, notify users when one of their social networking streams is updated, and
    so forth.
 </p>
 <p>
  Notice that the attribute prefix
  <code>
   android:
  </code>
  is not necessary for the attributes
    of
  <code>
   &lt;ContactsAccountType&gt;
  </code>
  .
 </p>
 <p>
  <strong>
   Attributes:
  </strong>
 </p>
 <dl>
  <dt>
   <code>
    inviteContactActivity
   </code>
  </dt>
  <dd>
   The fully-qualified class name of the activity in your application that you want to
        activate when the user selects
   <strong>
    Add connection
   </strong>
   from the device's
        contacts application.
  </dd>
  <dt>
   <code>
    inviteContactActionLabel
   </code>
  </dt>
  <dd>
   A text string that is displayed for the activity specified in
   <code>
    inviteContactActivity
   </code>
   , in the
   <strong>
    Add connection
   </strong>
   menu.
        For example, you can use the string "Follow in my network". You can use a string resource
        identifier for this label.
  </dd>
  <dt>
   <code>
    viewContactNotifyService
   </code>
  </dt>
  <dd>
   The fully-qualified class name of a service in your application that should receive
        notifications when the user views a contact. This notification is sent by the device's
        contacts application; it allows your application to postpone data-intensive operations
        until they're needed. For example, your application can respond to this notification
        by reading in and displaying the contact's high-resolution photo and most recent
        social stream items. This feature is described in more detail in the section
   <a href="#SocialStreamInteraction">
    Social stream interactions
   </a>
   . You can see an
        example of the notification service in the
   <code>
    NotifierService.java
   </code>
   file in the
   <a href="/resources/samples/SampleSyncAdapter/index.html">
    SampleSyncAdapter
   </a>
   sample app.
  </dd>
  <dt>
   <code>
    viewGroupActivity
   </code>
  </dt>
  <dd>
   The fully-qualified class name of an activity in your application that can display
        group information. When the user clicks the group label in the device's contacts
        application, the UI for this activity is displayed.
  </dd>
  <dt>
   <code>
    viewGroupActionLabel
   </code>
  </dt>
  <dd>
   The label that the contacts application displays for a UI control that allows
        the user to look at groups in your application.
   <p>
    For example, if you install the Google+ application on your device and you sync
            Google+ with the contacts application, you'll see Google+ circles listed as groups
            in your contacts application's
    <strong>
     Groups
    </strong>
    tab. If you click on a
            Google+ circle, you'll see people in that circle listed as a "group". At the top of
            the display, you'll see a Google+ icon; if you click it, control switches to the
            Google+ app. The contacts application does this with the
    <code>
     viewGroupActivity
    </code>
    , using the Google+ icon as the value of
    <code>
     viewGroupActionLabel
    </code>
    .
   </p>
   <p>
    A string resource identifier is allowed for this attribute.
   </p>
  </dd>
  <dt>
   <code>
    viewStreamItemActivity
   </code>
  </dt>
  <dd>
   The fully-qualified class name of an activity in your application that the device's
        contacts application launches when the user clicks a stream item for a raw contact.
  </dd>
  <dt>
   <code>
    viewStreamItemPhotoActivity
   </code>
  </dt>
  <dd>
   The fully-qualified class name of an activity in your application that the device's
        contacts application launches when the user clicks a photo in the stream item
        for a raw contact.
  </dd>
 </dl>
 <h4 id="SocialStreamDataKind">
  &lt;ContactsDataKind&gt; element
 </h4>
 <p>
  The
  <code>
   &lt;ContactsDataKind&gt;
  </code>
  element controls the display of your application's
    custom data rows in the contacts application's UI. It has the following syntax:
 </p>
 <pre>
&lt;ContactsDataKind
        android:mimeType="<em>MIMEtype</em>"
        android:icon="<em>icon_resources</em>"
        android:summaryColumn="<em>column_name</em>"
        android:detailColumn="<em>column_name</em>"&gt;
</pre>
 <p>
  <strong>
   contained in:
  </strong>
 </p>
 <code>
  &lt;ContactsAccountType&gt;
 </code>
 <p>
  <strong>
   Description:
  </strong>
 </p>
 <p>
  Use this element to have the contacts application display the contents of a custom data row as
    part of the details of a raw contact. Each
  <code>
   &lt;ContactsDataKind&gt;
  </code>
  child element
    of
  <code>
   &lt;ContactsAccountType&gt;
  </code>
  represents a type of custom data row that your sync
    adapter adds to the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table. Add one
  <code>
   &lt;ContactsDataKind&gt;
  </code>
  element for each custom MIME type you use. You don't have
    to add the element if you have a custom data row for which you don't want to display data.
 </p>
 <p>
  <strong>
   Attributes:
  </strong>
 </p>
 <dl>
  <dt>
   <code>
    android:mimeType
   </code>
  </dt>
  <dd>
   The custom MIME type you've defined for one of your custom data row types in the
   <code>
    <a href="/reference/android/provider/ContactsContract.Data.html">
     ContactsContract.Data
    </a>
   </code>
   table. For example, the value
   <code>
    vnd.android.cursor.item/vnd.example.locationstatus
   </code>
   could be a custom
        MIME type for a data row that records a contact's last known location.
  </dd>
  <dt>
   <code>
    android:icon
   </code>
  </dt>
  <dd>
   An Android
   <a href="/guide/topics/resources/drawable-resource.html">
    drawable resource
   </a>
   that the contacts application displays next to your data. Use this to indicate to the
        user that the data comes from your service.
  </dd>
  <dt>
   <code>
    android:summaryColumn
   </code>
  </dt>
  <dd>
   The column name for the first of two values retrieved from the data row. The
        value is displayed as the first line of the entry for this data row. The first line is
        intended to be used as a summary of the data, but that is optional. See also
   <a href="#detailColumn">
    android:detailColumn
   </a>
   .
  </dd>
  <dt>
   <code>
    android:detailColumn
   </code>
  </dt>
  <dd>
   The column name for the second of two values retrieved from the data row. The value is
        displayed as the second line of the entry for this data row. See also
   <code>
    android:summaryColumn
   </code>
   .
  </dd>
 </dl>
 <h2 id="AdditionalFeatures">
  Additional Contacts Provider Features
 </h2>
 <p>
  Besides the main features described in previous sections, the Contacts Provider offers
    these useful features for working with contacts data:
 </p>
 <ul>
  <li>
   Contact groups
  </li>
  <li>
   Photo features
  </li>
 </ul>
 <h3 id="Groups">
  Contact groups
 </h3>
 <p>
  The Contacts Provider can optionally label collections of related contacts with
  <strong>
   group
  </strong>
  data. If the server associated with a user account
    wants to maintain groups, the sync adapter for the account's account type should transfer
    groups data between the Contacts Provider and the server. When users add a new contact to the
    server and then put this contact in a new group, the sync adapter must add the new group
    to the
  <code>
   <a href="/reference/android/provider/ContactsContract.Groups.html">
    ContactsContract.Groups
   </a>
  </code>
  table. The group or groups a raw
    contact belongs to are stored in the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table, using
    the
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.GroupMembership.html">
    ContactsContract.CommonDataKinds.GroupMembership
   </a>
  </code>
  MIME type.
 </p>
 <p>
  If you're designing a sync adapter that will add raw contact data from
    server to the Contacts Provider, and you aren't using groups, then you need to tell the
    Provider to make your data visible. In the code that is executed when a user adds an account
    to the device, update the
  <code>
   <a href="/reference/android/provider/ContactsContract.Settings.html">
    ContactsContract.Settings
   </a>
  </code>
  row that the Contacts Provider adds for the account. In this row, set the value of the
  <code>
   <a href="/reference/android/provider/ContactsContract.SettingsColumns.html#UNGROUPED_VISIBLE">
    Settings.UNGROUPED_VISIBLE
   </a>
  </code>
  column to 1. When you do this, the Contacts Provider will always
    make your contacts data visible, even if you don't use groups.
 </p>
 <h3 id="Photos">
  Contact photos
 </h3>
 <p>
  The
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table stores photos as rows with MIME type
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Photo.html#CONTENT_ITEM_TYPE">
    Photo.CONTENT_ITEM_TYPE
   </a>
  </code>
  . The row's
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContactsColumns.html#CONTACT_ID">
    CONTACT_ID
   </a>
  </code>
  column is linked to the
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  column of the raw contact to which it belongs.
    The class
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.Photo.html">
    ContactsContract.Contacts.Photo
   </a>
  </code>
  defines a sub-table of
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.html">
    ContactsContract.Contacts
   </a>
  </code>
  containing photo information for a contact's
    primary photo, which is the primary photo of the contact's primary raw contact. Similarly,
    the class
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.DisplayPhoto.html">
    ContactsContract.RawContacts.DisplayPhoto
   </a>
  </code>
  defines a sub-table
    of
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.html">
    ContactsContract.RawContacts
   </a>
  </code>
  containing photo information for a
    raw contact's primary photo.
 </p>
 <p>
  The reference documentation for
  <code>
   <a href="/reference/android/provider/ContactsContract.Contacts.Photo.html">
    ContactsContract.Contacts.Photo
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/provider/ContactsContract.RawContacts.DisplayPhoto.html">
    ContactsContract.RawContacts.DisplayPhoto
   </a>
  </code>
  contain examples of
    retrieving photo information. There is no convenience class for retrieving the primary
    thumbnail for a raw contact, but you can send a query to the
  <code>
   <a href="/reference/android/provider/ContactsContract.Data.html">
    ContactsContract.Data
   </a>
  </code>
  table, selecting on the raw contact's
  <code>
   <a href="/reference/android/provider/BaseColumns.html#_ID">
    _ID
   </a>
  </code>
  , the
  <code>
   <a href="/reference/android/provider/ContactsContract.CommonDataKinds.Photo.html#CONTENT_ITEM_TYPE">
    Photo.CONTENT_ITEM_TYPE
   </a>
  </code>
  , and the
  <code>
   <a href="/reference/android/provider/ContactsContract.DataColumns.html#IS_PRIMARY">
    IS_PRIMARY
   </a>
  </code>
  column to find the raw contact's primary photo row.
 </p>
 <p>
  Social stream data for a person may also include photos. These are stored in the
  <code>
   <a href="/reference/android/provider/ContactsContract.StreamItemPhotos.html">
    ContactsContract.StreamItemPhotos
   </a>
  </code>
  table, which is described in more
    detail in the section
  <a href="#StreamPhotos">
   Social stream photos
  </a>
  .
 </p>
</div>
<h1>Storage Access Framework</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
    <a class="header-toggle" href="#" onclick="hideNestedItems('#toc44',this);return false;">
     <span class="more">
      show more
     </span>
     <span class="less" style="display:none">
      show less
     </span>
    </a>
   </h2>
   <ol class="hide-nested" id="toc44">
    <li>
     <a href="#overview">
      Overview
     </a>
    </li>
    <li>
     <a href="#flow">
      Control Flow
     </a>
    </li>
    <li>
     <a href="#client">
      Writing a Client App
     </a>
     <ol>
      <li>
       <a href="#search">
        Search for documents
       </a>
      </li>
      <li>
       <a href="#process">
        Process results
       </a>
      </li>
      <li>
       <a href="#metadata">
        Examine document metadata
       </a>
      </li>
      <li>
       <a href="#open">
        Open a document
       </a>
      </li>
      <li>
       <a href="#create">
        Create a new document
       </a>
      </li>
      <li>
       <a href="#delete">
        Delete a document
       </a>
      </li>
      <li>
       <a href="#edit">
        Edit a document
       </a>
      </li>
      <li>
       <a href="#permissions">
        Persist permissions
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#custom">
      Writing a Custom Document Provider
     </a>
     <ol>
      <li>
       <a href="#manifest">
        Manifest
       </a>
      </li>
      <li>
       <a href="#contract">
        Contracts
       </a>
      </li>
      <li>
       <a href="#subclass">
        Subclass DocumentsProvider
       </a>
      </li>
      <li>
       <a href="#security">
        Security
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/provider/DocumentsProvider.html">
       DocumentsProvider
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/provider/DocumentsContract.html">
       DocumentsContract
      </a>
     </code>
    </li>
   </ol>
   <h2>
    Videos
   </h2>
   <ol>
    <li>
     <a href="http://www.youtube.com/watch?v=zxHVeXbK1P4">
      DevBytes: Android 4.4 Storage Access Framework: Provider
     </a>
    </li>
    <li>
     <a href="http://www.youtube.com/watch?v=UFj9AEz0DHQ">
      DevBytes: Android 4.4 Storage Access Framework: Client
     </a>
    </li>
   </ol>
   <h2>
    Code Samples
   </h2>
   <ol>
    <li>
     <a href="/samples/StorageProvider/index.html">
      Storage Provider
     </a>
    </li>
    <li>
     <a href="/samples/StorageClient/index.html">
      StorageClient
     </a>
    </li>
   </ol>
   <h2>
    See Also
   </h2>
   <ol>
    <li>
     <a href="/guide/topics/providers/content-provider-basics.html">
      Content Provider Basics
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  Android 4.4 (API level 19) introduces the Storage Access Framework (SAF). The SAF
 makes it simple for users to browse and open documents, images, and other files
across all of their their preferred document storage providers. A standard, easy-to-use UI
lets users browse files and access recents in a consistent way across apps and providers.
 </p>
 <p>
  Cloud or local storage services can participate in this ecosystem by implementing a
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  that encapsulates their services. Client
apps that need access to a provider's documents can integrate with the SAF with just a few
lines of code.
 </p>
 <p>
  The SAF includes the following:
 </p>
 <ul>
  <li>
   <strong>
    Document provider
   </strong>
   &mdash;A content provider that allows a
storage service (such as Google Drive) to reveal the files it manages. A document provider is
implemented as a subclass of the
   <code>
    <a href="/reference/android/provider/DocumentsProvider.html">
     DocumentsProvider
    </a>
   </code>
   class.
The document-provider schema is based on a traditional file hierarchy,
though how your document provider physically stores data is up to you.
The Android platform includes several built-in document providers, such as
Downloads, Images, and Videos.
  </li>
  <li>
   <strong>
    Client app
   </strong>
   &mdash;A custom app that invokes the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
     ACTION_OPEN_DOCUMENT
    </a>
   </code>
   and/or
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
     ACTION_CREATE_DOCUMENT
    </a>
   </code>
   intent and receives the
files returned by document providers.
  </li>
  <li>
   <strong>
    Picker
   </strong>
   &mdash;A system UI that lets users access documents from all
document providers that satisfy the client app's search criteria.
  </li>
 </ul>
 <p>
  Some of the features offered by the SAF are as follows:
 </p>
 <ul>
  <li>
   Lets users browse content from all document providers, not just a single app.
  </li>
  <li>
   Makes it possible for your app to have long term, persistent access to
 documents owned by a document provider. Through this access users can add, edit,
 save, and delete files on the provider.
  </li>
  <li>
   Supports multiple user accounts and transient roots such as USB storage
providers, which only appear if the drive is plugged in.
  </li>
 </ul>
 <h2 id="overview">
  Overview
 </h2>
 <p>
  The SAF centers around a content provider that is a
subclass of the
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  class. Within a
  <em>
   document provider
  </em>
  , data is
structured as a traditional file hierarchy:
 </p>
 <p>
  <img alt="data model" src="http://developer.android.com/images/providers/storage_datamodel.png"/>
 </p>
 <p class="img-caption">
  <strong>
   Figure 1.
  </strong>
  Document provider data model. A Root points to a single Document,
which then starts the fan-out of the entire tree.
 </p>
 <p>
  Note the following:
 </p>
 <ul>
  <li>
   Each document provider reports one or more
"roots" which are starting points into exploring a tree of documents.
Each root has a unique
   <code>
    <a href="/reference/android/provider/DocumentsContract.Root.html#COLUMN_ROOT_ID">
     COLUMN_ROOT_ID
    </a>
   </code>
   ,
and it points to a document (a directory)
representing the contents under that root.
Roots are dynamic by design to support use cases like multiple accounts,
transient USB storage devices, or user login/log out.
  </li>
  <li>
   Under each root is a single document. That document points to 1 to
   <em>
    N
   </em>
   documents,
each of which in turn can point to 1 to
   <em>
    N
   </em>
   documents.
  </li>
  <li>
   Each storage backend surfaces
individual files and directories by referencing them with a unique
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#COLUMN_DOCUMENT_ID">
     COLUMN_DOCUMENT_ID
    </a>
   </code>
   .
Document IDs must be unique and not change once issued, since they are used for persistent
URI grants across device reboots.
  </li>
  <li>
   Documents can be either an openable file (with a specific MIME type), or a
directory containing additional documents (with the
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#MIME_TYPE_DIR">
     MIME_TYPE_DIR
    </a>
   </code>
   MIME type).
  </li>
  <li>
   Each document can have different capabilities, as described by
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#COLUMN_FLAGS">
     COLUMN_FLAGS
    </a>
   </code>
   .
For example,
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#FLAG_SUPPORTS_WRITE">
     FLAG_SUPPORTS_WRITE
    </a>
   </code>
   ,
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#FLAG_SUPPORTS_DELETE">
     FLAG_SUPPORTS_DELETE
    </a>
   </code>
   , and
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#FLAG_SUPPORTS_THUMBNAIL">
     FLAG_SUPPORTS_THUMBNAIL
    </a>
   </code>
   .
The same
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html#COLUMN_DOCUMENT_ID">
     COLUMN_DOCUMENT_ID
    </a>
   </code>
   can be
included in multiple directories.
  </li>
 </ul>
 <h2 id="flow">
  Control Flow
 </h2>
 <p>
  As stated above, the  document provider data model is based on a traditional
file hierarchy. However, you can physically store your data however you like, as
long as it can be accessed through the
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  API. For example, you
could use tag-based cloud storage for your data.
 </p>
 <p>
  Figure 2 shows an example of how a photo app might use the SAF
to access  stored data:
 </p>
 <p>
  <img alt="app" src="http://developer.android.com/images/providers/storage_dataflow.png"/>
 </p>
 <p class="img-caption">
  <strong>
   Figure 2.
  </strong>
  Storage Access Framework Flow
 </p>
 <p>
  Note the following:
 </p>
 <ul>
  <li>
   In the SAF, providers and clients don't interact
directly. A client requests permission to interact
with files (that is, to read, edit, create, or delete files).
  </li>
  <li>
   The interaction starts when an application (in this example, a photo app)  fires the intent
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
     ACTION_OPEN_DOCUMENT
    </a>
   </code>
   or
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
     ACTION_CREATE_DOCUMENT
    </a>
   </code>
   . The intent may include filters
to further refine the criteria&mdash;for example, "give me all openable files
that have the 'image' MIME type."
  </li>
  <li>
   Once the intent fires, the system picker goes to each registered provider
and shows the user the matching content roots.
  </li>
  <li>
   The picker gives users a standard interface for accessing documents, even
though the underlying document providers may be very different. For example, figure 2
shows a Google Drive provider, a USB provider, and a cloud provider.
  </li>
 </ul>
 <p>
  Figure 3 shows a picker in which a user searching for images has selected a
Google Drive account:
 </p>
 <p>
  <img alt="picker" src="http://developer.android.com/images/providers/storage_picker.png" style="border:2px solid #ddd" width="340"/>
 </p>
 <p class="img-caption">
  <strong>
   Figure 3.
  </strong>
  Picker
 </p>
 <p>
  When the user selects Google Drive the images are displayed, as shown in
figure 4. From that point on, the user can interact with them in whatever ways
are supported by the provider and client app.
 </p>
 <p>
  <img alt="picker" src="http://developer.android.com/images/providers/storage_photos.png" style="border:2px solid #ddd" width="340"/>
 </p>
 <p class="img-caption">
  <strong>
   Figure 4.
  </strong>
  Images
 </p>
 <h2 id="client">
  Writing a Client App
 </h2>
 <p>
  On Android 4.3 and lower, if you want your app to retrieve a file from another
app, it must invoke an intent such as
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_PICK">
    ACTION_PICK
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  . The user must then select
a single app from which to pick a file and the selected app must provide a user
interface for the user to browse and pick from the available files.
 </p>
 <p>
  On Android 4.4 and higher, you have the additional option of using the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  intent,
which displays a picker UI controlled by the system that allows the user to
browse all files that other apps have made available. From this single UI, the
user can pick a file from any of the supported apps.
 </p>
 <p>
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  is
not intended to be a replacement for
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  .
The one you should use depends on the needs of your app:
 </p>
 <ul>
  <li>
   Use
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
     ACTION_GET_CONTENT
    </a>
   </code>
   if you want your app
to simply read/import data. With this approach, the app imports a copy of the data,
such as an image file.
  </li>
  <li>
   Use
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
     ACTION_OPEN_DOCUMENT
    </a>
   </code>
   if you want your
app to have long term, persistent access to documents owned by a document
provider. An example would be a photo-editing app that lets users edit
images stored in a document provider.
  </li>
 </ul>
 <p>
  This section describes how to write client apps based on the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
    ACTION_CREATE_DOCUMENT
   </a>
  </code>
  intents.
 </p>
 <h3 id="search">
  Search for documents
 </h3>
 <p>
  The following snippet uses
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  to search for document providers that
contain image files:
 </p>
 <pre>private static final int READ_REQUEST_CODE = 42;
...
/**
 * Fires an intent to spin up the "file chooser" UI and select an image.
 */
public void performFileSearch() {

    // ACTION_OPEN_DOCUMENT is the intent to choose a file via the system's file
    // browser.
    Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);

    // Filter to only show results that can be "opened", such as a
    // file (as opposed to a list of contacts or timezones)
    intent.addCategory(Intent.CATEGORY_OPENABLE);

    // Filter to show only images, using the image MIME data type.
    // If one wanted to search for ogg vorbis files, the type would be "audio/ogg".
    // To search for all documents available via installed storage providers,
    // it would be "*/*".
    intent.setType("image/*");

    startActivityForResult(intent, READ_REQUEST_CODE);
}</pre>
 <p>
  Note the following:
 </p>
 <ul>
  <li>
   When the app fires the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
     ACTION_OPEN_DOCUMENT
    </a>
   </code>
   intent, it launches a picker that displays all matching document providers.
  </li>
  <li>
   Adding the category
   <code>
    <a href="/reference/android/content/Intent.html#CATEGORY_OPENABLE">
     CATEGORY_OPENABLE
    </a>
   </code>
   to the
intent filters the results to display only documents that can be opened, such as image files.
  </li>
  <li>
   The statement
   <code>
    intent.setType("image/*")
   </code>
   further filters to
display only documents that have the image MIME data type.
  </li>
 </ul>
 <h3 id="results">
  Process Results
 </h3>
 <p>
  Once the user selects a document in the picker,
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  gets called.
The URI that points to the selected document is contained in the
  <code>
   resultData
  </code>
  parameter. Extract the URI using
  <code>
   <a href="/reference/android/content/Intent.html#getData()">
    getData()
   </a>
  </code>
  .
Once you have it, you can use it to retrieve the document the user wants. For
example:
 </p>
 <pre>@Override
public void onActivityResult(int requestCode, int resultCode,
        Intent resultData) {

    // The ACTION_OPEN_DOCUMENT intent was sent with the request code
    // READ_REQUEST_CODE. If the request code seen here doesn't match, it's the
    // response to some other intent, and the code below shouldn't run at all.

    if (requestCode == READ_REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) {
        // The document selected by the user won't be returned in the intent.
        // Instead, a URI to that document will be contained in the return intent
        // provided to this method as a parameter.
        // Pull that URI using resultData.getData().
        Uri uri = null;
        if (resultData != null) {
            uri = resultData.getData();
            Log.i(TAG, "Uri: " + uri.toString());
            showImage(uri);
        }
    }
}
</pre>
 <h3 id="metadata">
  Examine document metadata
 </h3>
 <p>
  Once you have the URI for a document, you gain access to its metadata. This
snippet grabs the metadata for a document specified by the URI, and logs it:
 </p>
 <pre>public void dumpImageMetaData(Uri uri) {

    // The query, since it only applies to a single document, will only return
    // one row. There's no need to filter, sort, or select fields, since we want
    // all fields for one document.
    Cursor cursor = getActivity().getContentResolver()
            .query(uri, null, null, null, null, null);

    try {
    // moveToFirst() returns false if the cursor has 0 rows.  Very handy for
    // "if there's anything to look at, look at it" conditionals.
        if (cursor != null &amp;&amp; cursor.moveToFirst()) {

            // Note it's called "Display Name".  This is
            // provider-specific, and might not necessarily be the file name.
            String displayName = cursor.getString(
                    cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME));
            Log.i(TAG, "Display Name: " + displayName);

            int sizeIndex = cursor.getColumnIndex(OpenableColumns.SIZE);
            // If the size is unknown, the value stored is null.  But since an
            // int can't be null in Java, the behavior is implementation-specific,
            // which is just a fancy term for "unpredictable".  So as
            // a rule, check if it's null before assigning to an int.  This will
            // happen often:  The storage API allows for remote files, whose
            // size might not be locally known.
            String size = null;
            if (!cursor.isNull(sizeIndex)) {
                // Technically the column stores an int, but cursor.getString()
                // will do the conversion automatically.
                size = cursor.getString(sizeIndex);
            } else {
                size = "Unknown";
            }
            Log.i(TAG, "Size: " + size);
        }
    } finally {
        cursor.close();
    }
}
</pre>
 <h3 id="open-client">
  Open a document
 </h3>
 <p>
  Once you have the URI for a document, you can open it or do whatever else
you want to do with it.
 </p>
 <h4>
  Bitmap
 </h4>
 <p>
  Here is an example of how you might open a
  <code>
   <a href="/reference/android/graphics/Bitmap.html">
    Bitmap
   </a>
  </code>
  :
 </p>
 <pre>private Bitmap getBitmapFromUri(Uri uri) throws IOException {
    ParcelFileDescriptor parcelFileDescriptor =
            getContentResolver().openFileDescriptor(uri, "r");
    FileDescriptor fileDescriptor = parcelFileDescriptor.getFileDescriptor();
    Bitmap image = BitmapFactory.decodeFileDescriptor(fileDescriptor);
    parcelFileDescriptor.close();
    return image;
}
</pre>
 <p>
  Note that you should not do this operation on the UI thread. Do it in the
background, using
  <code>
   <a href="/reference/android/os/AsyncTask.html">
    AsyncTask
   </a>
  </code>
  . Once you open the bitmap, you
can display it in an
  <code>
   <a href="/reference/android/widget/ImageView.html">
    ImageView
   </a>
  </code>
  .
 </p>
 <h4>
  Get an InputStream
 </h4>
 <p>
  Here is an example of how you can get an
  <code>
   <a href="/reference/java/io/InputStream.html">
    InputStream
   </a>
  </code>
  from the URI. In this
snippet, the lines of the file are being read into a string:
 </p>
 <pre>private String readTextFromUri(Uri uri) throws IOException {
    InputStream inputStream = getContentResolver().openInputStream(uri);
    BufferedReader reader = new BufferedReader(new InputStreamReader(
            inputStream));
    StringBuilder stringBuilder = new StringBuilder();
    String line;
    while ((line = reader.readLine()) != null) {
        stringBuilder.append(line);
    }
    fileInputStream.close();
    parcelFileDescriptor.close();
    return stringBuilder.toString();
}
</pre>
 <h3 id="create">
  Create a new document
 </h3>
 <p>
  Your app can create a new document in a document provider using the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_CREATE_DOCUMENT">
    ACTION_CREATE_DOCUMENT
   </a>
  </code>
  intent. To create a file you give your intent a MIME type and a file name, and
launch it with a unique request code. The rest is taken care of for you:
 </p>
 <pre>
// Here are some examples of how you might call this method.
// The first parameter is the MIME type, and the second parameter is the name
// of the file you are creating:
//
// createFile("text/plain", "foobar.txt");
// createFile("image/png", "mypicture.png");

// Unique request code.
private static final int WRITE_REQUEST_CODE = 43;
...
private void createFile(String mimeType, String fileName) {
    Intent intent = new Intent(Intent.ACTION_CREATE_DOCUMENT);

    // Filter to only show results that can be "opened", such as
    // a file (as opposed to a list of contacts or timezones).
    intent.addCategory(Intent.CATEGORY_OPENABLE);

    // Create a file with the requested MIME type.
    intent.setType(mimeType);
    intent.putExtra(Intent.EXTRA_TITLE, fileName);
    startActivityForResult(intent, WRITE_REQUEST_CODE);
}
</pre>
 <p>
  Once you create a new document you can get its URI in
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  , so that you
can continue to write to it.
 </p>
 <h3 id="delete">
  Delete a document
 </h3>
 <p>
  If you have the URI for a document and the document's
  <code>
   <a href="/reference/android/provider/DocumentsContract.Document.html#COLUMN_FLAGS">
    Document.COLUMN_FLAGS
   </a>
  </code>
  contains
  <code>
   <a href="/reference/android/provider/DocumentsContract.Document.html#FLAG_SUPPORTS_DELETE">
    SUPPORTS_DELETE
   </a>
  </code>
  ,
you can delete the document. For example:
 </p>
 <pre>
DocumentsContract.deleteDocument(getContentResolver(), uri);
</pre>
 <h3 id="edit">
  Edit a document
 </h3>
 <p>
  You can use the SAF to edit a text document in place.
This snippet fires
the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  intent and uses the
category
  <code>
   <a href="/reference/android/content/Intent.html#CATEGORY_OPENABLE">
    CATEGORY_OPENABLE
   </a>
  </code>
  to to display only
documents that can be opened. It further filters to show only text files:
 </p>
 <pre>
private static final int EDIT_REQUEST_CODE = 44;
/**
 * Open a file for writing and append some text to it.
 */
 private void editDocument() {
    // ACTION_OPEN_DOCUMENT is the intent to choose a file via the system's
    // file browser.
    Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);

    // Filter to only show results that can be "opened", such as a
    // file (as opposed to a list of contacts or timezones).
    intent.addCategory(Intent.CATEGORY_OPENABLE);

    // Filter to show only text files.
    intent.setType("text/plain");

    startActivityForResult(intent, EDIT_REQUEST_CODE);
}
</pre>
 <p>
  Next, from
  <code>
   <a href="/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">
    onActivityResult()
   </a>
  </code>
  (see
  <a href="#results">
   Process results
  </a>
  ) you can call code to perform the edit.
The following snippet gets a
  <code>
   <a href="/reference/java/io/FileOutputStream.html">
    FileOutputStream
   </a>
  </code>
  from the
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  . By default it uses &ldquo;write&rdquo; mode.
It's best practice to ask for the least amount of access you need, so don&rsquo;t ask
for read/write if all you need is write:
 </p>
 <pre>private void alterDocument(Uri uri) {
    try {
        ParcelFileDescriptor pfd = getActivity().getContentResolver().
                openFileDescriptor(uri, "w");
        FileOutputStream fileOutputStream =
                new FileOutputStream(pfd.getFileDescriptor());
        fileOutputStream.write(("Overwritten by MyCloud at " +
                System.currentTimeMillis() + "\n").getBytes());
        // Let the document provider know you're done by closing the stream.
        fileOutputStream.close();
        pfd.close();
    } catch (FileNotFoundException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }
}</pre>
 <h3 id="permissions">
  Persist permissions
 </h3>
 <p>
  When your app opens a file for reading or writing, the system gives your
app a URI permission grant for that file. It lasts until the user's device restarts.
But suppose your app is an image-editing app, and you want users to be able to
access the last 5 images they edited, directly from your app. If the user's device has
restarted, you'd have to send the user back to the system picker to find the
files, which is obviously not ideal.
 </p>
 <p>
  To prevent this from happening, you can persist the permissions the system
gives your app. Effectively, your app "takes" the persistable URI permission grant
that the system is offering. This gives the user continued access to the files
through your app, even if the device has been restarted:
 </p>
 <pre>final int takeFlags = intent.getFlags()
            &amp; (Intent.FLAG_GRANT_READ_URI_PERMISSION
            | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
// Check for the freshest data.
getContentResolver().takePersistableUriPermission(uri, takeFlags);</pre>
 <p>
  There is one final step. You may have saved the most
recent URIs your app accessed, but they may no longer be valid&mdash;another app
may have deleted or modified a document. Thus, you should always call
  <code>
   getContentResolver().takePersistableUriPermission()
  </code>
  to check for the
freshest data.
 </p>
 <h2 id="custom">
  Writing a Custom Document Provider
 </h2>
 <p>
  If you're developing an app that provides storage services for files (such as
a cloud save service), you can make your files available through the
SAF by writing a custom document provider.  This section describes
how to do this.
 </p>
 <h3 id="manifest">
  Manifest
 </h3>
 <p>
  To implement a custom document provider, add the following to your application's
manifest:
 </p>
 <ul>
  <li>
   A target of API level 19 or higher.
  </li>
  <li>
   A
   <code>
    &lt;provider&gt;
   </code>
   element that declares your custom storage
provider.
  </li>
  <li>
   The name of your provider, which is its class name, including package name.
For example:
   <code>
    com.example.android.storageprovider.MyCloudProvider
   </code>
   .
  </li>
  <li>
   The name of your authority, which is your package name (in this example,
   <code>
    com.example.android.storageprovider
   </code>
   ) plus the type of content provider
(
   <code>
    documents
   </code>
   ). For example,
   <code>
    com.example.android.storageprovider.documents
   </code>
   .
  </li>
  <li>
   The attribute
   <code>
    android:exported
   </code>
   set to
   <code>
    "true"
   </code>
   .
You must export your provider so that other apps can see it.
  </li>
  <li>
   The attribute
   <code>
    android:grantUriPermissions
   </code>
   set to
   <code>
    "true"
   </code>
   . This setting allows the system to grant other apps access
to content in your provider. For a discussion of how to persist a grant for
a particular document, see
   <a href="#permissions">
    Persist permissions
   </a>
   .
  </li>
  <li>
   The
   <code>
    MANAGE_DOCUMENTS
   </code>
   permission. By default a provider is available
to everyone. Adding this permission restricts your provider to the system.
This restriction is important for security.
  </li>
  <li>
   The
   <code>
    android:enabled
   </code>
   attribute set to a boolean value defined in a resource
file. The purpose of this attribute is to disable the provider on devices running Android 4.3 or lower.
For example,
   <code>
    android:enabled="@bool/atLeastKitKat"
   </code>
   . In
addition to including this attribute in the manifest, you need to do the following:
   <ul>
    <li>
     In your
     <code>
      bool.xml
     </code>
     resources file under
     <code>
      res/values/
     </code>
     , add
this line:
     <pre>&lt;bool name="atLeastKitKat"&gt;false&lt;/bool&gt;</pre>
    </li>
    <li>
     In your
     <code>
      bool.xml
     </code>
     resources file under
     <code>
      res/values-v19/
     </code>
     , add
this line:
     <pre>&lt;bool name="atLeastKitKat"&gt;true&lt;/bool&gt;</pre>
    </li>
   </ul>
  </li>
  <li>
   An intent filter that includes the
   <code>
    android.content.action.DOCUMENTS_PROVIDER
   </code>
   action, so that your provider
appears in the picker when the system searches for providers.
  </li>
 </ul>
 <p>
  Here are excerpts from a sample manifest that includes a provider:
 </p>
 <pre>&lt;manifest... &gt;
    ...
    &lt;uses-sdk
        android:minSdkVersion="19"
        android:targetSdkVersion="19" /&gt;
        ....
        &lt;provider
            android:name="com.example.android.storageprovider.MyCloudProvider"
            android:authorities="com.example.android.storageprovider.documents"
            android:grantUriPermissions="true"
            android:exported="true"
            android:permission="android.permission.MANAGE_DOCUMENTS"
            android:enabled="@bool/atLeastKitKat"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.content.action.DOCUMENTS_PROVIDER" /&gt;
            &lt;/intent-filter&gt;
        &lt;/provider&gt;
    &lt;/application&gt;

&lt;/manifest&gt;</pre>
 <h4 id="43">
  Supporting devices running Android 4.3 and lower
 </h4>
 <p>
  The
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT">
    ACTION_OPEN_DOCUMENT
   </a>
  </code>
  intent is only available
on devices running Android 4.4 and higher.
If you want your application to support
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  to accommodate devices that are running Android 4.3 and lower, you should
disable the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  intent filter in
your manifest for devices running Android 4.4 or higher. A
document provider and
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  should be considered
 mutually exclusive. If you support both of them simultaneously, your app will
appear twice in the system picker UI, offering two different ways of accessing
your stored data. This would be confusing for users.
 </p>
 <p>
  Here is the recommended way of disabling the
  <code>
   <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
    ACTION_GET_CONTENT
   </a>
  </code>
  intent filter for devices
running Android version 4.4 or higher:
 </p>
 <ol>
  <li>
   In your
   <code>
    bool.xml
   </code>
   resources file under
   <code>
    res/values/
   </code>
   , add
this line:
   <pre>&lt;bool name="atMostJellyBeanMR2"&gt;true&lt;/bool&gt;</pre>
  </li>
  <li>
   In your
   <code>
    bool.xml
   </code>
   resources file under
   <code>
    res/values-v19/
   </code>
   , add
this line:
   <pre>&lt;bool name="atMostJellyBeanMR2"&gt;false&lt;/bool&gt;</pre>
  </li>
  <li>
   Add an
   <a href="/guide/topics/manifest/activity-alias-element.html">
    activity
alias
   </a>
   to disable the
   <code>
    <a href="/reference/android/content/Intent.html#ACTION_GET_CONTENT">
     ACTION_GET_CONTENT
    </a>
   </code>
   intent
filter for versions 4.4 (API level 19) and higher. For example:
   <pre>
&lt;!-- This activity alias is added so that GET_CONTENT intent-filter
     can be disabled for builds on API level 19 and higher. --&gt;
&lt;activity-alias android:name="com.android.example.app.MyPicker"
        android:targetActivity="com.android.example.app.MyActivity"
        ...
        android:enabled="@bool/atMostJellyBeanMR2"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.GET_CONTENT" /&gt;
        &lt;category android:name="android.intent.category.OPENABLE" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;data android:mimeType="image/*" /&gt;
        &lt;data android:mimeType="video/*" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity-alias&gt;
</pre>
  </li>
 </ol>
 <h3 id="contract">
  Contracts
 </h3>
 <p>
  Usually when you write a custom content provider, one of the tasks is
implementing contract classes, as described in the
  <a href="/guide/topics/providers/content-provider-creating.html#ContractClass">
   Content Providers
  </a>
  developers guide. A contract class is a
  <code>
   public final
  </code>
  class
that contains constant definitions for the URIs, column names, MIME types, and
other metadata that pertain to the provider. The SAF
provides these contract classes for you, so you don't need to write your
own:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/android/provider/DocumentsContract.Document.html">
     DocumentsContract.Document
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/provider/DocumentsContract.Root.html">
     DocumentsContract.Root
    </a>
   </code>
  </li>
 </ul>
 <p>
  For example, here are the columns you might return in a cursor when
your document provider is queried for documents or the root:
 </p>
 <pre>private static final String[] DEFAULT_ROOT_PROJECTION =
        new String[]{Root.COLUMN_ROOT_ID, Root.COLUMN_MIME_TYPES,
        Root.COLUMN_FLAGS, Root.COLUMN_ICON, Root.COLUMN_TITLE,
        Root.COLUMN_SUMMARY, Root.COLUMN_DOCUMENT_ID,
        Root.COLUMN_AVAILABLE_BYTES,};
private static final String[] DEFAULT_DOCUMENT_PROJECTION = new
        String[]{Document.COLUMN_DOCUMENT_ID, Document.COLUMN_MIME_TYPE,
        Document.COLUMN_DISPLAY_NAME, Document.COLUMN_LAST_MODIFIED,
        Document.COLUMN_FLAGS, Document.COLUMN_SIZE,};
</pre>
 <h3 id="subclass">
  Subclass DocumentsProvider
 </h3>
 <p>
  The next step in writing a custom document provider is to subclass the
abstract class
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  . At minimum, you need
to implement the following methods:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/android/provider/DocumentsProvider.html#queryRoots(java.lang.String[])">
     queryRoots()
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/provider/DocumentsProvider.html#queryChildDocuments(java.lang.String, java.lang.String[], java.lang.String)">
     queryChildDocuments()
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/provider/DocumentsProvider.html#queryDocument(java.lang.String, java.lang.String[])">
     queryDocument()
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/provider/DocumentsProvider.html#openDocument(java.lang.String, java.lang.String, android.os.CancellationSignal)">
     openDocument()
    </a>
   </code>
  </li>
 </ul>
 <p>
  These are the only methods you are strictly required to implement, but there
are many more you might want to. See
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html">
    DocumentsProvider
   </a>
  </code>
  for details.
 </p>
 <h4 id="queryRoots">
  Implement queryRoots
 </h4>
 <p>
  Your implementation of
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryRoots(java.lang.String[])">
    queryRoots()
   </a>
  </code>
  must return a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  pointing to all the
root directories of your document providers, using columns defined in
  <code>
   <a href="/reference/android/provider/DocumentsContract.Root.html">
    DocumentsContract.Root
   </a>
  </code>
  .
 </p>
 <p>
  In the following snippet, the
  <code>
   projection
  </code>
  parameter represents the
specific fields the caller wants to get back. The snippet creates a new cursor
and adds one row to it&mdash;one root, a top level directory, like
Downloads or Images.  Most providers only have one root. You might have more than one,
for example, in the case of multiple user accounts. In that case, just add a
second row to the cursor.
 </p>
 <pre>
@Override
public Cursor queryRoots(String[] projection) throws FileNotFoundException {

    // Create a cursor with either the requested fields, or the default
    // projection if "projection" is null.
    final MatrixCursor result =
            new MatrixCursor(resolveRootProjection(projection));

    // If user is not logged in, return an empty root cursor.  This removes our
    // provider from the list entirely.
    if (!isUserLoggedIn()) {
        return result;
    }

    // It's possible to have multiple roots (e.g. for multiple accounts in the
    // same app) -- just add multiple cursor rows.
    // Construct one row for a root called "MyCloud".
    final MatrixCursor.RowBuilder row = result.newRow();
    row.add(Root.COLUMN_ROOT_ID, ROOT);
    row.add(Root.COLUMN_SUMMARY, getContext().getString(R.string.root_summary));

    // FLAG_SUPPORTS_CREATE means at least one directory under the root supports
    // creating documents. FLAG_SUPPORTS_RECENTS means your application's most
    // recently used documents will show up in the "Recents" category.
    // FLAG_SUPPORTS_SEARCH allows users to search all documents the application
    // shares.
    row.add(Root.COLUMN_FLAGS, Root.FLAG_SUPPORTS_CREATE |
            Root.FLAG_SUPPORTS_RECENTS |
            Root.FLAG_SUPPORTS_SEARCH);

    // COLUMN_TITLE is the root title (e.g. Gallery, Drive).
    row.add(Root.COLUMN_TITLE, getContext().getString(R.string.title));

    // This document id cannot change once it's shared.
    row.add(Root.COLUMN_DOCUMENT_ID, getDocIdForFile(mBaseDir));

    // The child MIME types are used to filter the roots and only present to the
    //  user roots that contain the desired type somewhere in their file hierarchy.
    row.add(Root.COLUMN_MIME_TYPES, getChildMimeTypes(mBaseDir));
    row.add(Root.COLUMN_AVAILABLE_BYTES, mBaseDir.getFreeSpace());
    row.add(Root.COLUMN_ICON, R.drawable.ic_launcher);

    return result;
}</pre>
 <h4 id="queryChildDocuments">
  Implement queryChildDocuments
 </h4>
 <p>
  Your implementation of
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryChildDocuments(java.lang.String, java.lang.String[], java.lang.String)">
    queryChildDocuments()
   </a>
  </code>
  must return a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  that points to all the files in
the specified directory, using columns defined in
  <code>
   <a href="/reference/android/provider/DocumentsContract.Document.html">
    DocumentsContract.Document
   </a>
  </code>
  .
 </p>
 <p>
  This method gets called when you choose an application root in the picker UI.
It gets the child documents of a directory under the root.  It can be called at any level in
the file hierarchy, not just the root. This snippet
makes a new cursor with the requested columns, then adds information about
every immediate child in the parent directory to the cursor.
A child can be an image, another directory&mdash;any file:
 </p>
 <pre>@Override
public Cursor queryChildDocuments(String parentDocumentId, String[] projection,
                              String sortOrder) throws FileNotFoundException {

    final MatrixCursor result = new
            MatrixCursor(resolveDocumentProjection(projection));
    final File parent = getFileForDocId(parentDocumentId);
    for (File file : parent.listFiles()) {
        // Adds the file's display name, MIME type, size, and so on.
        includeFile(result, null, file);
    }
    return result;
}
</pre>
 <h4 id="queryDocument">
  Implement queryDocument
 </h4>
 <p>
  Your implementation of
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryDocument(java.lang.String, java.lang.String[])">
    queryDocument()
   </a>
  </code>
  must return a
  <code>
   <a href="/reference/android/database/Cursor.html">
    Cursor
   </a>
  </code>
  that points to the specified file,
using columns defined in
  <code>
   <a href="/reference/android/provider/DocumentsContract.Document.html">
    DocumentsContract.Document
   </a>
  </code>
  .
 </p>
 <p>
  The
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryDocument(java.lang.String, java.lang.String[])">
    queryDocument()
   </a>
  </code>
  method returns the same information that was passed in
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryChildDocuments(java.lang.String, java.lang.String[], java.lang.String)">
    queryChildDocuments()
   </a>
  </code>
  ,
but for a specific file:
 </p>
 <pre>@Override
public Cursor queryDocument(String documentId, String[] projection) throws
        FileNotFoundException {

    // Create a cursor with the requested projection, or the default projection.
    final MatrixCursor result = new
            MatrixCursor(resolveDocumentProjection(projection));
    includeFile(result, documentId, null);
    return result;
}
</pre>
 <h4 id="openDocument">
  Implement openDocument
 </h4>
 <p>
  You must implement
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#openDocument(java.lang.String, java.lang.String, android.os.CancellationSignal)">
    openDocument()
   </a>
  </code>
  to return a
  <code>
   <a href="/reference/android/os/ParcelFileDescriptor.html">
    ParcelFileDescriptor
   </a>
  </code>
  representing
the specified file. Other apps can use the returned
  <code>
   <a href="/reference/android/os/ParcelFileDescriptor.html">
    ParcelFileDescriptor
   </a>
  </code>
  to stream data. The system calls this method once the user selects a file
and the client app requests access to it by calling
  <code>
   <a href="/reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">
    openFileDescriptor()
   </a>
  </code>
  .
For example:
 </p>
 <pre>@Override
public ParcelFileDescriptor openDocument(final String documentId,
                                         final String mode,
                                         CancellationSignal signal) throws
        FileNotFoundException {
    Log.v(TAG, "openDocument, mode: " + mode);
    // It's OK to do network operations in this method to download the document,
    // as long as you periodically check the CancellationSignal. If you have an
    // extremely large file to transfer from the network, a better solution may
    // be pipes or sockets (see ParcelFileDescriptor for helper methods).

    final File file = getFileForDocId(documentId);

    final boolean isWrite = (mode.indexOf('w') != -1);
    if(isWrite) {
        // Attach a close listener if the document is opened in write mode.
        try {
            Handler handler = new Handler(getContext().getMainLooper());
            return ParcelFileDescriptor.open(file, accessMode, handler,
                        new ParcelFileDescriptor.OnCloseListener() {
                @Override
                public void onClose(IOException e) {

                    // Update the file with the cloud server. The client is done
                    // writing.
                    Log.i(TAG, "A file with id " +
                    documentId + " has been closed!
                    Time to " +
                    "update the server.");
                }

            });
        } catch (IOException e) {
            throw new FileNotFoundException("Failed to open document with id "
            + documentId + " and mode " + mode);
        }
    } else {
        return ParcelFileDescriptor.open(file, accessMode);
    }
}
</pre>
 <h3 id="security">
  Security
 </h3>
 <p>
  Suppose your document provider is a password-protected cloud storage service
and you want to make sure that users are logged in before you start sharing their files.
What should your app do if the user is not logged in?  The solution is to return
zero roots in your implementation of
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryRoots(java.lang.String[])">
    queryRoots()
   </a>
  </code>
  . That is, an empty root cursor:
 </p>
 <pre>
public Cursor queryRoots(String[] projection) throws FileNotFoundException {
...
    // If user is not logged in, return an empty root cursor.  This removes our
    // provider from the list entirely.
    if (!isUserLoggedIn()) {
        return result;
}
</pre>
 <p>
  The other step is to call
  <code>
   getContentResolver().notifyChange()
  </code>
  .
Remember the
  <code>
   <a href="/reference/android/provider/DocumentsContract.html">
    DocumentsContract
   </a>
  </code>
  ?  We&rsquo;re using it to make
this URI. The following snippet tells the system to query the roots of your
document provider whenever the user's login status changes. If the user is not
logged in, a call to
  <code>
   <a href="/reference/android/provider/DocumentsProvider.html#queryRoots(java.lang.String[])">
    queryRoots()
   </a>
  </code>
  returns an
empty cursor, as shown above. This ensures that a provider's documents are only
available if the user is logged into the provider.
 </p>
 <pre>private void onLoginButtonClick() {
    loginOrLogout();
    getContentResolver().notifyChange(DocumentsContract
            .buildRootsUri(AUTHORITY), null);
}
</pre>
</div>
<h1>App Widgets</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Basics">
      The Basics
     </a>
    </li>
    <li>
     <a href="#Manifest">
      Declaring an App Widget in the Manifest
     </a>
    </li>
    <li>
     <a href="#MetaData">
      Adding the AppWidgetProviderInfo Metadata
     </a>
    </li>
    <li>
     <a href="#CreatingLayout">
      Creating the App Widget Layout
     </a>
    </li>
    <li>
     <a href="#AppWidgetProvider">
      Using the AppWidgetProvider Class
     </a>
     <ol>
      <li>
       <a href="#ProviderBroadcasts">
        Receiving App Widget broadcast
Intents
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Configuring">
      Creating an App Widget Configuration
Activity
     </a>
     <ol>
      <li>
       <a href="#UpdatingFromTheConfiguration">
        Updating the App Widget
from 
            the Configuration Activity
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#preview">
      Setting a Preview Image
     </a>
    </li>
    <li>
     <a href="#collections">
      Using App Widgets with Collections
     </a>
     <ol>
      <li>
       <a href="#collection_sample">
        Sample application
       </a>
      </li>
      <li>
       <a href="#implementing_collections">
        Implementing app widgets with
collections
       </a>
      </li>
      <li>
       <a href="#fresh">
        Keeping Collection Data Fresh
       </a>
      </li>
     </ol>
    </li>
   </ol>
   <h2>
    Key classes
   </h2>
   <ol>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetProvider.html">
       AppWidgetProvider
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
       AppWidgetProviderInfo
      </a>
     </code>
    </li>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetManager.html">
       AppWidgetManager
      </a>
     </code>
    </li>
   </ol>
  </div>
 </div>
 <p>
  App Widgets are miniature application views that can be embedded in other
applications
(such as the Home screen) and receive periodic updates. These views are
referred 
to as Widgets in the user interface,
and you can publish one with an App Widget provider. An application component
that is 
able to hold other App Widgets is called an App Widget host. The screenshot
below shows
the Music App Widget.
 </p>
 <img alt="" src="http://developer.android.com/images/appwidgets/appwidget.png"/>
 <p>
  This document describes how to publish an App Widget using an App Widget
provider. For a discussion of creating your own
  <code>
   <a href="/reference/android/appwidget/AppWidgetHost.html">
    AppWidgetHost
   </a>
  </code>
  to host app widgets, see
  <a href="/guide/topics/appwidgets/host.html">
   App Widget Host
  </a>
  .
 </p>
 <div class="note design">
  <p>
   <strong>
    Widget Design
   </strong>
  </p>
  <p>
   For information about how to design your app widget, read the
   <a href="/design/patterns/widgets.html">
    Widgets
   </a>
   design guide.
  </p>
 </div>
 <h2 id="Basics">
  The Basics
 </h2>
 <p>
  To create an App Widget, you need the following:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
     AppWidgetProviderInfo
    </a>
   </code>
   object
  </dt>
  <dd>
   Describes the metadata for an App Widget, such as the App Widget's layout,
update frequency,
    and the AppWidgetProvider class. This should be defined in XML.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html">
     AppWidgetProvider
    </a>
   </code>
   class implementation
  </dt>
  <dd>
   Defines the basic methods that allow you to programmatically interface
with the App Widget,
    based on broadcast events. Through it, you will receive broadcasts when the
App Widget is updated, 
    enabled, disabled and deleted.
  </dd>
  <dt>
   View layout
  </dt>
  <dd>
   Defines the initial layout for the App Widget, defined in XML.
  </dd>
 </dl>
 <p>
  Additionally, you can implement an App Widget configuration Activity. This is
an optional
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  that launches when the user adds your App Widget
and allows him or her
to modify App Widget settings at create-time.
 </p>
 <p>
  The following sections describe how to set up each of these components.
 </p>
 <h2 id="Manifest">
  Declaring an App Widget in the Manifest
 </h2>
 <p>
  First, declare the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  class in your
application's
  <code>
   AndroidManifest.xml
  </code>
  file. For example:
 </p>
 <pre style="clear:right">
&lt;receiver android:name="ExampleAppWidgetProvider" &gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.appwidget.action.APPWIDGET_UPDATE" /&gt;
    &lt;/intent-filter&gt;
    &lt;meta-data android:name="android.appwidget.provider"
               android:resource="@xml/example_appwidget_info" /&gt;
&lt;/receiver&gt;
</pre>
 <p>
  The
  <code>
   &lt;receiver&gt;
  </code>
  element requires the
  <code>
   android:name
  </code>
  attribute, which specifies the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  used
by the App Widget.
 </p>
 <p>
  The
  <code>
   &lt;intent-filter&gt;
  </code>
  element must include an
  <code>
   &lt;action&gt;
  </code>
  element with the
  <code>
   android:name
  </code>
  attribute. This attribute specifies
that the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  accepts the
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_UPDATE">
    ACTION_APPWIDGET_UPDATE
   </a>
  </code>
  broadcast.
This is the only broadcast that you must explicitly declare. The
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html">
    AppWidgetManager
   </a>
  </code>
  automatically sends all other App Widget broadcasts to the AppWidgetProvider as
necessary.
 </p>
 <p>
  The
  <code>
   &lt;meta-data&gt;
  </code>
  element specifies the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
    AppWidgetProviderInfo
   </a>
  </code>
  resource and requires the 
following attributes:
 </p>
 <ul>
  <li>
   <code>
    android:name
   </code>
   - Specifies the metadata name. Use
   <code>
    android.appwidget.provider
   </code>
   to identify the data as the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
     AppWidgetProviderInfo
    </a>
   </code>
   descriptor.
  </li>
  <li>
   <code>
    android:resource
   </code>
   - Specifies the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
     AppWidgetProviderInfo
    </a>
   </code>
   resource location.
  </li>
 </ul>
 <h2 id="MetaData">
  Adding the AppWidgetProviderInfo Metadata
 </h2>
 <p>
  The
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
    AppWidgetProviderInfo
   </a>
  </code>
  defines the essential 
qualities of an App Widget, such as its minimum layout dimensions, its initial
layout resource,
how often to update the App Widget, and (optionally) a configuration Activity to
launch at create-time.
Define the AppWidgetProviderInfo object in an XML resource using a single
  <code>
   &lt;appwidget-provider&gt;
  </code>
  element and save it in the project's
  <code>
   res/xml/
  </code>
  folder.
 </p>
 <p>
  For example:
 </p>
 <pre>
&lt;appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
    android:minWidth="40dp"
    android:minHeight="40dp"
    android:updatePeriodMillis="86400000"
    android:previewImage="@drawable/preview"
    android:initialLayout="@layout/example_appwidget"
    android:configure="com.example.android.ExampleAppWidgetConfigure" 
    android:resizeMode="horizontal|vertical"
    android:widgetCategory="home_screen"&gt;
&lt;/appwidget-provider&gt;
</pre>
 <p>
  Here's a summary of the
  <code>
   &lt;appwidget-provider&gt;
  </code>
  attributes:
 </p>
 <ul>
  <li>
   The values for the
   <code>
    minWidth
   </code>
   and
   <code>
    minHeight
   </code>
   attributes specify the minimum amount of space the App Widget consumes
   <em>
    by default
   </em>
   . The default Home screen positions App Widgets in its
    window based on a grid of cells that have a defined height and width. If
    the values for an App Widget's minimum width or height don't match the
    dimensions of the cells, then the App Widget dimensions round
   <em>
    up
   </em>
   to the nearest cell size.
   <p>
    See the
    <a href="/guide/practices/ui_guidelines/widget_design.html#anatomy_determining_size">
     App Widget Design Guidelines
    </a>
    for more information on sizing your App
    Widgets.
   </p>
   <p class="note">
    <strong>
     Note:
    </strong>
    To make your app widget portable
    across devices, your app widget's minimum size should never be larger
    than 4 x 4 cells.
   </p>
  </li>
  <li>
   The
   <code>
    minResizeWidth
   </code>
   and
   <code>
    minResizeHeight
   </code>
   attributes
    specify the App Widget's absolute minimum size. These values should specify
    the size below which the App Widget would be illegible or otherwise unusable.
    Using these attributes allows the user to resize the widget to a size that
    may be smaller than the default widget size defined by the
   <code>
    minWidth
   </code>
   and
   <code>
    minHeight
   </code>
   attributes.
    Introduced in Android 3.1.
   <p>
    See the
    <a href="/guide/practices/ui_guidelines/widget_design.html#anatomy_determining_size">
     App Widget Design Guidelines
    </a>
    for more information on sizing your App
    Widgets.
   </p>
  </li>
  <li>
   The
   <code>
    updatePeriodMillis
   </code>
   attribute defines how often the App
Widget framework should request an update from the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html">
     AppWidgetProvider
    </a>
   </code>
   by calling the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
     onUpdate()
    </a>
   </code>
   callback method. The actual update
is not guaranteed to occur exactly on time with this value and we suggest
updating as infrequently as possible&mdash;perhaps no more than once an hour to
conserve the battery. You might also allow the user to adjust the frequency in a
configuration&mdash;some people might want a stock ticker to update every 15
minutes, or maybe only four times a day.
   <p class="note">
    <strong>
     Note:
    </strong>
    If the device is asleep when it
is time for an update 
    	(as defined by
    <code>
     updatePeriodMillis
    </code>
    ), then the device will
wake up in order 
    	to perform the update. If you don't update more than once per hour, this
probably won't 
    	cause significant problems for the battery life. If, however, you need
to update more 
    	frequently and/or you do not need to update while the device is asleep,
then you can instead 
    	perform updates based on an alarm that will not wake the device. To do
so, set an alarm with 
    	an Intent that your AppWidgetProvider receives, using the
    <code>
     <a href="/reference/android/app/AlarmManager.html">
      AlarmManager
     </a>
    </code>
    . 
    	Set the alarm type to either
    <code>
     <a href="/reference/android/app/AlarmManager.html#ELAPSED_REALTIME">
      ELAPSED_REALTIME
     </a>
    </code>
    or
    <code>
     <a href="/reference/android/app/AlarmManager.html#RTC">
      RTC
     </a>
    </code>
    , which will only
    	deliver the alarm when the device is awake. Then set
    <code>
     updatePeriodMillis
    </code>
    to 
    	zero (
    <code>
     "0"
    </code>
    ).
   </p>
  </li>
  <li>
   The
   <code>
    initialLayout
   </code>
   attribute points to the layout resource
that defines the
    App Widget layout.
  </li>
  <li>
   The
   <code>
    configure
   </code>
   attribute defines the
   <code>
    <a href="/reference/android/app/Activity.html">
     Activity
    </a>
   </code>
   to launch when
    the user adds the App Widget, in order for him or her to configure App
Widget properties. This is optional
    (read
   <a href="#Configuring">
    Creating an App Widget Configuration
Activity
   </a>
   below).
  </li>
  <li>
   The
   <code>
    previewImage
   </code>
   attribute specifies a preview of what the
app widget will look like after it's configured, which the user sees when
selecting the app widget. If not supplied, the user instead sees your
application's launcher icon. This field corresponds to the
   <code>
    android:previewImage
   </code>
   attribute in the
   <code>
    &lt;receiver&gt;
   </code>
   element in the
   <code>
    AndroidManifest.xml
   </code>
   file. For more discussion of
using
   <code>
    previewImage
   </code>
   , see
   <a href="#preview">
    Setting a Preview
Image
   </a>
   . Introduced in Android 3.0.
  </li>
  <li>
   The
   <code>
    autoAdvanceViewId
   </code>
   attribute specifies the view ID of the
app widget subview that should be auto-advanced by the widget's host. Introduced in Android 3.0.
  </li>
  <li>
   The
   <code>
    resizeMode
   </code>
   attribute specifies the rules by which a widget
can be resized. You use this attribute to make homescreen widgets
resizeable&mdash;horizontally, vertically, or on both axes. Users touch-hold a
widget to show its resize handles, then drag the horizontal and/or vertical
handles to change the size on the layout grid. Values for the
   <code>
    resizeMode
   </code>
   attribute include "horizontal", "vertical", and "none".
To declare a widget as resizeable horizontally and vertically, supply the value
"horizontal|vertical". Introduced in Android 3.1.
  </li>
  <li>
   The
   <code>
    minResizeHeight
   </code>
   attribute specifies the minimum height (in dps) to which
the widget can be resized. This field has no effect if it is greater than
   <code>
    minHeight
   </code>
   or if
vertical resizing isn't enabled (see
   <code>
    resizeMode
   </code>
   ). Introduced in Android 4.0.
  </li>
  <li>
   The
   <code>
    minResizeWidth
   </code>
   attribute specifies the minimum width (in dps) to which
the widget can be resized. This field has no effect if it is greater than
   <code>
    minWidth
   </code>
   or if
horizontal resizing isn't enabled (see
   <code>
    resizeMode
   </code>
   ). Introduced in Android 4.0.
  </li>
  <li>
   The
   <code>
    widgetCategory
   </code>
   attribute declares whether your App Widget
can be displayed on the home screen (
   <code>
    home_screen
   </code>
   ), the lock screen
(
   <code>
    keyguard
   </code>
   ), or both. Only Android versions lower than 5.0 support
lock-screen widgets. For Android 5.0 and higher, only
   <code>
    home_screen
   </code>
   is
valid.
  </li>
 </ul>
 <p>
  See the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
    AppWidgetProviderInfo
   </a>
  </code>
  class for more
information on the
attributes accepted by the
  <code>
   &lt;appwidget-provider&gt;
  </code>
  element.
 </p>
 <h2 id="CreatingLayout">
  Creating the App Widget Layout
 </h2>
 <p>
  You must define an initial layout for your App Widget in XML and save it in
the project's
  <code>
   res/layout/
  </code>
  directory. You can design your App Widget using the
View objects listed
below, but before you begin designing your App Widget, please read and
understand the
  <a href="/guide/practices/ui_guidelines/widget_design.html">
   App Widget
Design 
Guidelines
  </a>
  .
 </p>
 <p>
  Creating the App Widget layout is simple if you're
familiar with
  <a href="/guide/topics/ui/declaring-layout.html">
   Layouts
  </a>
  .
However, you must be aware that App Widget layouts are based on
  <code>
   <a href="/reference/android/widget/RemoteViews.html">
    RemoteViews
   </a>
  </code>
  ,
which do not support every kind of layout or view widget.
 </p>
 <p>
  A RemoteViews object (and, consequently, an App Widget) can support the 
following layout classes:
 </p>
 <ul class="nolist">
  <li>
   <code>
    <a href="/reference/android/widget/FrameLayout.html">
     FrameLayout
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/LinearLayout.html">
     LinearLayout
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/RelativeLayout.html">
     RelativeLayout
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/GridLayout.html">
     GridLayout
    </a>
   </code>
  </li>
 </ul>
 <p>
  And the following widget classes:
 </p>
 <ul class="nolist">
  <li>
   <code>
    <a href="/reference/android/widget/AnalogClock.html">
     AnalogClock
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/Button.html">
     Button
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/Chronometer.html">
     Chronometer
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/ImageButton.html">
     ImageButton
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/ImageView.html">
     ImageView
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/ProgressBar.html">
     ProgressBar
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/TextView.html">
     TextView
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/ViewFlipper.html">
     ViewFlipper
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/ListView.html">
     ListView
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/GridView.html">
     GridView
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/StackView.html">
     StackView
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/widget/AdapterViewFlipper.html">
     AdapterViewFlipper
    </a>
   </code>
  </li>
 </ul>
 <p>
  Descendants of these classes are not supported.
 </p>
 <p>
  RemoteViews also supports
  <code>
   <a href="/reference/android/view/ViewStub.html">
    ViewStub
   </a>
  </code>
  , which is an invisible, zero-sized View you can use 
to lazily inflate layout resources at runtime.
 </p>
 <h3 id="AddingMargins">
  Adding margins to App Widgets
 </h3>
 <p>
  Widgets should not generally extend to screen edges and should not visually be flush with other widgets, so you should add margins on all sides around your widget frame.
 </p>
 <p>
  As of Android 4.0, app widgets are automatically given padding between the widget frame and the app widget's bounding box to provide better alignment with other widgets and icons on the user's home screen. To take advantage of this strongly recommended behavior, set your application's
  <a href="/guide/topics/manifest/uses-sdk-element.html">
   targetSdkVersion
  </a>
  to 14 or greater.
 </p>
 <p>
  It's easy to write a single layout that has custom margins applied for earlier versions of the platform, and has no extra margins for Android 4.0 and greater:
 </p>
 <ol>
  <li>
   Set your application's
   <code>
    targetSdkVersion
   </code>
   to 14 or greater.
  </li>
  <li>
   Create a layout such as the one below, that references a
   <a href="/guide/topics/resources/more-resources.html#Dimension">
    dimension resource
   </a>
   for its margins:
   <pre>
&lt;FrameLayout
  android:layout_width="match_parent"
  android:layout_height="match_parent"
  <strong>android:padding="@dimen/widget_margin"&gt;</strong>

  &lt;LinearLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="horizontal"
    android:background="@drawable/my_widget_background"&gt;
    &hellip;
  &lt;/LinearLayout&gt;

&lt;/FrameLayout&gt;
</pre>
  </li>
  <li>
   Create two dimensions resources, one in
   <code>
    res/values/
   </code>
   to provide the pre-Android 4.0 custom margins, and one in
   <code>
    res/values-v14/
   </code>
   to provide no extra padding for Android 4.0 widgets:
   <p>
    <strong>
     res/values/dimens.xml
    </strong>
    :
    <br/>
   </p>
   <pre>&lt;dimen name="widget_margin"&gt;8dp&lt;/dimen&gt;</pre>
   <p>
    <strong>
     res/values-v14/dimens.xml
    </strong>
    :
    <br/>
   </p>
   <pre>&lt;dimen name="widget_margin"&gt;0dp&lt;/dimen&gt;</pre>
  </li>
 </ol>
 <p>
  Another option is to simply build extra margins into your
  <a href="/guide/topics/graphics/2d-graphics.html#nine-patch">
   nine-patch
  </a>
  background assets by default, and provide different nine-patches with no margins for API level 14 or later.
 </p>
 <h2 id="AppWidgetProvider">
  Using the AppWidgetProvider Class
 </h2>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <p>
    You must declare your AppWidgetProvider class implementation as a
broadcast receiver 
    using the
    <code>
     &lt;receiver&gt;
    </code>
    element in the AndroidManifest (see
    <a href="#Manifest">
     Declaring an App Widget in the Manifest
    </a>
    above).
   </p>
  </div>
 </div>
 <p>
  The
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  class extends
BroadcastReceiver as a convenience
class to handle the App Widget broadcasts. The AppWidgetProvider receives only
the event broadcasts that
are relevant to the App Widget, such as when the App Widget is updated, deleted,
enabled, and disabled.
When these broadcast events occur, the AppWidgetProvider receives the following
method calls:
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
     onUpdate()
    </a>
   </code>
  </dt>
  <dd>
   This is called to update the App Widget at intervals defined by the
   <code>
    updatePeriodMillis
   </code>
   attribute in the AppWidgetProviderInfo (see
   <a href="#MetaData">
    Adding the 
    AppWidgetProviderInfo Metadata
   </a>
   above). This method is also called
    when the user adds the App Widget, so it should perform the essential setup,
    such as define event handlers for Views and start a temporary
   <code>
    <a href="/reference/android/app/Service.html">
     Service
    </a>
   </code>
   , if necessary. However, if you have declared a
configuration
    Activity,
   <strong>
    this method is not called
   </strong>
   when the user adds the
App Widget,
    but is called for the subsequent updates. It is the responsibility of the 
    configuration Activity to perform the first update when configuration is
done.
    (See
   <a href="#Configuring">
    Creating an App Widget Configuration
Activity
   </a>
   below.)
  </dd>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onAppWidgetOptionsChanged(android.content.Context, android.appwidget.AppWidgetManager, int, android.os.Bundle)">
     onAppWidgetOptionsChanged()
    </a>
   </code>
  </dt>
  <dd>
   This is called when the widget is first placed and any time the widget is resized. You can use this callback to show or hide content based on the widget's size ranges. You get the size ranges by calling
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#getAppWidgetOptions(int)">
     getAppWidgetOptions()
    </a>
   </code>
   , which returns a
   <code>
    <a href="/reference/android/os/Bundle.html">
     Bundle
    </a>
   </code>
   that includes the following:
   <br/>
   <br/>
   <ul>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetManager.html#OPTION_APPWIDGET_MIN_WIDTH">
       OPTION_APPWIDGET_MIN_WIDTH
      </a>
     </code>
     &mdash;Contains 
the lower bound on the current width, in dp units, of a widget instance.
    </li>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetManager.html#OPTION_APPWIDGET_MIN_HEIGHT">
       OPTION_APPWIDGET_MIN_HEIGHT
      </a>
     </code>
     &mdash;Contains 
the lower bound on the current height, in dp units, of a widget instance.
    </li>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetManager.html#OPTION_APPWIDGET_MAX_WIDTH">
       OPTION_APPWIDGET_MAX_WIDTH
      </a>
     </code>
     &mdash;Contains
 the upper bound on the current width, in dp units, of a widget instance.
    </li>
    <li>
     <code>
      <a href="/reference/android/appwidget/AppWidgetManager.html#OPTION_APPWIDGET_MAX_HEIGHT">
       OPTION_APPWIDGET_MAX_HEIGHT
      </a>
     </code>
     &mdash;Contains 
the upper bound on the current width, in dp units, of a widget instance.
    </li>
   </ul>
   This callback was introduced in API Level 16 (Android 4.1). If you implement this callback, make sure that your app doesn't depend on it since it won't be called on older devices.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onDeleted(android.content.Context, int[])">
     onDeleted(Context, int[])
    </a>
   </code>
  </dt>
  <dd>
   This is called every time an App Widget is deleted from the App Widget
host.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onEnabled(android.content.Context)">
     onEnabled(Context)
    </a>
   </code>
  </dt>
  <dd>
   This is called when an instance the App Widget is created for the first
time. For example, if the user 
    adds two instances of your App Widget, this is only called the first time.
    If you need to open a new database or perform other setup that only needs to
occur once 
    for all App Widget instances, then this is a good place to do it.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onDisabled(android.content.Context)">
     onDisabled(Context)
    </a>
   </code>
  </dt>
  <dd>
   This is called when the last instance of your App Widget is deleted from
the App Widget host. 
    This is where you should clean up any work done in
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onEnabled(android.content.Context)">
     onEnabled(Context)
    </a>
   </code>
   , 
    such as delete a temporary database.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onReceive(android.content.Context, android.content.Intent)">
     onReceive(Context, Intent)
    </a>
   </code>
  </dt>
  <dd>
   This is called for every broadcast and before each of the above callback
methods.
    You normally don't need to implement this method because the default
AppWidgetProvider 
    implementation filters all App Widget broadcasts and calls the above 
    methods as appropriate.
  </dd>
 </dl>
 <p>
  The most important AppWidgetProvider callback is
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  because it is called when
each App Widget is added to a host (unless you use a configuration Activity). If
your App Widget accepts any user interaction events, then you need to register
the event handlers in this callback. If your App Widget doesn't create temporary
files or databases, or perform other work that requires clean-up, then
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  may be the only callback
method you need to define. For example, if you want an App Widget with a button
that launches an Activity when clicked, you could use the following
implementation of AppWidgetProvider:
 </p>
 <pre>
public class ExampleAppWidgetProvider extends AppWidgetProvider {

    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {
        final int N = appWidgetIds.length;

        // Perform this loop procedure for each App Widget that belongs to this provider
        for (int i=0; i&lt;N; i++) {
            int appWidgetId = appWidgetIds[i];

            // Create an Intent to launch ExampleActivity
            Intent intent = new Intent(context, ExampleActivity.class);
            PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent, 0);

            // Get the layout for the App Widget and attach an on-click listener
            // to the button
            RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.appwidget_provider_layout);
            views.setOnClickPendingIntent(R.id.button, pendingIntent);

            // Tell the AppWidgetManager to perform an update on the current app widget
            appWidgetManager.updateAppWidget(appWidgetId, views);
        }
    }
}
</pre>
 <p>
  This AppWidgetProvider defines only the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  method for the purpose of
defining a
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  that launches an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  and attaching it to the App Widget's button with
  <code>
   <a href="/reference/android/widget/RemoteViews.html#setOnClickPendingIntent(int, android.app.PendingIntent)">
    setOnClickPendingIntent(int, PendingIntent)
   </a>
  </code>
  . Notice
that it includes a loop that iterates through each entry in
  <code>
   appWidgetIds
  </code>
  , which is an array of IDs that identify each App
Widget created by this provider. In this way, if the user creates more than one
instance of the App Widget, then they are all updated simultaneously. However,
only one
  <code>
   updatePeriodMillis
  </code>
  schedule will be managed for all
instances of the App Widget. For example, if the update schedule is defined to
be every two hours, and a second instance of the App Widget is added one hour
after the first one, then they will both be updated on the period defined by the
first one and the second update period will be ignored (they'll both be updated
every two hours, not every hour).
 </p>
 <p class="note">
  <strong>
   Note:
  </strong>
  Because
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  is an extension of
  <code>
   <a href="/reference/android/content/BroadcastReceiver.html">
    BroadcastReceiver
   </a>
  </code>
  , your process is not guaranteed to keep
running after the callback methods return (see
  <code>
   <a href="/reference/android/content/BroadcastReceiver.html">
    BroadcastReceiver
   </a>
  </code>
  for information about the broadcast
lifecycle). If your App Widget setup process can take several seconds (perhaps
while performing web requests) and you require that your process continues,
consider starting a
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  in the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  method. From within the Service, you can perform your own updates
to the App Widget without worrying about the AppWidgetProvider closing down due
to an
  <a href="/guide/practices/responsiveness.html">
   Application
Not Responding
  </a>
  (ANR) error. See the
  <a href="http://code.google.com/p/wiktionary-android/source/browse/trunk/Wiktionary/src/com/example/android/wiktionary/WordWidget.java">
   Wiktionary sample's AppWidgetProvider
  </a>
  for an example of an App Widget running a
  <code>
   <a href="/reference/android/app/Service.html">
    Service
   </a>
  </code>
  .
 </p>
 <p>
  Also see the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/appwidget/ExampleAppWidgetProvider.html">
   ExampleAppWidgetProvider.java
  </a>
  sample class.
 </p>
 <h3 id="ProviderBroadcasts">
  Receiving App Widget broadcast Intents
 </h3>
 <p>
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  is just a convenience class.  If
you would like
to receive the App Widget broadcasts directly, you can implement your own
  <code>
   <a href="/reference/android/content/BroadcastReceiver.html">
    BroadcastReceiver
   </a>
  </code>
  or override the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onReceive(android.content.Context, android.content.Intent)">
    onReceive(Context, Intent)
   </a>
  </code>
  callback. 
The Intents you need to care about are as follows:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_UPDATE">
     ACTION_APPWIDGET_UPDATE
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_DELETED">
     ACTION_APPWIDGET_DELETED
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_ENABLED">
     ACTION_APPWIDGET_ENABLED
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_DISABLED">
     ACTION_APPWIDGET_DISABLED
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_OPTIONS_CHANGED">
     ACTION_APPWIDGET_OPTIONS_CHANGED
    </a>
   </code>
  </li>
 </ul>
 <h2 id="Configuring">
  Creating an App Widget Configuration Activity
 </h2>
 <p>
  If you would like the user to configure settings when he or she adds a new
App Widget,
you can create an App Widget configuration Activity. This
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  will be automatically launched by the App Widget host and allows the user to
configure
available settings for the App Widget at create-time, such as the App Widget
color, size, 
update period or other functionality settings.
 </p>
 <p>
  The configuration Activity should be declared as a normal Activity in the
Android manifest file.
However, it will be launched by the App Widget host with the
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#ACTION_APPWIDGET_CONFIGURE">
    ACTION_APPWIDGET_CONFIGURE
   </a>
  </code>
  action,
so the Activity needs to accept this Intent. For example:
 </p>
 <pre>
&lt;activity android:name=".ExampleAppWidgetConfigure"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.appwidget.action.APPWIDGET_CONFIGURE"/&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
 <p>
  Also, the Activity must be declared in the AppWidgetProviderInfo XML file,
with the
  <code>
   android:configure
  </code>
  attribute (see
  <a href="#MetaData">
   Adding 
the AppWidgetProviderInfo Metadata
  </a>
  above). For example, the configuration
Activity
can be declared like this:
 </p>
 <pre>
&lt;appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
    ...
    android:configure="com.example.android.ExampleAppWidgetConfigure" 
    ... &gt;
&lt;/appwidget-provider&gt;
</pre>
 <p>
  Notice that the Activity is declared with a fully-qualified namespace,
because 
it will be referenced from outside your package scope.
 </p>
 <p>
  That's all you need to get started with a configuration Activity. Now all you
need is the actual
Activity. There are, however, two important things to remember when you
implement the Activity:
 </p>
 <ul>
  <li>
   The App Widget host calls the configuration Activity and the configuration
Activity should always 
    return a result. The result should include the App Widget ID
    passed by the Intent that launched the Activity (saved in the Intent extras
as
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#EXTRA_APPWIDGET_ID">
     EXTRA_APPWIDGET_ID
    </a>
   </code>
   ).
  </li>
  <li>
   The
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
     onUpdate()
    </a>
   </code>
   method
   <strong>
    will not be called
   </strong>
   when the App Widget
is created
    (the system will not send the ACTION_APPWIDGET_UPDATE broadcast when a
configuration Activity
    is launched). It is the responsibility of the configuration Activity to
request an update from the 
    AppWidgetManager when the App Widget is first created. However,
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
     onUpdate()
    </a>
   </code>
   will be called for subsequent updates&mdash;it is only skipped
the first time.
  </li>
 </ul>
 <p>
  See the code snippets in the following section for an example of how to
return a result
from the configuration and update the App Widget.
 </p>
 <h3 id="UpdatingFromTheConfiguration">
  Updating the App Widget from the
configuration Activity
 </h3>
 <p>
  When an App Widget uses a configuration Activity, it is the responsibility of
the Activity
to update the App Widget when configuration is complete. 
You can do so by requesting an update directly from the
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html">
    AppWidgetManager
   </a>
  </code>
  .
 </p>
 <p>
  Here's a summary of the procedure to properly update the App Widget and close
the configuration Activity:
 </p>
 <ol>
  <li>
   First, get the App Widget ID from the Intent that launched the Activity:
   <pre>
Intent intent = getIntent();
Bundle extras = intent.getExtras();
if (extras != null) {
    mAppWidgetId = extras.getInt(
            AppWidgetManager.EXTRA_APPWIDGET_ID, 
            AppWidgetManager.INVALID_APPWIDGET_ID);
}
</pre>
  </li>
  <li>
   Perform your App Widget configuration.
  </li>
  <li>
   When the configuration is complete, get an instance of the
AppWidgetManager by calling
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#getInstance(android.content.Context)">
     getInstance(Context)
    </a>
   </code>
   :
   <pre>
AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context);
</pre>
  </li>
  <li>
   Update the App Widget with a
   <code>
    <a href="/reference/android/widget/RemoteViews.html">
     RemoteViews
    </a>
   </code>
   layout by
calling
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#updateAppWidget(int, android.widget.RemoteViews)">
     updateAppWidget(int, RemoteViews)
    </a>
   </code>
   :
   <pre>
RemoteViews views = new RemoteViews(context.getPackageName(),
R.layout.example_appwidget);
appWidgetManager.updateAppWidget(mAppWidgetId, views);
</pre>
  </li>
  <li>
   Finally, create the return Intent, set it with the Activity result, and
finish the Activity:
  </li>
  <pre>
Intent resultValue = new Intent();
resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);
setResult(RESULT_OK, resultValue);
finish();
</pre>
 </ol>
 <p class="note">
  <strong>
   Tip:
  </strong>
  When your configuration Activity first
opens, set
the Activity result to RESULT_CANCELED. This way, if the user backs-out of the
Activity before
reaching the end, the App Widget host is notified that the configuration was
cancelled and the
App Widget will not be added.
 </p>
 <p>
  See the
  <a href="/resources/samples/ApiDemos/src/com/example/android/apis/appwidget/ExampleAppWidgetConfigure.html">
   ExampleAppWidgetConfigure.java
  </a>
  sample class in ApiDemos for an example.
 </p>
 <h2 id="preview">
  Setting a Preview Image
 </h2>
 <p>
  Android 3.0 introduces the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#previewImage">
    previewImage
   </a>
  </code>
  field, which specifies a
preview of what the app widget looks like. This preview is shown to the user from the
widget picker. If this field is not supplied, the app widget's icon is used for
the preview.
 </p>
 <p>
  This is how you specify this setting in XML:
 </p>
 <pre>&lt;appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
  ...
  android:previewImage="@drawable/preview"&gt;
&lt;/appwidget-provider&gt;</pre>
 <p>
  To help create a preview image for your app widget (to specify in the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#previewImage">
    previewImage
   </a>
  </code>
  field), the Android
emulator includes an application called "Widget Preview." To create a
preview image, launch this application, select the app widget for your
application and set it up how you'd like your preview image to appear, then save
it and place it in your application's drawable resources.
 </p>
 <h2 id="collections">
  Using App Widgets with Collections
 </h2>
 <p>
  Android 3.0 introduces app widgets with collections. These kinds of App
Widgets use the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  to display collections
that are backed by remote data, such as from a
  <a href="/guide/topics/providers/content-providers.html">
   content
provider
  </a>
  . The data provided by the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  is presented in the app widget using one of the following view types, which
we&rsquo;ll refer to as &ldquo;collection views:&rdquo;
 </p>
 <dl>
  <dt>
   <code>
    <a href="/reference/android/widget/ListView.html">
     ListView
    </a>
   </code>
  </dt>
  <dd>
   A view that shows items in a
vertically scrolling
list. For an example, see the Gmail app widget.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/widget/GridView.html">
     GridView
    </a>
   </code>
  </dt>
  <dd>
   A view that shows items in
two-dimensional scrolling grid. For an example, see the Bookmarks app
widget.
  </dd>
  <dt>
   <code>
    <a href="/reference/android/widget/StackView.html">
     StackView
    </a>
   </code>
  </dt>
  <dd>
   A
stacked card view (kind of like a rolodex), where the user can flick the  front
card up/down to see the previous/next card, respectively.  Examples include
the YouTube and Books app widgets.&nbsp;
  </dd>
  <dt>
   <code>
    <a href="/reference/android/widget/AdapterViewFlipper.html">
     AdapterViewFlipper
    </a>
   </code>
  </dt>
  <dd>
   An adapter-backed simple
   <code>
    <a href="/reference/android/widget/ViewAnimator.html">
     ViewAnimator
    </a>
   </code>
   that  animates between two or more views. Only one
child is shown at a time.
  </dd>
 </dl>
 <p>
  As stated above, these collection views display collections backed by remote
data. This means that they use an
  <code>
   <a href="/reference/android/widget/Adapter.html">
    Adapter
   </a>
  </code>
  to bind their
user interface to their data. An
  <code>
   <a href="/reference/android/widget/Adapter.html">
    Adapter
   </a>
  </code>
  binds individual
items from a set of data into individual
  <code>
   <a href="/reference/android/view/View.html">
    View
   </a>
  </code>
  objects.
Because these collection views are backed by adapters, the Android framework
must include extra architecture to support their use in app widgets. In the
context of an app widget, the
  <code>
   <a href="/reference/android/widget/Adapter.html">
    Adapter
   </a>
  </code>
  is replaced by a
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  ,
which is simply a thin wrapper around  the
  <code>
   <a href="/reference/android/widget/Adapter.html">
    Adapter
   </a>
  </code>
  interface. 
 When
requested for a specific item in the collection, the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  creates
and returns the item for the collection as a
  <code>
   <a href="/reference/android/widget/RemoteViews.html">
    RemoteViews
   </a>
  </code>
  object.
In order to include a collection view in your app widget, you
must implement
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  .
 </p>
 <p>
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  is a service that allows a remote
adapter to request
  <code>
   <a href="/reference/android/widget/RemoteViews.html">
    RemoteViews
   </a>
  </code>
  objects.
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  is an
interface for an adapter between a collection view (such as
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/widget/GridView.html">
    GridView
   </a>
  </code>
  , and so on) and the
underlying data for that view. From the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  , here is an example of the boilerplate code you use to implement 
this service and interface:
 </p>
 <pre>
public class StackWidgetService extends RemoteViewsService {
    @Override
    public RemoteViewsFactory onGetViewFactory(Intent intent) {
        return new StackRemoteViewsFactory(this.getApplicationContext(), intent);
    }
}

class StackRemoteViewsFactory implements RemoteViewsService.RemoteViewsFactory {

//... include adapter-like methods here. See the StackView Widget sample.

}
</pre>
 <h3 id="collection_sample">
  Sample application
 </h3>
 <p>
  The code excerpts in this section are drawn from the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  :
 </p>
 <p>
  <img alt="" src="http://developer.android.com/images/appwidgets/StackWidget.png"/>
 </p>
 <p>
  This sample consists of a stack of 10 views, which  display the values
  <code>
   "0!"
  </code>
  through
  <code>
   "9!"
  </code>
  The sample
app widget has these primary behaviors:
 </p>
 <ul>
  <li>
   The user can vertically fling the top view in the
app widget to display the next or previous view. This is a built-in StackView
behavior.
  </li>
  <li>
   Without any user interaction, the app widget automatically advances
through
its views in sequence, like a slide show. This is due to the setting
   <code>
    android:autoAdvanceViewId="@id/stack_view"
   </code>
   in the
   <code>
    res/xml/stackwidgetinfo.xml
   </code>
   file. This setting applies to the view
ID,
which in this case is the view ID of the stack view.
  </li>
  <li>
   If the user touches the top view, the app widget displays the
   <code>
    <a href="/reference/android/widget/Toast.html">
     Toast
    </a>
   </code>
   message "Touched view
   <em>
    n
   </em>
   ," where
   <em>
    n
   </em>
   is the index (position) of the touched view. For more discussion of
how this is implemented, see
   <a href="#behavior">
    Adding behavior to individual items
   </a>
   .
  </li>
 </ul>
 <h3 id="implementing_collections">
  Implementing app widgets with collections
 </h3>
 <p>
  To implement an app widget with collections, you follow the same basic steps 
you would use to implement any app widget. The following sections  describe the
additional steps you need to perform to implement an app widget with
collections.
 </p>
 <h4>
  Manifest for app widgets with collections
 </h4>
 <p>
  In addition to the requirements listed in
  <a href="#Manifest">
   Declaring an
app widget in the Manifest
  </a>
  , to make it possible for app widgets with
collections to bind to your
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  , you must
declare the service in your manifest file with the permission
  <code>
   <a href="/reference/android/Manifest.permission.html#BIND_REMOTEVIEWS">
    BIND_REMOTEVIEWS
   </a>
  </code>
  . This prevents other applications
from freely accessing your app widget's data. For example, when creating an App
Widget that uses
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  to populate a
collection view, the manifest entry may look like this:
 </p>
 <pre>&lt;service android:name="MyWidgetService"
...
android:permission="android.permission.BIND_REMOTEVIEWS" /&gt;</pre>
 <p>
  The line
  <code>
   android:name="MyWidgetService"
  </code>
  refers to your subclass of
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  .
 </p>
 <h4>
  Layout for app widgets with collections
 </h4>
 <p>
  The main requirement for your app widget layout XML file is that it
include one of the collection views:
  <code>
   <a href="/reference/android/widget/ListView.html">
    ListView
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/widget/GridView.html">
    GridView
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/widget/StackView.html">
    StackView
   </a>
  </code>
  , or
  <code>
   <a href="/reference/android/widget/AdapterViewFlipper.html">
    AdapterViewFlipper
   </a>
  </code>
  . Here is the
  <code>
   widget_layout.xml
  </code>
  for
the
  <a href="/resources/samples/StackWidget/index.html">
   StackView
Widget sample
  </a>
  :
 </p>
 <pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;

&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
&nbsp; &nbsp; android:layout_width="match_parent"
&nbsp; &nbsp; android:layout_height="match_parent"&gt;
&nbsp; &nbsp; &lt;StackView xmlns:android="http://schemas.android.com/apk/res/android"
&nbsp; &nbsp; &nbsp; &nbsp; android:id="@+id/stack_view"
&nbsp; &nbsp; &nbsp; &nbsp; android:layout_width="match_parent"
&nbsp; &nbsp; &nbsp; &nbsp; android:layout_height="match_parent"
&nbsp; &nbsp; &nbsp; &nbsp; android:gravity="center"
&nbsp; &nbsp; &nbsp; &nbsp; android:loopViews="true" /&gt;
&nbsp; &nbsp; &lt;TextView xmlns:android="http://schemas.android.com/apk/res/android"
&nbsp; &nbsp; &nbsp; &nbsp; android:id="@+id/empty_view"
&nbsp; &nbsp; &nbsp; &nbsp; android:layout_width="match_parent"
&nbsp; &nbsp; &nbsp; &nbsp; android:layout_height="match_parent"
&nbsp; &nbsp; &nbsp; &nbsp; android:gravity="center"
&nbsp; &nbsp; &nbsp; &nbsp; android:background="@drawable/widget_item_background"
&nbsp; &nbsp; &nbsp; &nbsp; android:textColor="#ffffff"
&nbsp; &nbsp; &nbsp; &nbsp; android:textStyle="bold"
&nbsp; &nbsp; &nbsp; &nbsp; android:text="@string/empty_view_text"
&nbsp; &nbsp; &nbsp; &nbsp; android:textSize="20sp" /&gt;
&lt;/FrameLayout&gt;</pre>
 <p>
  Note that empty views must be siblings of the collection view for which the
empty view represents empty state.
 </p>
 <p>
  In addition to the layout file for your entire app widget, you must create
another layout file that defines the layout for each item in the collection (for
example, a layout for each book in a collection of books). For example, the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  only has one layout file,
  <code>
   widget_item.xml
  </code>
  , since all
items use the same layout. But the
  <a href="/resources/samples/WeatherListWidget/index.html">
   WeatherListWidget sample
  </a>
  has two layout files:
  <code>
   dark_widget_item.xml
  </code>
  and
  <code>
   light_widget_item.xml
  </code>
  .
 </p>
 <h4 id="AppWidgetProvider-collections">
  AppWidgetProvider class for app widgets with collections
 </h4>
 <p>
  As with a regular app widget, the bulk of your code in your
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  subclass typically goes in
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  . The major difference in
your implementation for
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  when creating an app
widget with collections is that you must call
  <code>
   <a href="/reference/android/widget/RemoteViews.html#setRemoteAdapter(int, android.content.Intent)">
    setRemoteAdapter()
   </a>
  </code>
  . This tells the
collection view where to get its data. The
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  can then return your implementation of
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  , and
the widget can serve up the appropriate data. When you call this method, you
must pass an intent that  points to your implementation of
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  and the app widget ID that specifies the app
widget to update.
 </p>
 <p>
  For example, here's how the StackView Widget sample implements the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onUpdate(android.content.Context, android.appwidget.AppWidgetManager, int[])">
    onUpdate()
   </a>
  </code>
  callback method to set
the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  as the remote adapter for the app widget
collection:
 </p>
 <pre>public void onUpdate(Context context, AppWidgetManager appWidgetManager,
int[] appWidgetIds) {
    // update each of the app widgets with the remote adapter
    for (int i = 0; i &lt; appWidgetIds.length; ++i) {
        
        // Set up the intent that starts the StackViewService, which will
        // provide the views for this collection.
        Intent intent = new Intent(context, StackWidgetService.class);
        // Add the app widget ID to the intent extras.
        intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetIds[i]);
        intent.setData(Uri.parse(intent.toUri(Intent.URI_INTENT_SCHEME)));
        // Instantiate the RemoteViews object for the app widget layout.
        RemoteViews rv = new RemoteViews(context.getPackageName(), R.layout.widget_layout);
        // Set up the RemoteViews object to use a RemoteViews adapter. 
        // This adapter connects
        // to a RemoteViewsService  through the specified intent.
        // This is how you populate the data.
        rv.setRemoteAdapter(appWidgetIds[i], R.id.stack_view, intent);
        
        // The empty view is displayed when the collection has no items. 
        // It should be in the same layout used to instantiate the RemoteViews
        // object above.
        rv.setEmptyView(R.id.stack_view, R.id.empty_view);

        //
        // Do additional processing specific to this app widget...
        //
        
        appWidgetManager.updateAppWidget(appWidgetIds[i], rv);   
    }
    super.onUpdate(context, appWidgetManager, appWidgetIds);
}</pre>
 <h4>
  RemoteViewsService class
 </h4>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h3>
    Persisting data
   </h3>
   <p>
    You can&rsquo;t rely on a single instance of your service, or any data it
contains, to persist. You should therefore not store any data in your
    <code>
     <a href="/reference/android/widget/RemoteViewsService.html">
      RemoteViewsService
     </a>
    </code>
    (unless it is static). If you want your
app widget&rsquo;s data to persist, the best approach is to use a
    <code>
     <a href="/reference/android/content/ContentProvider.html">
      ContentProvider
     </a>
    </code>
    whose data persists beyond the process
lifecycle.
   </p>
  </div>
 </div>
 <p>
  As described above, your
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  subclass
provides the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  used to  populate the remote collection view.
 </p>
 <p>
  Specifically, you need to
perform these steps:
 </p>
 <ol>
  <li>
   Subclass
   <code>
    <a href="/reference/android/widget/RemoteViewsService.html">
     RemoteViewsService
    </a>
   </code>
   .
   <code>
    <a href="/reference/android/widget/RemoteViewsService.html">
     RemoteViewsService
    </a>
   </code>
   is the service through which
a remote adapter can request
   <code>
    <a href="/reference/android/widget/RemoteViews.html">
     RemoteViews
    </a>
   </code>
   .
  </li>
  <li>
   In your
   <code>
    <a href="/reference/android/widget/RemoteViewsService.html">
     RemoteViewsService
    </a>
   </code>
   subclass, include a
class that implements the
   <code>
    <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
     RemoteViewsFactory
    </a>
   </code>
   interface.
   <code>
    <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
     RemoteViewsFactory
    </a>
   </code>
   is an interface for an adapter between a remote collection
view (such as
   <code>
    <a href="/reference/android/widget/ListView.html">
     ListView
    </a>
   </code>
   ,
   <code>
    <a href="/reference/android/widget/GridView.html">
     GridView
    </a>
   </code>
   ,
and so on) and  the underlying data for that view.  Your implementation is
responsible for making a
   <code>
    <a href="/reference/android/widget/RemoteViews.html">
     RemoteViews
    </a>
   </code>
   object  for each
item in the data set. This interface is a thin wrapper around
   <code>
    <a href="/reference/android/widget/Adapter.html">
     Adapter
    </a>
   </code>
   .
  </li>
 </ol>
 <p>
  The primary contents of the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.html">
    RemoteViewsService
   </a>
  </code>
  implementation is its
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  ,
described below.
 </p>
 <h4>
  RemoteViewsFactory interface
 </h4>
 <p>
  Your custom class that implements the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  interface provides the app widget with the data for the items in its collection.
To
do this, it combines your app widget item XML layout file with a source of data.
This source of data could be anything from a database to a simple array. In the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  , the data source is an array of
  <code>
   WidgetItems
  </code>
  . The
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  functions as an adapter to glue the data to the remote collection view.
 </p>
 <p>
  The two most important methods you need to implement for your
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  subclass are
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#onCreate()">
    onCreate()
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#getViewAt(int)">
    getViewAt()
   </a>
  </code>
  .
 </p>
 <p>
  The system calls
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#onCreate()">
    onCreate()
   </a>
  </code>
  when
creating your factory for the first time. This is where you set up any
connections and/or cursors to your data source. For example, the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  uses
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#onCreate()">
    onCreate()
   </a>
  </code>
  to
initialize an array of
  <code>
   WidgetItem
  </code>
  objects. When your app widget is
active, the system accesses these objects using their index position in the
array and the text they contain is displayed
 </p>
 <p>
  Here is an excerpt from the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
  </a>
  sample's
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  implementation that shows portions of the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#onCreate()">
    onCreate()
   </a>
  </code>
  method:
 </p>
 <pre>class StackRemoteViewsFactory implements
RemoteViewsService.RemoteViewsFactory {
&nbsp; &nbsp; private static final int mCount = 10;
&nbsp; &nbsp; private List&lt;WidgetItem&gt; mWidgetItems = new ArrayList&lt;WidgetItem&gt;();
&nbsp; &nbsp; private Context mContext;
&nbsp; &nbsp; private int mAppWidgetId;

&nbsp; &nbsp; public StackRemoteViewsFactory(Context context, Intent intent) {
&nbsp; &nbsp; &nbsp; &nbsp; mContext = context;
&nbsp; &nbsp; &nbsp; &nbsp; mAppWidgetId = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AppWidgetManager.INVALID_APPWIDGET_ID);
&nbsp; &nbsp; }

&nbsp; &nbsp; public void onCreate() {
&nbsp; &nbsp; &nbsp; &nbsp; // In onCreate() you setup any connections / cursors to your data source. Heavy lifting,
&nbsp; &nbsp; &nbsp; &nbsp; // for example downloading or creating content etc, should be deferred to onDataSetChanged()
&nbsp; &nbsp; &nbsp; &nbsp; // or getViewAt(). Taking more than 20 seconds in this call will result in an ANR.
&nbsp; &nbsp; &nbsp; &nbsp; for (int i = 0; i &lt; mCount; i++) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mWidgetItems.add(new WidgetItem(i + "!"));
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; ...
&nbsp; &nbsp; }
...</pre>
 <p>
  The
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  method
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#getViewAt(int)">
    getViewAt()
   </a>
  </code>
  returns a
  <code>
   <a href="/reference/android/widget/RemoteViews.html">
    RemoteViews
   </a>
  </code>
  object corresponding to the data at
the specified
  <code>
   position
  </code>
  in the data set. Here is an excerpt from 
the
  <a href="http://developer.android.com/resources/samples/StackWidget/index.html">
   StackView Widget
  </a>
  sample's
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  implementation:
 </p>
 <pre>public RemoteViews getViewAt(int position) {
   
    // Construct a remote views item based on the app widget item XML file, 
    // and set the text based on the position.
    RemoteViews rv = new RemoteViews(mContext.getPackageName(), R.layout.widget_item);
    rv.setTextViewText(R.id.widget_item, mWidgetItems.get(position).text);

    ...
    // Return the remote views object.
 &nbsp; &nbsp;return rv;
}</pre>
 <h4 id="behavior">
  Adding behavior to individual items
 </h4>
 <p>
  The above sections show you how to bind your data to your app widget
collection. But what if you want to add dynamic behavior to the individual items
in your collection view?
 </p>
 <p>
  As described in
  <a href="#AppWidgetProvider">
   Using the AppWidgetProvider
Class
  </a>
  , you  normally use
  <code>
   <a href="/reference/android/widget/RemoteViews.html#setOnClickPendingIntent(int, android.app.PendingIntent)">
    setOnClickPendingIntent()
   </a>
  </code>
  to set an object's click
behavior&mdash;such as to cause a button to launch an
  <code>
   <a href="/reference/android/app/Activity.html">
    Activity
   </a>
  </code>
  . But this approach is not allowed for child views in an
individual collection item (to clarify, you could use
  <code>
   <a href="/reference/android/widget/RemoteViews.html#setOnClickPendingIntent(int, android.app.PendingIntent)">
    setOnClickPendingIntent()
   </a>
  </code>
  to set up a global button
in the Gmail app widget that launches the app, for example, but not on the
individual list items). Instead, to add click behavior to individual items in a
collection, you  use
  <code>
   <a href="/reference/android/widget/RemoteViews.html#setOnClickFillInIntent(int, android.content.Intent)">
    setOnClickFillInIntent()
   </a>
  </code>
  . This entails setting up up a pending intent template
for your collection view, and then setting a fill-in intent on each item in the
collection via your
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  .
 </p>
 <p>
  This section uses the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  to describe how to add behavior to individual items. In the
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  , if the user touches the top view, the app widget displays the
  <code>
   <a href="/reference/android/widget/Toast.html">
    Toast
   </a>
  </code>
  message "Touched view
  <em>
   n
  </em>
  ," where
  <em>
   n
  </em>
  is the index (position) of the touched view. This is how it
works:
 </p>
 <ul>
  <li>
   The
   <code>
    StackWidgetProvider
   </code>
   (an
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html">
     AppWidgetProvider
    </a>
   </code>
   subclass) creates a pending intent that has
a custom action called
   <code>
    TOAST_ACTION
   </code>
   .
  </li>
  <li>
   When the user touches a view, the intent is fired and it broadcasts
   <code>
    TOAST_ACTION
   </code>
   .
  </li>
  <li>
   This broadcast is intercepted by the
   <code>
    StackWidgetProvider
   </code>
   's
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html#onReceive(android.content.Context, android.content.Intent)">
     onReceive()
    </a>
   </code>
   method, and the app widget displays the
   <code>
    <a href="/reference/android/widget/Toast.html">
     Toast
    </a>
   </code>
   message for the touched view. The data for the collection
items is provided by the
   <code>
    <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
     RemoteViewsFactory
    </a>
   </code>
   , via
the
   <code>
    <a href="/reference/android/widget/RemoteViewsService.html">
     RemoteViewsService
    </a>
   </code>
   .
  </li>
 </ul>
 <p class="note">
  <strong>
   Note:
  </strong>
  The
  <a href="/resources/samples/StackWidget/index.html">
   StackView Widget
sample
  </a>
  uses a broadcast, but typically an app widget would simply launch an
activity in a scenario like this one.
 </p>
 <h5>
  Setting up the pending intent template
 </h5>
 <p>
  The
  <code>
   StackWidgetProvider
  </code>
  (
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  subclass) sets up a pending intent.
Individuals items of a collection cannot set up their own pending intents.
Instead, the collection as a whole sets up a pending intent template, and the
individual items set a fill-in intent to create unique behavior on an
item-by-item
basis.
 </p>
 <p>
  This class  also receives the broadcast that is sent when the user touches a
view. It processes this event in its
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html#onReceive(android.content.Context, android.content.Intent)">
    onReceive()
   </a>
  </code>
  method. If the intent's action is
  <code>
   TOAST_ACTION
  </code>
  , the app widget displays a
  <code>
   <a href="/reference/android/widget/Toast.html">
    Toast
   </a>
  </code>
  message for the current view.
 </p>
 <pre>public class StackWidgetProvider extends AppWidgetProvider {
    public static final String TOAST_ACTION = "com.example.android.stackwidget.TOAST_ACTION";
&nbsp; &nbsp; public static final String EXTRA_ITEM = "com.example.android.stackwidget.EXTRA_ITEM";

&nbsp; &nbsp; ...

    // Called when the BroadcastReceiver receives an Intent broadcast.
    // Checks to see whether the intent's action is TOAST_ACTION. If it is, the app widget 
    // displays a Toast message for the current item.
    @Override
    public void onReceive(Context context, Intent intent) {
        AppWidgetManager mgr = AppWidgetManager.getInstance(context);
    &nbsp; &nbsp; if (intent.getAction().equals(TOAST_ACTION)) {
    &nbsp; &nbsp;     int appWidgetId = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,
    &nbsp; &nbsp; &nbsp; &nbsp;     AppWidgetManager.INVALID_APPWIDGET_ID);
    &nbsp; &nbsp; &nbsp; &nbsp; int viewIndex = intent.getIntExtra(EXTRA_ITEM, 0);
    &nbsp; &nbsp; &nbsp; &nbsp; Toast.makeText(context, "Touched view " + viewIndex, Toast.LENGTH_SHORT).show();
    &nbsp; &nbsp; }
    &nbsp; &nbsp; super.onReceive(context, intent);
    }
    
    @Override
    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {
        // update each of the app widgets with the remote adapter
    &nbsp; &nbsp; for (int i = 0; i &lt; appWidgetIds.length; ++i) {
    
    &nbsp; &nbsp;     // Sets up the intent that points to the StackViewService that will
    &nbsp; &nbsp;     // provide the views for this collection.
    &nbsp; &nbsp;     Intent intent = new Intent(context, StackWidgetService.class);
    &nbsp; &nbsp;     intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetIds[i]);
    &nbsp; &nbsp;     // When intents are compared, the extras are ignored, so we need to embed the extras
    &nbsp; &nbsp;     // into the data so that the extras will not be ignored.
    &nbsp; &nbsp;     intent.setData(Uri.parse(intent.toUri(Intent.URI_INTENT_SCHEME)));
    &nbsp; &nbsp;     RemoteViews rv = new RemoteViews(context.getPackageName(), R.layout.widget_layout);
    &nbsp; &nbsp;     rv.setRemoteAdapter(appWidgetIds[i], R.id.stack_view, intent);
    
    &nbsp; &nbsp;     // The empty view is displayed when the collection has no items. It should be a sibling
    &nbsp; &nbsp;     // of the collection view.
    &nbsp; &nbsp;     rv.setEmptyView(R.id.stack_view, R.id.empty_view);

    &nbsp; &nbsp;     // This section makes it possible for items to have individualized behavior.
    &nbsp; &nbsp;     // It does this by setting up a pending intent template. Individuals items of a collection
    &nbsp; &nbsp;     // cannot set up their own pending intents. Instead, the collection as a whole sets
    &nbsp; &nbsp;     // up a pending intent template, and the individual items set a fillInIntent
    &nbsp; &nbsp;     // to create unique behavior on an item-by-item basis.
    &nbsp; &nbsp;     Intent toastIntent = new Intent(context, StackWidgetProvider.class);
    &nbsp; &nbsp;     // Set the action for the intent.
    &nbsp; &nbsp;     // When the user touches a particular view, it will have the effect of
    &nbsp; &nbsp;     // broadcasting TOAST_ACTION.
    &nbsp; &nbsp;     toastIntent.setAction(StackWidgetProvider.TOAST_ACTION);
    &nbsp; &nbsp;     toastIntent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetIds[i]);
    &nbsp; &nbsp;     intent.setData(Uri.parse(intent.toUri(Intent.URI_INTENT_SCHEME)));
    &nbsp; &nbsp;     PendingIntent toastPendingIntent = PendingIntent.getBroadcast(context, 0, toastIntent,
    &nbsp; &nbsp;         PendingIntent.FLAG_UPDATE_CURRENT);
    &nbsp; &nbsp;     rv.setPendingIntentTemplate(R.id.stack_view, toastPendingIntent);
            
    &nbsp; &nbsp;     appWidgetManager.updateAppWidget(appWidgetIds[i], rv);
        }
    super.onUpdate(context, appWidgetManager, appWidgetIds);
    }
}</pre>
 <h5>
  <strong>
   Setting the fill-in Intent
  </strong>
 </h5>
 <p>
  Your
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  must set a fill-in intent on each item in the collection.
This makes it possible to distinguish the individual on-click action of a given
item. The fill-in intent is then combined with the
  <code>
   <a href="/reference/android/app/PendingIntent.html">
    PendingIntent
   </a>
  </code>
  template in order to determine the final intent that
will be executed when the item is clicked.
 </p>
 <pre>
public class StackWidgetService extends RemoteViewsService {
&nbsp; &nbsp; @Override
&nbsp; &nbsp; public RemoteViewsFactory onGetViewFactory(Intent intent) {
&nbsp; &nbsp; &nbsp; &nbsp; return new StackRemoteViewsFactory(this.getApplicationContext(), intent);
&nbsp; &nbsp; }
}

class StackRemoteViewsFactory implements RemoteViewsService.RemoteViewsFactory {
&nbsp; &nbsp; private static final int mCount = 10;
&nbsp; &nbsp; private List&lt;WidgetItem&gt; mWidgetItems = new ArrayList&lt;WidgetItem&gt;();
&nbsp; &nbsp; private Context mContext;
&nbsp; &nbsp; private int mAppWidgetId;

&nbsp; &nbsp; public StackRemoteViewsFactory(Context context, Intent intent) {
&nbsp; &nbsp; &nbsp; &nbsp; mContext = context;
&nbsp; &nbsp; &nbsp; &nbsp; mAppWidgetId = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AppWidgetManager.INVALID_APPWIDGET_ID);
&nbsp; &nbsp; }

    // Initialize the data set.
    &nbsp; &nbsp; public void onCreate() {
    &nbsp; &nbsp; &nbsp; &nbsp; // In onCreate() you set up any connections / cursors to your data source. Heavy lifting,
    &nbsp; &nbsp; &nbsp; &nbsp; // for example downloading or creating content etc, should be deferred to onDataSetChanged()
    &nbsp; &nbsp; &nbsp; &nbsp; // or getViewAt(). Taking more than 20 seconds in this call will result in an ANR.
    &nbsp; &nbsp; &nbsp; &nbsp; for (int i = 0; i &lt; mCount; i++) {
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mWidgetItems.add(new WidgetItem(i + "!"));
    &nbsp; &nbsp; &nbsp; &nbsp; }
    &nbsp; &nbsp; &nbsp; &nbsp;...
    &nbsp; &nbsp; }
    &nbsp; &nbsp; ...
    
        // Given the position (index) of a WidgetItem in the array, use the item's text value in 
        // combination with the app widget item XML file to construct a RemoteViews object.
    &nbsp; &nbsp; public RemoteViews getViewAt(int position) {
    &nbsp; &nbsp; &nbsp; &nbsp; // position will always range from 0 to getCount() - 1.
    
    &nbsp; &nbsp; &nbsp; &nbsp; // Construct a RemoteViews item based on the app widget item XML file, and set the
    &nbsp; &nbsp; &nbsp; &nbsp; // text based on the position.
    &nbsp; &nbsp; &nbsp; &nbsp; RemoteViews rv = new RemoteViews(mContext.getPackageName(), R.layout.widget_item);
    &nbsp; &nbsp; &nbsp; &nbsp; rv.setTextViewText(R.id.widget_item, mWidgetItems.get(position).text);
    
    &nbsp; &nbsp; &nbsp; &nbsp; // Next, set a fill-intent, which will be used to fill in the pending intent template
    &nbsp; &nbsp; &nbsp; &nbsp; // that is set on the collection view in StackWidgetProvider.
    &nbsp; &nbsp; &nbsp; &nbsp; Bundle extras = new Bundle();
    &nbsp; &nbsp; &nbsp; &nbsp; extras.putInt(StackWidgetProvider.EXTRA_ITEM, position);
    &nbsp; &nbsp; &nbsp; &nbsp; Intent fillInIntent = new Intent();
    &nbsp; &nbsp; &nbsp; &nbsp; fillInIntent.putExtras(extras);
            // Make it possible to distinguish the individual on-click
            // action of a given item
        &nbsp; &nbsp; rv.setOnClickFillInIntent(R.id.widget_item, fillInIntent);
        
        &nbsp; &nbsp; ...
        
        &nbsp; &nbsp; // Return the RemoteViews object.
        &nbsp; &nbsp; return rv;
        }
    ...
    }</pre>
 <h3 id="fresh">
  Keeping Collection Data Fresh
 </h3>
 <p>
  The following figure illustrates the flow that occurs in an app widget that
uses
collections when updates occur. It shows how the app widget code interacts with
the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  , and how you can trigger updates:
 </p>
 <img alt="" src="http://developer.android.com/images/appwidgets/appwidget_collections.png"/>
 <p>
  One feature of app widgets that use collections is the ability to provide
users with up-to-date content. For example, consider the Android 3.0 Gmail
app widget, which provides users with a snapshot of their inbox. To make this
possible, you need to be able to trigger your
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  and
collection view to fetch and display new data. You achieve this with the
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html">
    AppWidgetManager
   </a>
  </code>
  call
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#notifyAppWidgetViewDataChanged(int, int)">
    notifyAppWidgetViewDataChanged()
   </a>
  </code>
  . This call results in a callback to your
  <code>
   RemoteViewsFactory
  </code>
  &rsquo;s
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#onDataSetChanged()">
    onDataSetChanged()
   </a>
  </code>
  method, which gives you the opportunity to fetch any new
data. Note that you can perform
processing-intensive operations synchronously within the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#onDataSetChanged()">
    onDataSetChanged()
   </a>
  </code>
  callback. You are guaranteed that this call will be
completed before the metadata or view data is fetched from the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html">
    RemoteViewsFactory
   </a>
  </code>
  . In
addition, you can perform processing-intensive operations within the
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#getViewAt(int)">
    getViewAt()
   </a>
  </code>
  method. If this call takes a long time, the loading view (specified by the
  <code>
   RemoteViewsFactory
  </code>
  &rsquo;s
  <code>
   <a href="/reference/android/widget/RemoteViewsService.RemoteViewsFactory.html#getLoadingView()">
    getLoadingView()
   </a>
  </code>
  method)
will be displayed in the corresponding position of the collection view until it
returns.
 </p>
</div>
<h1>App Widget Host</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#host-binding">
      Binding App Widgets
     </a>
     <ol>
      <li>
       <a href="#binding-pre">
        Binding app widgets on Android 4.0 and lower
       </a>
      </li>
      <li>
       <a href="#binding-41">
        Binding app widgets on Android 4.1 and higher
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#host-state">
      Host Responsibilities
     </a>
     <ol>
      <li>
       <a href="#30">
        Android 3.0
       </a>
      </li>
      <li>
       <a href="#31">
        Android 3.1
       </a>
      </li>
      <li>
       <a href="#40">
        Android 4.0
       </a>
      </li>
      <li>
       <a href="#41">
        Android 4.1
       </a>
      </li>
      <li>
       <a href="#42">
        Android 4.2
       </a>
      </li>
     </ol>
    </li>
   </ol>
  </div>
 </div>
 <p>
  The Android Home screen available on most Android devices allows the user
to embed
  <a href="/guide/topics/appwidgets/index.html">
   app widgets
  </a>
  for quick
access to content. If you're building a Home replacement or a similar app,
you can also allow the user to embed app widgets by implementing an
  <code>
   <a href="/reference/android/appwidget/AppWidgetHost.html">
    AppWidgetHost
   </a>
  </code>
  .
This is not something that most apps will ever need to do, but if you are 
creating your own host, it's important to understand the contractual obligations 
a host implicitly agrees to.
 </p>
 <p>
  This document focuses on the responsibilities involved in implementing a custom
  <code>
   <a href="/reference/android/appwidget/AppWidgetHost.html">
    AppWidgetHost
   </a>
  </code>
  . For an example of how to implement an
  <code>
   <a href="/reference/android/appwidget/AppWidgetHost.html">
    AppWidgetHost
   </a>
  </code>
  , see the source code for the
Android Home screen
  <a href="https://android.googlesource.com/platform/packages/apps/Launcher2/+/master/src/com/android/launcher2/Launcher.java">
   Launcher
  </a>
  .
 </p>
 <p>
  Here is an overview of key classes and concepts involved in implementing a custom
  <code>
   <a href="/reference/android/appwidget/AppWidgetHost.html">
    AppWidgetHost
   </a>
  </code>
  :
 </p>
 <ul>
  <li>
   <strong>
    App Widget Host
   </strong>
   &mdash;  
    The
   <code>
    <a href="/reference/android/appwidget/AppWidgetHost.html">
     AppWidgetHost
    </a>
   </code>
   provides the interaction 
with the AppWidget service for apps, like the home screen, that want to embed 
app widgets in their UI. An
   <code>
    <a href="/reference/android/appwidget/AppWidgetHost.html">
     AppWidgetHost
    </a>
   </code>
   must have 
an ID that is unique within the host's own package. This ID remains persistent 
across all uses of the host. The ID is typically a hard-coded value that you assign
in your application.
  </li>
  <li>
   <strong>
    App Widget ID
   </strong>
   &mdash;
    Each app widget instance is assigned a unique ID at the time of binding 
(see
   <code>
    <a href="/reference/android/appwidget/AppWidgetManager.html#bindAppWidgetIdIfAllowed(int, android.content.ComponentName)">
     bindAppWidgetIdIfAllowed()
    </a>
   </code>
   , 
discussed in more detail in
   <a href="#binding">
    Binding app widgets
   </a>
   ). 
The unique ID is obtained by the host using
   <code>
    <a href="/reference/android/appwidget/AppWidgetHost.html#allocateAppWidgetId()">
     allocateAppWidgetId()
    </a>
   </code>
   . This ID is persistent across the lifetime of the widget, 
that is, until it is deleted from the host. Any host-specific state (such as the 
size and location of the widget) should be persisted by the hosting package and 
associated with the app widget ID.
  </li>
  <li>
   <strong>
    App Widget Host View
   </strong>
   &mdash;
   <code>
    <a href="/reference/android/appwidget/AppWidgetHostView.html">
     AppWidgetHostView
    </a>
   </code>
   can be thought of as a frame 
that the widget is wrapped in whenever it needs to be displayed. An app widget 
is assigned to an
   <code>
    <a href="/reference/android/appwidget/AppWidgetHostView.html">
     AppWidgetHostView
    </a>
   </code>
   every time the 
widget is inflated by the host.
  </li>
  <li>
   <strong>
    Options Bundle
   </strong>
   &mdash;
The
   <code>
    <a href="/reference/android/appwidget/AppWidgetHost.html">
     AppWidgetHost
    </a>
   </code>
   uses the options bundle to communicate 
information to the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html">
     AppWidgetProvider
    </a>
   </code>
   about how the 
widget is being displayed (for example, size range, and whether the widget is on 
a lockscreen or the home screen). This information allows the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html">
     AppWidgetProvider
    </a>
   </code>
   to tailor the widget's contents 
and appearance based on how and where it is  displayed.
You use
   <code>
    <a href="/reference/android/appwidget/AppWidgetHostView.html#updateAppWidgetOptions(android.os.Bundle)">
     updateAppWidgetOptions()
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/appwidget/AppWidgetHostView.html#updateAppWidgetSize(android.os.Bundle, int, int, int, int)">
     updateAppWidgetSize()
    </a>
   </code>
   to modify an app widget's 
bundle. Both of these methods trigger a callback to the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProvider.html">
     AppWidgetProvider
    </a>
   </code>
   .
  </li>
 </ul>
 <h2 id="host-binding">
  Binding App Widgets
 </h2>
 <p>
  When a user adds an app widget to a host, a process called
  <em>
   binding
  </em>
  occurs.
  <em>
   Binding
  </em>
  refers to associating
a particular app widget ID to a specific host and to a specific
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  . There are different
ways of achieving this, depending on what version of Android your
app is running on.
 </p>
 <h3 id="binding-pre">
  Binding app widgets on Android 4.0 and lower
 </h3>
 <p>
  On devices running Android version 4.0 and lower, users add app widgets 
via a system activity that allows users to select a widget. This implicitly 
does a permission check&mdash;that is, by adding the app widget, the user is 
implicitly granting permission to your app to add app widgets to the host. 
Here is an example that illustrates 
this approach, taken from the original
  <a href="https://android.googlesource.com/platform/packages/apps/Launcher/+/master/src/com/android/launcher/Launcher.java">
   Launcher
  </a>
  . In this snippet, an event handler invokes
  <code>
   <a href="/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">
    startActivityForResult()
   </a>
  </code>
  with the request code
  <code>
   REQUEST_PICK_APPWIDGET
  </code>
  in response to a 
user action:
 </p>
 <pre>
private static final int REQUEST_CREATE_APPWIDGET = 5;
private static final int REQUEST_PICK_APPWIDGET = 9;
...
public void onClick(DialogInterface dialog, int which) {
    switch (which) {
    ...
        case AddAdapter.ITEM_APPWIDGET: {
            ...
            int appWidgetId = 
                    Launcher.this.mAppWidgetHost.allocateAppWidgetId();
            Intent pickIntent = 
                    new Intent(AppWidgetManager.ACTION_APPWIDGET_PICK);
            pickIntent.putExtra
                    (AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId);
            ...
            startActivityForResult(pickIntent, REQUEST_PICK_APPWIDGET);
            break;
    }
    ...
}</pre>
 <p>
  When the system activity finishes, it returns a result with the user's chosen
app widget to your activity. In the following example, the activity responds
by calling
  <code>
   addAppWidget()
  </code>
  to add the app widget:
 </p>
 <pre>public final class Launcher extends Activity 
        implements View.OnClickListener, OnLongClickListener {
    ...
    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
        mWaitingForResult = false;

        if (resultCode == RESULT_OK &amp;&amp; mAddItemCellInfo != null) {
            switch (requestCode) {
                ...
                case REQUEST_PICK_APPWIDGET:
                    addAppWidget(data);
                    break;
                case REQUEST_CREATE_APPWIDGET:
                    completeAddAppWidget(data, mAddItemCellInfo, !mDesktopLocked);
                    break;
                }
        } 
        ...
    }
}</pre>
 <p>
  The method
  <code>
   addAppWidget()
  </code>
  checks to see if the app widget
needs to be configured before it's added:
 </p>
 <pre>void addAppWidget(Intent data) {
    int appWidgetId = data.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, -1);

    String customWidget = data.getStringExtra(EXTRA_CUSTOM_WIDGET);
    AppWidgetProviderInfo appWidget = 
            mAppWidgetManager.getAppWidgetInfo(appWidgetId);

    if (appWidget.configure != null) {
        // Launch over to configure widget, if needed.
        Intent intent = new Intent(AppWidgetManager.ACTION_APPWIDGET_CONFIGURE);
        intent.setComponent(appWidget.configure);
        intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId);
        startActivityForResult(intent, REQUEST_CREATE_APPWIDGET);
    } else {
        // Otherwise, finish adding the widget.
    }
}</pre>
 <p>
  For more discussion of configuration,
see
  <a href="/guide/topics/appwidgets/index.html#Configuring">
   Creating an
App Widget Configuration Activity
  </a>
  .
 </p>
 <p>
  Once the app widget is ready, the next step is to do the
actual work of adding it to the workspace. The
  <a href="https://android.googlesource.com/platform/packages/apps/Launcher/+/master/src/com/android/launcher/Launcher.java">
   original Launcher
  </a>
  uses a method called
  <code>
   completeAddAppWidget()
  </code>
  to do this.
 </p>
 <h3 id="binding-41">
  Binding app widgets on Android 4.1 and higher
 </h3>
 <p>
  Android 4.1 adds APIs for a more streamlined binding process.
These APIs also make it possible for a host to provide a custom UI for
binding. To use this improved process, your app must declare the
  <code>
   <a href="/reference/android/Manifest.permission.html#BIND_APPWIDGET">
    BIND_APPWIDGET
   </a>
  </code>
  permission in its manifest:
 </p>
 <pre>&lt;uses-permission android:name="android.permission.BIND_APPWIDGET" /&gt;
</pre>
 <p>
  But this is just the first step. At runtime the user must
explicitly grant permission to your app to allow it to add app widgets
to the host. To test whether your app has permission to add the widget,
you use the
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#bindAppWidgetIdIfAllowed(int, android.content.ComponentName)">
    bindAppWidgetIdIfAllowed()
   </a>
  </code>
  method. 
If
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#bindAppWidgetIdIfAllowed(int, android.content.ComponentName)">
    bindAppWidgetIdIfAllowed()
   </a>
  </code>
  returns
  <code>
   false
  </code>
  , your app must display a dialog prompting the
user to grant permission 
("allow" or "always allow," to cover all future app widget additions).
This snippet gives an example of how to display the dialog:
 </p>
 <pre>Intent intent = new Intent(AppWidgetManager.ACTION_APPWIDGET_BIND);
intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId);
intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_PROVIDER, info.componentName);
// This is the options bundle discussed above
intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_OPTIONS, options);
startActivityForResult(intent, REQUEST_BIND_APPWIDGET);
</pre>
 <p>
  The host also has to check whether the user added 
an app widget that needs configuration. For more discussion of this topic,
see
  <a href="/guide/topics/appwidgets/index.html#Configuring">
   Creating
an App Widget Configuration Activity
  </a>
  .
 </p>
 <h2 id="host-state">
  Host Responsibilities
 </h2>
 <div class="sidebox-wrapper">
  <div class="sidebox">
   <h2>
    What Version are You Targeting?
   </h2>
   <p>
    The approach you use in implementing your host should depend on what Android version  
you're targeting. Many of the features described in this section were introduced 
in 3.0 or later. For example:
   </p>
   <ul>
    <li>
     Android 3.0 (API Level 11) introduces auto-advance behavior for widgets.
    </li>
    <li>
     Android 3.1 (API Level 12) introduces the ability to resize widgets.
    </li>
    <li>
     Android 4.0 (API Level 15) introduces a change in padding policy that
puts the responsibility on the 
host to manage padding.
    </li>
    <li>
     Android 4.1 (API Level 16) adds an API that allows the widget provider
to get more detailed information about the environment in which its
widget instances are being hosted.
    </li>
    <li>
     Android 4.2 (API Level 17) introduces the options bundle and the
     <code>
      <a href="/reference/android/appwidget/AppWidgetManager.html#bindAppWidgetIdIfAllowed(int, android.content.ComponentName, android.os.Bundle)">
       bindAppWidgetIdIfAllowed()
      </a>
     </code>
     method. It also introduces lockscreen widgets.
    </li>
   </ul>
   <p>
    If you are targeting earlier devices, refer to the original
    <a href="https://android.googlesource.com/platform/packages/apps/Launcher/+/master/src/com/android/launcher/Launcher.java">
     Launcher
    </a>
    as an example.
   </p>
  </div>
 </div>
 <p>
  Widget developers can specify a number of configuration settings
for widgets using the
  <a href="/guide/topics/appwidgets/index.html#MetaData">
   AppWidgetProviderInfo metadata
  </a>
  .
These configuration options, discussed in more detail below, can be
retrieved by the host from the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
    AppWidgetProviderInfo
   </a>
  </code>
  object associated with a widget provider.
 </p>
 <p>
  Regardless of the version of Android you are targeting, all hosts
have the following responsibilities:
 </p>
 <ul>
  <li>
   When adding a widget, you must allocate the widget ID as described above.
You must also make sure that when a widget is removed from the host, you call
   <code>
    <a href="/reference/android/appwidget/AppWidgetHost.html#deleteAppWidgetId(int)">
     deleteAppWidgetId()
    </a>
   </code>
   to deallocate the widget ID.
  </li>
  <li>
   When adding a widget, be sure to launch its configuration activity
if it exists, as described in
   <a href="/guide/topics/appwidgets/index.html#UpdatingFromTheConfiguration">
    Updating the App Widget
from the Configuration Activity
   </a>
   . This is a necessary step for many app widgets before
they can be properly displayed.
  </li>
  <li>
   Every app widget specifies a minimum width and height in dps, as defined in the
   <code>
    <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
     AppWidgetProviderInfo
    </a>
   </code>
   metadata
(using
   <code>
    <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#minWidth">
     android:minWidth
    </a>
   </code>
   and
   <code>
    <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#minHeight">
     android:minHeight
    </a>
   </code>
   ).
Make sure that the widget is laid out with at least this many dps.
For example, many hosts align icons and widgets in a grid. In this scenario,
by default the host should add the app widget using the minimum number of
cells that satisfy the
   <code>
    minWidth
   </code>
   and
   <code>
    minHeight
   </code>
   constraints.
  </li>
 </ul>
 <p>
  In addition to the requirements listed above, specific platform
versions introduce features that place new responsibilities on the
host. These are described in the following sections.
 </p>
 <h3 id="30">
  Android 3.0
 </h3>
 <p>
  Android 3.0 (API Level 11) introduces the ability for a widget to specify
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#autoAdvanceViewId">
    autoAdvanceViewId()
   </a>
  </code>
  .
This view ID should point to an instance of an
  <code>
   <a href="/reference/android/widget/Advanceable.html">
    Advanceable
   </a>
  </code>
  , such as
  <code>
   <a href="/reference/android/widget/StackView.html">
    StackView
   </a>
  </code>
  or
  <code>
   <a href="/reference/android/widget/AdapterViewFlipper.html">
    AdapterViewFlipper
   </a>
  </code>
  . This indicates that the host
should call
  <code>
   <a href="/reference/android/widget/Advanceable.html#advance()">
    advance()
   </a>
  </code>
  on this
view at an interval deemed appropriate by the host (taking into account whether
it makes sense to advance the widget&mdash;for example, the host probably
wouldn't want to advance a widget if it were on another page, or
if the screen were turned off).
 </p>
 <h3 id="31">
  Android 3.1
 </h3>
 <p>
  Android 3.1 (API Level 12) introduces the ability to resize widgets.
A widget can specify that it is resizable using the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#resizeMode">
    android:resizeMode
   </a>
  </code>
  attribute in the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
    AppWidgetProviderInfo
   </a>
  </code>
  metadata, and indicate whether it supports horizontal and/or
vertical resizing. Introduced in Android 4.0 (API Level 14), the widget can also specify a
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#minResizeWidth">
    android:minResizeWidth
   </a>
  </code>
  and/or
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#minResizeHeight">
    android:minResizeHeight
   </a>
  </code>
  .
 </p>
 <p>
  It is the host&rsquo;s responsibility to make it possible for the
widget to be resized horizontally and/or vertically, as specified
by the widget. A widget that specifies that it is resizable can be
resized arbitrarily large, but should not be resized smaller than
the values specified by
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#minResizeWidth">
    android:minResizeWidth
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#minResizeHeight">
    android:minResizeHeight
   </a>
  </code>
  .
For a sample implementation, see
  <a href="https://android.googlesource.com/platform/packages/apps/Launcher2/+/master/src/com/android/launcher2/AppWidgetResizeFrame.java">
   <code>
    AppWidgetResizeFrame
   </code>
  </a>
  in
  <code>
   Launcher2
  </code>
  .
 </p>
 <h3 id="40">
  Android 4.0
 </h3>
 <p>
  Android 4.0 (API Level 15) introduces a change in padding policy that
puts the responsibility on the host to manage padding. As of 4.0, app
widgets no longer include their own padding. Instead, the system adds
padding for each widget, based the characteristics of the current screen.
This leads to a more uniform, consistent presentation of widgets in a grid.
To assist applications that host app widgets, the platform provides
the method
  <code>
   <a href="/reference/android/appwidget/AppWidgetHostView.html#getDefaultPaddingForWidget(android.content.Context, android.content.ComponentName, android.graphics.Rect)">
    getDefaultPaddingForWidget()
   </a>
  </code>
  .
Applications can call this method to get the system-defined padding
and account for it when computing the number of cells to allocate to the widget.
 </p>
 <h3 id="41">
  Android 4.1
 </h3>
 <p>
  Android 4.1 (API Level 16) adds an API that allows the widget provider
to get more detailed information  about the environment in which its
widget instances are being hosted. Specifically, the host hints to the
widget provider about the size at which the widget is being displayed.
It is the host&rsquo;s responsibility to provide this size information.
 </p>
 <p>
  The host provides this information via
  <code>
   <a href="/reference/android/appwidget/AppWidgetHostView.html#updateAppWidgetSize(android.os.Bundle, int, int, int, int)">
    updateAppWidgetSize()
   </a>
  </code>
  .
The size is specified as a minimum and maximum width/height in dps.
The reason that a range is specified (as opposed to a fixed size)
is because the width and height of a widget may change with orientation.
You don&rsquo;t want the host to have to update all of its widgets on rotation,
as this could cause serious system slowdown. These values should be
updated once upon the widget being placed, any time the widget is resized,
and any time the launcher inflates the widget for the first time in a
given boot (as the values aren&rsquo;t persisted across boot).
 </p>
 <h3 id="42">
  Android 4.2
 </h3>
 <p>
  Android 4.2 (API Level 17) adds the ability for the options bundle
to be specified at bind time. This is the ideal way to specify app
widget options, including size, as it gives the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  immediate access to the options
data on the first update. This can be achieved by using the method
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#bindAppWidgetIdIfAllowed(int, android.content.ComponentName, android.os.Bundle)">
    bindAppWidgetIdIfAllowed()
   </a>
  </code>
  . For more discussion of this topic,
see
  <a href="#host-binding">
   Binding app widgets
  </a>
  .
 </p>
 <p>
  Android 4.2 also introduces lockscreen widgets. When hosting widgets
on the lockscreen, the host must specify this information within the app
widget options bundle (the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProvider.html">
    AppWidgetProvider
   </a>
  </code>
  can use this information to style
the widget appropriately). To designate a widget as a lockscreen widget, use
  <code>
   <a href="/reference/android/appwidget/AppWidgetHostView.html#updateAppWidgetOptions(android.os.Bundle)">
    updateAppWidgetOptions()
   </a>
  </code>
  and include the field
  <code>
   <a href="/reference/android/appwidget/AppWidgetManager.html#OPTION_APPWIDGET_HOST_CATEGORY">
    OPTION_APPWIDGET_HOST_CATEGORY
   </a>
  </code>
  with the value
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#WIDGET_CATEGORY_KEYGUARD">
    WIDGET_CATEGORY_KEYGUARD
   </a>
  </code>
  .
This option defaults to
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#WIDGET_CATEGORY_HOME_SCREEN">
    WIDGET_CATEGORY_HOME_SCREEN
   </a>
  </code>
  ,
so it is not explicitly required to set this for a home screen host.
 </p>
 <p>
  Make sure that your host adds only app widgets that are appropriate
for your app&mdash;for example, if your host is a home screen, ensure
that the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#widgetCategory">
    android:widgetCategory
   </a>
  </code>
  attribute in the
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html">
    AppWidgetProviderInfo
   </a>
  </code>
  metadata includes
the flag
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#WIDGET_CATEGORY_HOME_SCREEN">
    WIDGET_CATEGORY_HOME_SCREEN
   </a>
  </code>
  .
Similarly, for the lockscreen, ensure that field includes the flag
  <code>
   <a href="/reference/android/appwidget/AppWidgetProviderInfo.html#WIDGET_CATEGORY_KEYGUARD">
    WIDGET_CATEGORY_KEYGUARD
   </a>
  </code>
  . For more
discussion of this topic, see
  <a href="/guide/topics/appwidgets/index.html#lockscreen">
   Enabling App Widgets on the Lockscreen
  </a>
  .
 </p>
</div>
<h1>Processes and Threads</h1>
<div class="jd-descr" itemprop="articleBody">
 <div id="qv-wrapper">
  <div id="qv">
   <h2>
    In this document
   </h2>
   <ol>
    <li>
     <a href="#Processes">
      Processes
     </a>
     <ol>
      <li>
       <a href="#Lifecycle">
        Process lifecycle
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#Threads">
      Threads
     </a>
     <ol>
      <li>
       <a href="#WorkerThreads">
        Worker threads
       </a>
      </li>
      <li>
       <a href="#ThreadSafe">
        Thread-safe methods
       </a>
      </li>
     </ol>
    </li>
    <li>
     <a href="#IPC">
      Interprocess Communication
     </a>
    </li>
   </ol>
  </div>
 </div>
 <p>
  When an application component starts and the application does not have any other components
running, the Android system starts a new Linux process for the application with a single thread of
execution. By default, all components of the same application run in the same process and thread
(called the "main" thread). If an application component starts and there already exists a process
for that application (because another component from the application exists), then the component is
started within that process and uses the same thread of execution. However, you can arrange for
different components in your application to run in separate processes, and you can create additional
threads for any process.
 </p>
 <p>
  This document discusses how processes and threads work in an Android application.
 </p>
 <h2 id="Processes">
  Processes
 </h2>
 <p>
  By default, all components of the same application run in the same process and most applications
should not change this. However, if you find that you need to control which process a certain
component belongs to, you can do so in the manifest file.
 </p>
 <p>
  The manifest entry for each type of component element&mdash;
  <a href="/guide/topics/manifest/activity-element.html">
   <code>
    &lt;activity&gt;
   </code>
  </a>
  ,
  <a href="/guide/topics/manifest/service-element.html">
   <code>
    &lt;service&gt;
   </code>
  </a>
  ,
  <a href="/guide/topics/manifest/receiver-element.html">
   <code>
    &lt;receiver&gt;
   </code>
  </a>
  , and
  <a href="/guide/topics/manifest/provider-element.html">
   <code>
    &lt;provider&gt;
   </code>
  </a>
  &mdash;supports an
  <code>
   android:process
  </code>
  attribute that can specify a
process in which that component should run. You can set this attribute so that each component runs
in its own process or so that some components share a process while others do not.  You can also set
  <code>
   android:process
  </code>
  so that components of different applications run in the same
process&mdash;provided that the applications share the same Linux user ID and are signed with the
same certificates.
 </p>
 <p>
  The
  <a href="/guide/topics/manifest/application-element.html">
   <code>
    &lt;application&gt;
   </code>
  </a>
  element also supports an
  <code>
   android:process
  </code>
  attribute, to set a
default value that applies to all components.
 </p>
 <p>
  Android might decide to shut down a process at some point, when memory is low and required by
other processes that are more immediately serving the user. Application
components running in the process that's killed are consequently destroyed.  A process is started
again for those components when there's again work for them to do.
 </p>
 <p>
  When deciding which processes to kill, the Android system weighs their relative importance to
the user.  For example, it more readily shuts down a process hosting activities that are no longer
visible on screen, compared to a process hosting visible activities. The decision whether to
terminate a process, therefore, depends on the state of the components running in that process. The
rules used to decide which processes to terminate is discussed below.
 </p>
 <h3 id="Lifecycle">
  Process lifecycle
 </h3>
 <p>
  The Android system tries to maintain an application process for as long as possible, but
eventually needs to remove old processes to reclaim memory for new or more important processes.  To
determine which processes to keep
and which to kill, the system places each process into an "importance hierarchy" based on the
components running in the process and the state of those components.  Processes with the lowest
importance are eliminated first, then those with the next lowest importance, and so on, as necessary
to recover system resources.
 </p>
 <p>
  There are five levels in the importance hierarchy. The following list presents the different
types of processes in order of importance (the first process is
  <em>
   most important
  </em>
  and is
  <em>
   killed last
  </em>
  ):
 </p>
 <ol>
  <li>
   <b>
    Foreground process
   </b>
   <p>
    A process that is required for what the user is currently doing.  A
      process is considered to be in the foreground if any of the following conditions are true:
   </p>
   <ul>
    <li>
     It hosts an
     <code>
      <a href="/reference/android/app/Activity.html">
       Activity
      </a>
     </code>
     that the user is interacting with (the
     <code>
      <a href="/reference/android/app/Activity.html">
       Activity
      </a>
     </code>
     's
     <code>
      <a href="/reference/android/app/Activity.html#onResume()">
       onResume()
      </a>
     </code>
     method has been
called).
    </li>
    <li>
     It hosts a
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
     that's bound to the activity that the user is
interacting with.
    </li>
    <li>
     It hosts a
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
     that's running "in the foreground"&mdash;the
service has called
     <code>
      <a href="/reference/android/app/Service.html#startForeground(int, android.app.Notification)">
       startForeground()
      </a>
     </code>
     .
    </li>
    <li>
     It hosts a
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
     that's executing one of its lifecycle
callbacks (
     <code>
      <a href="/reference/android/app/Service.html#onCreate()">
       onCreate()
      </a>
     </code>
     ,
     <code>
      <a href="/reference/android/app/Service.html#onStart(android.content.Intent, int)">
       onStart()
      </a>
     </code>
     , or
     <code>
      <a href="/reference/android/app/Service.html#onDestroy()">
       onDestroy()
      </a>
     </code>
     ).
    </li>
    <li>
     It hosts a
     <code>
      <a href="/reference/android/content/BroadcastReceiver.html">
       BroadcastReceiver
      </a>
     </code>
     that's executing its
     <code>
      <a href="/reference/android/content/BroadcastReceiver.html#onReceive(android.content.Context, android.content.Intent)">
       onReceive()
      </a>
     </code>
     method.
    </li>
   </ul>
   <p>
    Generally, only a few foreground processes exist at any given time.  They are killed only as
a last resort&mdash;if memory is so low that they cannot all continue to run.  Generally, at that
point, the device has reached a memory paging state, so killing some foreground processes is
required to keep the user interface responsive.
   </p>
  </li>
  <li>
   <b>
    Visible process
   </b>
   <p>
    A process that doesn't have any foreground components, but still can
      affect what the user sees on screen. A process is considered to be visible if either of the
      following conditions are true:
   </p>
   <ul>
    <li>
     It hosts an
     <code>
      <a href="/reference/android/app/Activity.html">
       Activity
      </a>
     </code>
     that is not in the foreground, but is still
visible to the user (its
     <code>
      <a href="/reference/android/app/Activity.html#onPause()">
       onPause()
      </a>
     </code>
     method has been called). 
This might occur, for example, if the foreground activity started a dialog, which allows the
previous activity to be seen behind it.
    </li>
    <li>
     It hosts a
     <code>
      <a href="/reference/android/app/Service.html">
       Service
      </a>
     </code>
     that's bound to a visible (or foreground)
activity.
    </li>
   </ul>
   <p>
    A visible process is considered extremely important and will not be killed unless doing so
is required to keep all foreground processes running.
   </p>
  </li>
  <li>
   <b>
    Service process
   </b>
   <p>
    A process that is running a service that has been started with the
    <code>
     <a href="/reference/android/content/Context.html#startService(android.content.Intent)">
      startService()
     </a>
    </code>
    method and does not fall into either of the two
higher categories. Although service processes are not directly tied to anything the user sees, they
are generally doing things that the user cares about (such as playing music in the background or
downloading  data on the network), so the system keeps them running unless there's not enough memory
to retain them along with all foreground and visible processes.
   </p>
  </li>
  <li>
   <b>
    Background process
   </b>
   <p>
    A process holding an activity that's not currently visible to the user  (the activity's
    <code>
     <a href="/reference/android/app/Activity.html#onStop()">
      onStop()
     </a>
    </code>
    method has been called). These processes have no direct
impact on the user experience, and the system can kill them at any time to reclaim memory for a
foreground,
visible, or service process. Usually there are many background processes running, so they are kept
in an LRU (least recently used) list to ensure that the process with the activity that was most
recently seen by the user is the last to be killed. If an activity implements its lifecycle methods
correctly, and saves its current state, killing its process will not have a visible effect on
the user experience, because when the user navigates back to the activity, the activity restores
all of its visible state. See the
    <a href="/guide/components/activities.html#SavingActivityState">
     Activities
    </a>
    document for information about saving and restoring state.
   </p>
  </li>
  <li>
   <b>
    Empty process
   </b>
   <p>
    A process that doesn't hold any active application components.  The only reason to keep this
kind of process alive is for caching purposes, to improve startup time the next time a component
needs to run in it.  The system often kills these processes in order to balance overall system
resources between process caches and the underlying kernel caches.
   </p>
  </li>
 </ol>
 <p>
  Android ranks a process at the highest level it can, based upon the importance of the
components currently active in the process.  For example, if a process hosts a service and a visible
activity, the process is ranked as a visible process, not a service process.
 </p>
 <p>
  In addition, a process's ranking might be increased because other processes are dependent on
it&mdash;a process that is serving another process can never be ranked lower than the process it is
serving. For example, if a content provider in process A is serving a client in process B, or if a
service in process A is bound to a component in process B, process A is always considered at least
as important as process B.
 </p>
 <p>
  Because a process running a service is ranked higher than a process with background activities,
an activity that initiates a long-running operation might do well to start a
  <a href="/guide/components/services.html">
   service
  </a>
  for that operation, rather than
simply create a worker thread&mdash;particularly if the operation will likely outlast the activity.
For example, an activity that's uploading a picture to a web site should start a service to perform
the upload so that the upload can continue in the background even if the user leaves the activity.
Using a service guarantees that the operation will have at least "service process" priority,
regardless of what happens to the activity. This is the same reason that broadcast receivers should
employ services rather than simply put time-consuming operations in a thread.
 </p>
 <h2 id="Threads">
  Threads
 </h2>
 <p>
  When an application is launched, the system creates a thread of execution for the application,
called "main." This thread is very important because it is in charge of dispatching events to
the appropriate user interface widgets, including drawing events. It is also the thread in which
your application interacts with components from the Android UI toolkit (components from the
  <code>
   <a href="/reference/android/widget/package-summary.html">
    android.widget
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/view/package-summary.html">
    android.view
   </a>
  </code>
  packages). As such, the main thread is also sometimes
called the UI thread.
 </p>
 <p>
  The system does
  <em>
   not
  </em>
  create a separate thread for each instance of a component. All
components that run in the same process are instantiated in the UI thread, and system calls to
each component are dispatched from that thread. Consequently, methods that respond to system
callbacks (such as
  <code>
   <a href="/reference/android/view/View.html#onKeyDown(int, android.view.KeyEvent)">
    onKeyDown()
   </a>
  </code>
  to report user actions
or a lifecycle callback method) always run in the UI thread of the process.
 </p>
 <p>
  For instance, when the user touches a button on the screen, your app's UI thread dispatches the
touch event to the widget, which in turn sets its pressed state and posts an invalidate request to
the event queue. The UI thread dequeues the request and notifies the widget that it should redraw
itself.
 </p>
 <p>
  When your app performs intensive work in response to user interaction, this single thread model
can yield poor performance unless you implement your application properly. Specifically, if
everything is happening in the UI thread, performing long operations such as network access or
database queries will block the whole UI. When the thread is blocked, no events can be dispatched,
including drawing events. From the user's perspective, the
application appears to hang. Even worse, if the UI thread is blocked for more than a few seconds
(about 5 seconds currently) the user is presented with the infamous "
  <a href="http://developer.android.com/guide/practices/responsiveness.html">
   application not
responding
  </a>
  " (ANR) dialog. The user might then decide to quit your application and uninstall it
if they are unhappy.
 </p>
 <p>
  Additionally, the Andoid UI toolkit is
  <em>
   not
  </em>
  thread-safe. So, you must not manipulate
your UI from a worker thread&mdash;you must do all manipulation to your user interface from the UI
thread. Thus, there are simply two rules to Android's single thread model:
 </p>
 <ol>
  <li>
   Do not block the UI thread
  </li>
  <li>
   Do not access the Android UI toolkit from outside the UI thread
  </li>
 </ol>
 <h3 id="WorkerThreads">
  Worker threads
 </h3>
 <p>
  Because of the single thread model described above, it's vital to the responsiveness of your
application's UI that you do not block the UI thread. If you have operations to perform
that are not instantaneous, you should make sure to do them in separate threads ("background" or
"worker" threads).
 </p>
 <p>
  For example, below is some code for a click listener that downloads an image from a separate
thread and displays it in an
  <code>
   <a href="/reference/android/widget/ImageView.html">
    ImageView
   </a>
  </code>
  :
 </p>
 <pre>
public void onClick(View v) {
    new Thread(new Runnable() {
        public void run() {
            Bitmap b = loadImageFromNetwork("http://example.com/image.png");
            mImageView.setImageBitmap(b);
        }
    }).start();
}
</pre>
 <p>
  At first, this seems to work fine, because it creates a new thread to handle the network
operation. However, it violates the second rule of the single-threaded model:
  <em>
   do not access the
Android UI toolkit from outside the UI thread
  </em>
  &mdash;this sample modifies the
  <code>
   <a href="/reference/android/widget/ImageView.html">
    ImageView
   </a>
  </code>
  from the worker thread instead of the UI thread. This can result in
undefined and unexpected behavior, which can be difficult and time-consuming to track down.
 </p>
 <p>
  To fix this problem, Android offers several ways to access the UI thread from other
threads. Here is a list of methods that can help:
 </p>
 <ul>
  <li>
   <code>
    <a href="/reference/android/app/Activity.html#runOnUiThread(java.lang.Runnable)">
     Activity.runOnUiThread(Runnable)
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/view/View.html#post(java.lang.Runnable)">
     View.post(Runnable)
    </a>
   </code>
  </li>
  <li>
   <code>
    <a href="/reference/android/view/View.html#postDelayed(java.lang.Runnable, long)">
     View.postDelayed(Runnable,
long)
    </a>
   </code>
  </li>
 </ul>
 <p>
  For example, you can fix the above code by using the
  <code>
   <a href="/reference/android/view/View.html#post(java.lang.Runnable)">
    View.post(Runnable)
   </a>
  </code>
  method:
 </p>
 <pre>
public void onClick(View v) {
    new Thread(new Runnable() {
        public void run() {
            final Bitmap bitmap =
                    loadImageFromNetwork("http://example.com/image.png");
            mImageView.post(new Runnable() {
                public void run() {
                    mImageView.setImageBitmap(bitmap);
                }
            });
        }
    }).start();
}
</pre>
 <p>
  Now this implementation is thread-safe: the network operation is done from a separate thread
while the
  <code>
   <a href="/reference/android/widget/ImageView.html">
    ImageView
   </a>
  </code>
  is manipulated from the UI thread.
 </p>
 <p>
  However, as the complexity of the operation grows, this kind of code can get complicated and
difficult to maintain. To handle more complex interactions with a worker thread, you might consider
using a
  <code>
   <a href="/reference/android/os/Handler.html">
    Handler
   </a>
  </code>
  in your worker thread, to process messages delivered from the UI
thread. Perhaps the best solution, though, is to extend the
  <code>
   <a href="/reference/android/os/AsyncTask.html">
    AsyncTask
   </a>
  </code>
  class,
which simplifies the execution of worker thread tasks that need to interact with the UI.
 </p>
 <h4 id="AsyncTask">
  Using AsyncTask
 </h4>
 <p>
  <code>
   <a href="/reference/android/os/AsyncTask.html">
    AsyncTask
   </a>
  </code>
  allows you to perform asynchronous work on your user
interface. It performs the blocking operations in a worker thread and then publishes the results on
the UI thread, without requiring you to handle threads and/or handlers yourself.
 </p>
 <p>
  To use it, you must subclass
  <code>
   <a href="/reference/android/os/AsyncTask.html">
    AsyncTask
   </a>
  </code>
  and implement the
  <code>
   <a href="/reference/android/os/AsyncTask.html#doInBackground(Params...)">
    doInBackground()
   </a>
  </code>
  callback method, which runs in a pool of
background threads. To update your UI, you should implement
  <code>
   <a href="/reference/android/os/AsyncTask.html#onPostExecute(Result)">
    onPostExecute()
   </a>
  </code>
  , which delivers the result from
  <code>
   <a href="/reference/android/os/AsyncTask.html#doInBackground(Params...)">
    doInBackground()
   </a>
  </code>
  and runs in the UI thread, so you can safely
update your UI. You can then run the task by calling
  <code>
   <a href="/reference/android/os/AsyncTask.html#execute(Params...)">
    execute()
   </a>
  </code>
  from the UI thread.
 </p>
 <p>
  For example, you can implement the previous example using
  <code>
   <a href="/reference/android/os/AsyncTask.html">
    AsyncTask
   </a>
  </code>
  this
way:
 </p>
 <pre>
public void onClick(View v) {
    new DownloadImageTask().execute("http://example.com/image.png");
}

private class DownloadImageTask extends AsyncTask&lt;String, Void, Bitmap&gt; {
    /** The system calls this to perform work in a worker thread and
      * delivers it the parameters given to AsyncTask.execute() */
    protected Bitmap doInBackground(String... urls) {
        return loadImageFromNetwork(urls[0]);
    }

    /** The system calls this to perform work in the UI thread and delivers
      * the result from doInBackground() */
    protected void onPostExecute(Bitmap result) {
        mImageView.setImageBitmap(result);
    }
}
</pre>
 <p>
  Now the UI is safe and the code is simpler, because it separates the work into the
part that should be done on a worker thread and the part that should be done on the UI thread.
 </p>
 <p>
  You should read the
  <code>
   <a href="/reference/android/os/AsyncTask.html">
    AsyncTask
   </a>
  </code>
  reference for a full understanding on
how to use this class, but here is a quick overview of how it works:
 </p>
 <ul>
  <li>
   You can specify the type of the parameters, the progress values, and the final
value of the task, using generics
  </li>
  <li>
   The method
   <code>
    <a href="/reference/android/os/AsyncTask.html#doInBackground(Params...)">
     doInBackground()
    </a>
   </code>
   executes automatically
on a worker thread
  </li>
  <li>
   <code>
    <a href="/reference/android/os/AsyncTask.html#onPreExecute()">
     onPreExecute()
    </a>
   </code>
   ,
   <code>
    <a href="/reference/android/os/AsyncTask.html#onPostExecute(Result)">
     onPostExecute()
    </a>
   </code>
   , and
   <code>
    <a href="/reference/android/os/AsyncTask.html#onProgressUpdate(Progress...)">
     onProgressUpdate()
    </a>
   </code>
   are all invoked on the UI thread
  </li>
  <li>
   The value returned by
   <code>
    <a href="/reference/android/os/AsyncTask.html#doInBackground(Params...)">
     doInBackground()
    </a>
   </code>
   is sent to
   <code>
    <a href="/reference/android/os/AsyncTask.html#onPostExecute(Result)">
     onPostExecute()
    </a>
   </code>
  </li>
  <li>
   You can call
   <code>
    <a href="/reference/android/os/AsyncTask.html#publishProgress(Progress...)">
     publishProgress()
    </a>
   </code>
   at anytime in
   <code>
    <a href="/reference/android/os/AsyncTask.html#doInBackground(Params...)">
     doInBackground()
    </a>
   </code>
   to execute
   <code>
    <a href="/reference/android/os/AsyncTask.html#onProgressUpdate(Progress...)">
     onProgressUpdate()
    </a>
   </code>
   on the UI thread
  </li>
  <li>
   You can cancel the task at any time, from any thread
  </li>
 </ul>
 <p class="caution">
  <strong>
   Caution:
  </strong>
  Another problem you might encounter when using a worker
thread is unexpected restarts in your activity due to a
  <a href="/guide/topics/resources/runtime-changes.html">
   runtime configuration change
  </a>
  (such as when the user changes the screen orientation), which may destroy your worker thread. To
see how you can persist your task during one of these restarts and how to properly cancel the task
when the activity is destroyed, see the source code for the
  <a href="http://code.google.com/p/shelves/">
   Shelves
  </a>
  sample application.
 </p>
 <h3 id="ThreadSafe">
  Thread-safe methods
 </h3>
 <p>
  In some situations, the methods you implement might be called from more than one thread, and
therefore must be written to be thread-safe.
 </p>
 <p>
  This is primarily true for methods that can be called remotely&mdash;such as methods in a
  <a href="/guide/components/bound-services.html">
   bound service
  </a>
  . When a call on a
method implemented in an
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  originates in the same process in which the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  is running, the method is executed in the caller's thread.
However, when the call originates in another process, the method is executed in a thread chosen from
a pool of threads that the system maintains in the same process as the
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  (it's not executed in the UI thread of the process).  For example, whereas a service's
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  method would be called from the UI thread of the
service's process, methods implemented in the object that
  <code>
   <a href="/reference/android/app/Service.html#onBind(android.content.Intent)">
    onBind()
   </a>
  </code>
  returns (for example, a subclass that implements RPC methods) would be called from threads
in the pool. Because a service can have more than one client, more than one pool thread can engage
the same
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  method at the same time.
  <code>
   <a href="/reference/android/os/IBinder.html">
    IBinder
   </a>
  </code>
  methods must, therefore, be implemented to be thread-safe.
 </p>
 <p>
  Similarly, a content provider can receive data requests that originate in other processes.
Although the
  <code>
   <a href="/reference/android/content/ContentResolver.html">
    ContentResolver
   </a>
  </code>
  and
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  classes hide the details of how the interprocess communication is managed,
  <code>
   <a href="/reference/android/content/ContentProvider.html">
    ContentProvider
   </a>
  </code>
  methods that respond to those requests&mdash;the methods
  <code>
   <a href="/reference/android/content/ContentProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">
    query()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/content/ContentProvider.html#insert(android.net.Uri, android.content.ContentValues)">
    insert()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/content/ContentProvider.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">
    delete()
   </a>
  </code>
  ,
  <code>
   <a href="/reference/android/content/ContentProvider.html#update(android.net.Uri, android.content.ContentValues, java.lang.String, java.lang.String[])">
    update()
   </a>
  </code>
  , and
  <code>
   <a href="/reference/android/content/ContentProvider.html#getType(android.net.Uri)">
    getType()
   </a>
  </code>
  &mdash;are called from a pool of threads in the content provider's process, not the UI
thread for the process.  Because these methods might be called from any number of threads at the
same time, they too must be implemented to be thread-safe.
 </p>
 <h2 id="IPC">
  Interprocess Communication
 </h2>
 <p>
  Android offers a mechanism for interprocess communication (IPC) using remote procedure calls
(RPCs), in which a method is called by an activity or other application component, but executed
remotely (in another process), with any result returned back to the
caller. This entails decomposing a method call and its data to a level the operating system can
understand, transmitting it from the local process and address space to the remote process and
address space, then reassembling and reenacting the call there.  Return values are then
transmitted in the opposite direction.  Android provides all the code to perform these IPC
transactions, so you can focus on defining and implementing the RPC programming interface.
 </p>
 <p>
  To perform IPC, your application must bind to a service, using
  <code>
   <a href="/reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">
    bindService()
   </a>
  </code>
  . For more information, see the
  <a href="/guide/components/services.html">
   Services
  </a>
  developer guide.
 </p>
 <!--
<h2>Beginner's Path</h2>

<p>For information about how to perform work in the background for an indefinite period of time
(without a user interface), continue with the <b><a
href="/guide/components/services.html">Services</a></b> document.</p>
-->
</div>
